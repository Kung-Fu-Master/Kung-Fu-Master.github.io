<!-- build time:Fri Jul 09 2021 17:41:50 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Hexo" href="https://kung-fu-master.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Hexo" href="https://kung-fu-master.github.io/atom.xml"><link rel="alternate" type="application/json" title="Hexo" href="https://kung-fu-master.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="istio"><link rel="canonical" href="https://kung-fu-master.github.io/2021/07/09/microService/istio/istio-benchmark/"><title>istio benchmark performance test - istio - microService | Kung Fu Master = Hexo</title><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">istio benchmark performance test</h1><div class="meta"><span class="item" title="创建时间：2021-07-09 17:09:03"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-07-09T17:09:03+08:00">2021-07-09</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>12k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>11 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Kung Fu Master</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipevgoki5j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipexe4oykj20zk0m87ji.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclhtuo6nj20zk0m8ttm.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclj9410cj20zk0m8h12.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclj61ylzj20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giph47e9vtj20zk0m8x6l.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/microService/" itemprop="item" rel="index" title="分类于 microService"><span itemprop="name">microService</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/microService/istio/" itemprop="item" rel="index" title="分类于 istio"><span itemprop="name">istio</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://kung-fu-master.github.io/2021/07/09/microService/istio/istio-benchmark/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Kung-Fu-Master"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><div class="body md" itemprop="articleBody"><p>Reference Link: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2lzdGlvL3Rvb2xzL3RyZWUvbWFzdGVyL3BlcmYvYmVuY2htYXJr">https://github.com/istio/tools/tree/master/perf/benchmark</span></p><h2 id="prerequisites"><a class="anchor" href="#prerequisites">#</a> Prerequisites</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ helm version</pre></td></tr><tr><td data-num="2"></td><td><pre>  version.BuildInfo<span class="token punctuation">&#123;</span>Version:<span class="token string">"v3.3.1"</span>, GitCommit:<span class="token string">"249e5215cde0c3fa72e27eb7a30e8d55c9696144"</span>, GitTreeState:<span class="token string">"clean"</span>, GoVersion:<span class="token string">"go1.14.7"</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="下载"><a class="anchor" href="#下载">#</a> 下载</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">git</span> clone https://github.com/istio/tools.git</pre></td></tr><tr><td data-num="2"></td><td><pre>$ <span class="token builtin class-name">cd</span> tools/perf/benchmark</pre></td></tr></table></figure><h2 id="部署"><a class="anchor" href="#部署">#</a> 部署</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">unset</span> http_proxy</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">unset</span> https_proxy</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">NAMESPACE</span><span class="token operator">=</span>twopods-istio</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">INTERCEPTION_MODE</span><span class="token operator">=</span>REDIRECT</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">ISTIO_INJECT</span><span class="token operator">=</span>true</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">LOAD_GEN_TYPE</span><span class="token operator">=</span>fortio</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">(</span>optional<span class="token punctuation">)</span>export <span class="token assign-left variable">LOAD_GEN_TYPE</span><span class="token operator">=</span>nighthawk</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">DNS_DOMAIN</span><span class="token operator">=</span>v104.qualistio.org</pre></td></tr><tr><td data-num="9"></td><td><pre>./setup_test.sh</pre></td></tr></table></figure><h2 id="创建pipenv环境"><a class="anchor" href="#创建pipenv环境">#</a> 创建 pipenv 环境</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token builtin class-name">cd</span> perf/benchmark</pre></td></tr><tr><td data-num="2"></td><td><pre>$ pipenv --three</pre></td></tr><tr><td data-num="3"></td><td><pre>$ pipenv shell</pre></td></tr><tr><td data-num="4"></td><td><pre>$ pipenv <span class="token function">install</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>// 如果遇到执行下面runner/runner.py脚本操作报找不到import包问题，需要再运行如下命令</pre></td></tr><tr><td data-num="7"></td><td><pre>$ python3 -m pip <span class="token function">install</span> pandas matplotlib pyyaml requests</pre></td></tr></table></figure><h2 id="测试"><a class="anchor" href="#测试">#</a> 测试</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>// Obtained the performance <span class="token builtin class-name">test</span> at the 90th percentiles <span class="token keyword">for</span> an increasing number of concurrent connections<span class="token punctuation">(</span><span class="token number">2,4</span>,8,16,32,64<span class="token punctuation">)</span> and with a <span class="token number">1</span> kB payload at <span class="token number">1000</span> requests per second<span class="token punctuation">(</span>RPS<span class="token punctuation">)</span>.</pre></td></tr><tr><td data-num="2"></td><td><pre>$ python runner/runner.py --conn <span class="token number">2,4</span>,8,16,32,64 --qps <span class="token number">1000</span> --duration <span class="token number">180</span> --baseline --load_gen_type<span class="token operator">=</span>fortio --telemetry_mode<span class="token operator">=</span>none</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">(</span>optional<span class="token punctuation">)</span>$ python runner/runner.py --conn <span class="token number">2,4</span>,8,16,32,64 --qps <span class="token number">1000</span> --duration <span class="token number">180</span> --baseline --load_gen_type<span class="token operator">=</span>nighthawk --telemetry_mode<span class="token operator">=</span>none</pre></td></tr></table></figure><h2 id="生成-csv-文件"><a class="anchor" href="#生成-csv-文件">#</a> 生成 csv 文件</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ kubectl get svc -n twopods-istio</pre></td></tr><tr><td data-num="2"></td><td><pre>  NAME           TYPE           CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                                                                                                    AGE</pre></td></tr><tr><td data-num="3"></td><td><pre>  fortioclient   LoadBalancer   <span class="token number">10.100</span>.26.23    <span class="token operator">&lt;</span>pending<span class="token operator">></span>     <span class="token number">8080</span>:30476/TCP,8079:31699/TCP,8078:31654/TCP,8077:30330/TCP,8076:32679/TCP,9999:30027/TCP,9076:32267/TCP   42m</pre></td></tr><tr><td data-num="4"></td><td><pre>  fortioserver   ClusterIP      <span class="token number">10.102</span>.28.144   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">8080</span>/TCP,8079/TCP,8078/TCP,8077/TCP,8076/TCP,9999/TCP,9076/TCP</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">FORTIO_CLIENT_URL</span><span class="token operator">=</span>http://localhost:32267</pre></td></tr><tr><td data-num="7"></td><td><pre>$ python ./runner/fortio.py <span class="token variable">$FORTIO_CLIENT_URL</span> --csv StartTime,ActualDuration,Labels,NumThreads,ActualQPS,p50,p90,p99,p999</pre></td></tr></table></figure><h2 id="修改graph_plotterpy脚本"><a class="anchor" href="#修改graph_plotterpy脚本">#</a> 修改 graph_plotter.py 脚本</h2><h3 id="第一处修改"><a class="anchor" href="#第一处修改">#</a> 第一处修改:</h3><figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ vim graph_plotter<span class="token operator">/</span>graph_plotter<span class="token punctuation">.</span>py</pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token number">44</span>     plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span>get_x_label<span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token number">45</span>     plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span>get_y_label<span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token number">46</span>     plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token number">47</span>     plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token number">48</span>     plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Istio P90, 1000RPS, 180 seconds"</span><span class="token punctuation">)</span> <span class="token comment"># 添加标题</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token number">49</span>     plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>args<span class="token punctuation">.</span>graph_title<span class="token punctuation">,</span> dpi<span class="token operator">=</span>dpi<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token number">50</span>     plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="第二处修改"><a class="anchor" href="#第二处修改">#</a> 第二处修改:</h3><figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> get_data_helper<span class="token punctuation">(</span>df<span class="token punctuation">,</span> query_list<span class="token punctuation">,</span> query_str<span class="token punctuation">,</span> telemetry_mode<span class="token punctuation">,</span> metric_name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    y_series_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">for</span> ql <span class="token keyword">in</span> query_list<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment"># 添加如下一行代码</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        query_str <span class="token operator">=</span> <span class="token string">"ActualQPS==1000 and NumThreads==&#123;ql&#125; and Labels.str.endswith('&#123;telemetry_mode&#125;')"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ql<span class="token operator">=</span>ql<span class="token punctuation">,</span> telemetry_mode<span class="token operator">=</span>telemetry_mode<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        data <span class="token operator">=</span> df<span class="token punctuation">.</span>query<span class="token punctuation">(</span>query_str<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment"># print(data)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            data<span class="token punctuation">[</span>metric_name<span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>empty</pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">except</span> KeyError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            y_series_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">[</span>metric_name<span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>empty<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token keyword">if</span> metric_name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> metric_name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'mem'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                    y_series_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span>metric_name<span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                    y_series_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span>metric_name<span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                y_series_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">return</span> y_series_data</pre></td></tr></table></figure><h2 id="画图"><a class="anchor" href="#画图">#</a> 画图</h2><p><img data-src="baseline(CNI)_perf_with_istio_benchmark.png" alt=""><br><img data-src="both(CNI)_perf_with_istio_benchmark.png" alt=""></p><p>Obtained the performance test at the 90th percentiles for an increasing number of concurrent connections(2,4,8,16,32,64) and with a 1 kB payload at 1000 requests per second.</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ python3 ./graph_plotter/graph_plotter.py --graph_type<span class="token operator">=</span>latency-p90 --x_axis<span class="token operator">=</span>conn --telemetry_modes<span class="token operator">=</span>none_baseline,none_both --query_list<span class="token operator">=</span><span class="token number">2,4</span>,8,16,32,64 --query_str<span class="token operator">=</span>ActualQPS<span class="token operator">==</span><span class="token number">1000</span> --csv_filepath<span class="token operator">=</span>/tmp/tmptqdbk703.csv --graph_title<span class="token operator">=</span>./weave_plotter_output.png </pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>$ python3 ./graph_plotter/graph_plotter.py --graph_type<span class="token operator">=</span>latency-p90 --x_axis<span class="token operator">=</span>conn --telemetry_modes<span class="token operator">=</span>none_baseline,none_both --query_list<span class="token operator">=</span><span class="token number">2,4</span>,8,16,32,64 --query_str<span class="token operator">=</span>ActualQPS<span class="token operator">==</span><span class="token number">1000</span> --csv_filepath<span class="token operator">=</span>/tmp/tmp7giam_5i.csv --graph_title<span class="token operator">=</span>./calico_plotter_output.png</pre></td></tr></table></figure><h2 id="卸载"><a class="anchor" href="#卸载">#</a> 卸载</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ kubectl delete -f tmp/twopods-istio.yaml -n twopods-istio</pre></td></tr><tr><td data-num="2"></td><td><pre>$ kubectl delete ns twopods-istio</pre></td></tr></table></figure><h2 id="optionalprometheus"><a class="anchor" href="#optionalprometheus">#</a> (Optional)Prometheus</h2><p>在 istio istio-1.8.1/samples/addons 目录新建了如下 yaml 文件把 prometheus 的端口映射到 host 主机.</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">cat</span> prometheus-NodePort.yaml</pre></td></tr><tr><td data-num="2"></td><td><pre>  apiVersion: v1</pre></td></tr><tr><td data-num="3"></td><td><pre>  kind: Service</pre></td></tr><tr><td data-num="4"></td><td><pre>  metadata:</pre></td></tr><tr><td data-num="5"></td><td><pre>    labels:</pre></td></tr><tr><td data-num="6"></td><td><pre>      component: <span class="token string">"server"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      app: prometheus</pre></td></tr><tr><td data-num="8"></td><td><pre>      release: prometheus</pre></td></tr><tr><td data-num="9"></td><td><pre>      chart: prometheus-11.16.2</pre></td></tr><tr><td data-num="10"></td><td><pre>      heritage: Helm</pre></td></tr><tr><td data-num="11"></td><td><pre>    name: prometheus-nodeport</pre></td></tr><tr><td data-num="12"></td><td><pre>    namespace: istio-system</pre></td></tr><tr><td data-num="13"></td><td><pre>  spec:</pre></td></tr><tr><td data-num="14"></td><td><pre>    ports:</pre></td></tr><tr><td data-num="15"></td><td><pre>      - name: http</pre></td></tr><tr><td data-num="16"></td><td><pre>        port: <span class="token number">9090</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        protocol: TCP</pre></td></tr><tr><td data-num="18"></td><td><pre>        targetPort: <span class="token number">9090</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    selector:</pre></td></tr><tr><td data-num="20"></td><td><pre>      component: <span class="token string">"server"</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      app: prometheus</pre></td></tr><tr><td data-num="22"></td><td><pre>      release: prometheus</pre></td></tr><tr><td data-num="23"></td><td><pre>    sessionAffinity: None</pre></td></tr><tr><td data-num="24"></td><td><pre>    type: <span class="token string">"NodePort"</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>$ kubectl apply -f prometheus-NodePort.yaml</pre></td></tr></table></figure><h2 id="csv转markdown脚本"><a class="anchor" href="#csv转markdown脚本">#</a> csv 转 markdown 脚本</h2><p><strong>cat all-results.csv</strong></p><pre><code>StartTime,ActualDuration,Labels,NumThreads,ActualQPS,p50,p90,p99,p999
2021-07-08T03:00:32.123633281Z,180,e379485c_qps_1000_c_2_1024_none_baseline,2,1000,633,927,994,1630
2021-07-08T03:03:32.552909916Z,180,e379485c_qps_1000_c_2_1024_none_both,2,1000,1535,1980,2894,3493
2021-07-08T03:06:33.127271331Z,180,e379485c_qps_1000_c_4_1024_none_baseline,4,1000,629,929,996,1893
2021-07-08T03:09:33.547611543Z,180,e379485c_qps_1000_c_4_1024_none_both,4,1000,1888,2793,2995,4715
2021-07-08T03:12:33.953340272Z,180,e379485c_qps_1000_c_8_1024_none_baseline,8,1000,665,942,1416,1998
2021-07-08T03:15:34.39170438Z,180,e379485c_qps_1000_c_8_1024_none_both,8,1000,3081,3827,3995,6173
2021-07-08T03:18:35.020425077Z,180,e379485c_qps_1000_c_16_1024_none_baseline,16,1000,1321,1870,1994,2871
2021-07-08T03:21:35.488938053Z,180,e379485c_qps_1000_c_16_1024_none_both,16,1000,5214,6386,6991,8800
2021-07-08T03:24:35.893324186Z,180,e379485c_qps_1000_c_32_1024_none_baseline,32,1000,1581,2448,3643,4181
2021-07-08T03:27:36.366429299Z,180,e379485c_qps_1000_c_32_1024_none_both,32,1000,9014,10532,11971,14664
2021-07-08T03:30:37.054477154Z,179,e379485c_qps_1000_c_64_1024_none_baseline,64,1000,2561,3895,5633,8073
2021-07-08T03:33:37.591317915Z,179,e379485c_qps_1000_c_64_1024_none_both,64,1000,16425,18346,21529,24656
2021-07-08T10:22:59.650647926Z,180,47e02b90_qps_1000_c_2_1024_none_baseline,2,1000,619,925,994,1685
2021-07-08T10:26:00.023923405Z,180,47e02b90_qps_1000_c_2_1024_none_both,2,1000,1544,2085,2922,3569
2021-07-08T10:29:00.5336073Z,180,47e02b90_qps_1000_c_4_1024_none_baseline,4,1000,641,931,997,1899
2021-07-08T10:32:00.926507967Z,180,47e02b90_qps_1000_c_4_1024_none_both,4,1000,1884,2798,3103,4726
2021-07-08T10:35:01.281884063Z,180,47e02b90_qps_1000_c_8_1024_none_baseline,8,1000,662,938,1121,2227
2021-07-08T10:38:01.659107592Z,180,47e02b90_qps_1000_c_8_1024_none_both,8,1000,4748,5754,6137,8558
2021-07-08T10:41:02.175849835Z,180,47e02b90_qps_1000_c_16_1024_none_baseline,16,1000,1283,1863,1993,2892
2021-07-08T10:44:02.568365775Z,180,47e02b90_qps_1000_c_16_1024_none_both,16,1000,5083,6026,7857,10078
2021-07-08T10:47:03.014074722Z,180,47e02b90_qps_1000_c_32_1024_none_baseline,32,1000,1594,2529,3537,4557
2021-07-08T10:50:03.455990894Z,180,47e02b90_qps_1000_c_32_1024_none_both,32,1000,12420,14040,15979,19009
2021-07-08T10:53:04.043806415Z,179,47e02b90_qps_1000_c_64_1024_none_baseline,64,1000,2771,3960,5281,7133
2021-07-08T10:56:04.516012475Z,179,47e02b90_qps_1000_c_64_1024_none_both,64,1000,18706,23763,26954,29338
</code></pre><p><strong>cat <span class="exturl" data-url="aHR0cDovL2Nzdi5weQ==">csv.py</span></strong></p><figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">to_table</span><span class="token punctuation">(</span>filename<span class="token operator">=</span><span class="token string">'all-results.csv'</span><span class="token punctuation">,</span> rept<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">'''将符号分割文本转化为markdown表格形式</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    </pre></td></tr><tr><td data-num="4"></td><td><pre>    parameter:需要转化的文件名(str),文本的分割符号(str)</pre></td></tr><tr><td data-num="5"></td><td><pre>    '''</pre></td></tr><tr><td data-num="6"></td><td><pre>    file_obj_r <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    file_obj_w <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'new'</span><span class="token operator">+</span>filename<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    count <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 哨兵，实现文件的第二行另做处理</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">for</span> line <span class="token keyword">in</span> file_obj_r<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        rec <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span>rept<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        new_rec <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> rec<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        new_rec <span class="token operator">=</span> <span class="token string">'|'</span><span class="token operator">+</span> <span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>new_rec<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">'|'</span><span class="token operator">+</span><span class="token string">'\n'</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        file_obj_w<span class="token punctuation">.</span>write<span class="token punctuation">(</span>new_rec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            head_rec <span class="token operator">=</span> <span class="token string">'|'</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token keyword">for</span> i <span class="token keyword">in</span> rec<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                head_rec <span class="token operator">+=</span> <span class="token string">'---|'</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            head_rec <span class="token operator">+=</span> <span class="token string">'\n'</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            file_obj_w<span class="token punctuation">.</span>write<span class="token punctuation">(</span>head_rec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            count <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    file_obj_r<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    file_obj_w<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre> </pre></td></tr><tr><td data-num="24"></td><td><pre> </pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">import</span> sys</pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        to_table<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">except</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        to_table<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>运行:</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>python csv.py all-results.csv</pre></td></tr></table></figure><h2 id="自己编写画图脚本"><a class="anchor" href="#自己编写画图脚本">#</a> 自己编写画图脚本</h2><h3 id="all-resultscsv"><a class="anchor" href="#all-resultscsv">#</a> all-results.csv</h3><p>cat all-results.csv</p><table><thead><tr><th>StartTime</th><th>ActualDuration</th><th>Labels</th><th>NumThreads</th><th>ActualQPS</th><th>p50</th><th>p90</th><th>p99</th><th>p999</th></tr></thead><tbody><tr><td>2021-07-08T03:00:32.123633281Z</td><td>180</td><td>e379485c_qps_1000_c_2_1024_none_baseline</td><td>2</td><td>1000</td><td>633</td><td>927</td><td>994</td><td>1630</td></tr><tr><td>2021-07-08T03:03:32.552909916Z</td><td>180</td><td>e379485c_qps_1000_c_2_1024_none_both</td><td>2</td><td>1000</td><td>1535</td><td>1980</td><td>2894</td><td>3493</td></tr><tr><td>2021-07-08T03:06:33.127271331Z</td><td>180</td><td>e379485c_qps_1000_c_4_1024_none_baseline</td><td>4</td><td>1000</td><td>629</td><td>929</td><td>996</td><td>1893</td></tr><tr><td>2021-07-08T03:09:33.547611543Z</td><td>180</td><td>e379485c_qps_1000_c_4_1024_none_both</td><td>4</td><td>1000</td><td>1888</td><td>2793</td><td>2995</td><td>4715</td></tr><tr><td>2021-07-08T03:12:33.953340272Z</td><td>180</td><td>e379485c_qps_1000_c_8_1024_none_baseline</td><td>8</td><td>1000</td><td>665</td><td>942</td><td>1416</td><td>1998</td></tr><tr><td>2021-07-08T03:15:34.39170438Z</td><td>180</td><td>e379485c_qps_1000_c_8_1024_none_both</td><td>8</td><td>1000</td><td>3081</td><td>3827</td><td>3995</td><td>6173</td></tr><tr><td>2021-07-08T03:18:35.020425077Z</td><td>180</td><td>e379485c_qps_1000_c_16_1024_none_baseline</td><td>16</td><td>1000</td><td>1321</td><td>1870</td><td>1994</td><td>2871</td></tr><tr><td>2021-07-08T03:21:35.488938053Z</td><td>180</td><td>e379485c_qps_1000_c_16_1024_none_both</td><td>16</td><td>1000</td><td>5214</td><td>6386</td><td>6991</td><td>8800</td></tr><tr><td>2021-07-08T03:24:35.893324186Z</td><td>180</td><td>e379485c_qps_1000_c_32_1024_none_baseline</td><td>32</td><td>1000</td><td>1581</td><td>2448</td><td>3643</td><td>4181</td></tr><tr><td>2021-07-08T03:27:36.366429299Z</td><td>180</td><td>e379485c_qps_1000_c_32_1024_none_both</td><td>32</td><td>1000</td><td>9014</td><td>10532</td><td>11971</td><td>14664</td></tr><tr><td>2021-07-08T03:30:37.054477154Z</td><td>179</td><td>e379485c_qps_1000_c_64_1024_none_baseline</td><td>64</td><td>1000</td><td>2561</td><td>3895</td><td>5633</td><td>8073</td></tr><tr><td>2021-07-08T03:33:37.591317915Z</td><td>179</td><td>e379485c_qps_1000_c_64_1024_none_both</td><td>64</td><td>1000</td><td>16425</td><td>18346</td><td>21529</td><td>24656</td></tr><tr><td>2021-07-08T10:22:59.650647926Z</td><td>180</td><td>47e02b90_qps_1000_c_2_1024_none_baseline</td><td>2</td><td>1000</td><td>619</td><td>925</td><td>994</td><td>1685</td></tr><tr><td>2021-07-08T10:26:00.023923405Z</td><td>180</td><td>47e02b90_qps_1000_c_2_1024_none_both</td><td>2</td><td>1000</td><td>1544</td><td>2085</td><td>2922</td><td>3569</td></tr><tr><td>2021-07-08T10:29:00.5336073Z</td><td>180</td><td>47e02b90_qps_1000_c_4_1024_none_baseline</td><td>4</td><td>1000</td><td>641</td><td>931</td><td>997</td><td>1899</td></tr><tr><td>2021-07-08T10:32:00.926507967Z</td><td>180</td><td>47e02b90_qps_1000_c_4_1024_none_both</td><td>4</td><td>1000</td><td>1884</td><td>2798</td><td>3103</td><td>4726</td></tr><tr><td>2021-07-08T10:35:01.281884063Z</td><td>180</td><td>47e02b90_qps_1000_c_8_1024_none_baseline</td><td>8</td><td>1000</td><td>662</td><td>938</td><td>1121</td><td>2227</td></tr><tr><td>2021-07-08T10:38:01.659107592Z</td><td>180</td><td>47e02b90_qps_1000_c_8_1024_none_both</td><td>8</td><td>1000</td><td>4748</td><td>5754</td><td>6137</td><td>8558</td></tr><tr><td>2021-07-08T10:41:02.175849835Z</td><td>180</td><td>47e02b90_qps_1000_c_16_1024_none_baseline</td><td>16</td><td>1000</td><td>1283</td><td>1863</td><td>1993</td><td>2892</td></tr><tr><td>2021-07-08T10:44:02.568365775Z</td><td>180</td><td>47e02b90_qps_1000_c_16_1024_none_both</td><td>16</td><td>1000</td><td>5083</td><td>6026</td><td>7857</td><td>10078</td></tr><tr><td>2021-07-08T10:47:03.014074722Z</td><td>180</td><td>47e02b90_qps_1000_c_32_1024_none_baseline</td><td>32</td><td>1000</td><td>1594</td><td>2529</td><td>3537</td><td>4557</td></tr><tr><td>2021-07-08T10:50:03.455990894Z</td><td>180</td><td>47e02b90_qps_1000_c_32_1024_none_both</td><td>32</td><td>1000</td><td>12420</td><td>14040</td><td>15979</td><td>19009</td></tr><tr><td>2021-07-08T10:53:04.043806415Z</td><td>179</td><td>47e02b90_qps_1000_c_64_1024_none_baseline</td><td>64</td><td>1000</td><td>2771</td><td>3960</td><td>5281</td><td>7133</td></tr><tr><td>2021-07-08T10:56:04.516012475Z</td><td>179</td><td>47e02b90_qps_1000_c_64_1024_none_both</td><td>64</td><td>1000</td><td>18706</td><td>23763</td><td>26954</td><td>29338</td></tr><tr></tr></tbody></table><h3 id="graph_plotterpy"><a class="anchor" href="#graph_plotterpy">#</a> graph_plotter.py</h3><h4 id="cat-graph_plotterpy"><a class="anchor" href="#cat-graph_plotterpy">#</a> cat graph_plotter.py</h4><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># python3 graph_plotter.py --telemetry_mode=baseline --query_list=2,4,8,16,32,64 --graph_type=latency-p90 --csv_filepath=./all-results.csv --cni=weave,calico --title="Istio P90, 1000RPS, 180 seconds"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">import</span> sys</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">import</span> argparse</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">import</span> pandas as pd</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">import</span> matplotlib.pyplot as plt</pre></td></tr><tr><td data-num="6"></td><td><pre>from typing <span class="token function">import</span> List</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>def get_metric_name<span class="token punctuation">(</span>args<span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">if</span> args.graph_type.startswith<span class="token punctuation">(</span><span class="token string">"latency"</span><span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token builtin class-name">return</span> args.graph_type.split<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token builtin class-name">return</span> metric_dict<span class="token punctuation">[</span>args.graph_type<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>def get_data<span class="token punctuation">(</span>df, query_list, startstr, telemetry_mode, metric_name<span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="14"></td><td><pre>    y_series_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">for</span> <span class="token for-or-select variable">ql</span> <span class="token keyword">in</span> query_list:</pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token comment"># Labels.str.contains/startwith/endswith</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        query_str <span class="token operator">=</span> <span class="token string">"ActualQPS==1000 and NumThreads==&#123;ql&#125; and Labels.str.contains('&#123;startstr&#125;') and Labels.str.endswith('&#123;telemetry_mode&#125;')"</span>.format<span class="token punctuation">(</span>ql<span class="token operator">=</span>ql, <span class="token assign-left variable">startstr</span><span class="token operator">=</span>startstr, <span class="token assign-left variable">telemetry_mode</span><span class="token operator">=</span>telemetry_mode<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        data <span class="token operator">=</span> df.query<span class="token punctuation">(</span>query_str<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        try:</pre></td></tr><tr><td data-num="20"></td><td><pre>            data<span class="token punctuation">[</span>metric_name<span class="token punctuation">]</span>.head<span class="token punctuation">(</span><span class="token punctuation">)</span>.empty</pre></td></tr><tr><td data-num="21"></td><td><pre>        except KeyError as e:</pre></td></tr><tr><td data-num="22"></td><td><pre>            y_series_data.append<span class="token punctuation">(</span>None<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        else:</pre></td></tr><tr><td data-num="24"></td><td><pre>            y_series_data.append<span class="token punctuation">(</span>data<span class="token punctuation">[</span>metric_name<span class="token punctuation">]</span>.head<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>.values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> / <span class="token number">1000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token builtin class-name">return</span> y_series_data</pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>def plotter<span class="token punctuation">(</span>args<span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token function">df</span> <span class="token operator">=</span> pd.read_csv<span class="token punctuation">(</span>args.csv_filepath<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    metric_name <span class="token operator">=</span> get_metric_name<span class="token punctuation">(</span>args<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    y_data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">for</span> <span class="token for-or-select variable">cni_mode</span> <span class="token keyword">in</span> args.cni:</pre></td></tr><tr><td data-num="33"></td><td><pre>        global startstr</pre></td></tr><tr><td data-num="34"></td><td><pre>        startstr <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">if</span> cni_mode <span class="token operator">==</span> <span class="token string">"weave"</span><span class="token builtin class-name">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            startstr <span class="token operator">=</span> <span class="token string">"e379485c"</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token keyword">if</span> cni_mode <span class="token operator">==</span> <span class="token string">"calico"</span><span class="token builtin class-name">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            startstr <span class="token operator">=</span> <span class="token string">"47e02b90"</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        y_data<span class="token punctuation">[</span>cni_mode<span class="token punctuation">]</span> <span class="token operator">=</span> get_data<span class="token punctuation">(</span>df, args.query_list, startstr, args.telemetry_mode, metric_name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>    dpi <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    plt.figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1138</span> / dpi, <span class="token number">871</span> / dpi<span class="token punctuation">)</span>, <span class="token assign-left variable">dpi</span><span class="token operator">=</span>dpi<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">for</span> key, val <span class="token keyword">in</span> y_data.items<span class="token punctuation">(</span><span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token comment"># print(key): weave / calico</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token comment"># print(val): [1.98, 2.793, 3.827, 6.386, 10.532, 18.346] / [2.085, 2.798, 5.754, 6.026, 14.04, 23.763]</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        plt.plot<span class="token punctuation">(</span>args.query_list, val, <span class="token assign-left variable">marker</span><span class="token operator">=</span><span class="token string">'o'</span>, <span class="token assign-left variable">label</span><span class="token operator">=</span>key+<span class="token string">"(CNI)_"</span> +<span class="token string">"(none_"</span>+args.telemetry_mode + <span class="token string">")_"</span>+  <span class="token string">"perf_with_istio_benchmark"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    </pre></td></tr><tr><td data-num="49"></td><td><pre>    plt.xlabel<span class="token punctuation">(</span><span class="token string">"Connections"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    plt.ylabel<span class="token punctuation">(</span><span class="token string">"Latency in milliseconds"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    plt.legend<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    plt.title<span class="token punctuation">(</span>args.title<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    plt.grid<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    plt.savefig<span class="token punctuation">(</span>args.telemetry_mode + <span class="token string">"(CNI)_perf_with_istio_benchmark.png"</span>, <span class="token assign-left variable">dpi</span><span class="token operator">=</span>dpi<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>def int_list<span class="token punctuation">(</span>lst<span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token builtin class-name">return</span> <span class="token punctuation">[</span>int<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> lst.split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>def string_list<span class="token punctuation">(</span>lst<span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token builtin class-name">return</span> <span class="token punctuation">[</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> lst.split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre>def get_parser<span class="token punctuation">(</span><span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="64"></td><td><pre>    parser <span class="token operator">=</span> argparse.ArgumentParser<span class="token punctuation">(</span><span class="token string">"Istio performance benchmark CSV file graph plotter."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    parser.add_argument<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token string">"--query_list"</span>,</pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"Specify the qps or conn range you want to plot based on the CSV file."</span></pre></td></tr><tr><td data-num="68"></td><td><pre>             <span class="token string">"For example, conn_query_list=[2, 4, 8, 16, 32, 64], qps_query_list=[10, 100, 200, 400, 800, 1000]."</span>,</pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token assign-left variable">type</span><span class="token operator">=</span>int_list</pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    parser.add_argument<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token string">"--graph_type"</span>,</pre></td></tr><tr><td data-num="73"></td><td><pre>        <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"Choose from one of them: [latency-p50, latency-p90, latency-p99, latency-p999, "</span></pre></td></tr><tr><td data-num="74"></td><td><pre>             <span class="token string">"cpu-client, cpu-server, mem-client, mem-server]."</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre>    parser.add_argument<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token string">"--telemetry_mode"</span>,</pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"This is a list of perf test labels, currently it can be any combinations from the follow supported modes:"</span></pre></td></tr><tr><td data-num="79"></td><td><pre>             <span class="token string">"[none_mtls_baseline, none_mtls_both, v2-sd-full-nullvm_both, v2-stats-nullvm_both, "</span></pre></td></tr><tr><td data-num="80"></td><td><pre>             <span class="token string">"v2-stats-wasm_both, v2-sd-nologging-nullvm_both]."</span>,</pre></td></tr><tr><td data-num="81"></td><td><pre>        <span class="token assign-left variable">type</span><span class="token operator">=</span>str</pre></td></tr><tr><td data-num="82"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="83"></td><td><pre>    parser.add_argument<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        <span class="token string">"--csv_filepath"</span>,</pre></td></tr><tr><td data-num="85"></td><td><pre>        <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"The path of the CSV file."</span></pre></td></tr><tr><td data-num="86"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="87"></td><td><pre>    parser.add_argument<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="88"></td><td><pre>        <span class="token string">"--cni"</span>,</pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"CNI type."</span>,</pre></td></tr><tr><td data-num="90"></td><td><pre>        <span class="token assign-left variable">type</span><span class="token operator">=</span>string_list</pre></td></tr><tr><td data-num="91"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="92"></td><td><pre>    parser.add_argument<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="93"></td><td><pre>        <span class="token string">"--title"</span>,</pre></td></tr><tr><td data-num="94"></td><td><pre>        <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"The graph title."</span></pre></td></tr><tr><td data-num="95"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    <span class="token builtin class-name">return</span> parser</pre></td></tr><tr><td data-num="97"></td><td><pre></pre></td></tr><tr><td data-num="98"></td><td><pre></pre></td></tr><tr><td data-num="99"></td><td><pre>def main<span class="token punctuation">(</span>argv<span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="100"></td><td><pre>    args <span class="token operator">=</span> get_parser<span class="token punctuation">(</span><span class="token punctuation">)</span>.parse_args<span class="token punctuation">(</span>argv<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="101"></td><td><pre>    <span class="token builtin class-name">return</span> plotter<span class="token punctuation">(</span>args<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token builtin class-name">:</span></pre></td></tr><tr><td data-num="104"></td><td><pre>    sys.exit<span class="token punctuation">(</span>main<span class="token punctuation">(</span>sys.argv<span class="token punctuation">[</span><span class="token number">1</span>:<span class="token punctuation">]</span><span class="token punctuation">))</span></pre></td></tr></table></figure><h3 id="运行"><a class="anchor" href="#运行">#</a> 运行</h3><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>python3 graph_plotter.py --telemetry_mode<span class="token operator">=</span>baseline --query_list<span class="token operator">=</span><span class="token number">2,4</span>,8,16,32,64 --graph_type<span class="token operator">=</span>latency-p90 --csv_filepath<span class="token operator">=</span>./all-results.csv --cni<span class="token operator">=</span>weave,calico --title<span class="token operator">=</span><span class="token string">"Istio P90, 1000RPS, 180 seconds"</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/istio/" rel="tag"><i class="ic i-tag"></i> istio</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-07-09 17:32:23" itemprop="dateModified" datetime="2021-07-09T17:32:23+08:00">2021-07-09</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Kung-Fu-Master 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Kung-Fu-Master 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Kung-Fu-Master 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Kung-Fu-Master <i class="ic i-at"><em>@</em></i>Hexo</li><li class="link"><strong>本文链接：</strong> <a href="https://kung-fu-master.github.io/2021/07/09/microService/istio/istio-benchmark/" title="istio benchmark performance test">https://kung-fu-master.github.io/2021/07/09/microService/istio/istio-benchmark/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/07/02/storage/ceph/ceph_03_tls/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclize41wj20zk0m87gk.jpg" title="Ceph 03 TLS"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> ceph</span><h3>Ceph 03 TLS</h3></a></div><div class="item right"><a href="/2021/07/09/microService/kubernetes/calico/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicitcxhpij20zk0m8hdt.jpg" title="CNI pulgin - Calico"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> kubernetes</span><h3>CNI pulgin - Calico</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#prerequisites"><span class="toc-number">1.</span> <span class="toc-text"># Prerequisites</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下载"><span class="toc-number">2.</span> <span class="toc-text"># 下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署"><span class="toc-number">3.</span> <span class="toc-text"># 部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建pipenv环境"><span class="toc-number">4.</span> <span class="toc-text"># 创建 pipenv 环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试"><span class="toc-number">5.</span> <span class="toc-text"># 测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成-csv-文件"><span class="toc-number">6.</span> <span class="toc-text"># 生成 csv 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改graph_plotterpy脚本"><span class="toc-number">7.</span> <span class="toc-text"># 修改 graph_plotter.py 脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一处修改"><span class="toc-number">7.1.</span> <span class="toc-text"># 第一处修改:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二处修改"><span class="toc-number">7.2.</span> <span class="toc-text"># 第二处修改:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#画图"><span class="toc-number">8.</span> <span class="toc-text"># 画图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#卸载"><span class="toc-number">9.</span> <span class="toc-text"># 卸载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#optionalprometheus"><span class="toc-number">10.</span> <span class="toc-text"># (Optional)Prometheus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#csv转markdown脚本"><span class="toc-number">11.</span> <span class="toc-text"># csv 转 markdown 脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自己编写画图脚本"><span class="toc-number">12.</span> <span class="toc-text"># 自己编写画图脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#all-resultscsv"><span class="toc-number">12.1.</span> <span class="toc-text"># all-results.csv</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#graph_plotterpy"><span class="toc-number">12.2.</span> <span class="toc-text"># graph_plotter.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cat-graph_plotterpy"><span class="toc-number">12.2.1.</span> <span class="toc-text"># cat graph_plotter.py</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行"><span class="toc-number">12.3.</span> <span class="toc-text"># 运行</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/03/13/microService/istio/01_istio_kubernetes%E7%BD%91%E4%B8%8A%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90/" rel="bookmark" title="istio kubernetes网上学习资源">istio kubernetes网上学习资源</a></li><li><a href="/2021/03/13/microService/istio/istio_K8s_SpringCloud/" rel="bookmark" title="Istio_K8s_SpringCloud">Istio_K8s_SpringCloud</a></li><li><a href="/2021/03/13/microService/istio/istio_problems/" rel="bookmark" title="Istio problems">Istio problems</a></li><li><a href="/2021/03/13/microService/istio/istio_%E6%9F%A5%E7%9C%8B%E5%92%8C%E5%BB%B6%E9%95%BF%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6/" rel="bookmark" title="istio 查看和延长自签名证书">istio 查看和延长自签名证书</a></li><li><a href="/2021/03/13/microService/istio/istio_%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE%E7%AD%96%E7%95%A5/" rel="bookmark" title="istio 限制访问策略">istio 限制访问策略</a></li><li><a href="/2021/03/13/microService/istio/istio_01_conception/" rel="bookmark" title="Istio 01 conception">Istio 01 conception</a></li><li><a href="/2021/03/13/microService/istio/istio_04_inject/" rel="bookmark" title="istio 04 sidecar inject">istio 04 sidecar inject</a></li><li><a href="/2021/03/13/microService/istio/istio_03_configuration_dashboard/" rel="bookmark" title="Istio 03 configuration & dashboard">Istio 03 configuration & dashboard</a></li><li><a href="/2021/03/13/microService/istio/istio_02_installation_upgrade/" rel="bookmark" title="Istio 02 Installation and upgrade">Istio 02 Installation and upgrade</a></li><li><a href="/2021/03/13/microService/istio/istio_05_virtual_service/" rel="bookmark" title="istio 05 virtual service">istio 05 virtual service</a></li><li><a href="/2021/03/13/microService/istio/istio_06_network_namespace/" rel="bookmark" title="istio 06 network namespace">istio 06 network namespace</a></li><li><a href="/2021/03/13/microService/istio/istio_secure_naming/" rel="bookmark" title="istio secure naming">istio secure naming</a></li><li><a href="/2021/03/13/microService/istio/istio_authorization/" rel="bookmark" title="istio authorization">istio authorization</a></li><li><a href="/2021/03/13/microService/istio/istio_%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E8%B6%85%E6%97%B6/" rel="bookmark" title="Istio 设置请求超时">Istio 设置请求超时</a></li><li><a href="/2021/05/31/microService/istio/istio_cert_manager/" rel="bookmark" title="istio cert-manager">istio cert-manager</a></li><li><a href="/2021/05/31/microService/istio/istio%E6%9F%A5%E7%9C%8B%E8%AF%81%E4%B9%A6/" rel="bookmark" title="Istio 查看证书">Istio 查看证书</a></li><li><a href="/2021/05/31/microService/istio/istio_dashboard/" rel="bookmark" title="istio dashboard">istio dashboard</a></li><li class="active"><a href="/2021/07/09/microService/istio/istio-benchmark/" rel="bookmark" title="istio benchmark performance test">istio benchmark performance test</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Kung-Fu-Master" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Kung-Fu-Master</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">337</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">42</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">14</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/07/02/storage/ceph/ceph_03_tls/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/07/09/microService/kubernetes/calico/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/microService/" title="分类于 microService">microService</a> <i class="ic i-angle-right"></i> <a href="/categories/microService/istio/" title="分类于 istio">istio</a></div><span><a href="/2021/07/09/microService/istio/istio-benchmark/" title="istio benchmark performance test">istio benchmark performance test</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/microService/" title="分类于 microService">microService</a> <i class="ic i-angle-right"></i> <a href="/categories/microService/istio/" title="分类于 istio">istio</a></div><span><a href="/2021/03/13/microService/istio/istio_secure_naming/" title="istio secure naming">istio secure naming</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/language/" title="分类于 language">language</a> <i class="ic i-angle-right"></i> <a href="/categories/language/c/" title="分类于 c">c</a></div><span><a href="/2021/06/16/language/c/sorting_algorithm/" title="c sort">c sort</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/blogs/" title="分类于 blogs">blogs</a> <i class="ic i-angle-right"></i> <a href="/categories/blogs/blogs/" title="分类于 blogs">blogs</a></div><span><a href="/2021/03/13/blogs/blogs/markdown%E6%94%AF%E6%8C%81%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BA%E7%9A%84%E8%AF%AD%E8%A8%80/" title="markdown支持高亮显示的语言">markdown支持高亮显示的语言</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/microService/" title="分类于 microService">microService</a> <i class="ic i-angle-right"></i> <a href="/categories/microService/istio/" title="分类于 istio">istio</a></div><span><a href="/2021/05/31/microService/istio/istio_cert_manager/" title="istio cert-manager">istio cert-manager</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/reference/" title="分类于 reference">reference</a> <i class="ic i-angle-right"></i> <a href="/categories/reference/k8s/" title="分类于 k8s">k8s</a></div><span><a href="/2021/03/13/reference/k8s/16.%E7%BC%96%E6%8E%92%E5%85%B6%E5%AE%9E%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%9A%E8%B0%88%E8%B0%88%E2%80%9C%E6%8E%A7%E5%88%B6%E5%99%A8%E2%80%9D%E6%A8%A1%E5%9E%8B/" title="16 | 编排其实很简单：谈谈“控制器”模型">16 | 编排其实很简单：谈谈“控制器”模型</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/reference/" title="分类于 reference">reference</a> <i class="ic i-angle-right"></i> <a href="/categories/reference/k8s/" title="分类于 k8s">k8s</a></div><span><a href="/2021/03/13/reference/k8s/03.%E9%A2%84%E4%B9%A0%E7%AF%87-%E5%B0%8F%E9%B2%B8%E9%B1%BC%E5%A4%A7%E4%BA%8B%E8%AE%B0(%E4%B8%89)%E7%BE%A4%E9%9B%84%E5%B9%B6%E8%B5%B7/" title="03 | 预习篇 · 小鲸鱼大事记（三）：群雄并起">03 | 预习篇 · 小鲸鱼大事记（三）：群雄并起</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/curl_wget/" title="curl &amp; wget">curl & wget</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/language/" title="分类于 language">language</a> <i class="ic i-angle-right"></i> <a href="/categories/language/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/2021/03/13/language/cpp/04_destructor/" title="04 Destructor">04 Destructor</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/06/10/linux/shrink_home_and_expand_root_space/" title="缩小home并扩充增大root和根目录空间">缩小home并扩充增大root和根目录空间</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Kung-Fu-Master @ Kung Fu Master</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.3m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">19:38</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/07/09/microService/istio/istio-benchmark/",favicon:{show:"（●´3｀●）",hide:"（●´3｀●）"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(i){return i.includes("#")},function(i){return new RegExp(LOCAL.path+"$").test(i)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->