<!-- build time:Wed Jun 02 2021 18:25:40 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Hexo" href="https://kung-fu-master.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Hexo" href="https://kung-fu-master.github.io/atom.xml"><link rel="alternate" type="application/json" title="Hexo" href="https://kung-fu-master.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="storage"><link rel="canonical" href="https://kung-fu-master.github.io/2021/05/31/technologies/security/keycloak/"><title>Deploy keycloak on kubernetes - security - technologies | Kung Fu Master = Hexo</title><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Deploy keycloak on kubernetes</h1><div class="meta"><span class="item" title="创建时间：2021-05-31 11:28:46"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-05-31T11:28:46+08:00">2021-05-31</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>11k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>10 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Kung Fu Master</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicliierfjj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclhpw3lwj20zk0m8gvw.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipexw3o58j20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giciszlczyj20zk0m816d.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclwrdwyaj20zk0m8are.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclwuom7cj20zk0m8dvn.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/technologies/" itemprop="item" rel="index" title="分类于 technologies"><span itemprop="name">technologies</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/technologies/security/" itemprop="item" rel="index" title="分类于 security"><span itemprop="name">security</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://kung-fu-master.github.io/2021/05/31/technologies/security/keycloak/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Kung-Fu-Master"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><div class="body md" itemprop="articleBody"><h2 id="prerequisites"><a class="anchor" href="#prerequisites">#</a> Prerequisites</h2><ol><li>Kubernetes 集群</li><li>需要安装 helm3+</li><li>Persistent volumes(PV) on local storage created for keycloak</li></ol><h2 id="部署步骤"><a class="anchor" href="#部署步骤">#</a> 部署步骤</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 部署 local storage</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">cat</span> <span class="token operator">></span>local-storage.yaml <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></pre></td></tr><tr><td data-num="3"></td><td><pre>apiVersion: storage.k8s.io/v1</pre></td></tr><tr><td data-num="4"></td><td><pre>kind: StorageClass</pre></td></tr><tr><td data-num="5"></td><td><pre>metadata:</pre></td></tr><tr><td data-num="6"></td><td><pre>  name: local-storage</pre></td></tr><tr><td data-num="7"></td><td><pre>provisioner: kubernetes.io/no-provisioner</pre></td></tr><tr><td data-num="8"></td><td><pre>volumeBindingMode: WaitForFirstConsumer</pre></td></tr><tr><td data-num="9"></td><td><pre>EOF</pre></td></tr><tr><td data-num="10"></td><td><pre>kubectl apply -f local-storage.yaml</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 设置 postgres password </span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">sed</span> -i <span class="token string">'s/PASSWORD/NEW_PASSWORD/'</span> values.yaml</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>kubectl create namespace dev</pre></td></tr><tr><td data-num="17"></td><td><pre>helm repo <span class="token function">add</span> codecentric https://codecentric.github.io/helm-charts</pre></td></tr><tr><td data-num="18"></td><td><pre>helm <span class="token function">install</span> my-keycloak codecentric/keycloak --values values.yaml -n dev</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>kubectl get po,svc,statefulset -l app.kubernetes.io/instance<span class="token operator">=</span>my-keycloak -n dev</pre></td></tr><tr><td data-num="21"></td><td><pre>  NAME                                  READY   STATUS    RESTARTS   AGE</pre></td></tr><tr><td data-num="22"></td><td><pre>  pod/my-keycloak-0                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          84m</pre></td></tr><tr><td data-num="23"></td><td><pre>  pod/my-keycloak-1                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          86m</pre></td></tr><tr><td data-num="24"></td><td><pre>  pod/my-keycloak-postgresql-master-0   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          86m</pre></td></tr><tr><td data-num="25"></td><td><pre>  pod/my-keycloak-postgresql-slave-0    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          86m</pre></td></tr><tr><td data-num="26"></td><td><pre>  pod/my-keycloak-postgresql-slave-1    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          86m</pre></td></tr><tr><td data-num="27"></td><td><pre>  </pre></td></tr><tr><td data-num="28"></td><td><pre>  ……</pre></td></tr><tr><td data-num="29"></td><td><pre>  NAME                                             READY   AGE</pre></td></tr><tr><td data-num="30"></td><td><pre>  statefulset.apps/my-keycloak                     <span class="token number">2</span>/2     86m</pre></td></tr><tr><td data-num="31"></td><td><pre>  statefulset.apps/my-keycloak-postgresql-master   <span class="token number">1</span>/1     86m</pre></td></tr><tr><td data-num="32"></td><td><pre>  statefulset.apps/my-keycloak-postgresql-slave    <span class="token number">2</span>/2     86m</pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>kubectl port-forward svc/my-keycloak-http <span class="token number">8080</span>:80 -n dev</pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment"># 如果本机 A 办法打开浏览器访问，可以登陆到其它有浏览器机器 B 进行端口映射</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token function">ssh</span> -L <span class="token number">8080</span>:127.0.0.1:8080 root@10.67.117.192</pre></td></tr><tr><td data-num="38"></td><td><pre>  root@10.67.117.192's password: <span class="token operator">&lt;</span>输入密码<span class="token operator">></span></pre></td></tr><tr><td data-num="39"></td><td><pre>  Last login: Thu Apr  <span class="token number">8</span> <span class="token number">18</span>:37:16 <span class="token number">2021</span> from yazhanma-mobl2.ccr.corp.intel.com</pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token punctuation">[</span>root@inspire-dev-nodea ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment"># 再打开机器 B 另外一个终端</span></pre></td></tr><tr><td data-num="43"></td><td><pre>firefox</pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token comment"># 浏览器输入如下网址</span></pre></td></tr><tr><td data-num="46"></td><td><pre>http://127.0.0.7:8080 </pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token comment"># 网页中创建 User 和设置密码，再登陆一遍就可以访问 dashboard 了.</span></pre></td></tr></table></figure><h2 id="清理"><a class="anchor" href="#清理">#</a> 清理</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>helm del my-keycloak -n dev</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>kubectl delete pvc data-my-keycloak-postgresql-master-0 -n dev</pre></td></tr><tr><td data-num="4"></td><td><pre>kubectl delete pvc data-my-keycloak-postgresql-slave-0 -n dev</pre></td></tr><tr><td data-num="5"></td><td><pre>kubectl delete pvc data-my-keycloak-postgresql-slave-1 -n dev</pre></td></tr></table></figure><h2 id="valuesyaml"><a class="anchor" href="#valuesyaml">#</a> values.yaml</h2><p>vim values.yaml</p><figure class="highlight raw"><figcaption data-lang=""><span>w</span></figcaption><table><tr><td data-num="1"></td><td><pre># Optionally override the fully qualified name</pre></td></tr><tr><td data-num="2"></td><td><pre>fullnameOverride: &quot;&quot;</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre># Optionally override the name</pre></td></tr><tr><td data-num="5"></td><td><pre>nameOverride: &quot;&quot;</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre># The number of replicas to create</pre></td></tr><tr><td data-num="8"></td><td><pre>replicas: 2</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>image:</pre></td></tr><tr><td data-num="11"></td><td><pre>  # The Keycloak image repository</pre></td></tr><tr><td data-num="12"></td><td><pre>  repository: docker.io&#x2F;jboss&#x2F;keycloak</pre></td></tr><tr><td data-num="13"></td><td><pre>  # Overrides the Keycloak image tag whose default is the chart version</pre></td></tr><tr><td data-num="14"></td><td><pre>  tag: &quot;&quot;</pre></td></tr><tr><td data-num="15"></td><td><pre>  # The Keycloak image pull policy</pre></td></tr><tr><td data-num="16"></td><td><pre>  pullPolicy: IfNotPresent</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre># Image pull secrets for the Pod</pre></td></tr><tr><td data-num="19"></td><td><pre>imagePullSecrets:</pre></td></tr><tr><td data-num="20"></td><td><pre>  - name: myRegistrKeySecretName</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre># Mapping between IPs and hostnames that will be injected as entries in the Pod&#39;s hosts files</pre></td></tr><tr><td data-num="23"></td><td><pre>hostAliases: []</pre></td></tr><tr><td data-num="24"></td><td><pre># - ip: &quot;1.2.3.4&quot;</pre></td></tr><tr><td data-num="25"></td><td><pre>#   hostnames:</pre></td></tr><tr><td data-num="26"></td><td><pre>#     - &quot;my.host.com&quot;</pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre># Indicates whether information about services should be injected into Pod&#39;s environment variables, matching the syntax of Docker links</pre></td></tr><tr><td data-num="29"></td><td><pre>enableServiceLinks: true</pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre># Pod management policy. One of &#96;Parallel&#96; or &#96;OrderedReady&#96;</pre></td></tr><tr><td data-num="32"></td><td><pre>podManagementPolicy: Parallel</pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre># Pod restart policy. One of &#96;Always&#96;, &#96;OnFailure&#96;, or &#96;Never&#96;</pre></td></tr><tr><td data-num="35"></td><td><pre>restartPolicy: Always</pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>serviceAccount:</pre></td></tr><tr><td data-num="38"></td><td><pre>  # Specifies whether a ServiceAccount should be created</pre></td></tr><tr><td data-num="39"></td><td><pre>  create: true</pre></td></tr><tr><td data-num="40"></td><td><pre>  # The name of the service account to use.</pre></td></tr><tr><td data-num="41"></td><td><pre>  # If not set and create is true, a name is generated using the fullname template</pre></td></tr><tr><td data-num="42"></td><td><pre>  name: &quot;&quot;</pre></td></tr><tr><td data-num="43"></td><td><pre>  # Additional annotations for the ServiceAccount</pre></td></tr><tr><td data-num="44"></td><td><pre>  annotations: &#123;&#125;</pre></td></tr><tr><td data-num="45"></td><td><pre>  # Additional labels for the ServiceAccount</pre></td></tr><tr><td data-num="46"></td><td><pre>  labels: &#123;&#125;</pre></td></tr><tr><td data-num="47"></td><td><pre>  # Image pull secrets that are attached to the ServiceAccount</pre></td></tr><tr><td data-num="48"></td><td><pre>  imagePullSecrets: []</pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>rbac:</pre></td></tr><tr><td data-num="51"></td><td><pre>  create: false</pre></td></tr><tr><td data-num="52"></td><td><pre>  rules: []</pre></td></tr><tr><td data-num="53"></td><td><pre>  # RBAC rules for KUBE_PING</pre></td></tr><tr><td data-num="54"></td><td><pre>  #  - apiGroups:</pre></td></tr><tr><td data-num="55"></td><td><pre>  #      - &quot;&quot;</pre></td></tr><tr><td data-num="56"></td><td><pre>  #    resources:</pre></td></tr><tr><td data-num="57"></td><td><pre>  #      - pods</pre></td></tr><tr><td data-num="58"></td><td><pre>  #    verbs:</pre></td></tr><tr><td data-num="59"></td><td><pre>  #      - get</pre></td></tr><tr><td data-num="60"></td><td><pre>  #      - list</pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre># SecurityContext for the entire Pod. Every container running in the Pod will inherit this SecurityContext. This might be relevant when other components of the environment inject additional containers into running Pods (service meshes are the most prominent example for this)</pre></td></tr><tr><td data-num="63"></td><td><pre>podSecurityContext:</pre></td></tr><tr><td data-num="64"></td><td><pre>  fsGroup: 1000</pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre># SecurityContext for the Keycloak container</pre></td></tr><tr><td data-num="67"></td><td><pre>securityContext:</pre></td></tr><tr><td data-num="68"></td><td><pre>  runAsUser: 1000</pre></td></tr><tr><td data-num="69"></td><td><pre>  runAsNonRoot: true</pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre># Additional init containers, e. g. for providing custom themes</pre></td></tr><tr><td data-num="72"></td><td><pre>extraInitContainers: &quot;&quot;</pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre># Additional sidecar containers, e. g. for a database proxy, such as Google&#39;s cloudsql-proxy</pre></td></tr><tr><td data-num="75"></td><td><pre>extraContainers: &quot;&quot;</pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre># Lifecycle hooks for the Keycloak container</pre></td></tr><tr><td data-num="78"></td><td><pre>lifecycleHooks: |</pre></td></tr><tr><td data-num="79"></td><td><pre>#  postStart:</pre></td></tr><tr><td data-num="80"></td><td><pre>#    exec:</pre></td></tr><tr><td data-num="81"></td><td><pre>#      command:</pre></td></tr><tr><td data-num="82"></td><td><pre>#        - &#x2F;bin&#x2F;sh</pre></td></tr><tr><td data-num="83"></td><td><pre>#        - -c</pre></td></tr><tr><td data-num="84"></td><td><pre>#        - ls</pre></td></tr><tr><td data-num="85"></td><td><pre></pre></td></tr><tr><td data-num="86"></td><td><pre># Termination grace period in seconds for Keycloak shutdown. Clusters with a large cache might need to extend this to give Infinispan more time to rebalance</pre></td></tr><tr><td data-num="87"></td><td><pre>terminationGracePeriodSeconds: 60</pre></td></tr><tr><td data-num="88"></td><td><pre></pre></td></tr><tr><td data-num="89"></td><td><pre># The internal Kubernetes cluster domain</pre></td></tr><tr><td data-num="90"></td><td><pre>clusterDomain: cluster.local</pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre>## Overrides the default entrypoint of the Keycloak container</pre></td></tr><tr><td data-num="93"></td><td><pre>command: []</pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre>## Overrides the default args for the Keycloak container</pre></td></tr><tr><td data-num="96"></td><td><pre>args: []</pre></td></tr><tr><td data-num="97"></td><td><pre></pre></td></tr><tr><td data-num="98"></td><td><pre># Additional environment variables for Keycloak</pre></td></tr><tr><td data-num="99"></td><td><pre>extraEnv: |</pre></td></tr><tr><td data-num="100"></td><td><pre>  - name: JGROUPS_DISCOVERY_PROTOCOL</pre></td></tr><tr><td data-num="101"></td><td><pre>    value: dns.DNS_PING</pre></td></tr><tr><td data-num="102"></td><td><pre>  - name: JGROUPS_DISCOVERY_PROPERTIES</pre></td></tr><tr><td data-num="103"></td><td><pre>
    value: 'dns_query={{ include "keycloak.serviceDnsName" . }}'
</pre></td></tr><tr><td data-num="104"></td><td><pre>  - name: CACHE_OWNERS_COUNT</pre></td></tr><tr><td data-num="105"></td><td><pre>    value: &quot;2&quot;</pre></td></tr><tr><td data-num="106"></td><td><pre>  - name: CACHE_OWNERS_AUTH_SESSIONS_COUNT</pre></td></tr><tr><td data-num="107"></td><td><pre>    value: &quot;2&quot;</pre></td></tr><tr><td data-num="108"></td><td><pre>  # - name: KEYCLOAK_LOGLEVEL</pre></td></tr><tr><td data-num="109"></td><td><pre>  #   value: DEBUG</pre></td></tr><tr><td data-num="110"></td><td><pre>  # - name: WILDFLY_LOGLEVEL</pre></td></tr><tr><td data-num="111"></td><td><pre>  #   value: DEBUG</pre></td></tr><tr><td data-num="112"></td><td><pre>  # - name: CACHE_OWNERS_COUNT</pre></td></tr><tr><td data-num="113"></td><td><pre>  #   value: &quot;2&quot;</pre></td></tr><tr><td data-num="114"></td><td><pre>  # - name: CACHE_OWNERS_AUTH_SESSIONS_COUNT</pre></td></tr><tr><td data-num="115"></td><td><pre>  #   value: &quot;2&quot;</pre></td></tr><tr><td data-num="116"></td><td><pre></pre></td></tr><tr><td data-num="117"></td><td><pre># Additional environment variables for Keycloak mapped from Secret or ConfigMap</pre></td></tr><tr><td data-num="118"></td><td><pre>extraEnvFrom: &quot;&quot;</pre></td></tr><tr><td data-num="119"></td><td><pre></pre></td></tr><tr><td data-num="120"></td><td><pre>#  Pod priority class name</pre></td></tr><tr><td data-num="121"></td><td><pre>priorityClassName: &quot;&quot;</pre></td></tr><tr><td data-num="122"></td><td><pre></pre></td></tr><tr><td data-num="123"></td><td><pre># Pod affinity</pre></td></tr><tr><td data-num="124"></td><td><pre>affinity: |</pre></td></tr><tr><td data-num="125"></td><td><pre>  podAntiAffinity:</pre></td></tr><tr><td data-num="126"></td><td><pre>    requiredDuringSchedulingIgnoredDuringExecution:</pre></td></tr><tr><td data-num="127"></td><td><pre>      - labelSelector:</pre></td></tr><tr><td data-num="128"></td><td><pre>          matchLabels:</pre></td></tr><tr><td data-num="129"></td><td><pre>
            {{- include "keycloak.selectorLabels" . | nindent 10 }}
</pre></td></tr><tr><td data-num="130"></td><td><pre>          matchExpressions:</pre></td></tr><tr><td data-num="131"></td><td><pre>            - key: app.kubernetes.io&#x2F;component</pre></td></tr><tr><td data-num="132"></td><td><pre>              operator: NotIn</pre></td></tr><tr><td data-num="133"></td><td><pre>              values:</pre></td></tr><tr><td data-num="134"></td><td><pre>                - test</pre></td></tr><tr><td data-num="135"></td><td><pre>        topologyKey: kubernetes.io&#x2F;hostname</pre></td></tr><tr><td data-num="136"></td><td><pre>    preferredDuringSchedulingIgnoredDuringExecution:</pre></td></tr><tr><td data-num="137"></td><td><pre>      - weight: 100</pre></td></tr><tr><td data-num="138"></td><td><pre>        podAffinityTerm:</pre></td></tr><tr><td data-num="139"></td><td><pre>          labelSelector:</pre></td></tr><tr><td data-num="140"></td><td><pre>            matchLabels:</pre></td></tr><tr><td data-num="141"></td><td><pre>
              {{- include "keycloak.selectorLabels" . | nindent 12 }}
</pre></td></tr><tr><td data-num="142"></td><td><pre>            matchExpressions:</pre></td></tr><tr><td data-num="143"></td><td><pre>              - key: app.kubernetes.io&#x2F;component</pre></td></tr><tr><td data-num="144"></td><td><pre>                operator: NotIn</pre></td></tr><tr><td data-num="145"></td><td><pre>                values:</pre></td></tr><tr><td data-num="146"></td><td><pre>                  - test</pre></td></tr><tr><td data-num="147"></td><td><pre>          topologyKey: failure-domain.beta.kubernetes.io&#x2F;zone</pre></td></tr><tr><td data-num="148"></td><td><pre></pre></td></tr><tr><td data-num="149"></td><td><pre># Node labels for Pod assignment</pre></td></tr><tr><td data-num="150"></td><td><pre>nodeSelector: &#123;&#125;</pre></td></tr><tr><td data-num="151"></td><td><pre></pre></td></tr><tr><td data-num="152"></td><td><pre># Node taints to tolerate</pre></td></tr><tr><td data-num="153"></td><td><pre>tolerations: []</pre></td></tr><tr><td data-num="154"></td><td><pre></pre></td></tr><tr><td data-num="155"></td><td><pre># Additional Pod labels</pre></td></tr><tr><td data-num="156"></td><td><pre>podLabels: &#123;&#125;</pre></td></tr><tr><td data-num="157"></td><td><pre></pre></td></tr><tr><td data-num="158"></td><td><pre># Additional Pod annotations</pre></td></tr><tr><td data-num="159"></td><td><pre>podAnnotations: &#123;&#125;</pre></td></tr><tr><td data-num="160"></td><td><pre></pre></td></tr><tr><td data-num="161"></td><td><pre># Liveness probe configuration</pre></td></tr><tr><td data-num="162"></td><td><pre>livenessProbe: |</pre></td></tr><tr><td data-num="163"></td><td><pre>  httpGet:</pre></td></tr><tr><td data-num="164"></td><td><pre>    path: &#x2F;auth&#x2F;</pre></td></tr><tr><td data-num="165"></td><td><pre>    port: http</pre></td></tr><tr><td data-num="166"></td><td><pre>  initialDelaySeconds: 300</pre></td></tr><tr><td data-num="167"></td><td><pre>  timeoutSeconds: 5</pre></td></tr><tr><td data-num="168"></td><td><pre></pre></td></tr><tr><td data-num="169"></td><td><pre># Readiness probe configuration</pre></td></tr><tr><td data-num="170"></td><td><pre>readinessProbe: |</pre></td></tr><tr><td data-num="171"></td><td><pre>  httpGet:</pre></td></tr><tr><td data-num="172"></td><td><pre>    path: &#x2F;auth&#x2F;realms&#x2F;master</pre></td></tr><tr><td data-num="173"></td><td><pre>    port: http</pre></td></tr><tr><td data-num="174"></td><td><pre>  initialDelaySeconds: 30</pre></td></tr><tr><td data-num="175"></td><td><pre>  timeoutSeconds: 1</pre></td></tr><tr><td data-num="176"></td><td><pre></pre></td></tr><tr><td data-num="177"></td><td><pre># Pod resource requests and limits</pre></td></tr><tr><td data-num="178"></td><td><pre>resources: &#123;&#125;</pre></td></tr><tr><td data-num="179"></td><td><pre>  # requests:</pre></td></tr><tr><td data-num="180"></td><td><pre>  #   cpu: &quot;500m&quot;</pre></td></tr><tr><td data-num="181"></td><td><pre>  #   memory: &quot;1024Mi&quot;</pre></td></tr><tr><td data-num="182"></td><td><pre>  # limits:</pre></td></tr><tr><td data-num="183"></td><td><pre>  #   cpu: &quot;500m&quot;</pre></td></tr><tr><td data-num="184"></td><td><pre>  #   memory: &quot;1024Mi&quot;</pre></td></tr><tr><td data-num="185"></td><td><pre></pre></td></tr><tr><td data-num="186"></td><td><pre># Startup scripts to run before Keycloak starts up</pre></td></tr><tr><td data-num="187"></td><td><pre>startupScripts:</pre></td></tr><tr><td data-num="188"></td><td><pre>  # WildFly CLI script for configuring the node-identifier</pre></td></tr><tr><td data-num="189"></td><td><pre>  keycloak.cli: |</pre></td></tr><tr><td data-num="190"></td><td><pre>
    {{- .Files.Get "scripts/keycloak.cli" }}
</pre></td></tr><tr><td data-num="191"></td><td><pre>  # mystartup.sh: |</pre></td></tr><tr><td data-num="192"></td><td><pre>  #   #!&#x2F;bin&#x2F;sh</pre></td></tr><tr><td data-num="193"></td><td><pre>  #</pre></td></tr><tr><td data-num="194"></td><td><pre>  # echo &#39;Hello from my custom startup script!&#39;</pre></td></tr><tr><td data-num="195"></td><td><pre></pre></td></tr><tr><td data-num="196"></td><td><pre># Add additional volumes, e. g. for custom themes</pre></td></tr><tr><td data-num="197"></td><td><pre>extraVolumes: &quot;&quot;</pre></td></tr><tr><td data-num="198"></td><td><pre></pre></td></tr><tr><td data-num="199"></td><td><pre># Add additional volumes mounts, e. g. for custom themes</pre></td></tr><tr><td data-num="200"></td><td><pre>extraVolumeMounts: &quot;&quot;</pre></td></tr><tr><td data-num="201"></td><td><pre></pre></td></tr><tr><td data-num="202"></td><td><pre># Add additional ports, e. g. for admin console or exposing JGroups ports</pre></td></tr><tr><td data-num="203"></td><td><pre>extraPorts: []</pre></td></tr><tr><td data-num="204"></td><td><pre></pre></td></tr><tr><td data-num="205"></td><td><pre># Pod disruption budget</pre></td></tr><tr><td data-num="206"></td><td><pre>podDisruptionBudget: &#123;&#125;</pre></td></tr><tr><td data-num="207"></td><td><pre>#  maxUnavailable: 1</pre></td></tr><tr><td data-num="208"></td><td><pre>#  minAvailable: 1</pre></td></tr><tr><td data-num="209"></td><td><pre></pre></td></tr><tr><td data-num="210"></td><td><pre># Annotations for the StatefulSet</pre></td></tr><tr><td data-num="211"></td><td><pre>statefulsetAnnotations: &#123;&#125;</pre></td></tr><tr><td data-num="212"></td><td><pre></pre></td></tr><tr><td data-num="213"></td><td><pre># Additional labels for the StatefulSet</pre></td></tr><tr><td data-num="214"></td><td><pre>statefulsetLabels: &#123;&#125;</pre></td></tr><tr><td data-num="215"></td><td><pre></pre></td></tr><tr><td data-num="216"></td><td><pre># Configuration for secrets that should be created</pre></td></tr><tr><td data-num="217"></td><td><pre>secrets: &#123;&#125;</pre></td></tr><tr><td data-num="218"></td><td><pre>  # mysecret:</pre></td></tr><tr><td data-num="219"></td><td><pre>  #   annotations: &#123;&#125;</pre></td></tr><tr><td data-num="220"></td><td><pre>  #   labels: &#123;&#125;</pre></td></tr><tr><td data-num="221"></td><td><pre>  #   stringData: &#123;&#125;</pre></td></tr><tr><td data-num="222"></td><td><pre>  #   data: &#123;&#125;</pre></td></tr><tr><td data-num="223"></td><td><pre></pre></td></tr><tr><td data-num="224"></td><td><pre>service:</pre></td></tr><tr><td data-num="225"></td><td><pre>  # Annotations for headless and HTTP Services</pre></td></tr><tr><td data-num="226"></td><td><pre>  annotations: &#123;&#125;</pre></td></tr><tr><td data-num="227"></td><td><pre>  # Additional labels for headless and HTTP Services</pre></td></tr><tr><td data-num="228"></td><td><pre>  labels: &#123;&#125;</pre></td></tr><tr><td data-num="229"></td><td><pre>  # key: value</pre></td></tr><tr><td data-num="230"></td><td><pre>  # The Service type</pre></td></tr><tr><td data-num="231"></td><td><pre>  type: ClusterIP</pre></td></tr><tr><td data-num="232"></td><td><pre>  # Optional IP for the load balancer. Used for services of type LoadBalancer only</pre></td></tr><tr><td data-num="233"></td><td><pre>  loadBalancerIP: &quot;&quot;</pre></td></tr><tr><td data-num="234"></td><td><pre>  # The http Service port</pre></td></tr><tr><td data-num="235"></td><td><pre>  httpPort: 80</pre></td></tr><tr><td data-num="236"></td><td><pre>  # The HTTP Service node port if type is NodePort</pre></td></tr><tr><td data-num="237"></td><td><pre>  httpNodePort: null</pre></td></tr><tr><td data-num="238"></td><td><pre>  # The HTTPS Service port</pre></td></tr><tr><td data-num="239"></td><td><pre>  httpsPort: 8443</pre></td></tr><tr><td data-num="240"></td><td><pre>  # The HTTPS Service node port if type is NodePort</pre></td></tr><tr><td data-num="241"></td><td><pre>  httpsNodePort: null</pre></td></tr><tr><td data-num="242"></td><td><pre>  # The WildFly management Service port</pre></td></tr><tr><td data-num="243"></td><td><pre>  httpManagementPort: 9990</pre></td></tr><tr><td data-num="244"></td><td><pre>  # The WildFly management Service node port if type is NodePort</pre></td></tr><tr><td data-num="245"></td><td><pre>  httpManagementNodePort: null</pre></td></tr><tr><td data-num="246"></td><td><pre>  # Additional Service ports, e. g. for custom admin console</pre></td></tr><tr><td data-num="247"></td><td><pre>  extraPorts: []</pre></td></tr><tr><td data-num="248"></td><td><pre></pre></td></tr><tr><td data-num="249"></td><td><pre>ingress:</pre></td></tr><tr><td data-num="250"></td><td><pre>  # If &#96;true&#96;, an Ingress is created</pre></td></tr><tr><td data-num="251"></td><td><pre>  enabled: false</pre></td></tr><tr><td data-num="252"></td><td><pre>  # The Service port targeted by the Ingress</pre></td></tr><tr><td data-num="253"></td><td><pre>  servicePort: http</pre></td></tr><tr><td data-num="254"></td><td><pre>  # Ingress annotations</pre></td></tr><tr><td data-num="255"></td><td><pre>  annotations: &#123;&#125;</pre></td></tr><tr><td data-num="256"></td><td><pre>  # Additional Ingress labels</pre></td></tr><tr><td data-num="257"></td><td><pre>  labels: &#123;&#125;</pre></td></tr><tr><td data-num="258"></td><td><pre>   # List of rules for the Ingress</pre></td></tr><tr><td data-num="259"></td><td><pre>  rules:</pre></td></tr><tr><td data-num="260"></td><td><pre>    -</pre></td></tr><tr><td data-num="261"></td><td><pre>      # Ingress host</pre></td></tr><tr><td data-num="262"></td><td><pre>
      host: '{{ .Release.Name }}.keycloak.example.com'
</pre></td></tr><tr><td data-num="263"></td><td><pre>      # Paths for the host</pre></td></tr><tr><td data-num="264"></td><td><pre>      paths:</pre></td></tr><tr><td data-num="265"></td><td><pre>        - &#x2F;</pre></td></tr><tr><td data-num="266"></td><td><pre>  # TLS configuration</pre></td></tr><tr><td data-num="267"></td><td><pre>  tls:</pre></td></tr><tr><td data-num="268"></td><td><pre>    - hosts:</pre></td></tr><tr><td data-num="269"></td><td><pre>        - keycloak.example.com</pre></td></tr><tr><td data-num="270"></td><td><pre>      secretName: keycloak-tls</pre></td></tr><tr><td data-num="271"></td><td><pre></pre></td></tr><tr><td data-num="272"></td><td><pre>route:</pre></td></tr><tr><td data-num="273"></td><td><pre>  # If &#96;true&#96;, an OpenShift Route is created</pre></td></tr><tr><td data-num="274"></td><td><pre>  enabled: false</pre></td></tr><tr><td data-num="275"></td><td><pre>  # Path for the Route</pre></td></tr><tr><td data-num="276"></td><td><pre>  path: &#x2F;</pre></td></tr><tr><td data-num="277"></td><td><pre>  # Route annotations</pre></td></tr><tr><td data-num="278"></td><td><pre>  annotations: &#123;&#125;</pre></td></tr><tr><td data-num="279"></td><td><pre>  # Additional Route labels</pre></td></tr><tr><td data-num="280"></td><td><pre>  labels: &#123;&#125;</pre></td></tr><tr><td data-num="281"></td><td><pre>  # Host name for the Route</pre></td></tr><tr><td data-num="282"></td><td><pre>  host: &quot;&quot;</pre></td></tr><tr><td data-num="283"></td><td><pre>  # TLS configuration</pre></td></tr><tr><td data-num="284"></td><td><pre>  tls:</pre></td></tr><tr><td data-num="285"></td><td><pre>    # If &#96;true&#96;, TLS is enabled for the Route</pre></td></tr><tr><td data-num="286"></td><td><pre>    enabled: true</pre></td></tr><tr><td data-num="287"></td><td><pre>    # Insecure edge termination policy of the Route. Can be &#96;None&#96;, &#96;Redirect&#96;, or &#96;Allow&#96;</pre></td></tr><tr><td data-num="288"></td><td><pre>    insecureEdgeTerminationPolicy: Redirect</pre></td></tr><tr><td data-num="289"></td><td><pre>    # TLS termination of the route. Can be &#96;edge&#96;, &#96;passthrough&#96;, or &#96;reencrypt&#96;</pre></td></tr><tr><td data-num="290"></td><td><pre>    termination: edge</pre></td></tr><tr><td data-num="291"></td><td><pre></pre></td></tr><tr><td data-num="292"></td><td><pre>pgchecker:</pre></td></tr><tr><td data-num="293"></td><td><pre>  image:</pre></td></tr><tr><td data-num="294"></td><td><pre>    # Docker image used to check Postgresql readiness at startup</pre></td></tr><tr><td data-num="295"></td><td><pre>    repository: docker.io&#x2F;busybox</pre></td></tr><tr><td data-num="296"></td><td><pre>    # Image tag for the pgchecker image</pre></td></tr><tr><td data-num="297"></td><td><pre>    tag: 1.32</pre></td></tr><tr><td data-num="298"></td><td><pre>    # Image pull policy for the pgchecker image</pre></td></tr><tr><td data-num="299"></td><td><pre>    pullPolicy: IfNotPresent</pre></td></tr><tr><td data-num="300"></td><td><pre>  # SecurityContext for the pgchecker container</pre></td></tr><tr><td data-num="301"></td><td><pre>  securityContext:</pre></td></tr><tr><td data-num="302"></td><td><pre>    allowPrivilegeEscalation: false</pre></td></tr><tr><td data-num="303"></td><td><pre>    runAsUser: 1000</pre></td></tr><tr><td data-num="304"></td><td><pre>    runAsGroup: 1000</pre></td></tr><tr><td data-num="305"></td><td><pre>    runAsNonRoot: true</pre></td></tr><tr><td data-num="306"></td><td><pre>  # Resource requests and limits for the pgchecker container</pre></td></tr><tr><td data-num="307"></td><td><pre>  resources:</pre></td></tr><tr><td data-num="308"></td><td><pre>    requests:</pre></td></tr><tr><td data-num="309"></td><td><pre>      cpu: &quot;10m&quot;</pre></td></tr><tr><td data-num="310"></td><td><pre>      memory: &quot;16Mi&quot;</pre></td></tr><tr><td data-num="311"></td><td><pre>    limits:</pre></td></tr><tr><td data-num="312"></td><td><pre>      cpu: &quot;10m&quot;</pre></td></tr><tr><td data-num="313"></td><td><pre>      memory: &quot;16Mi&quot;</pre></td></tr><tr><td data-num="314"></td><td><pre></pre></td></tr><tr><td data-num="315"></td><td><pre>postgresql:</pre></td></tr><tr><td data-num="316"></td><td><pre>  # If &#96;true&#96;, the Postgresql dependency is enabled</pre></td></tr><tr><td data-num="317"></td><td><pre>  enabled: true</pre></td></tr><tr><td data-num="318"></td><td><pre>  # PostgreSQL User to create</pre></td></tr><tr><td data-num="319"></td><td><pre>  postgresqlUsername: keycloak</pre></td></tr><tr><td data-num="320"></td><td><pre>  # PostgreSQL Password for the new user</pre></td></tr><tr><td data-num="321"></td><td><pre>  postgresqlPassword: hce123</pre></td></tr><tr><td data-num="322"></td><td><pre>  # PostgreSQL Database to create</pre></td></tr><tr><td data-num="323"></td><td><pre>  postgresqlDatabase: keycloak</pre></td></tr><tr><td data-num="324"></td><td><pre>  # Persistent Volume Storage configuration</pre></td></tr><tr><td data-num="325"></td><td><pre>  persistence:</pre></td></tr><tr><td data-num="326"></td><td><pre>    storageClass: local-storage</pre></td></tr><tr><td data-num="327"></td><td><pre>  replication:</pre></td></tr><tr><td data-num="328"></td><td><pre>    enabled: true</pre></td></tr><tr><td data-num="329"></td><td><pre>    user: repl_user</pre></td></tr><tr><td data-num="330"></td><td><pre>    password: hce123</pre></td></tr><tr><td data-num="331"></td><td><pre>    slaveReplicas: 2</pre></td></tr><tr><td data-num="332"></td><td><pre>    ## Set synchronous commit mode: on, off, remote_apply, remote_write and local</pre></td></tr><tr><td data-num="333"></td><td><pre>    ## ref: https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;9.6&#x2F;runtime-config-wal.html#GUC-WAL-LEVEL</pre></td></tr><tr><td data-num="334"></td><td><pre>    synchronousCommit: &quot;on&quot;</pre></td></tr><tr><td data-num="335"></td><td><pre>    ## From the number of &#96;slaveReplicas&#96; defined above, set the number of those that will have synchronous replication</pre></td></tr><tr><td data-num="336"></td><td><pre>    ## NOTE: It cannot be &gt; slaveReplicas</pre></td></tr><tr><td data-num="337"></td><td><pre>    numSynchronousReplicas: 1</pre></td></tr><tr><td data-num="338"></td><td><pre>    ## Replication Cluster application name. Useful for defining multiple replication policies</pre></td></tr><tr><td data-num="339"></td><td><pre>    applicationName: my_application</pre></td></tr><tr><td data-num="340"></td><td><pre></pre></td></tr><tr><td data-num="341"></td><td><pre>serviceMonitor:</pre></td></tr><tr><td data-num="342"></td><td><pre>  # If &#96;true&#96;, a ServiceMonitor resource for the prometheus-operator is created</pre></td></tr><tr><td data-num="343"></td><td><pre>  enabled: false</pre></td></tr><tr><td data-num="344"></td><td><pre>  # Optionally sets a target namespace in which to deploy the ServiceMonitor resource</pre></td></tr><tr><td data-num="345"></td><td><pre>  namespace: &quot;&quot;</pre></td></tr><tr><td data-num="346"></td><td><pre>  # Annotations for the ServiceMonitor</pre></td></tr><tr><td data-num="347"></td><td><pre>  annotations: &#123;&#125;</pre></td></tr><tr><td data-num="348"></td><td><pre>  # Additional labels for the ServiceMonitor</pre></td></tr><tr><td data-num="349"></td><td><pre>  labels: &#123;&#125;</pre></td></tr><tr><td data-num="350"></td><td><pre>  # Interval at which Prometheus scrapes metrics</pre></td></tr><tr><td data-num="351"></td><td><pre>  interval: 10s</pre></td></tr><tr><td data-num="352"></td><td><pre>  # Timeout for scraping</pre></td></tr><tr><td data-num="353"></td><td><pre>  scrapeTimeout: 10s</pre></td></tr><tr><td data-num="354"></td><td><pre>  # The path at which metrics are served</pre></td></tr><tr><td data-num="355"></td><td><pre>  path: &#x2F;metrics</pre></td></tr><tr><td data-num="356"></td><td><pre>  # The Service port at which metrics are served</pre></td></tr><tr><td data-num="357"></td><td><pre>  port: http-management</pre></td></tr><tr><td data-num="358"></td><td><pre></pre></td></tr><tr><td data-num="359"></td><td><pre>prometheusRule:</pre></td></tr><tr><td data-num="360"></td><td><pre>  # If &#96;true&#96;, a PrometheusRule resource for the prometheus-operator is created</pre></td></tr><tr><td data-num="361"></td><td><pre>  enabled: false</pre></td></tr><tr><td data-num="362"></td><td><pre>  # Annotations for the PrometheusRule</pre></td></tr><tr><td data-num="363"></td><td><pre>  annotations: &#123;&#125;</pre></td></tr><tr><td data-num="364"></td><td><pre>  # Additional labels for the PrometheusRule</pre></td></tr><tr><td data-num="365"></td><td><pre>  labels: &#123;&#125;</pre></td></tr><tr><td data-num="366"></td><td><pre>  # List of rules for Prometheus</pre></td></tr><tr><td data-num="367"></td><td><pre>  rules: []</pre></td></tr><tr><td data-num="368"></td><td><pre>  # - alert: keycloak-IngressHigh5xxRate</pre></td></tr><tr><td data-num="369"></td><td><pre>  #   annotations:</pre></td></tr><tr><td data-num="370"></td><td><pre>  #     message: The percentage of 5xx errors for keycloak over the last 5 minutes is over 1%.</pre></td></tr><tr><td data-num="371"></td><td><pre>  #   expr: |</pre></td></tr><tr><td data-num="372"></td><td><pre>  #     (</pre></td></tr><tr><td data-num="373"></td><td><pre>  #       sum(</pre></td></tr><tr><td data-num="374"></td><td><pre>  #         rate(</pre></td></tr><tr><td data-num="375"></td><td><pre>  #           nginx_ingress_controller_response_duration_seconds_count&#123;exported_namespace&#x3D;&quot;mynamespace&quot;,ingress&#x3D;&quot;mynamespace-keycloak&quot;,status&#x3D;~&quot;5[0-9]&#123;2&#125;&quot;&#125;[1m]</pre></td></tr><tr><td data-num="376"></td><td><pre>  #         )</pre></td></tr><tr><td data-num="377"></td><td><pre>  #       )</pre></td></tr><tr><td data-num="378"></td><td><pre>  #       &#x2F;</pre></td></tr><tr><td data-num="379"></td><td><pre>  #       sum(</pre></td></tr><tr><td data-num="380"></td><td><pre>  #         rate(</pre></td></tr><tr><td data-num="381"></td><td><pre>  #           nginx_ingress_controller_response_duration_seconds_count&#123;exported_namespace&#x3D;&quot;mynamespace&quot;,ingress&#x3D;&quot;mynamespace-keycloak&quot;&#125;[1m]</pre></td></tr><tr><td data-num="382"></td><td><pre>  #         )</pre></td></tr><tr><td data-num="383"></td><td><pre>  #       )</pre></td></tr><tr><td data-num="384"></td><td><pre>  #     ) * 100 &gt; 1</pre></td></tr><tr><td data-num="385"></td><td><pre>  #   for: 5m</pre></td></tr><tr><td data-num="386"></td><td><pre>  #   labels:</pre></td></tr><tr><td data-num="387"></td><td><pre>  #     severity: warning</pre></td></tr><tr><td data-num="388"></td><td><pre></pre></td></tr><tr><td data-num="389"></td><td><pre>test:</pre></td></tr><tr><td data-num="390"></td><td><pre>  # If &#96;true&#96;, test resources are created</pre></td></tr><tr><td data-num="391"></td><td><pre>  enabled: false</pre></td></tr><tr><td data-num="392"></td><td><pre>  image:</pre></td></tr><tr><td data-num="393"></td><td><pre>    # The image for the test Pod</pre></td></tr><tr><td data-num="394"></td><td><pre>    repository: docker.io&#x2F;unguiculus&#x2F;docker-python3-phantomjs-selenium</pre></td></tr><tr><td data-num="395"></td><td><pre>    # The tag for the test Pod image</pre></td></tr><tr><td data-num="396"></td><td><pre>    tag: v1</pre></td></tr><tr><td data-num="397"></td><td><pre>    # The image pull policy for the test Pod image</pre></td></tr><tr><td data-num="398"></td><td><pre>    pullPolicy: IfNotPresent</pre></td></tr><tr><td data-num="399"></td><td><pre>  # SecurityContext for the entire test Pod</pre></td></tr><tr><td data-num="400"></td><td><pre>  podSecurityContext:</pre></td></tr><tr><td data-num="401"></td><td><pre>    fsGroup: 1000</pre></td></tr><tr><td data-num="402"></td><td><pre>  # SecurityContext for the test container</pre></td></tr><tr><td data-num="403"></td><td><pre>  securityContext:</pre></td></tr><tr><td data-num="404"></td><td><pre>    runAsUser: 1000</pre></td></tr><tr><td data-num="405"></td><td><pre>    runAsNonRoot: true</pre></td></tr></table></figure><div class="tags"><a href="/tags/storage/" rel="tag"><i class="ic i-tag"></i> storage</a></div></div><footer><div class="meta"></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Kung-Fu-Master 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Kung-Fu-Master 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Kung-Fu-Master 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Kung-Fu-Master <i class="ic i-at"><em>@</em></i>Hexo</li><li class="link"><strong>本文链接：</strong> <a href="https://kung-fu-master.github.io/2021/05/31/technologies/security/keycloak/" title="Deploy keycloak on kubernetes">https://kung-fu-master.github.io/2021/05/31/technologies/security/keycloak/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/05/31/storage/greenplum/greenplum_client/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclwrdwyaj20zk0m8are.jpg" title="greenplum client"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> greenplum</span><h3>greenplum client</h3></a></div><div class="item right"><a href="/2021/05/31/technologies/docker/docker_timeout/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclip4jbpj20zk0m87cv.jpg" title="docker timeout"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> docker</span><h3>docker timeout</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#prerequisites"><span class="toc-number">1.</span> <span class="toc-text"># Prerequisites</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署步骤"><span class="toc-number">2.</span> <span class="toc-text"># 部署步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#清理"><span class="toc-number">3.</span> <span class="toc-text"># 清理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#valuesyaml"><span class="toc-number">4.</span> <span class="toc-text"># values.yaml</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/03/13/technologies/security/key_digest_signature_certificates/" rel="bookmark" title="certificates, public/private key, signature digest">certificates, public/private key, signature digest</a></li><li><a href="/2021/03/13/technologies/security/pki/" rel="bookmark" title="PKI 体系概述">PKI 体系概述</a></li><li><a href="/2021/03/13/technologies/security/tls_ssl_https_http_protocol/" rel="bookmark" title="TLS/SSL/HTTP/HTTPS protocol">TLS/SSL/HTTP/HTTPS protocol</a></li><li><a href="/2021/03/13/linux/aws-sdk-cpp%E4%BA%9A%E9%A9%AC%E9%80%8A/" rel="bookmark" title="亚马逊aws-sdk-cpp">亚马逊aws-sdk-cpp</a></li><li><a href="/2021/03/13/technologies/security/ECDHE-RSA-AES256-GCM-SHA384%E8%A7%A3%E9%87%8A/" rel="bookmark" title="ECDHE-RSA-AES256-GCM-SHA384 解释">ECDHE-RSA-AES256-GCM-SHA384 解释</a></li><li><a href="/2021/03/13/technologies/security/algorithm_security/" rel="bookmark" title="algorithm security">algorithm security</a></li><li><a href="/2021/03/13/technologies/security/cfssl/" rel="bookmark" title="cfssl">cfssl</a></li><li><a href="/2021/03/13/technologies/security/openssl/" rel="bookmark" title="openssl">openssl</a></li><li><a href="/2021/03/13/technologies/security/jwt_jwks/" rel="bookmark" title="jwt jwks">jwt jwks</a></li><li><a href="/2021/03/13/technologies/security/token_jwt/" rel="bookmark" title="Token jwt">Token jwt</a></li><li><a href="/2021/03/16/technologies/security/openssl_update/" rel="bookmark" title="openssl update">openssl update</a></li><li><a href="/2021/03/21/technologies/security/kms_vault/" rel="bookmark" title="KMS vault">KMS vault</a></li><li><a href="/2021/05/31/technologies/security/openssl_certificates/" rel="bookmark" title="openssl certificates">openssl certificates</a></li><li class="active"><a href="/2021/05/31/technologies/security/keycloak/" rel="bookmark" title="Deploy keycloak on kubernetes">Deploy keycloak on kubernetes</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Kung-Fu-Master" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Kung-Fu-Master</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">314</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">42</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">14</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/05/31/storage/greenplum/greenplum_client/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/05/31/technologies/docker/docker_timeout/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/blogs/" title="分类于 blogs">blogs</a> <i class="ic i-angle-right"></i> <a href="/categories/blogs/blog%E6%90%AD%E5%BB%BA/" title="分类于 blog搭建">blog搭建</a></div><span><a href="/2021/03/13/blogs/blog%E6%90%AD%E5%BB%BA/Hexo_03_%E5%86%99%E5%8D%9A%E5%AE%A2%E8%AF%AD%E6%B3%95/" title="Hexo 03 写博客语法">Hexo 03 写博客语法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/language/" title="分类于 language">language</a> <i class="ic i-angle-right"></i> <a href="/categories/language/c/" title="分类于 c">c</a></div><span><a href="/2021/03/13/language/c/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" title="线程池">线程池</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MLearning/" title="分类于 MLearning">MLearning</a> <i class="ic i-angle-right"></i> <a href="/categories/MLearning/matplotlib/" title="分类于 matplotlib">matplotlib</a></div><span><a href="/2021/06/01/MLearning/matplotlib/01_%E5%AD%90%E5%9B%BE%E4%B8%8E%E6%A0%87%E6%B3%A8/" title="01 子图与标注">01 子图与标注</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/language/" title="分类于 language">language</a> <i class="ic i-angle-right"></i> <a href="/categories/language/nodejs/" title="分类于 nodejs">nodejs</a></div><span><a href="/2021/03/13/language/nodejs/4.node_modules/" title="4.node_modules">4.node_modules</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technologies/" title="分类于 technologies">technologies</a> <i class="ic i-angle-right"></i> <a href="/categories/technologies/security/" title="分类于 security">security</a></div><span><a href="/2021/05/31/technologies/security/keycloak/" title="Deploy keycloak on kubernetes">Deploy keycloak on kubernetes</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/language/" title="分类于 language">language</a> <i class="ic i-angle-right"></i> <a href="/categories/language/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/2021/03/13/language/cpp/c++_learn_links/" title="c++ learn links">c++ learn links</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/storage/" title="分类于 storage">storage</a> <i class="ic i-angle-right"></i> <a href="/categories/storage/greenplum/" title="分类于 greenplum">greenplum</a></div><span><a href="/2021/05/31/storage/greenplum/greenplum_client/" title="greenplum client">greenplum client</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/language/" title="分类于 language">language</a> <i class="ic i-angle-right"></i> <a href="/categories/language/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/2021/03/13/language/cpp/STL/03.shared_ptr/" title="STL 03 shared_ptr">STL 03 shared_ptr</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/entertainment/" title="分类于 entertainment">entertainment</a></div><span><a href="/2021/03/13/entertainment/test/" title="test">test</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technologies/" title="分类于 technologies">technologies</a> <i class="ic i-angle-right"></i> <a href="/categories/technologies/docker/" title="分类于 docker">docker</a></div><span><a href="/2021/05/31/technologies/docker/DCT/" title="Docker Content Trust(DCT) and Notary">Docker Content Trust(DCT) and Notary</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Kung-Fu-Master @ Kung Fu Master</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.2m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">18:20</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/05/31/technologies/security/keycloak/",favicon:{show:"（●´3｀●）",hide:"（●´3｀●）"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->