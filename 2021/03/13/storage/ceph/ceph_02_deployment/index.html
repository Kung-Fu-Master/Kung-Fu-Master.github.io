<!-- build time:Fri Jul 02 2021 17:43:29 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Hexo" href="https://kung-fu-master.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Hexo" href="https://kung-fu-master.github.io/atom.xml"><link rel="alternate" type="application/json" title="Hexo" href="https://kung-fu-master.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="storage"><link rel="canonical" href="https://kung-fu-master.github.io/2021/03/13/storage/ceph/ceph_02_deployment/"><title>Ceph 02 deployment on Kubernetes - ceph - storage | Kung Fu Master = Hexo</title><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Ceph 02 deployment on Kubernetes</h1><div class="meta"><span class="item" title="创建时间：2021-03-13 13:00:42"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-03-13T13:00:42+08:00">2021-03-13</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>15k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>14 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Kung Fu Master</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipex2cdtbj20zk0m8x6p.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicm07ih54j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipet8c1a2j20zk0m8kct.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipewf5l51j20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giph47e9vtj20zk0m8x6l.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclip4jbpj20zk0m87cv.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/storage/" itemprop="item" rel="index" title="分类于 storage"><span itemprop="name">storage</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/storage/ceph/" itemprop="item" rel="index" title="分类于 ceph"><span itemprop="name">ceph</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://kung-fu-master.github.io/2021/03/13/storage/ceph/ceph_02_deployment/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Kung-Fu-Master"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><div class="body md" itemprop="articleBody"><p>This document describes the steps to enable Ceph cluster in Kubernetes(k8s)</p><h2 id="prerequisites"><a class="anchor" href="#prerequisites">#</a> <strong>Prerequisites</strong></h2><ol><li>A running Kubernetes environmen.</li><li>In order to configure the Ceph storage cluster, at least one of these local storage options are required:</li></ol><ul><li>Raw devices (no partitions or formatted filesystems)</li><li>Raw partitions (no formatted filesystem)</li><li>PVs available from a storage class in block mode</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>lsblk -f</pre></td></tr><tr><td data-num="2"></td><td><pre>NAME                  FSTYPE      LABEL UUID                                   MOUNTPOINT</pre></td></tr><tr><td data-num="3"></td><td><pre>vda</pre></td></tr><tr><td data-num="4"></td><td><pre>└─vda1                LVM2_member       <span class="token operator">></span>eSO50t-GkUV-YKTH-WsGq-hNJY-eKNf-3i07IB</pre></td></tr><tr><td data-num="5"></td><td><pre> ├─ubuntu--vg-root   ext4              c2366f76-6e21-4f10-a8f3-6776212e2fe4   /</pre></td></tr><tr><td data-num="6"></td><td><pre> └─ubuntu--vg-swap_1 swap              9492a3dc-ad75-47cd-9596-678e8cf17ff9   <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>vdb</pre></td></tr></table></figure><p>If the <code>FSTYPE</code> field is not empty, there is a filesystem on top of the corresponding device. In this case, you can use <code>vdb</code> for Ceph and can’t use <code>vda</code> and its partitions.</p><h2 id="磁盘分区"><a class="anchor" href="#磁盘分区">#</a> 磁盘分区</h2><div class="tab" data-id="id01" data-title="第一种"><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">fdisk</span> /dev/sdc</pre></td></tr><tr><td data-num="2"></td><td><pre>// 分成类似如下分区</pre></td></tr><tr><td data-num="3"></td><td><pre>  sdc1  500G</pre></td></tr><tr><td data-num="4"></td><td><pre>  sdc2  500G</pre></td></tr></table></figure></div><div class="tab" data-id="id01" data-title="第二种"><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">parted</span> --script /dev/sdc <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    mklabel gpt <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    mkpart primary 4096s 512000MiB <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    mkpart primary 512000MiB 1024000MiB</pre></td></tr></table></figure></div><h2 id="setup-steps"><a class="anchor" href="#setup-steps">#</a> <strong>Setup steps</strong></h2><ol><li>The first step is to deploy the Rook operator. Check that you are using the example yaml files that correspond to your release of Rook.</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">git</span> clone --single-branch --branch v1.6.6 https://github.com/rook/rook.git</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">cd</span> cluster/examples/kubernetes/ceph</pre></td></tr><tr><td data-num="3"></td><td><pre>kubectl create -f crds.yaml -f common.yaml -f operator.yaml</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>// verify the rook-ceph-operator is <span class="token keyword">in</span> the <span class="token variable"><span class="token variable">`</span>Running<span class="token variable">`</span></span> state before proceeding</pre></td></tr><tr><td data-num="6"></td><td><pre>kubectl -n rook-ceph get pod</pre></td></tr></table></figure><ol start="2"><li>Now that the Rook operator is running we can create the Ceph cluster. For the cluster to survive reboots, make sure you set the dataDirHostPath property that is valid for your hosts.</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl create -f cluster.yaml</pre></td></tr></table></figure><ol start="3"><li>Use kubectl to list pods in the rook-ceph namespace. You should be able to see the following pods once they are all running. The number of osd pods will depend on the number of nodes in the cluster and the number of devices configured. If you did not modify the cluster.yaml above, it is expected that one OSD will be created per node. The CSI, rook-ceph-agent, and rook-discover pods are also optional depending on your settings.</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl -n rook-ceph get pod</pre></td></tr><tr><td data-num="2"></td><td><pre>  NAME                                                   READY   STATUS      RESTARTS   AGE</pre></td></tr><tr><td data-num="3"></td><td><pre>  csi-cephfsplugin-pgvdw                                 <span class="token number">3</span>/3     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="4"></td><td><pre>  csi-cephfsplugin-provisioner-78d66674d8-gss5x          <span class="token number">6</span>/6     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="5"></td><td><pre>  csi-cephfsplugin-provisioner-78d66674d8-jvsf5          <span class="token number">6</span>/6     Running     <span class="token number">1</span>          24h</pre></td></tr><tr><td data-num="6"></td><td><pre>  csi-cephfsplugin-q9c9g                                 <span class="token number">3</span>/3     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="7"></td><td><pre>  csi-cephfsplugin-v992c                                 <span class="token number">3</span>/3     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="8"></td><td><pre>  csi-rbdplugin-68r24                                    <span class="token number">3</span>/3     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="9"></td><td><pre>  csi-rbdplugin-9lbmf                                    <span class="token number">3</span>/3     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="10"></td><td><pre>  csi-rbdplugin-mld2w                                    <span class="token number">3</span>/3     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="11"></td><td><pre>  csi-rbdplugin-provisioner-687cf777ff-fch2h             <span class="token number">6</span>/6     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="12"></td><td><pre>  csi-rbdplugin-provisioner-687cf777ff-txn2l             <span class="token number">6</span>/6     Running     <span class="token number">1</span>          24h</pre></td></tr><tr><td data-num="13"></td><td><pre>  rook-ceph-crashcollector-hci-node01-5b74c85f6-ftxqn    <span class="token number">1</span>/1     Running     <span class="token number">0</span>          141m</pre></td></tr><tr><td data-num="14"></td><td><pre>  rook-ceph-crashcollector-hci-node03-bd4467796-tk4kh    <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="15"></td><td><pre>  rook-ceph-crashcollector-hci-node04-855695b9c5-q6hgv   <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="16"></td><td><pre>  rook-ceph-mgr-a-7988f89b64-6nw2x                       <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="17"></td><td><pre>  rook-ceph-mon-a-7f94b656fc-74kgj                       <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="18"></td><td><pre>  rook-ceph-mon-b-846c875f6b-kfxgb                       <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="19"></td><td><pre>  rook-ceph-mon-c-5889b5879f-tkd5g                       <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="20"></td><td><pre>  rook-ceph-operator-6b986cf46d-xgk9z                    <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="21"></td><td><pre>  rook-ceph-osd-0-869dd5f9b9-z9p4v                       <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="22"></td><td><pre>  rook-ceph-osd-1-d444b579d-x5c6g                        <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="23"></td><td><pre>  rook-ceph-osd-2-c9cb4cf-jwvn7                          <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="24"></td><td><pre>  rook-ceph-osd-3-5fd9dc87c-zm4mv                        <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="25"></td><td><pre>  rook-ceph-osd-4-9bcbd9777-8hc98                        <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="26"></td><td><pre>  rook-ceph-osd-5-747897f6ff-p84qh                       <span class="token number">1</span>/1     Running     <span class="token number">0</span>          24h</pre></td></tr><tr><td data-num="27"></td><td><pre>  rook-ceph-osd-prepare-hci-node01-ztbs9                 <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          5h25m</pre></td></tr><tr><td data-num="28"></td><td><pre>  rook-ceph-osd-prepare-hci-node03-2qd9g                 <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          5h25m</pre></td></tr><tr><td data-num="29"></td><td><pre>  rook-ceph-osd-prepare-hci-node04-jfbth                 <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          5h25m</pre></td></tr></table></figure><ol start="4"><li>Confirm that the disk is occupied by the ceph osd process</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">fuser</span> -mv /dev/sdc1</pre></td></tr><tr><td data-num="2"></td><td><pre>                       <span class="token environment constant">USER</span>        PID ACCESS COMMAND</pre></td></tr><tr><td data-num="3"></td><td><pre>  /dev/sdc1:           <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>  <span class="token number">76694</span> F<span class="token punctuation">..</span><span class="token punctuation">..</span> ceph-osd</pre></td></tr><tr><td data-num="4"></td><td><pre>$ <span class="token function">fuser</span> -mv /dev/sdc2</pre></td></tr><tr><td data-num="5"></td><td><pre>                       <span class="token environment constant">USER</span>        PID ACCESS COMMAND</pre></td></tr><tr><td data-num="6"></td><td><pre>  /dev/sdc2:           <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>  <span class="token number">76878</span> F<span class="token punctuation">..</span><span class="token punctuation">..</span> ceph-osd</pre></td></tr></table></figure><ol start="5"><li>To verify that the cluster is in a healthy state, connect to the Rook toolbox and run the ceph status command.</li></ol><ul><li>All mons should be in quorum</li><li>A mgr should be active</li><li>At least one OSD should be active</li><li>If the health is not HEALTH_OK, the warnings or errors should be investigated.</li></ul><p>Running the Toolbox in Kubernetes:</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl create -f toolbox.yaml</pre></td></tr></table></figure><p>Wait for the toolbox pod to download its container and get to the running state:</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl -n rook-ceph rollout status deploy/rook-ceph-tools</pre></td></tr></table></figure><p>Once the rook-ceph-tools pod is running, you can connect to it with:</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl -n rook-ceph <span class="token builtin class-name">exec</span> -it deploy/rook-ceph-tools -- <span class="token function">bash</span></pre></td></tr></table></figure><p>Example:</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ ceph status</pre></td></tr><tr><td data-num="2"></td><td><pre>    cluster:</pre></td></tr><tr><td data-num="3"></td><td><pre>      id:     10bfaaa8-a143-406e-9cd0-69d691dac2b2</pre></td></tr><tr><td data-num="4"></td><td><pre>      health: HEALTH_OK</pre></td></tr><tr><td data-num="5"></td><td><pre>  </pre></td></tr><tr><td data-num="6"></td><td><pre>    services:</pre></td></tr><tr><td data-num="7"></td><td><pre>      mon: <span class="token number">3</span> daemons, quorum a,b,c <span class="token punctuation">(</span>age 24h<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      mgr: a<span class="token punctuation">(</span>active, since 24h<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      osd: <span class="token number">6</span> osds: <span class="token number">6</span> up <span class="token punctuation">(</span>since 24h<span class="token punctuation">)</span>, <span class="token number">6</span> <span class="token keyword">in</span> <span class="token punctuation">(</span>since 24h<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      rgw: <span class="token number">1</span> daemon active <span class="token punctuation">(</span>my.store.a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  </pre></td></tr><tr><td data-num="12"></td><td><pre>    task status:</pre></td></tr><tr><td data-num="13"></td><td><pre>  </pre></td></tr><tr><td data-num="14"></td><td><pre>    data:</pre></td></tr><tr><td data-num="15"></td><td><pre>      pools:   <span class="token number">8</span> pools, <span class="token number">81</span> pgs</pre></td></tr><tr><td data-num="16"></td><td><pre>      objects: <span class="token number">292</span> objects, <span class="token number">341</span> KiB</pre></td></tr><tr><td data-num="17"></td><td><pre>      usage:   <span class="token number">6.0</span> GiB used, <span class="token number">2.9</span> TiB / <span class="token number">2.9</span> TiB avail</pre></td></tr><tr><td data-num="18"></td><td><pre>      pgs:     <span class="token number">81</span> active+clean</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>$ ceph osd status</pre></td></tr><tr><td data-num="21"></td><td><pre>  ID  HOST         USED  AVAIL  WR OPS  WR DATA  RD OPS  RD DATA  STATE</pre></td></tr><tr><td data-num="22"></td><td><pre>   <span class="token number">0</span>  hci-node01  1024M   498G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up</pre></td></tr><tr><td data-num="23"></td><td><pre>   <span class="token number">1</span>  hci-node04  1024M   498G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up</pre></td></tr><tr><td data-num="24"></td><td><pre>   <span class="token number">2</span>  hci-node03  1024M   498G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up</pre></td></tr><tr><td data-num="25"></td><td><pre>   <span class="token number">3</span>  hci-node01  1024M   498G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up</pre></td></tr><tr><td data-num="26"></td><td><pre>   <span class="token number">4</span>  hci-node04  1024M   498G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up</pre></td></tr><tr><td data-num="27"></td><td><pre>   <span class="token number">5</span>  hci-node03  1024M   498G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up</pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>$ ceph <span class="token function">df</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  --- RAW STORAGE ---</pre></td></tr><tr><td data-num="32"></td><td><pre>  CLASS  SIZE     AVAIL    USED     RAW USED  %RAW USED</pre></td></tr><tr><td data-num="33"></td><td><pre>  ssd    <span class="token number">2.9</span> TiB  <span class="token number">2.9</span> TiB  <span class="token number">4.2</span> MiB   <span class="token number">6.0</span> GiB       <span class="token number">0.20</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  TOTAL  <span class="token number">2.9</span> TiB  <span class="token number">2.9</span> TiB  <span class="token number">4.2</span> MiB   <span class="token number">6.0</span> GiB       <span class="token number">0.20</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  </pre></td></tr><tr><td data-num="36"></td><td><pre>  --- POOLS ---</pre></td></tr><tr><td data-num="37"></td><td><pre>  POOL                         ID  PGS  STORED   OBJECTS  USED      %USED  MAX AVAIL</pre></td></tr><tr><td data-num="38"></td><td><pre>  device_health_metrics         <span class="token number">1</span>    <span class="token number">1</span>      <span class="token number">0</span> B        <span class="token number">3</span>       <span class="token number">0</span> B      <span class="token number">0</span>    <span class="token number">948</span> GiB</pre></td></tr><tr><td data-num="39"></td><td><pre>  my-store.rgw.buckets.non-ec   <span class="token number">2</span>    <span class="token number">8</span>      <span class="token number">0</span> B        <span class="token number">0</span>       <span class="token number">0</span> B      <span class="token number">0</span>    <span class="token number">948</span> GiB</pre></td></tr><tr><td data-num="40"></td><td><pre>  my-store.rgw.control          <span class="token number">3</span>    <span class="token number">8</span>      <span class="token number">0</span> B        <span class="token number">8</span>       <span class="token number">0</span> B      <span class="token number">0</span>    <span class="token number">948</span> GiB</pre></td></tr><tr><td data-num="41"></td><td><pre>  my-store.rgw.meta             <span class="token number">4</span>    <span class="token number">8</span>  <span class="token number">3.5</span> KiB       <span class="token number">16</span>   <span class="token number">168</span> KiB      <span class="token number">0</span>    <span class="token number">948</span> GiB</pre></td></tr><tr><td data-num="42"></td><td><pre>  my-store.rgw.log              <span class="token number">5</span>    <span class="token number">8</span>  <span class="token number">3.6</span> KiB      <span class="token number">213</span>   <span class="token number">420</span> KiB      <span class="token number">0</span>    <span class="token number">948</span> GiB</pre></td></tr><tr><td data-num="43"></td><td><pre>  .rgw.root                     <span class="token number">6</span>    <span class="token number">8</span>  <span class="token number">3.9</span> KiB       <span class="token number">16</span>   <span class="token number">180</span> KiB      <span class="token number">0</span>    <span class="token number">948</span> GiB</pre></td></tr><tr><td data-num="44"></td><td><pre>  my-store.rgw.buckets.index    <span class="token number">7</span>    <span class="token number">8</span>      <span class="token number">0</span> B       <span class="token number">33</span>       <span class="token number">0</span> B      <span class="token number">0</span>    <span class="token number">948</span> GiB</pre></td></tr><tr><td data-num="45"></td><td><pre>  my-store.rgw.buckets.data     <span class="token number">8</span>   <span class="token number">32</span>  <span class="token number">330</span> KiB        <span class="token number">3</span>  <span class="token number">1020</span> KiB      <span class="token number">0</span>    <span class="token number">948</span> GiB</pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>$ rados <span class="token function">df</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  POOL_NAME                        USED  OBJECTS  CLONES  COPIES  MISSING_ON_PRIMARY  UNFOUND  DEGRADED  RD_OPS       RD  WR_OPS       WR  USED COMPR  UNDER COMPR</pre></td></tr><tr><td data-num="50"></td><td><pre>  .rgw.root                     <span class="token number">180</span> KiB       <span class="token number">16</span>       <span class="token number">0</span>      <span class="token number">48</span>                   <span class="token number">0</span>        <span class="token number">0</span>         <span class="token number">0</span>     <span class="token number">105</span>  <span class="token number">105</span> KiB      <span class="token number">28</span>   <span class="token number">21</span> KiB         <span class="token number">0</span> B          <span class="token number">0</span> B</pre></td></tr><tr><td data-num="51"></td><td><pre>  device_health_metrics             <span class="token number">0</span> B        <span class="token number">3</span>       <span class="token number">0</span>       <span class="token number">9</span>                   <span class="token number">0</span>        <span class="token number">0</span>         <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span> B       <span class="token number">3</span>   <span class="token number">54</span> KiB         <span class="token number">0</span> B          <span class="token number">0</span> B</pre></td></tr><tr><td data-num="52"></td><td><pre>  my-store.rgw.buckets.data    <span class="token number">1020</span> KiB        <span class="token number">3</span>       <span class="token number">0</span>       <span class="token number">9</span>                   <span class="token number">0</span>        <span class="token number">0</span>         <span class="token number">0</span>    <span class="token number">1083</span>  <span class="token number">1.7</span> MiB    <span class="token number">1870</span>  <span class="token number">484</span> KiB         <span class="token number">0</span> B          <span class="token number">0</span> B</pre></td></tr><tr><td data-num="53"></td><td><pre>  my-store.rgw.buckets.index        <span class="token number">0</span> B       <span class="token number">33</span>       <span class="token number">0</span>      <span class="token number">99</span>                   <span class="token number">0</span>        <span class="token number">0</span>         <span class="token number">0</span>    <span class="token number">2227</span>  <span class="token number">2.2</span> MiB    <span class="token number">4304</span>  <span class="token number">465</span> KiB         <span class="token number">0</span> B          <span class="token number">0</span> B</pre></td></tr><tr><td data-num="54"></td><td><pre>  my-store.rgw.buckets.non-ec       <span class="token number">0</span> B        <span class="token number">0</span>       <span class="token number">0</span>       <span class="token number">0</span>                   <span class="token number">0</span>        <span class="token number">0</span>         <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span> B       <span class="token number">0</span>      <span class="token number">0</span> B         <span class="token number">0</span> B          <span class="token number">0</span> B</pre></td></tr><tr><td data-num="55"></td><td><pre>  my-store.rgw.control              <span class="token number">0</span> B        <span class="token number">8</span>       <span class="token number">0</span>      <span class="token number">24</span>                   <span class="token number">0</span>        <span class="token number">0</span>         <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span> B       <span class="token number">0</span>      <span class="token number">0</span> B         <span class="token number">0</span> B          <span class="token number">0</span> B</pre></td></tr><tr><td data-num="56"></td><td><pre>  my-store.rgw.log              <span class="token number">420</span> KiB      <span class="token number">213</span>       <span class="token number">0</span>     <span class="token number">639</span>                   <span class="token number">0</span>        <span class="token number">0</span>         <span class="token number">0</span>    <span class="token number">7911</span>  <span class="token number">7.5</span> MiB    <span class="token number">5385</span>  <span class="token number">367</span> KiB         <span class="token number">0</span> B          <span class="token number">0</span> B</pre></td></tr><tr><td data-num="57"></td><td><pre>  my-store.rgw.meta             <span class="token number">168</span> KiB       <span class="token number">16</span>       <span class="token number">0</span>      <span class="token number">48</span>                   <span class="token number">0</span>        <span class="token number">0</span>         <span class="token number">0</span>    <span class="token number">2219</span>  <span class="token number">1.8</span> MiB    <span class="token number">1203</span>  <span class="token number">374</span> KiB         <span class="token number">0</span> B          <span class="token number">0</span> B</pre></td></tr><tr><td data-num="58"></td><td><pre>  </pre></td></tr><tr><td data-num="59"></td><td><pre>  total_objects    <span class="token number">292</span></pre></td></tr><tr><td data-num="60"></td><td><pre>  total_used       <span class="token number">6.0</span> GiB</pre></td></tr><tr><td data-num="61"></td><td><pre>  total_avail      <span class="token number">2.9</span> TiB</pre></td></tr><tr><td data-num="62"></td><td><pre>  total_space      <span class="token number">2.9</span> TiB</pre></td></tr></table></figure><p>When you are done with the toolbox, you can remove the deployment, but if you want continue to doing other test experiments below, please keep the toolbox:</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">(</span>Optional<span class="token punctuation">)</span>kubectl -n rook-ceph delete deployment rook-ceph-tools</pre></td></tr></table></figure><h2 id="object-store"><a class="anchor" href="#object-store">#</a> <strong>Object Store</strong></h2><p>Create an Object Store</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> cluster/examples/kubernetes/ceph</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>// Create the object store</pre></td></tr><tr><td data-num="4"></td><td><pre>kubectl create -f object.yaml</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>// To confirm the object store is configured, <span class="token function">wait</span> <span class="token keyword">for</span> the rgw pod to start</pre></td></tr><tr><td data-num="7"></td><td><pre>kubectl -n rook-ceph get pod -l <span class="token assign-left variable">app</span><span class="token operator">=</span>rook-ceph-rgw</pre></td></tr><tr><td data-num="8"></td><td><pre>kubectl -n rook-ceph get svc -l <span class="token assign-left variable">app</span><span class="token operator">=</span>rook-ceph-rgw</pre></td></tr></table></figure><h2 id="create-bucket"><a class="anchor" href="#create-bucket">#</a> Create Bucket</h2><h3 id="第一种通过s3接口创建bucket"><a class="anchor" href="#第一种通过s3接口创建bucket">#</a> 第一种：通过 S3 接口创建 Bucket</h3><ol><li>Create a User</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>// Create the object store user</pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl create -f object-user.yaml</pre></td></tr></table></figure><ol start="2"><li>创建 external service</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl create -f rgw-external.yaml</pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl -n rook-ceph get <span class="token function">service</span> rook-ceph-rgw-my-store rook-ceph-rgw-my-store-external</pre></td></tr><tr><td data-num="3"></td><td><pre>  NAME                              TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE</pre></td></tr><tr><td data-num="4"></td><td><pre>  rook-ceph-rgw-my-store            ClusterIP   <span class="token number">10.109</span>.208.9   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>/TCP         171m</pre></td></tr><tr><td data-num="5"></td><td><pre>  rook-ceph-rgw-my-store-external   NodePort    <span class="token number">10.97</span>.94.98    <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>:32314/TCP   153m</pre></td></tr></table></figure><ol start="3"><li>To confirm the object store user is configured, describe the secret</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl -n rook-ceph describe secret rook-ceph-object-user-my-store-my-user</pre></td></tr></table></figure><ol start="4"><li>To directly retrieve the secrets</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_HOST</span><span class="token operator">=</span>http://10.67.108.211:32314</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_ENDPOINT</span><span class="token operator">=</span><span class="token number">10.67</span>.108.211:32314</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">$(</span>kubectl -n rook-ceph get secret rook-ceph-object-user-my-store-my-user -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'&#123;.data.AccessKey&#125;'</span> <span class="token operator">|</span> base64 --decode<span class="token variable">)</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span>64ILG09702G1R3LQTUX6</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">$(</span>kubectl -n rook-ceph get secret rook-ceph-object-user-my-store-my-user -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'&#123;.data.SecretKey&#125;'</span> <span class="token operator">|</span> base64 --decode<span class="token variable">)</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span>WAghMWZM1YSYrAXrUiZVKWUV78cWI6yNoELZP21s</pre></td></tr></table></figure><ul><li><code>AWS_HOST</code> : Combine the Cluster Node IP and the NodePort</li><li><code>AWS_ENDPOINT</code> : Combine the Cluster Node IP and the NodePort</li></ul><div class="tab" data-id="id02" data-title="S3cmd操作方法"><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token builtin class-name">echo</span> <span class="token string">"Hello Rook 01"</span> <span class="token operator">></span> /tmp/clean.sh</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>$ s3cmd mb --no-ssl --host<span class="token operator">=</span><span class="token variable">$&#123;AWS_HOST&#125;</span> --region<span class="token operator">=</span><span class="token string">":default-placement"</span> --host-bucket<span class="token operator">=</span> s3://bucket01</pre></td></tr><tr><td data-num="4"></td><td><pre>  Bucket <span class="token string">'s3://bucket02/'</span> created</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>$ s3cmd put /tmp/clean.sh --no-ssl --host<span class="token operator">=</span><span class="token variable">$&#123;AWS_HOST&#125;</span> --host-bucket<span class="token operator">=</span>  s3://bucket01</pre></td></tr><tr><td data-num="7"></td><td><pre>  upload: <span class="token string">'/tmp/clean.sh'</span> -<span class="token operator">></span> <span class="token string">'s3://bucket02/clean.sh'</span>  <span class="token punctuation">[</span><span class="token number">1</span> of <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token number">14</span> of <span class="token number">14</span>   <span class="token number">100</span>% <span class="token keyword">in</span>    0s   <span class="token number">260.42</span> B/s  <span class="token keyword">done</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>$ s3cmd get s3://bucket01/clean.sh /tmp/download-clean.sh --no-ssl --host<span class="token operator">=</span><span class="token variable">$&#123;AWS_HOST&#125;</span> --host-bucket<span class="token operator">=</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  download: <span class="token string">'s3://bucket01/clean.sh'</span> -<span class="token operator">></span> <span class="token string">'/tmp/download-clean.sh'</span>  <span class="token punctuation">[</span><span class="token number">1</span> of <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre>   <span class="token number">14</span> of <span class="token number">14</span>   <span class="token number">100</span>% <span class="token keyword">in</span>    0s   <span class="token number">328.99</span> B/s  <span class="token keyword">done</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>$ <span class="token function">cat</span> /tmp/download-clean.sh</pre></td></tr><tr><td data-num="15"></td><td><pre>  Hello Rook 01</pre></td></tr></table></figure></div><div class="tab" data-id="id02" data-title="minIO mc 操作方法"><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ ./mc config <span class="token function">host</span> <span class="token function">add</span> cephObject http://<span class="token operator">&lt;</span>Node-IP<span class="token operator">></span>:32314 64ILG09702G1R3LQTUX6 WAghMWZM1YSYrAXrUiZVKWUV78cWI6yNoELZP21s --api S3v4</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>$ ./mc <span class="token function">ls</span> cephObject</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>$ ./mc mb cephObject/bucket01</pre></td></tr><tr><td data-num="6"></td><td><pre>    Bucket created successfully <span class="token variable"><span class="token variable">`</span>cephObject/bucket01<span class="token variable">`</span></span><span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>$ ./mc <span class="token function">ls</span> cephObject</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">[</span><span class="token number">2021</span>-07-01 <span class="token number">13</span>:13:53 CST<span class="token punctuation">]</span>      0B bucket01/</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>$ ./mc <span class="token function">cp</span> clean.sh cephObject/bucket01</pre></td></tr><tr><td data-num="12"></td><td><pre>    clean.sh:               <span class="token number">657</span> B / <span class="token number">657</span> B     ┃▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓┃ <span class="token number">10.60</span> KiB/s 0s</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>$ ./mc <span class="token function">ls</span> cephObject/bucket01</pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">[</span><span class="token number">2021</span>-07-01 <span class="token number">13</span>:16:35 CST<span class="token punctuation">]</span>    657B clean.sh</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>$ ./mc <span class="token function">cp</span> cephObject/bucket01/clean.sh /tmp/download-clean.sh</pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">..</span>./bucket01/clean.sh:  <span class="token number">657</span> B / <span class="token number">657</span> B ┃▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓┃ <span class="token number">11.93</span> KiB/s 0s<span class="token punctuation">[</span></pre></td></tr></table></figure></div><h3 id="第二种通过yaml创建bucket"><a class="anchor" href="#第二种通过yaml创建bucket">#</a> 第二种：通过 yaml 创建 Bucket</h3><ol><li>Define a storage class that will allow object clients to create a bucket.</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>// Define the storage class that will allow object clients to create a bucket</pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl create -f storageclass-bucket-delete.yaml</pre></td></tr></table></figure><ol start="2"><li>Create a Bucket<br>An Object Bucket Claim (OBC) is custom resource which requests a bucket (new or existing) and is described by a Custom Resource Definition (CRD).</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>// Create an Object Bucket Claim <span class="token punctuation">(</span>OBC<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>$ kubectl create -f object-bucket-claim-delete.yaml</pre></td></tr></table></figure><p>When the OBC is created, the Rook-Ceph bucket provisioner will create a new bucket.A <code>secret</code> and <code>ConfigMap</code> are created with the same name as the OBC and in the same namespace. The secret contains credentials used by the application pod to access the bucket. The ConfigMap contains bucket endpoint information and is also consumed by the pod.</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>// Check the created bucket name, <span class="token string">"ceph-bkt-5124df41-7939-4aa6-b989-2bff0aa38deb"</span> as shown below.</pre></td></tr><tr><td data-num="2"></td><td><pre>$ kubectl describe obc ceph-delete-bucket</pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  Spec:</pre></td></tr><tr><td data-num="5"></td><td><pre>    Object Bucket Name:    obc-default-ceph-delete-bucket</pre></td></tr><tr><td data-num="6"></td><td><pre>    Bucket Name:           ceph-bkt-5124df41-7939-4aa6-b989-2bff0aa38deb</pre></td></tr><tr><td data-num="7"></td><td><pre>    Generate Bucket Name:  ceph-bkt</pre></td></tr><tr><td data-num="8"></td><td><pre>    Storage Class Name:    rook-ceph-delete-bucket</pre></td></tr><tr><td data-num="9"></td><td><pre>  Status:</pre></td></tr><tr><td data-num="10"></td><td><pre>    Phase:  Bound		// <span class="token punctuation">[</span>Notice<span class="token punctuation">]</span>: The Status must be Bound, <span class="token keyword">if</span> <span class="token variable"><span class="token variable">`</span>Pending<span class="token variable">`</span></span>, please <span class="token function">wait</span> or delete and recreate the obc.</pre></td></tr><tr><td data-num="11"></td><td><pre>  Events:   <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr></table></figure><p>An Object Bucket (OB) is a custom resource automatically generated when a bucket is provisioned. It is a global resource, typically not visible to non-admin users, and contains information specific to the bucket. It is described by an OB CRD.</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>// Check the OB</pre></td></tr><tr><td data-num="2"></td><td><pre>$ kubectl get ob</pre></td></tr><tr><td data-num="3"></td><td><pre>  NAME                             AGE</pre></td></tr><tr><td data-num="4"></td><td><pre>  obc-default-ceph-delete-bucket   5m16s</pre></td></tr></table></figure><ol start="3"><li>Create another Bucket<br>Change the ObjectBucketClaim <span class="exturl" data-url="aHR0cDovL21ldGFkYXRhLm5hbWU=">metadata.name</span> and create another bucket.</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">vim</span> object-bucket-claim-delete.yaml</pre></td></tr><tr><td data-num="2"></td><td><pre>  apiVersion: objectbucket.io/v1alpha1</pre></td></tr><tr><td data-num="3"></td><td><pre>  kind: ObjectBucketClaim</pre></td></tr><tr><td data-num="4"></td><td><pre>  metadata:</pre></td></tr><tr><td data-num="5"></td><td><pre>    name: ceph-bucket-new		<span class="token comment"># Change bucket name</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  spec:</pre></td></tr><tr><td data-num="7"></td><td><pre>    generateBucketName: ceph-bkt</pre></td></tr><tr><td data-num="8"></td><td><pre>    storageClassName: rook-ceph-bucket</pre></td></tr><tr><td data-num="9"></td><td><pre>$ kubectl create -f object-bucket-claim-delete.yaml</pre></td></tr></table></figure><p><strong>Client Connections</strong><br>The following commands extract key pieces of information from the secret and configmap:</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#config-map, secret, OBC will part of default if no specific name space mentioned</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_HOST</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl -n default get cm ceph-delete-bucket -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'&#123;.data.BUCKET_HOST&#125;'</span><span class="token variable">)</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl -n default get secret ceph-delete-bucket -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'&#123;.data.AWS_ACCESS_KEY_ID&#125;'</span> <span class="token operator">|</span> base64 --decode<span class="token variable">)</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl -n default get secret ceph-delete-bucket -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'&#123;.data.AWS_SECRET_ACCESS_KEY&#125;'</span> <span class="token operator">|</span> base64 --decode<span class="token variable">)</span></span></pre></td></tr></table></figure><ul><li><code>AWS_Host</code> : The DNS host name where the rgw service is found in the cluster. Assuming you are using the default rook-ceph cluster, it will be rook-ceph-rgw-my-store.rook-ceph.</li><li><code>AWS_Endpoint</code> : The endpoint where the rgw service is listening. Run kubectl -n rook-ceph get svc rook-ceph-rgw-my-store, then combine the clusterIP and the port.</li><li><code>AWS_ACCESS_KEY_ID</code> : The user’s access_key as printed above</li><li><code>AWS_SECRET_ACCESS_KEY</code> : The user’s secret_key as printed above</li></ul><ol start="4"><li>Consume the Object Storage<br><strong>Enter into the toolbox</strong></li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl <span class="token builtin class-name">exec</span> <span class="token variable"><span class="token variable">$(</span>kubectl get po -l <span class="token assign-left variable">app</span><span class="token operator">=</span>rook-ceph-tools -n rook-ceph -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'&#123;.items[0].metadata.name&#125;'</span><span class="token variable">)</span></span> -it -n rook-ceph -- <span class="token function">bash</span></pre></td></tr></table></figure><p>Connected to the Rook toolbox Pod and then set the four environment variables for use by your client(ie. inside the toolbox).</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_HOST</span><span class="token operator">=</span>rook-ceph-rgw-my-store.rook-ceph</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>Optional<span class="token punctuation">)</span>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_ENDPOINT</span><span class="token operator">=</span>rook-ceph-rgw-my-store:80</pre></td></tr><tr><td data-num="3"></td><td><pre>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span>64ILG09702G1R3LQTUX6</pre></td></tr><tr><td data-num="4"></td><td><pre>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span>WAghMWZM1YSYrAXrUiZVKWUV78cWI6yNoELZP21s</pre></td></tr></table></figure><p>Endpoint: The endpoint where the rgw service is listening. Run <code>kubectl -n rook-ceph get svc rook-ceph-rgw-my-store</code> , then combine the clusterIP and the port.</p><p><strong>Install s3cmd</strong></p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token builtin class-name">echo</span> <span class="token assign-left variable">proxy</span><span class="token operator">=</span>http://Proxy-Name:913 <span class="token operator">>></span> /etc/yum.conf</pre></td></tr><tr><td data-num="2"></td><td><pre>$ yum --assumeyes <span class="token function">install</span> s3cmd</pre></td></tr></table></figure><p><strong>PUT or GET an object</strong><br>Upload a file to the newly created bucket</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token builtin class-name">echo</span> <span class="token string">"Hello Rook"</span> <span class="token operator">></span> /tmp/rookObj</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>$ s3cmd put /tmp/rookObj --no-ssl --host<span class="token operator">=</span><span class="token variable">$&#123;AWS_HOST&#125;</span> --host-bucket<span class="token operator">=</span>  s3://<span class="token operator">&lt;</span>-Your-Bucket-Name-<span class="token operator">></span> // As follow.</pre></td></tr><tr><td data-num="4"></td><td><pre>// $ s3cmd put /tmp/rookObj --no-ssl --host<span class="token operator">=</span><span class="token variable">$&#123;AWS_HOST&#125;</span> --host-bucket<span class="token operator">=</span>  s3://ceph-bkt-5124df41-7939-4aa6-b989-2bff0aa38deb</pre></td></tr><tr><td data-num="5"></td><td><pre>  upload: <span class="token string">'/tmp/rookObj'</span> -<span class="token operator">></span> <span class="token string">'s3://ceph-bkt-5124df41-7939-4aa6-b989-2bff0aa38deb/rookObj'</span>  <span class="token punctuation">[</span><span class="token number">1</span> of <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token number">11</span> of <span class="token number">11</span>   <span class="token number">100</span>% <span class="token keyword">in</span>    0s   <span class="token number">190.11</span> B/s  <span class="token keyword">done</span></pre></td></tr></table></figure><p>Download and verify the file from the bucket</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ s3cmd get s3://<span class="token operator">&lt;</span>-Your-Bucket-Name-<span class="token operator">></span>/rookObj /tmp/rookObj-download --no-ssl --host<span class="token operator">=</span><span class="token variable">$&#123;AWS_HOST&#125;</span> --host-bucket<span class="token operator">=</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  download: <span class="token string">'s3://ceph-bkt-5124df41-7939-4aa6-b989-2bff0aa38deb/rookObj'</span> -<span class="token operator">></span> <span class="token string">'/tmp/rookObj-download'</span>  <span class="token punctuation">[</span><span class="token number">1</span> of <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token number">11</span> of <span class="token number">11</span>   <span class="token number">100</span>% <span class="token keyword">in</span>    0s   <span class="token number">254.34</span> B/s  <span class="token keyword">done</span></pre></td></tr><tr><td data-num="4"></td><td><pre>$ <span class="token function">cat</span> /tmp/rookObj-download</pre></td></tr></table></figure><p>List the buckets</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ s3cmd <span class="token function">ls</span> --no-ssl --host<span class="token operator">=</span><span class="token variable">$&#123;AWS_HOST&#125;</span> --host-bucket<span class="token operator">=</span></pre></td></tr></table></figure><h2 id="teardown"><a class="anchor" href="#teardown">#</a> Teardown</h2><ol><li>Delete the CephCluster CRD</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl -n rook-ceph patch cephcluster rook-ceph --type merge -p <span class="token string">'&#123;"spec":&#123;"cleanupPolicy":&#123;"confirmation":"yes-really-destroy-data"&#125;&#125;&#125;'</span></pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl -n rook-ceph delete cephcluster rook-ceph</pre></td></tr></table></figure><ol start="2"><li>Delete the Operator and related Resources</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl delete -f operator.yaml  -f common.yaml -f crds.yaml</pre></td></tr></table></figure><ol start="3"><li>删掉未删除的 crd, 如果以前创建过 Object bucket 的话.</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> <span class="token for-or-select variable">CRD</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span>kubectl get crd -n rook-ceph <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'/ceph.rook.io/ &#123;print <span class="token variable">$1</span>&#125;'</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    kubectl get -n rook-ceph <span class="token string">"<span class="token variable">$CRD</span>"</span> -o name <span class="token operator">|</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">xargs</span> -I <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> kubectl patch <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> -n rook-ceph --type merge -p <span class="token string">'&#123;"metadata":&#123;"finalizers": [null]&#125;&#125;'</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">done</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>kubectl patch crd objectbuckets.objectbucket.io --type merge -p <span class="token string">'&#123;"metadata":&#123;"finalizers": [null]&#125;&#125;'</span></pre></td></tr><tr><td data-num="7"></td><td><pre>kubectl patch configmap/ceph-delete-bucket --type merge -p <span class="token string">'&#123;"metadata":&#123;"finalizers": [null]&#125;&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>kubectl patch secret/ceph-delete-bucket --type merge -p '<span class="token punctuation">&#123;</span><span class="token string">"metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"finalizers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>null<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token string">'</span></pre></td></tr><tr><td data-num="9"></td><td><pre>kubectl patch objectbucketclaim.objectbucket.io/ceph-delete-bucket --type merge -p '<span class="token punctuation">&#123;</span><span class="token string">"metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"finalizers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>null<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>'</pre></td></tr></table></figure><ol start="4"><li>/var/lib/rook: Path on each host in the cluster where configuration is cached by the ceph mons and osds. so need to clean the files in the path.</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">rm</span> -rf /var/lib/rook/</pre></td></tr></table></figure><p>Additional: If there are ceph related files in the &quot;/var/lib/kubelet/plugins/&quot; and &quot;/var/lib/kubelet/plugins_registry/&quot; path, delete them.</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">rm</span> -rf /var/lib/kubelet/plugins/rook-ceph.*</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">rm</span> -rf /var/lib/kubelet/plugins_registry/direct.csi.min.io-reg.sock</pre></td></tr></table></figure><ol start="5"><li>If the namespace is still stuck in Terminating state, you can check which resources are holding up the deletion and remove the finalizers and delete those</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl api-resources --verbs<span class="token operator">=</span>list --namespaced -o name <span class="token operator">|</span> <span class="token function">xargs</span> -n <span class="token number">1</span> kubectl get --show-kind --ignore-not-found -n rook-ceph</pre></td></tr></table></figure><ol start="6"><li>Delete the data on hosts</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/usr/bin/env bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token assign-left variable">DISK</span><span class="token operator">=</span><span class="token string">"/dev/sdb"</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># Zap the disk to a fresh, usable state (zap-all is important, b/c MBR has to be clean)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># You will have to run this step for all disks.</span></pre></td></tr><tr><td data-num="7"></td><td><pre>sgdisk --zap-all <span class="token variable">$DISK</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># Clean hdds with dd</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$DISK</span>"</span> <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">100</span> <span class="token assign-left variable">oflag</span><span class="token operator">=</span>direct,dsync</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># Clean disks such as ssd with blkdiscard instead of dd</span></pre></td></tr><tr><td data-num="13"></td><td><pre>blkdiscard <span class="token variable">$DISK</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># These steps only have to be run once on each node</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># If rook sets up osds using ceph-volume, teardown leaves some devices mapped that lock the disks.</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token function">ls</span> /dev/mapper/ceph-* <span class="token operator">|</span> <span class="token function">xargs</span> -I% -- dmsetup remove %</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># ceph-volume setup can leave ceph-&lt;UUID> directories in /dev and /dev/mapper (unnecessary clutter)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token function">rm</span> -rf /dev/ceph-*</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token function">rm</span> -rf /dev/mapper/ceph--*</pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># Inform the OS of partition table changes</span></pre></td></tr><tr><td data-num="24"></td><td><pre>partprobe <span class="token variable">$DISK</span></pre></td></tr></table></figure><h2 id="faq"><a class="anchor" href="#faq">#</a> FAQ</h2><p>If the cluster resource still exists even though you have executed the delete command earlier, see the command below remove the finalizer.</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl -n rook-ceph patch crd cephclusters.ceph.rook.io --type merge -p <span class="token string">'&#123;"metadata":&#123;"finalizers": [null]&#125;&#125;'</span></pre></td></tr></table></figure><h2 id="遇到的问题"><a class="anchor" href="#遇到的问题">#</a> 遇到的问题</h2><p>删除其它机器 pvc 绑定的 /var/lib/kubelet/plugins/* 出错</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">rm</span> -rf /var/lib/kubelet/plugins/rook-ceph.*</pre></td></tr><tr><td data-num="2"></td><td><pre>  rm: cannot remove ‘/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-d6ea6990-2a0b-4f4b-9838-3a971424732d/globalmount’: Device or resource busy</pre></td></tr><tr><td data-num="3"></td><td><pre>  rm: cannot remove ‘/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-a08fed0b-b16d-4a74-a052-7936d6fb8340/globalmount’: Device or resource busy</pre></td></tr></table></figure><p>解决方法:</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">umount</span> /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-d6ea6990-2a0b-4f4b-9838-3a971424732d/globalmount</pre></td></tr><tr><td data-num="2"></td><td><pre>$ <span class="token function">umount</span> /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-a08fed0b-b16d-4a74-a052-7936d6fb8340/globalmount</pre></td></tr></table></figure><p>再进行删除即可</p><div class="tags"><a href="/tags/storage/" rel="tag"><i class="ic i-tag"></i> storage</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-07-02 17:33:44" itemprop="dateModified" datetime="2021-07-02T17:33:44+08:00">2021-07-02</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Kung-Fu-Master 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Kung-Fu-Master 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Kung-Fu-Master 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Kung-Fu-Master <i class="ic i-at"><em>@</em></i>Hexo</li><li class="link"><strong>本文链接：</strong> <a href="https://kung-fu-master.github.io/2021/03/13/storage/ceph/ceph_02_deployment/" title="Ceph 02 deployment on Kubernetes">https://kung-fu-master.github.io/2021/03/13/storage/ceph/ceph_02_deployment/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/03/13/storage/minio/minIO_04_client_SDK/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipesx5fdwj20zk0m81kx.jpg" title="MinIO 04 client SDK"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> minio</span><h3>MinIO 04 client SDK</h3></a></div><div class="item right"><a href="/2021/03/13/technologies/security/token_jwt/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicis3attqj20zk0m8k7l.jpg" title="Token jwt"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> security</span><h3>Token jwt</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#prerequisites"><span class="toc-number">1.</span> <span class="toc-text"># Prerequisites</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#磁盘分区"><span class="toc-number">2.</span> <span class="toc-text"># 磁盘分区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#setup-steps"><span class="toc-number">3.</span> <span class="toc-text"># Setup steps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#object-store"><span class="toc-number">4.</span> <span class="toc-text"># Object Store</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#create-bucket"><span class="toc-number">5.</span> <span class="toc-text"># Create Bucket</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一种通过s3接口创建bucket"><span class="toc-number">5.1.</span> <span class="toc-text"># 第一种：通过 S3 接口创建 Bucket</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二种通过yaml创建bucket"><span class="toc-number">5.2.</span> <span class="toc-text"># 第二种：通过 yaml 创建 Bucket</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#teardown"><span class="toc-number">6.</span> <span class="toc-text"># Teardown</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#faq"><span class="toc-number">7.</span> <span class="toc-text"># FAQ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#遇到的问题"><span class="toc-number">8.</span> <span class="toc-text"># 遇到的问题</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/03/13/storage/ceph/ceph_01_conception/" rel="bookmark" title="Ceph 01 Storage Conception">Ceph 01 Storage Conception</a></li><li class="active"><a href="/2021/03/13/storage/ceph/ceph_02_deployment/" rel="bookmark" title="Ceph 02 deployment on Kubernetes">Ceph 02 deployment on Kubernetes</a></li><li><a href="/2021/07/02/storage/ceph/ceph_03_tls/" rel="bookmark" title="Ceph 03 TLS">Ceph 03 TLS</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Kung-Fu-Master" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Kung-Fu-Master</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">334</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">42</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">14</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/03/13/storage/minio/minIO_04_client_SDK/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/03/13/technologies/security/token_jwt/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/scp%E6%9C%BA%E5%99%A8%E9%97%B4%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6/" title="scp机器间复制文件">scp机器间复制文件</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/blogs/" title="分类于 blogs">blogs</a> <i class="ic i-angle-right"></i> <a href="/categories/blogs/blogs/" title="分类于 blogs">blogs</a></div><span><a href="/2021/03/13/blogs/blogs/VScode_%E9%85%8D%E7%BD%AE%E8%AE%BE%E7%BD%AE/" title="VScode 配置设置">VScode 配置设置</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technologies/" title="分类于 technologies">technologies</a> <i class="ic i-angle-right"></i> <a href="/categories/technologies/security/" title="分类于 security">security</a></div><span><a href="/2021/03/21/technologies/security/kms_vault/" title="KMS vault">KMS vault</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/language/" title="分类于 language">language</a> <i class="ic i-angle-right"></i> <a href="/categories/language/c/" title="分类于 c">c</a></div><span><a href="/2021/06/16/language/c/struct/" title="c struct">c struct</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/storage/" title="分类于 storage">storage</a> <i class="ic i-angle-right"></i> <a href="/categories/storage/greenplum/" title="分类于 greenplum">greenplum</a></div><span><a href="/2021/05/31/storage/greenplum/greenplum_K8s_%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/" title="greenplum(psql) 远程连接k8s部署的greenplum">greenplum(psql) 远程连接k8s部署的greenplum</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/Linux%E4%B8%8B%E5%91%BD%E4%BB%A4Is%E5%92%8C%E5%91%BD%E4%BB%A4dir%E7%9A%84%E5%8C%BA%E5%88%AB/" title="Linux下命令Is和命令dir的区别">Linux下命令Is和命令dir的区别</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/microService/" title="分类于 microService">microService</a> <i class="ic i-angle-right"></i> <a href="/categories/microService/kubernetes/" title="分类于 kubernetes">kubernetes</a></div><span><a href="/2021/05/31/microService/kubernetes/affinity/" title="affinity">affinity</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/%E7%94%A8%E6%88%B7%E6%80%81%E5%92%8C%E5%86%85%E6%A0%B8%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98-%E4%BD%BF%E7%94%A8dev_mem&mmap/" title="用户态和内核共享内存----使用 &#x2F;dev&#x2F;mem &amp; mmap">用户态和内核共享内存----使用 /dev/mem & mmap</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/storage/" title="分类于 storage">storage</a> <i class="ic i-angle-right"></i> <a href="/categories/storage/greenplum/" title="分类于 greenplum">greenplum</a></div><span><a href="/2021/05/31/storage/greenplum/greenplum_01_deployment/" title="greenplum 01 deployment on Kubernetes">greenplum 01 deployment on Kubernetes</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technologies/" title="分类于 technologies">technologies</a> <i class="ic i-angle-right"></i> <a href="/categories/technologies/security/" title="分类于 security">security</a></div><span><a href="/2021/03/16/technologies/security/openssl_update/" title="openssl update">openssl update</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Kung-Fu-Master @ Kung Fu Master</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.3m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">19:16</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/03/13/storage/ceph/ceph_02_deployment/",favicon:{show:"（●´3｀●）",hide:"（●´3｀●）"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->