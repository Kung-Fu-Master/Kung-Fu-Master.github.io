<!-- build time:Mon Jun 07 2021 20:55:31 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Hexo" href="https://kung-fu-master.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Hexo" href="https://kung-fu-master.github.io/atom.xml"><link rel="alternate" type="application/json" title="Hexo" href="https://kung-fu-master.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="storage"><link rel="canonical" href="https://kung-fu-master.github.io/2021/05/31/storage/greenplum/greenplum_01_deployment/"><title>greenplum 01 deployment on Kubernetes - greenplum - storage | Kung Fu Master = Hexo</title><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">greenplum 01 deployment on Kubernetes</h1><div class="meta"><span class="item" title="创建时间：2021-05-31 11:28:46"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-05-31T11:28:46+08:00">2021-05-31</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>14k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>13 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Kung Fu Master</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicm07ih54j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclimtf7dj20zk0m8qav.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicivghyooj20zk0m8dir.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipexoj0moj20zk0m8kgu.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclwrdwyaj20zk0m8are.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeybxm1pj20zk0m8niv.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/storage/" itemprop="item" rel="index" title="分类于 storage"><span itemprop="name">storage</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/storage/greenplum/" itemprop="item" rel="index" title="分类于 greenplum"><span itemprop="name">greenplum</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://kung-fu-master.github.io/2021/05/31/storage/greenplum/greenplum_01_deployment/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Kung-Fu-Master"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><div class="body md" itemprop="articleBody"><h2 id="prerequisites"><a class="anchor" href="#prerequisites">#</a> <strong>Prerequisites</strong></h2><ol><li><span class="exturl" data-url="aHR0cDovL2dyZWVucGx1bS1rdWJlcm5ldGVzLmRvY3MucGl2b3RhbC5pby8yLTAvbm9kZS1yZXF1aXJlbWVudHMuaHRtbA==">Kubernetes Node Configuration</span> describes the Linux kernel configuration requirements for each Kubernetes node that is used in a Pivotal Greenplum cluster. These requirements are common to all Pivotal Greenplum deployments, regardless of which Kubernetes environment you use.</li><li>Ensure that any previous Pivotal Greenplum installation has been uninstalled as described in Uninstalling Pivotal Greenplum.</li><li>kubectl configured to refer to a Kubernetes cluster.</li></ol><p>mount 磁盘，使得 greenplum 存储的数据保存到指定的挂载磁盘目录.</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">mount</span> /dev/sdb1 /mnt/greenplum/greenplum-master-vol0/</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">mount</span> /dev/sdb2 /mnt/greenplum/greenplum-segment-vol0/</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">mount</span> /dev/sdb3 /mnt/greenplum/greenplum-segment-vol1/</pre></td></tr></table></figure><p>将挂在的磁盘写到系统文件.</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vim</span> /etc/fstab</pre></td></tr><tr><td data-num="2"></td><td><pre>  /dev/sdb1               /mnt/greenplum/greenplum-master-vol0      ext4    defaults        <span class="token number">0</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  /dev/sdb2               /mnt/greenplum/greenplum-segment-vol0     ext4    defaults        <span class="token number">0</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  /dev/sdb3               /mnt/greenplum/greenplum-segment-vol1     ext4    defaults        <span class="token number">0</span> <span class="token number">0</span></pre></td></tr></table></figure><h2 id="install-greenplum-operator-for-kubernetes"><a class="anchor" href="#install-greenplum-operator-for-kubernetes">#</a> <strong>Install Greenplum Operator for Kubernetes</strong></h2><ol><li><p>Download the Pivotal Greenplum software from <span class="exturl" data-url="aHR0cHM6Ly9uZXR3b3JrLnBpdm90YWwuaW8vcHJvZHVjdHMvZ3JlZW5wbHVtLWZvci1rdWJlcm5ldGVz">VMware Tanzu Network</span> or skip to step 3 if have greenplum related files. The download file has the name: <code>greenplum-for-kubernetes-&lt;version&gt;.tar.gz.</code></p></li><li><p>Go to the directory where you downloaded Greenplum for Kubernetes, and unpack the downloaded software. For example:</p></li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> ~/Downloads</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">tar</span> xzf greenplum-for-kubernetes-*.tar.gz</pre></td></tr></table></figure><p>The above command unpacks the distribution into a new directory named <code>greenplum-for-kubernetes-&lt;version&gt;</code> .<br>3. Go into the new greenplum-for-kubernetes-&lt;version&gt; directory:</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> ./greenplum-for-kubernetes-*</pre></td></tr></table></figure><ol start="4"><li>Load the Greenplum for Kubernetes Docker image to the local Docker registry:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker load -i ./images/greenplum-for-kubernetes</pre></td></tr></table></figure><ol start="5"><li>Load the Greenplum Operator Docker image to the Docker registry:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker load -i ./images/greenplum-operator</pre></td></tr></table></figure><ol start="6"><li>Push the Greenplum docker images to the local container registry. For example:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token assign-left variable">IMAGE_REPO</span><span class="token operator">=</span><span class="token string">"hci-node01:5000"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token assign-left variable">GREENPLUM_IMAGE_NAME</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;IMAGE_REPO&#125;</span>/greenplum-for-kubernetes:<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> ./images/greenplum-for-kubernetes-tag<span class="token variable">)</span></span>"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>docker tag <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> ./images/greenplum-for-kubernetes-id<span class="token variable">)</span></span> <span class="token variable">$&#123;GREENPLUM_IMAGE_NAME&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>docker push <span class="token variable">$&#123;GREENPLUM_IMAGE_NAME&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token assign-left variable">OPERATOR_IMAGE_NAME</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;IMAGE_REPO&#125;</span>/greenplum-operator:<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> ./images/greenplum-operator-tag<span class="token variable">)</span></span>"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>docker tag <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> ./images/greenplum-operator-id<span class="token variable">)</span></span> <span class="token variable">$&#123;OPERATOR_IMAGE_NAME&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>docker push <span class="token variable">$&#123;OPERATOR_IMAGE_NAME&#125;</span></pre></td></tr></table></figure><ol start="7"><li>Create a new YAML file in the workspace subdirectory with two lines to indicate the registry where you pushed the images</li></ol><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre>cat &lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EOF</span> <span class="token punctuation">></span></span>workspace/operator-values-overrides.yaml</pre></td></tr><tr><td data-num="2"></td><td><pre>operatorImageRepository: $&#123;IMAGE_REPO&#125;/greenplum-operator</pre></td></tr><tr><td data-num="3"></td><td><pre>greenplumImageRepository: $&#123;IMAGE_REPO&#125;/greenplum-for-kubernetes</pre></td></tr><tr><td data-num="4"></td><td><pre>operatorWorkerSelector: &#123;</pre></td></tr><tr><td data-num="5"></td><td><pre>greenplum-operator: "default"</pre></td></tr><tr><td data-num="6"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="7"></td><td><pre>EOF</pre></td></tr></table></figure><ol start="8"><li>Use helm to create a new Greenplum Operator release.</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 先给某台机器添加标签来部署 greenplum-operator</span></pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl label node hci-node02  greenplum-operator<span class="token operator">=</span>default</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>kubectl create namespace greenplum</pre></td></tr><tr><td data-num="5"></td><td><pre>helm <span class="token function">install</span> -n greenplum-operator -f workspace/operator-values-overrides.yaml operator/ --namespace greenplum</pre></td></tr><tr><td data-num="6"></td><td><pre>helm <span class="token function">install</span> greenplum-operator operator/</pre></td></tr></table></figure><h2 id="create-local-persistent-volumes-for-greenplum"><a class="anchor" href="#create-local-persistent-volumes-for-greenplum">#</a> <strong>Create Local Persistent Volumes for Greenplum</strong></h2><ol><li><p>Create the directory, partition, or logical volume that you want to use as a Kubernetes local volume.</p></li><li><p>Create the StorageClass definition, specifying no-provisioner in order to manually provision local persistent volumes. Using volumeBindingMode: WaitForFirstConsumer is also recommended to delay binding the local PersistenVolume until a pod requires.</p></li></ol><p>vim gpdb-storage-class.yaml</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre>kind: StorageClass</pre></td></tr><tr><td data-num="2"></td><td><pre>apiVersion: storage.k8s.io/v1</pre></td></tr><tr><td data-num="3"></td><td><pre>metadata:</pre></td></tr><tr><td data-num="4"></td><td><pre>  name: gpdb-storage</pre></td></tr><tr><td data-num="5"></td><td><pre>provisioner: kubernetes.io/no-provisioner</pre></td></tr><tr><td data-num="6"></td><td><pre>volumeBindingMode: WaitForFirstConsumer</pre></td></tr></table></figure><ol start="3"><li>Create a PersistentVolume definition, specifying the local volume and the required NodeAffinity field. For example:</li></ol><p>vim pv-master.yaml</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre>apiVersion: v1</pre></td></tr><tr><td data-num="2"></td><td><pre>kind: PersistentVolume</pre></td></tr><tr><td data-num="3"></td><td><pre>metadata:</pre></td></tr><tr><td data-num="4"></td><td><pre>  name: greenplum-master-node02</pre></td></tr><tr><td data-num="5"></td><td><pre>spec:</pre></td></tr><tr><td data-num="6"></td><td><pre>  capacity:</pre></td></tr><tr><td data-num="7"></td><td><pre>    storage: 1Gi</pre></td></tr><tr><td data-num="8"></td><td><pre>  accessModes:</pre></td></tr><tr><td data-num="9"></td><td><pre>  - ReadWriteOnce</pre></td></tr><tr><td data-num="10"></td><td><pre>  persistentVolumeReclaimPolicy: Retain</pre></td></tr><tr><td data-num="11"></td><td><pre>  storageClassName: gpdb-storage</pre></td></tr><tr><td data-num="12"></td><td><pre>  local:</pre></td></tr><tr><td data-num="13"></td><td><pre>    path: /mnt/disks/greenplum-master-vol0	// 需要提前在相应机器上创建此目录</pre></td></tr><tr><td data-num="14"></td><td><pre>  nodeAffinity:</pre></td></tr><tr><td data-num="15"></td><td><pre>    required:</pre></td></tr><tr><td data-num="16"></td><td><pre>      nodeSelectorTerms:</pre></td></tr><tr><td data-num="17"></td><td><pre>      - matchExpressions:</pre></td></tr><tr><td data-num="18"></td><td><pre>        - key: kubernetes.io/hostname</pre></td></tr><tr><td data-num="19"></td><td><pre>          operator: In</pre></td></tr><tr><td data-num="20"></td><td><pre>          values:</pre></td></tr><tr><td data-num="21"></td><td><pre>          - hci-node02</pre></td></tr><tr><td data-num="22"></td><td><pre>---</pre></td></tr><tr><td data-num="23"></td><td><pre>apiVersion: v1</pre></td></tr><tr><td data-num="24"></td><td><pre>kind: PersistentVolume</pre></td></tr><tr><td data-num="25"></td><td><pre>metadata:</pre></td></tr><tr><td data-num="26"></td><td><pre>  name: greenplum-master-node02</pre></td></tr><tr><td data-num="27"></td><td><pre>......重复上面的内容, 改变下local.path, nodeAffinity等在不同node机器上创建多个pv</pre></td></tr></table></figure><ol start="4"><li><p>Repeat the previous step for each PersistentVolume required for your cluster. Remember that each Greenplum segment host requires a dedicated storage volume.</p></li><li><p>Use kubectl to apply the StorageClass and PersistentVolume configurations that you created.</p></li><li><p>Specify the local storage StorageClass name when you deploy a new Greenplum cluster as below.</p></li></ol><h2 id="deploy-a-greenplum-cluster"><a class="anchor" href="#deploy-a-greenplum-cluster">#</a> <strong>Deploy a greenplum cluster</strong></h2><ol><li>Go to the workspace subdirectory where you unpacked the Pivotal Greenplum distribution for Kubernetes:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> ./greenplum-for-kubernetes-*/workspace</pre></td></tr></table></figure><ol start="2"><li>If necessary, create a Kubernetes manifest file to specify the configuration of your Greenplum cluster. A sample file is provided in workspace/my-gp-instance.yaml. my-gp-instance.yaml contains the minimal set of instructions necessary to create a demonstration cluster named “my-greenplum” with a single segment and default storage, memory, and CPU settings:</li></ol><p>vim my-gp-instance.yaml</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre>apiVersion: "greenplum.pivotal.io/v1"</pre></td></tr><tr><td data-num="2"></td><td><pre>kind: "GreenplumCluster"</pre></td></tr><tr><td data-num="3"></td><td><pre>metadata:</pre></td></tr><tr><td data-num="4"></td><td><pre>  name: my-greenplum</pre></td></tr><tr><td data-num="5"></td><td><pre>spec:</pre></td></tr><tr><td data-num="6"></td><td><pre>  masterAndStandby:</pre></td></tr><tr><td data-num="7"></td><td><pre>    hostBasedAuthentication: |</pre></td></tr><tr><td data-num="8"></td><td><pre>      # host   all   gpadmin   1.2.3.4/32   trust</pre></td></tr><tr><td data-num="9"></td><td><pre>      # host   all   gpuser    0.0.0.0/0   md5</pre></td></tr><tr><td data-num="10"></td><td><pre>      host    all   hce       0.0.0.0/0   md5</pre></td></tr><tr><td data-num="11"></td><td><pre>    memory: "800Mi"</pre></td></tr><tr><td data-num="12"></td><td><pre>    cpu: "0.5"</pre></td></tr><tr><td data-num="13"></td><td><pre>    storageClassName: gpdb-storage</pre></td></tr><tr><td data-num="14"></td><td><pre>    storage: 1G</pre></td></tr><tr><td data-num="15"></td><td><pre>    antiAffinity: "yes"</pre></td></tr><tr><td data-num="16"></td><td><pre>    workerSelector: &#123;&#125;</pre></td></tr><tr><td data-num="17"></td><td><pre>  segments:</pre></td></tr><tr><td data-num="18"></td><td><pre>    primarySegmentCount: 2		# Expand the segment to 2</pre></td></tr><tr><td data-num="19"></td><td><pre>    memory: "800Mi"</pre></td></tr><tr><td data-num="20"></td><td><pre>    cpu: "0.5"</pre></td></tr><tr><td data-num="21"></td><td><pre>    storageClassName: gpdb-storage		# Use the specify storageclass</pre></td></tr><tr><td data-num="22"></td><td><pre>    storage: 10G				# Expand the storage to 10G</pre></td></tr><tr><td data-num="23"></td><td><pre>    antiAffinity: "yes"</pre></td></tr><tr><td data-num="24"></td><td><pre>    workerSelector: &#123;&#125;</pre></td></tr><tr><td data-num="25"></td><td><pre>    mirrors: "yes"</pre></td></tr></table></figure><div class="note primary"><p>在上面的<span class="red"> hostBasedAuthentication</span> 添加认证信息后就不需要 deploy greenplum 后再登陆 master-0 Pod 手动添加认证信息到 pg_hba.conf 文件</p></div><ol start="3"><li>Use kubectl apply command and specify your manifest file to send the deployment request to the Greenplum Operator. For example, to use the sample my-gp-instance.yaml file:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl apply -f ./my-gp-instance.yaml </pre></td></tr><tr><td data-num="2"></td><td><pre>  greenplumcluster.greenplum.pivotal.io/my-greenplum created</pre></td></tr></table></figure><h2 id="deploy-multiple-greenplum-cluster"><a class="anchor" href="#deploy-multiple-greenplum-cluster">#</a> <strong>Deploy multiple greenplum cluster</strong></h2><ol><li>Create namespaces for greenplum cluster to deploy. Deploy two greenplum cluster instances:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl create namespace gpinstance-1</pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl create namespace gpinstance-2</pre></td></tr></table></figure><ol start="2"><li>Deploy Greenplum cluster into the correspond namespace.</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> workspace</pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl apply -f ./my-gp-instance.yaml -n gpinstance-1</pre></td></tr><tr><td data-num="3"></td><td><pre>kubectl apply -f ./my-gp-instance.yaml -n gpinstance-2</pre></td></tr></table></figure><h2 id="test-whether-the-greenplum-cluster-deployment-is-successful"><a class="anchor" href="#test-whether-the-greenplum-cluster-deployment-is-successful">#</a> <strong>Test whether the Greenplum Cluster deployment is successful</strong></h2><p>查看 greenplum logs</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl logs po/master-0 -n greenplum</pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  *******************************</pre></td></tr><tr><td data-num="4"></td><td><pre>  Adding <span class="token function">host</span> based authentication to master-0 pg_hba.conf</pre></td></tr><tr><td data-num="5"></td><td><pre>  *******************************</pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  *******************************</pre></td></tr><tr><td data-num="8"></td><td><pre>  Running createdb</pre></td></tr><tr><td data-num="9"></td><td><pre>  *******************************</pre></td></tr></table></figure><p>需要等待一段时间才能执行下方操作</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl <span class="token builtin class-name">exec</span> -it master-0 -n greenplum -- <span class="token function">bash</span> -c <span class="token string">"source /opt/gpdb/greenplum_path.sh; psql"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  psql <span class="token punctuation">(</span><span class="token number">8.3</span>.23<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  Type <span class="token string">"help"</span> <span class="token keyword">for</span> help.</pre></td></tr><tr><td data-num="4"></td><td><pre> </pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token assign-left variable">gpadmin</span><span class="token operator">=</span><span class="token comment"># select * from gp_segment_configuration;</span></pre></td></tr></table></figure><p>如果报一些错误无法执行可以:</p><ol><li>先进入 master-0: kubectl exec -it master-0 -n greenplum -- bash, 再查找 greenplum_path.sh</li><li>执行 <code>$ source /opt/gpdb/greenplum_path.sh</code> , 再 <code>$ exit</code> 退出，然后就可以用以上命令了</li></ol><p>(Enter <code>\q</code> to exit the psql utility.)</p><p><strong>If you are redeploying a cluster that configured to use a standby master, wait until all pods reach the Running status. Then connect to the master-0 pod and execute the gpstart command manually. For example:</strong></p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl <span class="token builtin class-name">exec</span> -it master-0 -n greenplum -- <span class="token function">bash</span> -c <span class="token string">"source /opt/gpdb/greenplum_path.sh; gpstart"</span></pre></td></tr></table></figure><h2 id="trusted-client"><a class="anchor" href="#trusted-client">#</a> trusted client</h2><p>Reference Link: <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdyZWVucGx1bS5vcmcvNi04L3NlY3VyaXR5LWd1aWRlL3RvcGljcy9BdXRoZW50aWNhdGUuaHRtbA==">https://docs.greenplum.org/6-8/security-guide/topics/Authenticate.html</span></p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># Login to the Greenplum master-0 pod </span></pre></td></tr><tr><td data-num="2"></td><td><pre>$ kubectl <span class="token builtin class-name">exec</span> po/master-0 -n greenplum -it -- /bin/bash </pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># Add the following information</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 添加如下内容使所有 client 链接都要输入密码</span></pre></td></tr><tr><td data-num="6"></td><td><pre>gpadmin@master-0:~$ <span class="token function">vim</span> /greenplum/data-1/pg_hba.conf </pre></td></tr><tr><td data-num="7"></td><td><pre>  …… </pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">host</span>     all         hce             <span class="token number">0.0</span>.0.0/0  md5</pre></td></tr><tr><td data-num="9"></td><td><pre>  ……</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># reload the configuration of greenplum</span></pre></td></tr><tr><td data-num="12"></td><td><pre>gpadmin@master-0:~$ gpstop –u </pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># Exit the Greenplum master-0 pod </span></pre></td></tr><tr><td data-num="15"></td><td><pre>gpadmin@master-0:~$ <span class="token builtin class-name">exit</span></pre></td></tr></table></figure><h2 id="delete-a-greenplum-cluster-and-uninstall-pivotal-greenplum-for-kubernetes"><a class="anchor" href="#delete-a-greenplum-cluster-and-uninstall-pivotal-greenplum-for-kubernetes">#</a> <strong>Delete a greenplum cluster and uninstall pivotal greenplum for kubernetes</strong></h2><h3 id="delete-a-greenplum-cluster"><a class="anchor" href="#delete-a-greenplum-cluster">#</a> <strong>Delete a greenplum cluster</strong></h3><ol><li>Navigate to the workspace directory of the Pivotal Greenplum distribution (or to the location of the Kubernetes manifest that you used to deploy the cluster). For example:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> ./greenplum-for-kubernetes-*/workspace</pre></td></tr></table></figure><ol start="2"><li>Execute the kubectl delete command, specifying the manifest that you used to deploy the cluster. For example:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl delete -f ./my-gp-instance.yaml --wait<span class="token operator">=</span>false</pre></td></tr></table></figure><p><strong>Note:</strong> Use the optional --wait=false flag to return immediately without waiting for the deletion to complete.<br>3. Use kubectl to describe the Greenplum cluster to verify Status.Phase and Events:</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl describe greenplumcluster my-greenplum</pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  Status:</pre></td></tr><tr><td data-num="4"></td><td><pre>    Instance Image:    greenplum-for-kubernetes:latest</pre></td></tr><tr><td data-num="5"></td><td><pre>    Operator Version:  greenplum-operator:latest</pre></td></tr><tr><td data-num="6"></td><td><pre>    Phase:             Deleting</pre></td></tr><tr><td data-num="7"></td><td><pre>  Events:</pre></td></tr><tr><td data-num="8"></td><td><pre>    Type    Reason                    Age   From               Message</pre></td></tr><tr><td data-num="9"></td><td><pre>    ----    ------                    ----  ----               -------</pre></td></tr><tr><td data-num="10"></td><td><pre>    Normal  CreatingGreenplumCluster  3m    greenplumOperator  Creating Greenplum cluster my-greenplum <span class="token keyword">in</span> default</pre></td></tr><tr><td data-num="11"></td><td><pre>    Normal  CreatedGreenplumCluster   1m    greenplumOperator  Successfully created Greenplum cluster my-greenplum <span class="token keyword">in</span> default</pre></td></tr><tr><td data-num="12"></td><td><pre>    Normal  DeletingGreenplumCluster  6s    greenplumOperator  Deleting Greenplum cluster my-greenplum <span class="token keyword">in</span> default</pre></td></tr></table></figure><p>If for any reason stopping the Greenplum instance fails, you should see a warning message in the greenplum-operator logs as shown below:</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl logs -l <span class="token assign-left variable">app</span><span class="token operator">=</span>greenplum-operator</pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token punctuation">&#123;</span><span class="token string">"level"</span><span class="token builtin class-name">:</span><span class="token string">"INFO"</span>,<span class="token string">"ts"</span><span class="token builtin class-name">:</span><span class="token string">"2020-01-24T19:03:22.874Z"</span>,<span class="token string">"logger"</span><span class="token builtin class-name">:</span><span class="token string">"controllers.GreenplumCluster"</span>,<span class="token string">"msg"</span><span class="token builtin class-name">:</span><span class="token string">"DeletingGreenplumCluster"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"my-greenplum"</span>,<span class="token string">"namespace"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">&#123;</span><span class="token string">"level"</span><span class="token builtin class-name">:</span><span class="token string">"INFO"</span>,<span class="token string">"ts"</span><span class="token builtin class-name">:</span><span class="token string">"2020-01-24T19:03:23.068Z"</span>,<span class="token string">"logger"</span><span class="token builtin class-name">:</span><span class="token string">"controllers.GreenplumCluster"</span>,<span class="token string">"msg"</span><span class="token builtin class-name">:</span><span class="token string">"initiating shutdown of the greenplum cluster"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">&#123;</span><span class="token string">"level"</span><span class="token builtin class-name">:</span><span class="token string">"INFO"</span>,<span class="token string">"ts"</span><span class="token builtin class-name">:</span><span class="token string">"2020-01-24T19:03:31.971Z"</span>,<span class="token string">"logger"</span><span class="token builtin class-name">:</span><span class="token string">"controllers.GreenplumCluster"</span>,<span class="token string">"msg"</span><span class="token builtin class-name">:</span><span class="token string">"gpstop did not stop cleanly. Please check gpAdminLogs for more info."</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#123;</span><span class="token string">"level"</span><span class="token builtin class-name">:</span><span class="token string">"INFO"</span>,<span class="token string">"ts"</span><span class="token builtin class-name">:</span><span class="token string">"2020-01-24T19:03:32.252Z"</span>,<span class="token string">"logger"</span><span class="token builtin class-name">:</span><span class="token string">"controllers.GreenplumCluster"</span>,<span class="token string">"msg"</span><span class="token builtin class-name">:</span><span class="token string">"DeletedGreenplumCluster"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"my-greenplum"</span>,<span class="token string">"namespace"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="4"><li>Use kubectl to monitor the progress of terminating Greenplum resources in your cluster. For example, if your cluster deployment was named my-greenplum:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl get all -l greenplum-cluster<span class="token operator">=</span>my-greenplum</pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl label nodes hci-node01 greenplum-affinity-greenplum-master-	// 去掉node上关于greenplum的label</pre></td></tr><tr><td data-num="3"></td><td><pre>kubectl label nodes hci-node01 greenplum-affinity-greenplum-segment-</pre></td></tr></table></figure><h3 id="delete-greenplum-persistent-volume-claims"><a class="anchor" href="#delete-greenplum-persistent-volume-claims">#</a> <strong>Delete greenplum persistent volume claims</strong></h3><p><strong>Caution:</strong> If the Persistent Volumes were created using dynamic provisioning, then deleting the PVCs will also delete the associated PVs. In this case, do not delete the PVCs unless you are certain that you no longer need the data.</p><ol><li>Verify that the PVCs are present for your cluster. For example, to show the Persistent Volume Claims created for a cluster named my-greenplum:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl get pvc -l greenplum-cluster<span class="token operator">=</span>my-greenplum</pre></td></tr></table></figure><ol start="2"><li>Use kubectl to delete the PVCs associated with the cluster. For example, to delete all PersistentVolume Claims created for a cluster named my-greenplum:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl delete pvc -l greenplum-cluster<span class="token operator">=</span>my-greenplum</pre></td></tr></table></figure><ol start="3"><li>If the Persistent Volumes were provisioned manually, then deleting the PVCs does not delete the associated PVs. (You can check for the PVs using kubectl get pv.) To delete any remaining Persistent Volumes, execute the command:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl delete <span class="token function">pv</span> -l greenplum-cluster<span class="token operator">=</span>my-greenplum</pre></td></tr></table></figure><h3 id="uninstall-pivotal-greenplum-for-kubernetes"><a class="anchor" href="#uninstall-pivotal-greenplum-for-kubernetes">#</a> <strong>Uninstall pivotal greenplum for kubernetes</strong></h3><ol><li>Use the helm delete command to delete the greenplum-operator release:</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>helm delete greenplum-operator</pre></td></tr><tr><td data-num="2"></td><td><pre>helm del --purge greenplum-operator<span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="2"><li>Delete the node label of greenplum operator when deployed on kubernetes</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl label nodes hci-node02 greenplum-operator-</pre></td></tr></table></figure><ol start="3"><li>Use docker rmi to delete images</li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker rmi <span class="token operator">&lt;</span>ImageName or ImgaeID<span class="token operator">></span></pre></td></tr></table></figure><h2 id="faq"><a class="anchor" href="#faq">#</a> <strong>FAQ</strong></h2><p>When uninstall greenplum, encountered this problem: Object is being deleted: <span class="exturl" data-url="aHR0cDovL2N1c3RvbXJlc291cmNlZGVmaW5pdGlvbnMuYXBpZXh0ZW5zaW9ucy5rOHMuaW8=">customresourcedefinitions.apiextensions.k8s.io</span> &quot;<span class="exturl" data-url="aHR0cDovL2dyZWVucGx1bWNsdXN0ZXJzLmdyZWVucGx1bS5waXZvdGFsLmlv">greenplumclusters.greenplum.pivotal.io</span>&quot; already exists.</p><p>solution refer to this:<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2t1YmVybmV0ZXMva3ViZXJuZXRlcy9pc3N1ZXMvNjA1Mzg=">delete crd</span></p><h2 id="删除greenplum集群脚本"><a class="anchor" href="#删除greenplum集群脚本">#</a> <strong>删除 greenplum 集群脚本</strong></h2><p>vim clean_greenplum.sh</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token assign-left variable">workspace</span><span class="token operator">=</span>workspace</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token assign-left variable">node01</span><span class="token operator">=</span>hci-node01</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token assign-left variable">node02</span><span class="token operator">=</span>hci-node02</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token assign-left variable">node03</span><span class="token operator">=</span>hci-node03</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token assign-left variable">node04</span><span class="token operator">=</span>hci-node04</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token assign-left variable">greenplum_operator</span><span class="token operator">=</span>hci-node02</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token builtin class-name">cd</span> greenplum-for-kubernetes-v1.13.0</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># delete greenplum cluster</span></pre></td></tr><tr><td data-num="13"></td><td><pre>kubectl delete -f <span class="token variable">$&#123;workspace&#125;</span>/my-gp-instance.yaml</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># delete pvc</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token assign-left variable">pvc_results</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get pvc -n greenplum <span class="token operator">|</span> <span class="token function">grep</span> greenplum <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print <span class="token variable">$1</span>&#125;'</span><span class="token variable">)</span></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token assign-left variable">pvc_arr</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$&#123;pvc_results&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>$&#123;#pvc_arr[<span class="token operator">*</span>]&#125;<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">))</span></span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">do</span></pre></td></tr><tr><td data-num="20"></td><td><pre>kubectl delete pvc <span class="token variable">$&#123;pvc_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>&#125;</span> -n greenplum</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">done</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># delete pv</span></pre></td></tr><tr><td data-num="24"></td><td><pre>kubectl delete -f <span class="token variable">$&#123;workspace&#125;</span>/pv-master.yaml</pre></td></tr><tr><td data-num="25"></td><td><pre>kubectl delete -f <span class="token variable">$&#123;workspace&#125;</span>/pv-segment.yaml</pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment"># delete sc</span></pre></td></tr><tr><td data-num="28"></td><td><pre>kubectl delete -f <span class="token variable">$&#123;workspace&#125;</span>/workspacegpdb-storage-class.yaml</pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment"># delete greenplum operator</span></pre></td></tr><tr><td data-num="31"></td><td><pre>helm delete greenplum-operator</pre></td></tr><tr><td data-num="32"></td><td><pre>helm del --purge greenplum-operator<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment"># delete label on nodes</span></pre></td></tr><tr><td data-num="35"></td><td><pre>kubectl label nodes <span class="token variable">$&#123;node01&#125;</span> greenplum-affinity-greenplum-master-</pre></td></tr><tr><td data-num="36"></td><td><pre>kubectl label nodes <span class="token variable">$&#123;node01&#125;</span> greenplum-affinity-greenplum-segment-</pre></td></tr><tr><td data-num="37"></td><td><pre>kubectl label nodes <span class="token variable">$&#123;node02&#125;</span> greenplum-affinity-greenplum-master-</pre></td></tr><tr><td data-num="38"></td><td><pre>kubectl label nodes <span class="token variable">$&#123;node02&#125;</span> greenplum-affinity-greenplum-segment-</pre></td></tr><tr><td data-num="39"></td><td><pre>kubectl label nodes <span class="token variable">$&#123;node03&#125;</span> greenplum-affinity-greenplum-master-</pre></td></tr><tr><td data-num="40"></td><td><pre>kubectl label nodes <span class="token variable">$&#123;node03&#125;</span> greenplum-affinity-greenplum-segment-</pre></td></tr><tr><td data-num="41"></td><td><pre>kubectl label nodes <span class="token variable">$&#123;node04&#125;</span> greenplum-affinity-greenplum-master-</pre></td></tr><tr><td data-num="42"></td><td><pre>kubectl label nodes <span class="token variable">$&#123;node04&#125;</span> greenplum-affinity-greenplum-segment-</pre></td></tr><tr><td data-num="43"></td><td><pre>kubectl label nodes <span class="token variable">$&#123;greenplum_operator&#125;</span> greenplum-operator-</pre></td></tr></table></figure><h2 id="删除clusterrole等资源"><a class="anchor" href="#删除clusterrole等资源">#</a> 删除 clusterrole 等资源</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 查询系统还存在的 greenplum 相关组件</span></pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl get crd <span class="token operator">|</span> <span class="token function">grep</span> greenplum</pre></td></tr><tr><td data-num="3"></td><td><pre>kubectl get clusterrolebinding <span class="token operator">|</span> <span class="token function">grep</span> greenplum</pre></td></tr><tr><td data-num="4"></td><td><pre>kubectl get clusterrole <span class="token operator">|</span> <span class="token function">grep</span> greenplum</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 删除上面还存在的组件</span></pre></td></tr><tr><td data-num="7"></td><td><pre>kubectl delete crd <span class="token operator">&lt;</span>correspond component name<span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre>kubectl delete clusterrolebinding <span class="token operator">&lt;</span>correspond component name<span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre>kubectl delete clusterrole <span class="token operator">&lt;</span>correspond component name<span class="token operator">></span></pre></td></tr></table></figure><h2 id="删除数据"><a class="anchor" href="#删除数据">#</a> 删除数据</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">rm</span> -rf  /mnt/greenplum/greenplum-master-vol0/*</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">rm</span> -rf /mnt/greenplum/greenplum-segment-vol0/*</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">rm</span> -rf /mnt/greenplum/greenplum-segment-vol1/*</pre></td></tr></table></figure><h2 id="创建user"><a class="anchor" href="#创建user">#</a> 创建 User</h2><p>Reference: <span class="exturl" data-url="aHR0cHM6Ly9ncmVlbnBsdW0ub3JnL3VzZXItYW5kLXNjaGVtYS1jcmVhdGlvbi1pbi1ncmVlbnBsdW0tZGF0YWJhc2Uv">https://greenplum.org/user-and-schema-creation-in-greenplum-database/</span></p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 查看 k8s 上的 greenplum 服务端口</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">$(</span>kubectl get svc greenplum -n greenplum -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'&#123;.spec.ports[0].nodePort&#125;'</span><span class="token variable">)</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#(optional)kubectl get svc -n greenplum | grep greenplum | awk '&#123;print $5&#125;'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token number">31905</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 查看部署到 k8s 上用来访问同样部署到 k8s 上的 greenplum 的 pod 的 IP</span></pre></td></tr><tr><td data-num="9"></td><td><pre>kubectl get po -n storage-rest -o wide</pre></td></tr><tr><td data-num="10"></td><td><pre>NAME                            READY   STATUS    RESTARTS   AGE   IP           NODE                NOMINATED NODE   READINESS GATES</pre></td></tr><tr><td data-num="11"></td><td><pre>storage-rest-7799775d48-45m7l   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          15h   <span class="token number">10.32</span>.0.13   inspire-dev-nodea   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 从 Host 主机登陆 psql 数据库，需要提前在 Host 下载好 postgresql10.</span></pre></td></tr><tr><td data-num="16"></td><td><pre>psql -h127.0.0.1 -p31905 -Uhce -dhce</pre></td></tr><tr><td data-num="17"></td><td><pre>  psql: FATAL:  no pg_hba.conf entry <span class="token keyword">for</span> <span class="token function">host</span> <span class="token string">"10.32.0.1"</span>, user <span class="token string">"hce"</span>, database <span class="token string">"hce"</span>, SSL off</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 修改 k8s 上的 greenplum 的 pg_hba.conf 文件</span></pre></td></tr><tr><td data-num="20"></td><td><pre>kubectl <span class="token builtin class-name">exec</span> po/master-0 -n greenplum -it -- /bin/bash</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token function">vim</span> /greenplum/data-1/pg_hba.conf</pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token function">host</span>     all         hce             <span class="token number">0.0</span>.0.0/0  md5</pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre> * <span class="token number">10.32</span>.0.13 是在K8S集群里部署的 POD 的IP, 用来访问也在k8s上部署的greenplum psql数据库</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment"># 加载 greenplum 修改的配置</span></pre></td></tr><tr><td data-num="28"></td><td><pre>gpstop -u</pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment"># 退出 POD</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token builtin class-name">exit</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment"># 从 Host 主机登陆 greenplum 创建 User</span></pre></td></tr><tr><td data-num="35"></td><td><pre>psql -h127.0.0.1 -p31905 -Ugpadmin</pre></td></tr><tr><td data-num="36"></td><td><pre>psql <span class="token punctuation">(</span><span class="token number">10.16</span>, server <span class="token number">8.3</span>.23<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>Type <span class="token string">"help"</span> <span class="token keyword">for</span> help.</pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token assign-left variable">gpadmin</span><span class="token operator">=</span><span class="token comment"># CREATE USER hce WITH PASSWORD 'hce123';</span></pre></td></tr><tr><td data-num="40"></td><td><pre>NOTICE:  resource group required -- using default resource group <span class="token string">"default_group"</span></pre></td></tr><tr><td data-num="41"></td><td><pre>CREATE ROLE</pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token assign-left variable">gpadmin</span><span class="token operator">=</span><span class="token comment"># GRANT ALL PRIVILEGES ON DATABASE hce TO hce;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>ERROR:  database <span class="token string">"hce"</span> does not exist</pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token assign-left variable">gpadmin</span><span class="token operator">=</span><span class="token comment"># CREATE DATABASE hce;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>CREATE DATABASE</pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token assign-left variable">gpadmin</span><span class="token operator">=</span><span class="token comment"># GRANT ALL PRIVILEGES ON DATABASE hce TO hce;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>GRANT</pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token assign-left variable">gpadmin</span><span class="token operator">=</span><span class="token comment"># \q</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token comment"># 从 Host 主机重新登陆 psql 数据库</span></pre></td></tr><tr><td data-num="53"></td><td><pre>psql -h127.0.0.1 -p31905 -Uhce -dhce</pre></td></tr><tr><td data-num="54"></td><td><pre>Password <span class="token keyword">for</span> user hce: <span class="token operator">&lt;</span>输入密码: hce12<span class="token operator"><span class="token file-descriptor important">3</span>></span></pre></td></tr><tr><td data-num="55"></td><td><pre>psql <span class="token punctuation">(</span><span class="token number">10.16</span>, server <span class="token number">8.3</span>.23<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>Type <span class="token string">"help"</span> <span class="token keyword">for</span> help.</pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token assign-left variable">hce</span><span class="token operator">=</span><span class="token operator">></span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token comment"># 删除 user</span></pre></td></tr><tr><td data-num="63"></td><td><pre>psql -h127.0.0.1 -p31905 -Ugpadmin</pre></td></tr><tr><td data-num="64"></td><td><pre>psql <span class="token punctuation">(</span><span class="token number">10.16</span>, server <span class="token number">8.3</span>.23<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>Type <span class="token string">"help"</span> <span class="token keyword">for</span> help.</pre></td></tr><tr><td data-num="66"></td><td><pre></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token assign-left variable">gpadmin</span><span class="token operator">=</span><span class="token comment"># DROP USER hce</span></pre></td></tr><tr><td data-num="68"></td><td><pre>gpadmin-<span class="token comment"># ;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>DROP ROLE</pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token comment"># 查看 user</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token keyword">select</span> rolname,oid from pg_roles<span class="token punctuation">;</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/storage/" rel="tag"><i class="ic i-tag"></i> storage</a></div></div><footer><div class="meta"></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Kung-Fu-Master 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Kung-Fu-Master 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Kung-Fu-Master 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Kung-Fu-Master <i class="ic i-at"><em>@</em></i>Hexo</li><li class="link"><strong>本文链接：</strong> <a href="https://kung-fu-master.github.io/2021/05/31/storage/greenplum/greenplum_01_deployment/" title="greenplum 01 deployment on Kubernetes">https://kung-fu-master.github.io/2021/05/31/storage/greenplum/greenplum_01_deployment/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/05/31/storage/minio/minIO_02_deployment_on_kubernetes/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeyvx1d4j20zk0m8hdt.jpg" title="MinIO 02 deployment on kubernetes"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> minio</span><h3>MinIO 02 deployment on kubernetes</h3></a></div><div class="item right"><a href="/2021/05/31/storage/greenplum/greenplum_problems/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicli9lfebj20zk0m84qp.jpg" title="greenplum 遇到的问题"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> greenplum</span><h3>greenplum 遇到的问题</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#prerequisites"><span class="toc-number">1.</span> <span class="toc-text"># Prerequisites</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#install-greenplum-operator-for-kubernetes"><span class="toc-number">2.</span> <span class="toc-text"># Install Greenplum Operator for Kubernetes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#create-local-persistent-volumes-for-greenplum"><span class="toc-number">3.</span> <span class="toc-text"># Create Local Persistent Volumes for Greenplum</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#deploy-a-greenplum-cluster"><span class="toc-number">4.</span> <span class="toc-text"># Deploy a greenplum cluster</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#deploy-multiple-greenplum-cluster"><span class="toc-number">5.</span> <span class="toc-text"># Deploy multiple greenplum cluster</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#test-whether-the-greenplum-cluster-deployment-is-successful"><span class="toc-number">6.</span> <span class="toc-text"># Test whether the Greenplum Cluster deployment is successful</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#trusted-client"><span class="toc-number">7.</span> <span class="toc-text"># trusted client</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delete-a-greenplum-cluster-and-uninstall-pivotal-greenplum-for-kubernetes"><span class="toc-number">8.</span> <span class="toc-text"># Delete a greenplum cluster and uninstall pivotal greenplum for kubernetes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#delete-a-greenplum-cluster"><span class="toc-number">8.1.</span> <span class="toc-text"># Delete a greenplum cluster</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete-greenplum-persistent-volume-claims"><span class="toc-number">8.2.</span> <span class="toc-text"># Delete greenplum persistent volume claims</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uninstall-pivotal-greenplum-for-kubernetes"><span class="toc-number">8.3.</span> <span class="toc-text"># Uninstall pivotal greenplum for kubernetes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#faq"><span class="toc-number">9.</span> <span class="toc-text"># FAQ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除greenplum集群脚本"><span class="toc-number">10.</span> <span class="toc-text"># 删除 greenplum 集群脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除clusterrole等资源"><span class="toc-number">11.</span> <span class="toc-text"># 删除 clusterrole 等资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除数据"><span class="toc-number">12.</span> <span class="toc-text"># 删除数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建user"><span class="toc-number">13.</span> <span class="toc-text"># 创建 User</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/05/31/storage/greenplum/greenplum_client/" rel="bookmark" title="greenplum client">greenplum client</a></li><li><a href="/2021/05/31/storage/greenplum/greenplum_K8s_%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/" rel="bookmark" title="greenplum(psql) 远程连接k8s部署的greenplum">greenplum(psql) 远程连接k8s部署的greenplum</a></li><li><a href="/2021/05/31/storage/greenplum/greenplum_problems/" rel="bookmark" title="greenplum 遇到的问题">greenplum 遇到的问题</a></li><li class="active"><a href="/2021/05/31/storage/greenplum/greenplum_01_deployment/" rel="bookmark" title="greenplum 01 deployment on Kubernetes">greenplum 01 deployment on Kubernetes</a></li><li><a href="/2021/05/31/storage/greenplum/greenplum_authorization_encryption/" rel="bookmark" title="greenplum authorization and encryption">greenplum authorization and encryption</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Kung-Fu-Master" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Kung-Fu-Master</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">316</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">42</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">14</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/05/31/storage/minio/minIO_02_deployment_on_kubernetes/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/05/31/storage/greenplum/greenplum_problems/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/06/01/linux/shell/" title="shell">shell</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/chown/" title="chown改变文件所属用户和用户组">chown改变文件所属用户和用户组</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/CPU%E8%A7%92%E5%BA%A6%E7%90%86%E8%A7%A3PCIE/" title="CPU角度理解PCIE">CPU角度理解PCIE</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technologies/" title="分类于 technologies">technologies</a> <i class="ic i-angle-right"></i> <a href="/categories/technologies/restful/" title="分类于 restful">restful</a></div><span><a href="/2021/05/31/technologies/restful_api/restfulAPI_Flask/" title="RESTful API">RESTful API</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technologies/" title="分类于 technologies">technologies</a> <i class="ic i-angle-right"></i> <a href="/categories/technologies/security/" title="分类于 security">security</a></div><span><a href="/2021/03/13/technologies/security/openssl/" title="openssl">openssl</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/microService/" title="分类于 microService">microService</a> <i class="ic i-angle-right"></i> <a href="/categories/microService/istio/" title="分类于 istio">istio</a></div><span><a href="/2021/03/13/microService/istio/istio_01_conception/" title="Istio 01 conception">Istio 01 conception</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/microService/" title="分类于 microService">microService</a> <i class="ic i-angle-right"></i> <a href="/categories/microService/kubernetes/" title="分类于 kubernetes">kubernetes</a></div><span><a href="/2021/03/13/microService/kubernetes/01_kubernetes%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E5%92%8C%E9%85%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6/" title="01 Kubernetes安装方式和配置条件">01 Kubernetes安装方式和配置条件</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/%E8%A7%A3%E5%8E%8B%E7%BC%A9%E5%91%BD%E4%BB%A4%E5%90%88%E9%9B%86/" title="解压缩命令合集">解压缩命令合集</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/06/07/linux/environment_variable/" title="环境变量加载顺序">环境变量加载顺序</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/microService/" title="分类于 microService">microService</a> <i class="ic i-angle-right"></i> <a href="/categories/microService/kubernetes/" title="分类于 kubernetes">kubernetes</a></div><span><a href="/2021/03/13/microService/kubernetes/k8s_port_forward/" title="使用端口转发(Port Forwarding)来访问集群中的应用">使用端口转发(Port Forwarding)来访问集群中的应用</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Kung-Fu-Master @ Kung Fu Master</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.2m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">18:22</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/05/31/storage/greenplum/greenplum_01_deployment/",favicon:{show:"（●´3｀●）",hide:"（●´3｀●）"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->