---
title: STL 03 shared_ptr
tags:
categories:
- language
- cpp
---

## shared_ptr

Reference Link: https://jingyan.baidu.com/article/adc81513d2c217f723bf7327.html

### 实例1

```cpp
	#include <iostream>
	#include <memory>
	
	using namespace std;
	
	int main(int argc, char *argv[])
	{
	
	    /**
	     * shared_ptr智能指针使用方法:
	     * std::shared_ptr<Entity> e1(new Entity());
	     * std::shared_ptr<Entity> e1 = std::make_shared<Entity>();
	     */
	
	    auto ptr = std::make_shared<char *>();
	    std::shared_ptr<char *> ptr1 = std::make_shared<char *>();
	    *ptr1 = "Hello world 1";
	    cout << *ptr1 << endl;
	
	    std::shared_ptr<char *> ptr2(new char *());
	    *ptr2 = "Hello world 2";
	    cout << *ptr2 << endl;
	
	    { // 离开此作用域后ptr3自动销毁
	        auto ptr3 = ptr2;
	        cout << *ptr3 << endl;
	        cout << ptr2.use_count() << endl;
	    }
	    cout << ptr2.use_count() << endl;
	
	    return 0;
	}
```

### 实例2

```cpp
	#include <iostream>
	#include <cstring>
	#include <memory>
	
	using namespace std;
	
	int main()
	{
	    char* str = (char *)"Hello";
	    cout << "strlen of str:" << strlen(str) << endl;
	    cout << "size   of str:" << sizeof(str) << endl;
	    char* s = new char[strlen(str) + 1];
	    s = str;
	    cout << s << endl;
	
	    std::shared_ptr<char> ptr(new char[strlen(str) + 1](), [](char *p) { delete [] p; });
	
	    // 第一种, 字符串给shared_ptr赋值
	    for (int i = 0; i < strlen(str); i++)
	    {
	        *(ptr.get() + i) = str[i];
	    }
	
	    // 第二种, 字符串给shared_ptr赋值
	    strcpy(ptr.get(), str);
	
	    // 第一种, 输出字符串
	    cout << ptr << endl;
	
	    // 第二种, 输出字符串
	    cout << ptr.get() << endl;
	
	    // 第三种, 输出字符串
	    for (int i = 0; i < strlen(str); i++)
	    {
	        cout << *(ptr.get() + i) << " ";
	    }
	    cout << endl;
	
	    // 输出一个字符
	    cout << *str << "," << *ptr << "," << *ptr.get() << endl;
	
	    std::shared_ptr<int> p1 = std::make_shared<int>();
	    *p1 = 78;
	    cout << "p1=" << *p1 << endl;
	
	    return 0;
	}
```

**编译**

```shell
	g++ tt.cpp
```

**输出**

```shell
	[root@laboratory test]# ./a.out
	strlen of str:5
	size   of str:8
	Hello
	Hello
	Hello
	H e l l o
	H,H,H
	p1=78
```
