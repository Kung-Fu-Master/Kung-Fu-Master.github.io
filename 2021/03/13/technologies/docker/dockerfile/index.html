<!-- build time:Wed Mar 17 2021 14:55:43 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Hexo" href="https://kung-fu-master.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Hexo" href="https://kung-fu-master.github.io/atom.xml"><link rel="alternate" type="application/json" title="Hexo" href="https://kung-fu-master.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="docker"><link rel="canonical" href="https://kung-fu-master.github.io/2021/03/13/technologies/docker/dockerfile/"><title>Dockerfile introduction - docker - technologies | Kung Fu Master = Hexo</title><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Dockerfile introduction</h1><div class="meta"><span class="item" title="创建时间：2021-03-13 13:00:42"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-03-13T13:00:42+08:00">2021-03-13</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>8k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>7 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Kung Fu Master</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclip4jbpj20zk0m87cv.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclhfehz7j20zk0m8u0x.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giciuv0socj20zk0m8qes.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipewkhf1zj20zk0m81kx.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giph4lm9i7j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclg5ms2rj20zk0m8u0x.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/technologies/" itemprop="item" rel="index" title="分类于 technologies"><span itemprop="name">technologies</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/technologies/docker/" itemprop="item" rel="index" title="分类于 docker"><span itemprop="name">docker</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://kung-fu-master.github.io/2021/03/13/technologies/docker/dockerfile/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Kung-Fu-Master"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><div class="body md" itemprop="articleBody"><p>Reference Link：<br>(官网): <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZGV2ZWxvcC9kZXZlbG9wLWltYWdlcy9kb2NrZXJmaWxlX2Jlc3QtcHJhY3RpY2VzLw==">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/</span></p><h2 id="dockerfile-brief-introduction"><a class="anchor" href="#dockerfile-brief-introduction">#</a> Dockerfile brief introduction</h2><blockquote><p>在 Docker 中创建镜像最常用的方式，就是使用 Dockerfile。Dockerfile 是一个 Docker 镜像的描述文件，我们可以理解成火箭发射的 A、B、C、D… 的步骤。Dockerfile 其内部包含了一条条的指令，每一条指令构建一层，因此每一条指令的内容，就是描述该层应当如何构建。<br><img data-src="01.png" alt=""><br><img data-src="02.png" alt=""></p></blockquote><h3 id="from"><a class="anchor" href="#from">#</a> From</h3><p>指明构建的新镜像是来自于哪个基础镜像</p><pre><code>	From ubuntu:18.04
</code></pre><h3 id="maintainer"><a class="anchor" href="#maintainer">#</a> MAINTAINER</h3><p>指明镜像维护着及其联系方式（一般是邮箱地址），例如：</p><pre><code>	MAINTAINER Edison Zhou &lt;edisonchou@hotmail.com&gt;
</code></pre><p>不过，MAINTAINER 并不推荐使用，更推荐使用 LABEL 来指定镜像作者，例如：</p><pre><code>	LABEL maintainer=&quot;edisonzhou.cn&quot;
</code></pre><h3 id="run"><a class="anchor" href="#run">#</a> RUN</h3><p>构建镜像时运行的 Shell 命令，例如：</p><pre><code>	RUN [&quot;yum&quot;, &quot;install&quot;, &quot;httpd&quot;]
	RUN yum install httpd
</code></pre><h3 id="add"><a class="anchor" href="#add">#</a> ADD</h3><p>拷贝文件或目录到镜像中，例如：</p><pre><code>	ADD &lt;src&gt;...&lt;dest&gt;
	ADD html.tar.gz /var/www/html
	ADD https://xxx.com/html.tar.gz /var/www/html
	PS：如果是URL或压缩包，会自动下载或自动解压。
</code></pre><h3 id="copy"><a class="anchor" href="#copy">#</a> COPY</h3><p>原路径：可以是多个，甚至可以是通配符<br>目标路径：可以是容器内的绝对路径，也可以是相对于工作目录的相对路径 (工作目录可以用 WORKDIR 指令来指定，不需要事先创建，会自动创建)<br>拷贝文件或目录到镜像中，用法同 ADD，只是不支持自动下载和解压，例如：</p><pre><code>	COPY ./start.sh /start.sh
	# 拷贝start.sh和src下的所有源文件到image的/home/workfile目录
	COPY ./start.sh ./src/*.cpp /home/workfile
	# 利用 通配符 进行复制
	COPY hom* /mydir/
	COPY hom?.txt /mydir/
	
	# 拷贝文件夹, 必须在image目录中定义folder name
	COPY folder /home/folder
</code></pre><p>note : COPY 会将原文件的各种数据都保留，比如 读、写、执行权限，可以通过 --chown=&lt;user&gt;:&lt;group&gt; 选项来改变文件的所属用户及所属组。<br>Although <code>ADD</code> and <code>COPY</code> are functionally similar, generally speaking, <code>COPY</code> is preferred. That’s because it’s more transparent than <code>ADD</code> .</p><h3 id="workdir"><a class="anchor" href="#workdir">#</a> WORKDIR</h3><p>为 RUN、CMD、ENTRYPOINT 以及 COPY 和 AND 设置工作目录，例如：</p><pre><code>	WORKDIR /home/zhan
</code></pre><h3 id="volume"><a class="anchor" href="#volume">#</a> VOLUME</h3><p>指定容器挂载点到宿主机自动生成的目录或其他容器，例如：</p><pre><code>	VOLUME [&quot;/var/lib/mysql&quot;]
	PS：一般不会在Dockerfile中用到，更常见的还是在docker run的时候指定-v数据卷。
</code></pre><h3 id="expose"><a class="anchor" href="#expose">#</a> EXPOSE</h3><p>声明容器运行的服务端口，例如：</p><pre><code>	EXPOSE 80 443
</code></pre><h3 id="cmd"><a class="anchor" href="#cmd">#</a> CMD</h3><p>启动容器时执行的 Shell 命令， <code>会被docker run命令行指定的参数所覆盖</code> ，例如：</p><pre><code>	CMD [&quot;-C&quot;, &quot;/start.sh&quot;] 
	CMD [&quot;/usr/sbin/sshd&quot;, &quot;-D&quot;] 
	CMD /usr/sbin/sshd -D
</code></pre><h3 id="entrypoint"><a class="anchor" href="#entrypoint">#</a> ENTRYPOINT</h3><p>启动容器时执行的 Shell 命令，同 CMD 类似，只是由 ENTRYPOINT 启动的程序不会被 docker run 命令行指定的参数所覆盖，而且，这些命令行参数会被当作参数传递给 ENTRYPOINT 指定指定的程序，例如：</p><pre><code>	ENTRYPOINT [&quot;/bin/bash&quot;, &quot;-C&quot;, &quot;/start.sh&quot;]
	ENTRYPOINT /bin/bash -C '/start.sh'
	PS：Dockerfile文件中也可以存在多个ENTRYPOINT指令，但仅有最后一个会生效。
</code></pre><h3 id="env"><a class="anchor" href="#env">#</a> ENV</h3><p>设置环境内环境变量，例如：</p><pre><code>	ENV MYSQL_ROOT_PASSWORD 123456
	ENV JAVA_HOME /usr/local/jdk1.8.0_45
	ENV http_proxy http://proxy:913
</code></pre><h3 id="user"><a class="anchor" href="#user">#</a> USER</h3><p>为 RUN、CMD 和 ENTRYPOINT 执行 Shell 命令指定运行用户，例如：</p><pre><code>	USER &lt;user&gt;[:&lt;usergroup&gt;]
	USER &lt;UID&gt;[:&lt;UID&gt;]
	USER edisonzhou
</code></pre><h3 id="healthcheck"><a class="anchor" href="#healthcheck">#</a> HEALTHCHECK</h3><p>告诉 Docker 如何测试容器以检查它是否仍在工作，即健康检查，例如：</p><pre><code>	HEALTHCHECK --interval=5m --timeout=3s --retries=3 \
		CMD curl -f http:/localhost/ || exit 1
	其中，一些选项的说明：
	--interval=DURATION (default: 30s)：每隔多长时间探测一次，默认30秒
	-- timeout= DURATION (default: 30s)：服务响应超时时长，默认30秒
	--start-period= DURATION (default: 0s)：服务启动多久后开始探测，默认0秒
	--retries=N (default: 3)：认为检测失败几次为宕机，默认3次
	一些返回值的说明：
	0：容器成功是健康的，随时可以使用
	1：不健康的容器无法正常工作
	2：保留不使用此退出代码
</code></pre><h3 id="arg"><a class="anchor" href="#arg">#</a> ARG</h3><p>在构建镜像时，指定一些参数，例如：</p><pre><code>	FROM centos:6
	ARG user # ARG user=root
	USER $user
	这时，我们在docker build时可以带上自定义参数user了，如下所示：
	docker build --build-arg user=edisonzhou Dockerfile .
</code></pre><h2 id="配置proxy"><a class="anchor" href="#配置proxy">#</a> 配置 proxy</h2><h3 id="第一种-配置proxy环境变量-有时候需要加http和https两个proxy-而下面两个还没找出怎么加两个proxy"><a class="anchor" href="#第一种-配置proxy环境变量-有时候需要加http和https两个proxy-而下面两个还没找出怎么加两个proxy">#</a> 第一种：配置 proxy 环境变量，有时候需要加 http 和 https 两个 proxy, 而下面两个还没找出怎么加两个 proxy.</h3><pre><code>	ENV http_proxy=http://child-prc.intel.com:913
	ENV https_proxy=http://child-prc.intel.com:913
	ENV HTTP_PROXY=http://child-prc.intel.com:913
	ENV HTTPS_PROXY=http://child-prc.intel.com:913
</code></pre><h3 id="第二种-在dockerfile中命令行加上proxy"><a class="anchor" href="#第二种-在dockerfile中命令行加上proxy">#</a> 第二种：在 Dockerfile 中命令行加上 proxy</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>RUN pip <span class="token function">install</span> Flask-JSON<span class="token operator">==</span><span class="token number">0.3</span>.3 --proxy<span class="token operator">=</span>http://child-prc.intel.com:913</pre></td></tr></table></figure><h3 id="推荐第三种-在构建image命令行上加proxy-这样不会写道image里给其他人用时候不会暴漏自己公司的proxy"><a class="anchor" href="#推荐第三种-在构建image命令行上加proxy-这样不会写道image里给其他人用时候不会暴漏自己公司的proxy">#</a> (推荐) 第三种：在构建 image 命令行上加 proxy, 这样不会写道 image 里，给其他人用时候不会暴漏自己公司的 proxy</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker build --pull -t <span class="token string">"productpage:<span class="token variable">$&#123;VERSION&#125;</span>"</span> -t <span class="token string">"productpage:latest"</span> --build-arg <span class="token assign-left variable">HTTP_PROXY</span><span class="token operator">=</span>http://child-prc.intel.com:913 --build-arg <span class="token assign-left variable">HTTPS_PROXY</span><span class="token operator">=</span>http://child-prc.intel.com:913 <span class="token builtin class-name">.</span></pre></td></tr></table></figure><p>然后在 Dockerfile 里面你应该添加</p><pre><code>	ARG HTTP_PROXY
	ARG HTTPS_PROXY
</code></pre><h2 id="use-cases"><a class="anchor" href="#use-cases">#</a> Use cases</h2><h3 id="case1-编译执行在一个image里"><a class="anchor" href="#case1-编译执行在一个image里">#</a> Case1: 编译执行在一个 image 里</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token builtin class-name">cd</span> /home/zhan</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>	$ <span class="token function">touch</span> test.c</pre></td></tr></table></figure><p>test.c 添加如下内容</p><figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>	</pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">touch</span> Dockerfile</pre></td></tr></table></figure><p>Dockerfile 添加如下内容</p><pre><code>	From ubuntu:18.04
	LABEL maintainer=&quot;tester.com&quot;
	RUN mkdir -p /home/zhan
	WORKDIR /home/zhan
	COPY test.c .
	ENV http_proxy http://proxy:913
	RUN apt-get update
	RUN apt-get install gcc -y
	RUN gcc -g test.c -o test.o
	#CMD [&quot;/bin/bash&quot;]
	CMD [&quot;./test.o&quot;]
</code></pre><p>构建 image</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ docker build -t dockerfile-01:1.0 <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	$ docker images</pre></td></tr><tr><td data-num="3"></td><td><pre>	REPOSITORY                           TAG                 IMAGE ID            CREATED             SIZE</pre></td></tr><tr><td data-num="4"></td><td><pre>	dockerfile-01                        <span class="token number">1.0</span>                 cd9a95fccaa9        <span class="token number">45</span> minutes ago      207MB</pre></td></tr><tr><td data-num="5"></td><td><pre>	ubuntu                               <span class="token number">18.04</span>               4e5021d210f6        <span class="token number">6</span> weeks ago         <span class="token number">64</span>.2MB</pre></td></tr></table></figure><ul><li>第一种执行应用方式：启动容器直接运行可执行文件</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ docker run --rm dockerfile-01</pre></td></tr><tr><td data-num="2"></td><td><pre>	Hello World<span class="token operator">!</span></pre></td></tr></table></figure><ul><li>第二种执行应用方式：启动容器，进入容器，再手动执行可执行文件</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ docker run -itd --name test01 dockerfile-01 /bin/bash</pre></td></tr><tr><td data-num="2"></td><td><pre>	$ docker <span class="token builtin class-name">exec</span> -it test01 /bin/bash</pre></td></tr><tr><td data-num="3"></td><td><pre>	root@bfb87ec4b27a:/home/zhan<span class="token comment"># ls</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	test.c  test.o</pre></td></tr><tr><td data-num="5"></td><td><pre>	root@bfb87ec4b27a:/home/zhan<span class="token comment">#</span></pre></td></tr></table></figure><p>进入容器可以看到直接到 /home/zhan 目录，有 test.c 和 test.o 两个文件</p><h3 id="case2-编译执行在两个image里"><a class="anchor" href="#case2-编译执行在两个image里">#</a> Case2: 编译执行在两个 image 里</h3><p>因为编译生成的 image 非常大，因此把编译生成的文件再 copy 到另一个 image 就减小了体积<br>Dockfile 内容如下</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>From ubuntu:18.04 as builder <span class="token comment"># 基于 ubuntu:18.04 创建第一个 image</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	LABEL <span class="token assign-left variable">maintainer</span><span class="token operator">=</span><span class="token string">"tester.com"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	RUN <span class="token function">mkdir</span> -p /home/zhan</pre></td></tr><tr><td data-num="4"></td><td><pre>	WORKDIR /home/zhan</pre></td></tr><tr><td data-num="5"></td><td><pre>	COPY test.c <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	ENV http_proxy http://proxy:913</pre></td></tr><tr><td data-num="7"></td><td><pre>	RUN <span class="token function">apt-get</span> update</pre></td></tr><tr><td data-num="8"></td><td><pre>	RUN <span class="token function">apt-get</span> <span class="token function">install</span> gcc -y</pre></td></tr><tr><td data-num="9"></td><td><pre>	RUN gcc -g test.c -o test.o</pre></td></tr><tr><td data-num="10"></td><td><pre>	</pre></td></tr><tr><td data-num="11"></td><td><pre>	FROM ubuntu:18.04 <span class="token comment"># 基于 ubuntu:18.04 再创建第二个 image</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	WORKDIR /root/</pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token comment"># 从上面的 image "builder" 拷贝编译好的可执行文件 /home/zhan/test.o 文件到当前 image 的 /root/ 目录</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	COPY --from<span class="token operator">=</span>builder /home/zhan/test.o <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	CMD <span class="token punctuation">[</span><span class="token string">"./test.o"</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>构建 image</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ docker build -t dockerfile-01:2.0 <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	$ docker images</pre></td></tr><tr><td data-num="3"></td><td><pre>	REPOSITORY                           TAG                 IMAGE ID            CREATED             SIZE</pre></td></tr><tr><td data-num="4"></td><td><pre>	dockerfile-01                        <span class="token number">2.0</span>                 f29fa900630d        <span class="token number">5</span> seconds ago       <span class="token number">63</span>.3MB</pre></td></tr><tr><td data-num="5"></td><td><pre>	dockerfile-01                        <span class="token number">1.0</span>                 cd9a95fccaa9        <span class="token number">45</span> minutes ago      207MB</pre></td></tr><tr><td data-num="6"></td><td><pre>	ubuntu                               <span class="token number">18.04</span>               4e5021d210f6        <span class="token number">6</span> weeks ago         <span class="token number">63</span>.2MB</pre></td></tr></table></figure><p>可以看到新生成的两个 image， 一个 image 为 &lt;none&gt;:&lt;none&gt; 大小为 207MB, 另一个 image 为 dockerfile-01:2.0 大小为 64.2MB<br>以后就可以用 dockerfile-01:2.0 作为项目中的应用 docker 容器</p><ul><li>第一种执行应用方式：启动容器直接运行可执行文件</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ docker run --rm dockerfile-01:2.0</pre></td></tr><tr><td data-num="2"></td><td><pre>	Hello World<span class="token operator">!</span></pre></td></tr></table></figure><ul><li>第二种执行应用方式：启动容器，进入容器，再手动执行可执行文件</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ docker run -itd --name test02 dockerfile-01:2.0 /bin/bash</pre></td></tr><tr><td data-num="2"></td><td><pre>	baef91591402ac368816b8baf9251859db9aa9e378845d88009ad8dffdcb8028</pre></td></tr><tr><td data-num="3"></td><td><pre>	$ docker <span class="token builtin class-name">exec</span> -it test02 /bin/bash</pre></td></tr><tr><td data-num="4"></td><td><pre>	root@baef91591402:~<span class="token comment"># ls</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	test.o</pre></td></tr><tr><td data-num="6"></td><td><pre>	root@baef91591402:~<span class="token comment">#</span></pre></td></tr></table></figure><p>进入容器可以看到直接进入 /root 目录，只有可执行文件 test.o</p><h3 id="additional"><a class="anchor" href="#additional">#</a> Additional</h3><p>找一个目录新建两个文件 app.js 和 Dockerfile</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>root@alpha:/home/zhan/images_test<span class="token comment"># ls</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	app.js  Dockerfile</pre></td></tr></table></figure><p>app.js</p><figure class="highlight js"><figcaption data-lang="JavaScript"><span>s</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Kubia server starting ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	</pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">var</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Received request from"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>remoteAddress<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">"You've hit "</span> <span class="token operator">+</span> os<span class="token punctuation">.</span><span class="token function">hostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">var</span> www <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	www<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>Dockerfile</p><pre><code>	FROM node:7
	ADD app.js /app.js
	ENTRYPOINT [&quot;node&quot;,&quot;app.js&quot;]
</code></pre><p>运行如下命令</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ docker build -t kubia <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	$ docker images</pre></td></tr><tr><td data-num="3"></td><td><pre>	$ docker run --name kubia-container -p <span class="token number">8081</span>:8080 -d kubia:latest</pre></td></tr><tr><td data-num="4"></td><td><pre>	$ <span class="token function">curl</span> <span class="token number">10.239</span>.140.186:8081 或者 <span class="token function">curl</span> http://10.239.1n40.186:8081 <span class="token punctuation">(</span>linux添加proxy如child-prc.intel.com:913后用这行命令<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	You've hit fef0dd414fe4</pre></td></tr><tr><td data-num="6"></td><td><pre>	// 浏览器输入http://localhost:8081也能返回同样的container ID, </pre></td></tr><tr><td data-num="7"></td><td><pre>	// 如果机器没有添加proxy代理用 $ <span class="token function">curl</span> localhost:8081 就可以</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>	$ docker <span class="token builtin class-name">exec</span> -it kubia-container1 <span class="token function">bash</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	$ <span class="token function">cat</span> /etc/hostname</pre></td></tr><tr><td data-num="11"></td><td><pre>	fef0dd414fe4 // 发现container的hostname和container ID是一样的十六进制数</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>	$ <span class="token function">ps</span> aux  // 查看容器内运行的进程</pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token environment constant">USER</span>       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</pre></td></tr><tr><td data-num="15"></td><td><pre>	root         <span class="token number">1</span>  <span class="token number">0.0</span>  <span class="token number">0.3</span> <span class="token number">813600</span> <span class="token number">26092</span> ?        Ssl  06:58   <span class="token number">0</span>:00 node app.js</pre></td></tr><tr><td data-num="16"></td><td><pre>	root        <span class="token number">11</span>  <span class="token number">0.1</span>  <span class="token number">0.0</span>  <span class="token number">20244</span>  <span class="token number">3232</span> pts/0    Ss   07:24   <span class="token number">0</span>:00 <span class="token function">bash</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	root        <span class="token number">17</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>  <span class="token number">17500</span>  <span class="token number">2048</span> pts/0    R+   07:26   <span class="token number">0</span>:00 <span class="token function">ps</span> aux</pre></td></tr><tr><td data-num="18"></td><td><pre>	root@fef0dd414fe4:/<span class="token comment">#</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	在宿主主机上运行这个命令 $ <span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> app.js</pre></td></tr><tr><td data-num="20"></td><td><pre>	root     <span class="token number">12028</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>  <span class="token number">21532</span>  <span class="token number">1044</span> pts/1    S+   <span class="token number">15</span>:26   <span class="token number">0</span>:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto app.js</pre></td></tr><tr><td data-num="21"></td><td><pre>	root     <span class="token number">30631</span>  <span class="token number">0.0</span>  <span class="token number">0.3</span> <span class="token number">813600</span> <span class="token number">26092</span> ?        Ssl  <span class="token number">14</span>:58   <span class="token number">0</span>:00 node app.js</pre></td></tr><tr><td data-num="22"></td><td><pre>	发现进程的ID在容器中与主机上不同, 容器使用独立的PID Linux命名空间并且有着独立的系列号，完全独立于进程树.</pre></td></tr><tr><td data-num="23"></td><td><pre>	正如拥有独立的进程树一样，每个容器也拥有独立的文件系统.</pre></td></tr><tr><td data-num="24"></td><td><pre>	容器内的应用不仅拥有独立的文件系统，还有进程、用户、主机名和网络接口.</pre></td></tr></table></figure><h2 id="dockerfile逆向"><a class="anchor" href="#dockerfile逆向">#</a> Dockerfile 逆向</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ docker <span class="token function">history</span> dockerfile-01:1.0</pre></td></tr><tr><td data-num="2"></td><td><pre>	IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</pre></td></tr><tr><td data-num="3"></td><td><pre>	01c4f6c6dc0b        <span class="token number">3</span> hours ago         /bin/sh -c <span class="token comment">#(nop)  CMD ["./test.o"]             0B</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	9237cc69b6b9        <span class="token number">3</span> hours ago         /bin/sh -c gcc -g test.c -o test.o              <span class="token number">10</span>.8kB</pre></td></tr><tr><td data-num="5"></td><td><pre>	4e775aeb3a93        <span class="token number">3</span> hours ago         /bin/sh -c <span class="token function">apt-get</span> <span class="token function">install</span> gcc -y               124MB</pre></td></tr><tr><td data-num="6"></td><td><pre>	4524eb24d841        <span class="token number">3</span> hours ago         /bin/sh -c <span class="token function">apt-get</span> update                       <span class="token number">34</span>.2MB</pre></td></tr><tr><td data-num="7"></td><td><pre>	91c7861b5cb3        <span class="token number">3</span> hours ago         /bin/sh -c <span class="token comment">#(nop)  ENV http_proxy=http://chi…   0B</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	1ca351444c36        <span class="token number">3</span> hours ago         /bin/sh -c <span class="token comment">#(nop) COPY file:48688e4f8a2a718c…   102B</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	82e8f67a2e3f        <span class="token number">3</span> hours ago         /bin/sh -c <span class="token comment">#(nop) WORKDIR /home/zhan            0B</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	21555537a646        <span class="token number">3</span> hours ago         /bin/sh -c <span class="token function">mkdir</span> -p /home/zhan                  0B</pre></td></tr><tr><td data-num="11"></td><td><pre>	14b43e5758aa        <span class="token number">3</span> hours ago         /bin/sh -c <span class="token comment">#(nop)  LABEL maintainer=tester.c…   0B</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	56def654ec22        <span class="token number">6</span> weeks ago         /bin/sh -c <span class="token comment">#(nop)  CMD ["/bin/bash"]            0B</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token operator">&lt;</span>missing<span class="token operator">></span>           <span class="token number">6</span> weeks ago         /bin/sh -c <span class="token function">mkdir</span> -p /run/systemd <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">'do…   7B</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	&lt;missing>           6 weeks ago         /bin/sh -c [ -z "<span class="token variable"><span class="token variable">$(</span><span class="token function">apt-get</span> indextargets<span class="token variable">)</span></span>" ]     0B</pre></td></tr><tr><td data-num="15"></td><td><pre>	&lt;missing>           6 weeks ago         /bin/sh -c set -xe   &amp;&amp; echo '<span class="token comment">#!/bin/sh' > /…   745B</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token operator">&lt;</span>missing<span class="token operator">></span>           <span class="token number">6</span> weeks ago         /bin/sh -c <span class="token comment">#(nop) ADD file:4974bb5483c392fb5…   63.2MB</span></pre></td></tr></table></figure><h2 id="遇到的问题"><a class="anchor" href="#遇到的问题">#</a> 遇到的问题</h2><h3 id="docker-proxy"><a class="anchor" href="#docker-proxy">#</a> docker proxy</h3><p>docker pull ubuntu 等系统镜像后登陆上去，配置公司 proxy 后无法连接网络，apt-get update 无法执行<br>解决方案：修改主机上的文件 /etc/docker/daemon.json 内容如下，添加主机 IP:</p><pre><code>	{ &quot;insecure-registries&quot;: [&quot;10.239.140.186&quot;] }
</code></pre><p>之后重启 docker</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ systemctl daemon-reload</pre></td></tr><tr><td data-num="2"></td><td><pre>	$ systemctl restart docker.service</pre></td></tr></table></figure><p>再次登陆容器配置好 proxy, apt-get update 就可以执行了</p><h3 id="删除所有none镜像"><a class="anchor" href="#删除所有none镜像">#</a> 删除所有 &lt;none&gt; 镜像</h3><p>一条命令 ko</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>docker rmi <span class="token variable"><span class="token variable">`</span>docker images <span class="token operator">|</span> <span class="token function">grep</span>  <span class="token string">"&lt;none>"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print <span class="token variable">$3</span>&#125;'</span><span class="token variable">`</span></span></pre></td></tr></table></figure><p>如果确定所有 none 镜像确实没用，直接加个 - f 强制删除，谨慎</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>docker rmi -f <span class="token variable"><span class="token variable">`</span>docker images <span class="token operator">|</span> <span class="token function">grep</span>  <span class="token string">"&lt;none>"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print <span class="token variable">$3</span>&#125;'</span><span class="token variable">`</span></span></pre></td></tr></table></figure><div class="tags"><a href="/tags/docker/" rel="tag"><i class="ic i-tag"></i> docker</a></div></div><footer><div class="meta"></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Kung-Fu-Master 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Kung-Fu-Master 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Kung-Fu-Master 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Kung-Fu-Master <i class="ic i-at"><em>@</em></i>Hexo</li><li class="link"><strong>本文链接：</strong> <a href="https://kung-fu-master.github.io/2021/03/13/technologies/docker/dockerfile/" title="Dockerfile introduction">https://kung-fu-master.github.io/2021/03/13/technologies/docker/dockerfile/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/03/13/technologies/git/git_commands/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giciszlczyj20zk0m816d.jpg" title="git commands"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> git</span><h3>git commands</h3></a></div><div class="item right"><a href="/2021/03/13/technologies/docker/docker_01_installation/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeyvx1d4j20zk0m8hdt.jpg" title="docker 01 installation and control commands"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> docker</span><h3>docker 01 installation and control commands</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#dockerfile-brief-introduction"><span class="toc-number">1.</span> <span class="toc-text"># Dockerfile brief introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#from"><span class="toc-number">1.1.</span> <span class="toc-text"># From</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#maintainer"><span class="toc-number">1.2.</span> <span class="toc-text"># MAINTAINER</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#run"><span class="toc-number">1.3.</span> <span class="toc-text"># RUN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add"><span class="toc-number">1.4.</span> <span class="toc-text"># ADD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy"><span class="toc-number">1.5.</span> <span class="toc-text"># COPY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#workdir"><span class="toc-number">1.6.</span> <span class="toc-text"># WORKDIR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#volume"><span class="toc-number">1.7.</span> <span class="toc-text"># VOLUME</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#expose"><span class="toc-number">1.8.</span> <span class="toc-text"># EXPOSE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cmd"><span class="toc-number">1.9.</span> <span class="toc-text"># CMD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#entrypoint"><span class="toc-number">1.10.</span> <span class="toc-text"># ENTRYPOINT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#env"><span class="toc-number">1.11.</span> <span class="toc-text"># ENV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#user"><span class="toc-number">1.12.</span> <span class="toc-text"># USER</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#healthcheck"><span class="toc-number">1.13.</span> <span class="toc-text"># HEALTHCHECK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arg"><span class="toc-number">1.14.</span> <span class="toc-text"># ARG</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置proxy"><span class="toc-number">2.</span> <span class="toc-text"># 配置 proxy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一种-配置proxy环境变量-有时候需要加http和https两个proxy-而下面两个还没找出怎么加两个proxy"><span class="toc-number">2.1.</span> <span class="toc-text"># 第一种：配置 proxy 环境变量，有时候需要加 http 和 https 两个 proxy, 而下面两个还没找出怎么加两个 proxy.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二种-在dockerfile中命令行加上proxy"><span class="toc-number">2.2.</span> <span class="toc-text"># 第二种：在 Dockerfile 中命令行加上 proxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#推荐第三种-在构建image命令行上加proxy-这样不会写道image里给其他人用时候不会暴漏自己公司的proxy"><span class="toc-number">2.3.</span> <span class="toc-text"># (推荐) 第三种：在构建 image 命令行上加 proxy, 这样不会写道 image 里，给其他人用时候不会暴漏自己公司的 proxy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#use-cases"><span class="toc-number">3.</span> <span class="toc-text"># Use cases</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#case1-编译执行在一个image里"><span class="toc-number">3.1.</span> <span class="toc-text"># Case1: 编译执行在一个 image 里</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#case2-编译执行在两个image里"><span class="toc-number">3.2.</span> <span class="toc-text"># Case2: 编译执行在两个 image 里</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#additional"><span class="toc-number">3.3.</span> <span class="toc-text"># Additional</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dockerfile逆向"><span class="toc-number">4.</span> <span class="toc-text"># Dockerfile 逆向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#遇到的问题"><span class="toc-number">5.</span> <span class="toc-text"># 遇到的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-proxy"><span class="toc-number">5.1.</span> <span class="toc-text"># docker proxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除所有none镜像"><span class="toc-number">5.2.</span> <span class="toc-text"># 删除所有 &lt;none&gt; 镜像</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/03/13/technologies/docker/DCT/" rel="bookmark" title="Docker Content Trust(DCT) and Notary">Docker Content Trust(DCT) and Notary</a></li><li><a href="/2021/03/13/technologies/docker/docker_02_private_hub/" rel="bookmark" title="docker 02 private hub & journal">docker 02 private hub & journal</a></li><li><a href="/2021/03/13/technologies/docker/regenerateTestingCerts/" rel="bookmark" title="regenerateTestingCerts.sh">regenerateTestingCerts.sh</a></li><li><a href="/2021/03/13/technologies/docker/docker_01_installation/" rel="bookmark" title="docker 01 installation and control commands">docker 01 installation and control commands</a></li><li class="active"><a href="/2021/03/13/technologies/docker/dockerfile/" rel="bookmark" title="Dockerfile introduction">Dockerfile introduction</a></li><li><a href="/2021/03/13/technologies/docker/%E5%AE%89%E8%A3%85docker-compose/" rel="bookmark" title="安装 docker compose">安装 docker compose</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Kung-Fu-Master" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Kung-Fu-Master</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">293</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">40</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">12</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/03/13/technologies/git/git_commands/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/03/13/technologies/docker/docker_01_installation/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/reference/" title="分类于 reference">reference</a> <i class="ic i-angle-right"></i> <a href="/categories/reference/k8s/" title="分类于 k8s">k8s</a></div><span><a href="/2021/03/13/reference/k8s/12.%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8%E5%8C%96%E5%BA%94%E7%94%A8/" title="12 | 牛刀小试：我的第一个容器化应用">12 | 牛刀小试：我的第一个容器化应用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/Centos%E6%9B%B4%E6%94%B9kernel%20%E9%BB%98%E8%AE%A4%E5%90%AF%E5%8A%A8%E9%A1%B9/" title="Centos 更改kernel 默认启动项">Centos 更改kernel 默认启动项</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/centos%E5%8D%87%E7%BA%A7gcc%E5%88%B09.1.0/" title="centos升级gcc到9.1.0">centos升级gcc到9.1.0</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/reference/" title="分类于 reference">reference</a> <i class="ic i-angle-right"></i> <a href="/categories/reference/k8s/" title="分类于 k8s">k8s</a></div><span><a href="/2021/03/13/reference/k8s/02.%E9%A2%84%E4%B9%A0%E7%AF%87-%E5%B0%8F%E9%B2%B8%E9%B1%BC%E5%A4%A7%E4%BA%8B%E8%AE%B0(%E4%BA%8C)%E5%B4%AD%E9%9C%B2%E5%A4%B4%E8%A7%92/" title="02 | 预习篇 · 小鲸鱼大事记（二）：崭露头角">02 | 预习篇 · 小鲸鱼大事记（二）：崭露头角</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/microService/" title="分类于 microService">microService</a> <i class="ic i-angle-right"></i> <a href="/categories/microService/istio/" title="分类于 istio">istio</a></div><span><a href="/2021/03/13/micro_service/istio/istio_authorization/" title="istio authorization">istio authorization</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/language/" title="分类于 language">language</a> <i class="ic i-angle-right"></i> <a href="/categories/language/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" title="分类于 排序算法">排序算法</a></div><span><a href="/2021/03/13/language/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/" title="插入排序">插入排序</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/intel_pstate-acpi-cpufreq%E9%A9%B1%E5%8A%A8%E7%A0%94%E7%A9%B6/" title="intel_pstate&#x2F;acpi-cpufreq驱动研究">intel_pstate/acpi-cpufreq驱动研究</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technologies/" title="分类于 technologies">technologies</a> <i class="ic i-angle-right"></i> <a href="/categories/technologies/security/" title="分类于 security">security</a></div><span><a href="/2021/03/13/technologies/security/jwt_jwks/" title="jwt jwks">jwt jwks</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/history/" title="Linux中禁用命令历史记录">Linux中禁用命令历史记录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/reference/" title="分类于 reference">reference</a> <i class="ic i-angle-right"></i> <a href="/categories/reference/k8s/" title="分类于 k8s">k8s</a></div><span><a href="/2021/03/13/reference/k8s/54.%E7%89%B9%E5%88%AB%E6%94%BE%E9%80%81.%E5%9F%BA%E4%BA%8E%20Kubernetes%20%E7%9A%84%E4%BA%91%E5%8E%9F%E7%94%9F%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86%EF%BC%8C%E5%88%B0%E5%BA%95%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E5%81%9A/" title="54 | 特别放送 | 基于 Kubernetes 的云原生应用管理，到底应该怎么做？">54 | 特别放送 | 基于 Kubernetes 的云原生应用管理，到底应该怎么做？</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Kung-Fu-Master @ Kung Fu Master</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.1m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">16:33</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/03/13/technologies/docker/dockerfile/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->