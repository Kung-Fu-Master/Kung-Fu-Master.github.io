<!-- build time:Wed Mar 24 2021 11:26:45 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Hexo" href="https://kung-fu-master.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Hexo" href="https://kung-fu-master.github.io/atom.xml"><link rel="alternate" type="application/json" title="Hexo" href="https://kung-fu-master.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="docker"><link rel="canonical" href="https://kung-fu-master.github.io/2021/03/13/technologies/docker/DCT/"><title>Docker Content Trust(DCT) and Notary - docker - technologies | Kung Fu Master = Hexo</title><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Docker Content Trust(DCT) and Notary</h1><div class="meta"><span class="item" title="创建时间：2021-03-13 13:00:42"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-03-13T13:00:42+08:00">2021-03-13</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>14k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>13 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Kung Fu Master</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeudstjqj20zk0m8k3r.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeuv80yoj20zk0m8kjl.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giph4lm9i7j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipet4bz0yj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeybxm1pj20zk0m8niv.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giciszlczyj20zk0m816d.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/technologies/" itemprop="item" rel="index" title="分类于 technologies"><span itemprop="name">technologies</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/technologies/docker/" itemprop="item" rel="index" title="分类于 docker"><span itemprop="name">docker</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://kung-fu-master.github.io/2021/03/13/technologies/docker/DCT/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Kung-Fu-Master"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><div class="body md" itemprop="articleBody"><p>reference: <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3NlY3VyaXR5L3RydXN0Lw==">https://docs.docker.com/engine/security/trust/</span></p><p><a id="more"></a></p><p><strong><code>Note:</code> </strong>每次重新部署 DCT 和 Notary 时候要重启 shell 终端，因为设置了很多临时环境变量会导致重新部署 Notary 不成功！</p><pre><code>unset DOCKER_CONTENT_TRUST_SERVER
unset DOCKER_CONTENT_TRUST
</code></pre><h2 id="machine-configuration"><a class="anchor" href="#machine-configuration">#</a> Machine configuration</h2><table><thead><tr><th style="text-align:left">机器</th><th style="text-align:left">IP</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:left">master</td><td style="text-align:left">10.239.140.65</td><td style="text-align:center">部署了 docker registry 仓库和 notary 服务器</td></tr><tr><td style="text-align:left">laboratory</td><td style="text-align:left">10.239.131.157</td><td style="text-align:center">用来测试上传下载 master 上的 registry 中的 images</td></tr></tbody></table><ul><li>master 机器：</li></ul><pre><code>cat /etc/hosts
......
10.239.140.65 master
10.239.131.157 laboratory
127.0.0.1 notary-server
</code></pre><ul><li>laboratory 机器:</li></ul><pre><code>10.239.140.65 master notaryserver
10.239.131.157 laboratory
</code></pre><h2 id="master机器"><a class="anchor" href="#master机器">#</a> master 机器</h2><h3 id="部署registry本地仓库"><a class="anchor" href="#部署registry本地仓库">#</a> 部署 registry 本地仓库</h3><pre><code>//改变容器运行时存储位置
$ vim /etc/docker/daemon.json
{
&quot;insecure-registries&quot; :[&quot;10.239.140.65:5000&quot;, &quot;master:5000&quot;],
&quot;registry-mirrors&quot;: [&quot;https://uxk0ognt.mirror.aliyuncs.com&quot;],
&quot;live-restore&quot;: true,
&quot;data-root&quot;: &quot;/home/&lt;user-name&gt;/data&quot;,
}

// 重新加载docker daemon, systemctl daemon-reload会重启doker运行时.
$ systemctl reload docker

// 部署私有仓库
$ docker run -d -p 5000:5000 -v /home/&lt;user-name&gt;/data/registry:/var/lib/registry --restart=always --name registry registry:2
</code></pre><h3 id="安装docker-compose"><a class="anchor" href="#安装docker-compose">#</a> 安装 docker-compose</h3><pre><code>$ sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.28.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose

// Apply executable permissions to the binary:
$ sudo chmod +x /usr/local/bin/docker-compose
</code></pre><h3 id="部署notary-server"><a class="anchor" href="#部署notary-server">#</a> 部署 notary server</h3><p><strong><code>master机器上部署notary server, signer, mysql服务</code></strong></p><p>notary 只能在 master 机器上部署</p><pre><code>git clone https://github.com/theupdateframework/notary.git
cd notary/fixtures/
vim regenerateTestingCerts.sh
	在&quot;notary-server.cnf&quot;部分的subjectAltName变量修改成如下, 加上master机器IP
	subjectAltName = DNS:notary-server, DNS:notaryserver, DNS:localhost, IP:10.239.140.65, IP:127.0.0.1

// 另外 notary-server.key, notary-signer.key, notary-escrow.key默认用已存在的key
// 需要再在regenerateTestingCerts.sh脚本里添加重新生成这三者
vim regenerateTestingCerts.sh
	......
	56 # Then generate notary-server
	57 openssl genrsa -out &quot;notary-server.key&quot; 3072
	58 # Use the existing notary-server key
	......
	80 # Then generate notary-signer
	81 openssl genrsa -out &quot;notary-signer.key&quot; 3072
	82 # Use the existing notary-signer key
	......
	104 # Then generate notary-escrow
	105 openssl genrsa -out &quot;notary-escrow.key&quot; 3072
	106 # Use the existing notary-escrow key
	......

cd ..    //回到notary根目录
vim  -O server.Dockerfile signer.Dockerfile 添加如下两行配置proxy
	ENV http_proxy=http://child-prc.intel.com:913
	ENV https_proxy=http://child-prc.intel.com:913
docker-compose build  // 构建image, 但不会启动容器
docker-compose up -d  // 启动容器, -d:后台运行
mkdir -p ~/.notary &amp;&amp; cp cmd/notary/config.json cmd/notary/root-ca.crt ~/.notary

// 拷贝 notary-server.crt到docker可信赖目录
mkdir -p ~/.docker/tls/127.0.0.1:4443
cp fixtures/notary-server.crt ~/.docker/tls/127.0.0.1:4443/ca.crt
</code></pre><p><strong><code>NOTE:</code> </strong>完整的 regenerateTestingCerts.sh 文件请参考<a href="../../../../../02/02/technologies/docker/regenerateTestingCerts/"> regenerateTestingCerts.sh</a> 文档</p><p>修改 ** <code>~/.notary/config.json</code> ** 文件内容如下:</p><pre><code>{
    &quot;trust_dir&quot; : &quot;~/.docker/trust&quot;,
    &quot;remote_server&quot;: {
        &quot;url&quot;: &quot;https://127.0.0.1:4443&quot;,
        &quot;root_ca&quot;: &quot;root-ca.crt&quot;
    }
}
</code></pre><p>所有 notary server 配置文件设置信息请参考如下连接:<br><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vbm90YXJ5L3JlZmVyZW5jZS9zZXJ2ZXItY29uZmlnLw==">https://docs.docker.com/notary/reference/server-config/</span></p><p>添加 ** <code>trust_dir</code> ** 后运行如下命令可以查看已存在的 key, 但是需要参考下面下载 notary client 才可执行</p><pre><code>$ notary key list
</code></pre><p>Add <strong><code>127.0.0.1 notary-server</code> </strong>to your <strong><code>/etc/hosts</code> </strong>, or if using docker-machine, add $(docker-machine ip) notary-server).<br>You can run through the examples in the getting started docs and advanced usage docs, but without the** <code>-s</code> ** (server URL) argument to the <strong><code>notary</code> </strong>command since the server URL is specified already in the configuration, file you copied.</p><p>You can also leave off the <strong><code>-d ~/.docker/trust</code> </strong>argument if you do not care to use <strong><code>notary</code> </strong>with Docker images.</p><pre><code>docker ps | grep notary
	bcaa8af05a11        notary_server                    &quot;/usr/bin/env sh -c …&quot;   3 hours ago         Up 3 hours          0.0.0.0:4443-&gt;4443/tcp, 0.0.0.0:32769-&gt;8080/tcp   notary_server_1
	8a5f51586629        notary_signer                    &quot;/usr/bin/env sh -c …&quot;   3 hours ago         Up 3 hours                                                            notary_signer_1
	17920752ae65        mariadb:10.4                     &quot;docker-entrypoint.s…&quot;   3 hours ago         Up 3 hours          3306/tcp                                          notary_mysql_1
</code></pre><p>验证证书:</p><pre><code>openssl verify -CAfile &lt;(cat fixtures/intermediate-ca.crt fixtures/root-ca.crt) fixtures/notary-server.crt
</code></pre><p>(可选操作) 添加 notary 根证书到主机 ** <code>/etc/pki/ca-trust/source/anchors/</code> ** 目录，让主机信任证书，这里可以跳过不设置.</p><pre><code>sudo cp fixtures/root-ca.crt /etc/pki/ca-trust/source/anchors/
sudo cp fixtures/intermediate-ca.crt /etc/pki/ca-trust/source/anchors/
update-ca-trust
</code></pre><p>测试 connect to notary server</p><pre><code>openssl s_client -connect 10.239.140.65:4443 -CAfile fixtures/root-ca.crt -no_ssl3 -no_ssl2
openssl s_client -connect 10.239.140.65:4443 -CAfile ~/.notary/root-ca.crt -no_ssl3 -no_ssl2
</code></pre><h3 id="设置环境变量"><a class="anchor" href="#设置环境变量">#</a> 设置环境变量</h3><p>配置 notary server 端证书到 docker 目录</p><pre><code>//export DOCKER_CONTENT_TRUST_SERVER=https://&lt;URL&gt;:&lt;PORT&gt;
export DOCKER_CONTENT_TRUST_SERVER=https://127.0.0.1:4443
export DOCKER_CONTENT_TRUST=1
</code></pre><h3 id="生成key和证书"><a class="anchor" href="#生成key和证书">#</a> 生成 key 和证书.</h3><p><strong>可以在 master 机器上生成 key 和证书可以用来</strong> <code>sign image</code> <strong>, 在 laboratory 机器上生成 key 和证书可以用来 sign image</strong>, <strong><code>此时master机器和laboraty机器作用一样</code></strong></p><p>A prerequisite for signing an image is a Docker Registry with a Notary server attached (Such as the Docker Hub ). Instructions for standing up a self-hosted environment can be found here <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3NlY3VyaXR5L3RydXN0L2RlcGxveWluZ19ub3Rhcnkv">deploying_notary</span>.</p><p>To sign a Docker Image you will need a delegation key pair. These keys can be generated locally using <strong><code>$ docker trust key generate</code> </strong>or generated by a certificate authority.</p><p>在 master 机器和 laboratry 分别执行以下操作生成 key 和证书，名字可以一个叫 jeff, 另一个叫 tester01.</p><pre><code>openssl genrsa -out key.pem 3072
openssl req -new -sha512 -key key.pem -out key.csr
	填写信息直接回车, 到要填写CN处输入*然后回车
	Common Name (eg, your name or your server's hostname) []:*
openssl x509 -req -sha512 -days 365 -in key.csr -signkey key.pem -out key.crt
chmod 600 key.pem
export DOCKER_CONTENT_TRUST_REPOSITORY_PASSPHRASE=&quot;12345678&quot; //有这一步后下面的命令就不需要再输入密码

docker trust key load key.pem --name jeff
	输入passphrase: 12345678
</code></pre><p>之后会在 <strong><code>~/.docker/trust/private/</code> </strong>生成相应的 key</p><p>Within the Docker CLI we can sign and push a container image with the <strong><code>$ docker trust</code> </strong>command syntax. This is built on top of the Notary feature set, more information on Notary can be found here <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vbm90YXJ5L2dldHRpbmdfc3RhcnRlZC8=">notary-get-start</span>.</p><h3 id="签名仓库和镜像"><a class="anchor" href="#签名仓库和镜像">#</a> 签名仓库和镜像</h3><p><strong>私有仓库 (如 10.239.140.65:5000/python) 先前已经存在，上传 <code>jeff</code> 的 <code>signer key</code> 到此私有仓库，于此同时初始化此私有仓库</strong></p><pre><code>docker trust signer add --key certs/key.crt jeff 10.239.140.65:5000/python
notary delegation list 10.239.140.65:5000/python
</code></pre><p><strong><code>NOTE:</code> </strong>通过 registry:2 搭建的 private repository 里的 <strong><code>python目录</code> </strong>就相当于一个私有仓库，而其它目录如 <strong><code>dir02</code> </strong>就是另外的仓库.<br>如果用 <strong><code>trust signer</code> </strong>上传到 <strong><code>dir02</code> </strong>就会重新生成 singer key 到 ** <code>dir02</code> ** 仓库，此过程会需要你重新设置 <strong>dir02</strong> 仓库 singer key 的 PASSPHRASE<br>上面操作后应该是会在宿主机 <strong><code>ls ~/.docker/trust/private/</code> </strong>生成 signer key, 下次操作时候可以注意下.</p><p><strong>签名本地 image 并上传到 private repository</strong><br>use the delegation private key to sign a particular tag and push it up to the registry：<br>使用 <strong><code>jeff</code> </strong>的 ** <code>signer key</code> ** 签名 image 并上传到部署的 registry 私有仓库.</p><pre><code>	docker trust sign 10.239.140.65:5000/python:3.9.1-slim-security-01
</code></pre><p>Remote trust data for a tag or a repository can be viewed by the $ docker trust inspect command:<br>如果 sign 过的 image 显示信息如下:</p><pre><code>	$ docker trust inspect --pretty 10.239.140.65:5000/python:3.9.1-slim-security-01
	Signatures for 10.239.140.65:5000/python:3.9.1-slim-security-01
	
	SIGNED TAG               DIGEST                                                             SIGNERS
	3.9.1-slim-security-01   b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33   jeff
	
	List of signers and their keys for 10.239.140.65:5000/python:3.9.1-slim-security-01
	
	SIGNER              KEYS
	jeff                3e6bcd979c6c
	
	Administrative keys for 10.239.140.65:5000/python:3.9.1-slim-security-01
	
	  Repository Key:       fd98d671f8da8902c3202891513c743408039cf747185ce74a3790142a0a2535
	  Root Key:     f6ee60c9640fb9ed3a3086c3d884a1fde655a31e5fd0eed70e07ba985c634f95
</code></pre><p>没有 sign 过的 image 显示信息如下，缺少 SIGNED TAG 信息:</p><pre><code>	$ docker trust inspect --pretty 10.239.140.65:5000/python:3.9.1-slim
	No signatures for 10.239.140.65:5000/python:3.9.1-slim
	
	List of signers and their keys for 10.239.140.65:5000/python:3.9.1-slim
	
	SIGNER              KEYS
	jeff                3e6bcd979c6c
	
	Administrative keys for 10.239.140.65:5000/python:3.9.1-slim
	
	  Repository Key:       fd98d671f8da8902c3202891513c743408039cf747185ce74a3790142a0a2535
	  Root Key:     f6ee60c9640fb9ed3a3086c3d884a1fde655a31e5fd0eed70e07ba985c634f95
</code></pre><h3 id="去掉镜像签名"><a class="anchor" href="#去掉镜像签名">#</a> 去掉镜像签名</h3><p>去除 Remote Trust data for a tag:</p><pre><code>	docker trust revoke 10.239.140.65:5000/python:3.9.1-slim-security-01
</code></pre><p>使 docker 客户端强制实行 DCT<br>Content trust is disabled by default in the Docker Client. To enable it, set the DOCKER_CONTENT_TRUST environment variable to 1</p><pre><code>	export DOCKER_CONTENT_TRUST=1
</code></pre><p>When DCT is enabled in the Docker client, <strong><code>docker</code> </strong>CLI commands that operate on tagged images must either have content signatures or explicit content hashes. The commands that operate with DCT are:<br>• push<br>• build<br>• create<br>• pull<br>• run</p><p>For example, with DCT enabled a docker pull someimage:latest only succeeds if someimage:latest is signed. However, an operation with an explicit content hash always succeeds as long as the hash exists:</p><pre><code>	$ docker pull 10.239.140.65:5000/python:3.9.1-slim
	No valid trust data for 3.9.1-slim
	
	$ docker pull 10.239.140.65:5000/python:3.9.1-slim-security-01
	Pull (1 of 1): 10.239.140.65:5000/python:3.9.1-slim-security-01@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33
	sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33: Pulling from python
	Digest: sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33
	Status: Image is up to date for 10.239.140.65:5000/python@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33
	Tagging 10.239.140.65:5000/python@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33 as 10.239.140.65:5000/python:3.9.1-slim-security-01
	10.239.140.65:5000/python:3.9.1-slim-security-01
	
	$ docker pull 10.239.140.65:5000/python:3.9.1-slim@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33
	sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33: Pulling from python
	Digest: sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33
	Status: Image is up to date for 10.239.140.65:5000/python@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33
	10.239.140.65:5000/python:3.9.1-slim@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33
	
	$ docker images | grep python 
	看不到上面的10.239.140.65:5000/python:3.9.1-slim@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33
	
	但是可以通过tag命令给此image再添加标签如:
	$ docker tag 10.239.140.65:5000/python:3.9.1-slim@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33 10.239.140.65:5000/python:test
	$ docker images | grep python
	10.239.140.65:5000/python                               test                           edd87973afe0        2 weeks ago         114MB
</code></pre><h2 id="laboratory机器"><a class="anchor" href="#laboratory机器">#</a> laboratory 机器</h2><h3 id="配置环境变量"><a class="anchor" href="#配置环境变量">#</a> 配置环境变量</h3><pre><code>cat /etc/hosts
10.239.140.65 master notaryserver
10.239.131.157 laboratory
</code></pre><p>设置 DCT 可信任变量</p><pre><code>export DOCKER_CONTENT_TRUST_SERVER=https://10.239.140.65:4443
export DOCKER_CONTENT_TRUST=1
</code></pre><h3 id="拷贝master-notary证书"><a class="anchor" href="#拷贝master-notary证书">#</a> 拷贝 master notary 证书</h3><p>scp master 机器的 notary-server 证书和 root-ca 证书 到 laboratory 机器.</p><pre><code>mkdir -p ~/.docker/tls/10.239.140.65:4443/
scp root@10.239.140.65:/root/.docker/tls/127.0.0.1:4443/ca.crt ~/.docker/tls/10.239.140.65:4443/ca.crt
mkdir -p ~/.notary
scp root@10.239.140.65:/root/.notary/root-ca.crt ~/.notary/root-ca.crt
</code></pre><p>编写 notary config 文件</p><pre><code>cat ~/.notary/config.json
{
        &quot;trust_dir&quot; : &quot;~/.docker/trust&quot;,
        &quot;remote_server&quot;: {
                &quot;url&quot;: &quot;https://10.239.140.65:4443&quot;,
                &quot;root_ca&quot;: &quot;root-ca.crt&quot;
        }
}
</code></pre><h3 id="生成key和证书-2"><a class="anchor" href="#生成key和证书-2">#</a> 生成 key 和证书</h3><p>在 laboratory 机器上生成 signer <strong><code>bob</code> </strong>的 key 和 证书，添加 signer <strong><code>bob</code> </strong>的 key 到指定 registry 仓库，之后 sign image</p><pre><code>mkdir certs
cd certs
openssl genrsa -out key.pem 3072
openssl req -new -sha512 -key key.pem -out key.csr
	填写信息直接回车, 到要填写CN处输入*然后回车
	Common Name (eg, your name or your server's hostname) []:*
openssl x509 -req -sha512 -days 365 -in key.csr -signkey key.pem -out key.crt
chmod 600 key.pem
export DOCKER_CONTENT_TRUST_REPOSITORY_PASSPHRASE=&quot;12345678&quot; //有这一步后下面的命令就不需要再输入密码

docker trust key load key.pem --name bob
	输入passphrase: 12345678
之后会在 **`~/.docker/trust/private/`** 生成相应的key
</code></pre><h3 id="签名仓库和镜像并上传"><a class="anchor" href="#签名仓库和镜像并上传">#</a> 签名仓库和镜像并上传</h3><pre><code>// 添加signer key到10.239.140.65:5000/python-test10仓库
$ docker trust signer add --key certs/key.crt bob 10.239.140.65:5000/python-test10

// 查看delegation key
$ notary delegation list 10.239.140.65:5000/python-test10
  ROLE                PATHS             KEY IDS                                                             THRESHOLD
  ----                -----             -------                                                             ---------
  targets/releases    &quot;&quot; &lt;all paths&gt;    7e1f01ed1d6d0698d5cd5856ec9be27debed33645d2450f20495b70a8a5db83c    1
  targets/bob         &quot;&quot; &lt;all paths&gt;    7e1f01ed1d6d0698d5cd5856ec9be27debed33645d2450f20495b70a8a5db83c    1

// sign image并上传到10.239.140.65:5000/python-test10仓库
$ docker trust sign 10.239.140.65:5000/python-test10:3.9.1-slim-security-01

// 再次sign同一个image会提示image的sign已存在
$ docker trust sign 10.239.140.65:5000/python-test10:3.9.1-slim-security-01
  Signing and pushing trust metadata for 10.239.140.65:5000/python-test10:3.9.1-slim-security-01
  Existing signatures for tag 3.9.1-slim-security-01 digest b9c45d9576c0e70dfe19ec5f481ec4b59daf970a5036463fcb523cf8ebf7fc5c from:
  bob
  Successfully signed 10.239.140.65:5000/python-test10:3.9.1-slim-security-01
</code></pre><h3 id="查看registry私有仓库"><a class="anchor" href="#查看registry私有仓库">#</a> 查看 registry 私有仓库</h3><pre><code>//查看所有仓库
$ curl 10.239.140.65:5000/v2/_catalog

//查看指定仓库所有tag
$ curl 10.239.140.65:5000/v2/python-test10/tags/list
{&quot;name&quot;:&quot;python-test10&quot;,&quot;tags&quot;:[&quot;3.9.1-slim-security-01&quot;, &quot;3.9.1-slim-security-02&quot;]}
</code></pre><h2 id="notary-client"><a class="anchor" href="#notary-client">#</a> notary client</h2><p><strong>master 和 laboratory 都需要下载 notary client, notary client 是一个二进制可执行文件.</strong></p><p>If you would like to use your own Notary server, it is important to use the same or a newer Notary version, as the client for feature compatibility (ex: client version 0.2, server/signer version &gt;= 0.2). (reference: <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vbm90YXJ5L2dldHRpbmdfc3RhcnRlZC8jaW5zcGVjdC1hLWRvY2tlci1odWItcmVwb3NpdG9yeQ==">https://docs.docker.com/notary/getting_started/#inspect-a-docker-hub-repository</span>)<br>查看 nodary server signer 版本</p><pre><code>docker images | grep notary

wget https://github.com/theupdateframework/notary/releases/download/v0.6.1/notary-Linux-amd64
chmod +x notary-Linux-amd64
cp notary-Linux-amd64 /usr/local/bin/notary
</code></pre><p>查看 notary client 版本</p><pre><code>$ notary version
notary
 Version:    0.6.1
 Git commit: d6e1431f
</code></pre><p>The Notary client used in isolation does not know where the trust repositories are located. So, you must provide the <strong><code>-s</code> </strong>(or long form <strong><code>--server</code> </strong>) flag to tell the client which repository server it should communicate with.</p><p>Additionally, Notary stores your own signing keys, and a cache of previously downloaded trust metadata in a directory, provided with the <strong><code>-d</code> </strong>flag. When interacting with Docker Hub repositories, you must instruct the client to use the associated trust directory, which by default is found at <strong><code>.docker/trust</code> </strong>within the calling user’s home directory (failing to use this directory may result in errors when publishing updates to your trust data):</p><pre><code>$ notary -s https://notary.docker.io -d ~/.docker/trust list docker.io/library/alpine
   NAME                                 DIGEST                                SIZE (BYTES)    ROLE
------------------------------------------------------------------------------------------------------
  2.6      e9cec9aec697d8b9d450edd32860ecd363f2f3174c8338beb5f809422d182c63   1374           targets
  2.7      9f08005dff552038f0ad2f46b8e65ff3d25641747d3912e3ea8da6785046561a   1374           targets
  3.1      e876b57b2444813cd474523b9c74aacacc238230b288a22bccece9caf2862197   1374           targets
  3.2      4a8c62881c6237b4c1434125661cddf09434d37c6ef26bf26bfaef0b8c5e2f05   1374           targets
  3.3      2d4f890b7eddb390285e3afea9be98a078c2acd2fb311da8c9048e3d1e4864d3   1374           targets
  edge     878c1b1d668830f01c2b1622ebf1656e32ce830850775d26a387b2f11f541239   1374           targets
  latest   24a36bbc059b1345b7e8be0df20f1b23caa3602e85d42fff7ecd9d0bd255de56   1377           targets
</code></pre><h2 id="rotate-keys"><a class="anchor" href="#rotate-keys">#</a> Rotate keys</h2><p>Reference: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RoZXVwZGF0ZWZyYW1ld29yay9ub3RhcnkvYmxvYi9tYXN0ZXIvZG9jcy9hZHZhbmNlZF91c2FnZS5tZCNtYW5hZ2Uta2V5cw==">https://github.com/theupdateframework/notary/blob/master/docs/advanced_usage.md#manage-keys</span></p><h2 id="清理notary"><a class="anchor" href="#清理notary">#</a> 清理 notary</h2><pre><code>cd notary
rm -rf ~/.notary
rm -rf ~/.docker
docker-compose down
docker rmi notary_server:latest
docker rmi notary_signer:latest
unset DOCKER_CONTENT_TRUST_SERVER
unset DOCKER_CONTENT_TRUST
</code></pre><h3 id="清理notary-key"><a class="anchor" href="#清理notary-key">#</a> 清理 notary key</h3><p>Remove the key from the local Docker Trust store</p><pre><code>// 查看有哪些key
notary key list

// 清理key
notary key remove 1091060d7bfd938dfa5be703fa057974f9322a4faef6f580334f3d6df44c02d1
</code></pre><p>以下命令可以直接从本地删除 key, 因此避免误删最好备份.</p><pre><code>rm -rf ~/.notary/trust/private/&lt;key-number&gt;
</code></pre><div class="tags"><a href="/tags/docker/" rel="tag"><i class="ic i-tag"></i> docker</a></div></div><footer><div class="meta"></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Kung-Fu-Master 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Kung-Fu-Master 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Kung-Fu-Master 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Kung-Fu-Master <i class="ic i-at"><em>@</em></i>Hexo</li><li class="link"><strong>本文链接：</strong> <a href="https://kung-fu-master.github.io/2021/03/13/technologies/docker/DCT/" title="Docker Content Trust(DCT) and Notary">https://kung-fu-master.github.io/2021/03/13/technologies/docker/DCT/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/03/13/technologies/docker/docker_02_private_hub/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclh5u05ej20zk0m87df.jpg" title="docker 02 private hub &amp; journal"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> docker</span><h3>docker 02 private hub & journal</h3></a></div><div class="item right"><a href="/2021/03/13/storage/minio/minIO_02_deployment_on_kubernetes/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclga70tsj20zk0m84mr.jpg" title="MinIO 02 deployment on kubernetes"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> minio</span><h3>MinIO 02 deployment on kubernetes</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#machine-configuration"><span class="toc-number">1.</span> <span class="toc-text"># Machine configuration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#master机器"><span class="toc-number">2.</span> <span class="toc-text"># master 机器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#部署registry本地仓库"><span class="toc-number">2.1.</span> <span class="toc-text"># 部署 registry 本地仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装docker-compose"><span class="toc-number">2.2.</span> <span class="toc-text"># 安装 docker-compose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#部署notary-server"><span class="toc-number">2.3.</span> <span class="toc-text"># 部署 notary server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置环境变量"><span class="toc-number">2.4.</span> <span class="toc-text"># 设置环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#生成key和证书"><span class="toc-number">2.5.</span> <span class="toc-text"># 生成 key 和证书.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#签名仓库和镜像"><span class="toc-number">2.6.</span> <span class="toc-text"># 签名仓库和镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#去掉镜像签名"><span class="toc-number">2.7.</span> <span class="toc-text"># 去掉镜像签名</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#laboratory机器"><span class="toc-number">3.</span> <span class="toc-text"># laboratory 机器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置环境变量"><span class="toc-number">3.1.</span> <span class="toc-text"># 配置环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拷贝master-notary证书"><span class="toc-number">3.2.</span> <span class="toc-text"># 拷贝 master notary 证书</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#生成key和证书-2"><span class="toc-number">3.3.</span> <span class="toc-text"># 生成 key 和证书</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#签名仓库和镜像并上传"><span class="toc-number">3.4.</span> <span class="toc-text"># 签名仓库和镜像并上传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看registry私有仓库"><span class="toc-number">3.5.</span> <span class="toc-text"># 查看 registry 私有仓库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#notary-client"><span class="toc-number">4.</span> <span class="toc-text"># notary client</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rotate-keys"><span class="toc-number">5.</span> <span class="toc-text"># Rotate keys</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#清理notary"><span class="toc-number">6.</span> <span class="toc-text"># 清理 notary</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#清理notary-key"><span class="toc-number">6.1.</span> <span class="toc-text"># 清理 notary key</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/2021/03/13/technologies/docker/DCT/" rel="bookmark" title="Docker Content Trust(DCT) and Notary">Docker Content Trust(DCT) and Notary</a></li><li><a href="/2021/03/13/technologies/docker/docker_02_private_hub/" rel="bookmark" title="docker 02 private hub & journal">docker 02 private hub & journal</a></li><li><a href="/2021/03/13/technologies/docker/regenerateTestingCerts/" rel="bookmark" title="regenerateTestingCerts.sh">regenerateTestingCerts.sh</a></li><li><a href="/2021/03/13/technologies/docker/dockerfile/" rel="bookmark" title="Dockerfile introduction">Dockerfile introduction</a></li><li><a href="/2021/03/13/technologies/docker/%E5%AE%89%E8%A3%85docker-compose/" rel="bookmark" title="安装 docker compose">安装 docker compose</a></li><li><a href="/2021/03/13/technologies/docker/docker_01_installation/" rel="bookmark" title="docker 01 installation and control commands">docker 01 installation and control commands</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Kung-Fu-Master" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Kung-Fu-Master</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">297</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">40</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">12</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/03/13/technologies/docker/docker_02_private_hub/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/03/13/storage/minio/minIO_02_deployment_on_kubernetes/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/yum%E4%B8%8B%E8%BD%BD%E9%81%87%E5%88%B0XZ_5.1.2alpha%E9%97%AE%E9%A2%98/" title="yum下载遇到XZ_5.1.2alpha问题">yum下载遇到XZ_5.1.2alpha问题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/reference/" title="分类于 reference">reference</a> <i class="ic i-angle-right"></i> <a href="/categories/reference/k8s/" title="分类于 k8s">k8s</a></div><span><a href="/2021/03/13/reference/k8s/48.Prometheus%E3%80%81Metrics%20Server%E4%B8%8EKubernetes%E7%9B%91%E6%8E%A7%E4%BD%93%E7%B3%BB/" title="48 | Prometheus、Metrics Server与Kubernetes监控体系">48 | Prometheus、Metrics Server与Kubernetes监控体系</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/language/" title="分类于 language">language</a> <i class="ic i-angle-right"></i> <a href="/categories/language/english/" title="分类于 english">english</a></div><span><a href="/2021/03/13/language/english/english/" title="Unit 1">Unit 1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technologies/" title="分类于 technologies">technologies</a></div><span><a href="/2021/03/13/technologies/Intel_tips_at_work/" title="Intel_tips_at_work">Intel_tips_at_work</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/storage/" title="分类于 storage">storage</a> <i class="ic i-angle-right"></i> <a href="/categories/storage/greenplum/" title="分类于 greenplum">greenplum</a></div><span><a href="/2021/03/13/storage/greenplum/greenplum_client/" title="greenplum client">greenplum client</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/RHEL8.0%E5%BC%80%E6%9C%BA%E6%80%BB%E6%98%AF%E8%A6%81dhclient%E6%89%8B%E5%8A%A8%E8%8E%B7%E5%8F%96IP/" title="RHEL8.0开机总是要dhclient手动获取IP">RHEL8.0开机总是要dhclient手动获取IP</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/perf/" title="perf">perf</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/PTU(Power%20Thermal%20Utility)/" title="PTU(Power Thermal Utility)">PTU(Power Thermal Utility)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/blogs/" title="分类于 blogs">blogs</a> <i class="ic i-angle-right"></i> <a href="/categories/blogs/blogs/" title="分类于 blogs">blogs</a></div><span><a href="/2021/03/13/blogs/blogs/markdown%E6%94%AF%E6%8C%81%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BA%E7%9A%84%E8%AF%AD%E8%A8%80/" title="markdown支持高亮显示的语言">markdown支持高亮显示的语言</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/03/13/linux/intel_pstate-acpi-cpufreq%E9%A9%B1%E5%8A%A8%E7%A0%94%E7%A9%B6/" title="intel_pstate&#x2F;acpi-cpufreq驱动研究">intel_pstate/acpi-cpufreq驱动研究</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Kung-Fu-Master @ Kung Fu Master</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.1m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">17:12</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/03/13/technologies/docker/DCT/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->