{
    "version": "https://jsonfeed.org/version/1",
    "title": "Hexo",
    "subtitle": "",
    "icon": "https://kung-fu-master.github.io/images/favicon.ico",
    "description": "",
    "home_page_url": "https://kung-fu-master.github.io",
    "items": [
        {
            "id": "https://kung-fu-master.github.io/2021/06/16/language/c/struct/",
            "url": "https://kung-fu-master.github.io/2021/06/16/language/c/struct/",
            "title": "c struct",
            "date_published": "2021-06-16T12:57:21.817Z",
            "content_html": "<!-- build time:Wed Jun 16 2021 21:02:36 GMT+0800 (中国标准时间) --><h2 id=\"定义与初始化\"><a class=\"anchor\" href=\"#定义与初始化\">#</a> 定义与初始化</h2><p>格式: <code>struct 结构体名 结构体变量名;</code></p><ol><li>先定义结构体类型，再定义变量</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> stu<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ol start=\"2\"><li>定义结构体类型的同时定义变量</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span> stu<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ol start=\"3\"><li>匿名结构体定义结构体变量</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span> stu<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><div class=\"note info\"><p>第三种方法与第二种方法的区别在于，第三种方法中省去了结构体类型名称，而直接给出结构变量，这种结构体最大的问题是结构体类型不能复用.</p></div><h2 id=\"结构体变量初始化\"><a class=\"anchor\" href=\"#结构体变量初始化\">#</a> 结构体变量初始化</h2><ol><li>定义的同时按顺序初始化</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> stu <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"lnj\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">27</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ol start=\"2\"><li>定义的同时不按顺序初始化</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> stu <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"lnj\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ol start=\"3\"><li>先定义后逐个初始化</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> stu<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>stu<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"lnj\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>stu<span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> <span class=\"token number\">35</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ol start=\"4\"><li>先定义后一次性初始化</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> stu<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>stu2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"lnj\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"成员访问\"><a class=\"anchor\" href=\"#成员访问\">#</a> 成员访问</h2><p>一般对结构体变量的操作是以成员为单位进行的，引用的一般形式为： <code>结构体变量名.成员名</code></p><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> stu<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 访问 stu 的 age 成员</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>stu<span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> <span class=\"token number\">27</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"age = %d\"</span><span class=\"token punctuation\">,</span> stu<span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"作用域\"><a class=\"anchor\" href=\"#作用域\">#</a> 作用域</h2><p>定义局部结构体会 屏蔽 全局同名的结构体.</p><h2 id=\"结构体数组\"><a class=\"anchor\" href=\"#结构体数组\">#</a> 结构体数组</h2><p>结构体数组和普通数组并无太大差异，只不过是数组中的元素都是结构体而已<br>格式: <code>struct 结构体类型名称 数组名称[元素个数]</code></p><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> stu<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ol><li>定义同时初始化</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> stu<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>￼<span class=\"token number\">0</span><span class=\"token operator\">--</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ol start=\"2\"><li>先定义后初始化</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> stu<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>stu<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"lnj\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>stu<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"zs\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"结构体指针\"><a class=\"anchor\" href=\"#结构体指针\">#</a> 结构体指针</h2><p>一个指针变量当用来指向一个结构体变量时，称之为结构体指针变量<br>格式: <code>struct 结构名 *结构指针变量名</code></p><p>通过结构体指针访问结构体成员，可以通过以下两种方式</p><ul><li>(* 结构指针变量). 成员名</li><li>结构指针变量 -&gt; 成员名 (用熟)</li></ul><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 定义一个结构体变量</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> stu <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>“lnj\"<span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 定义一个指向结构体的指针变量</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 指向结构体变量 stu</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>p <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>stu<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// 方式 1：结构体变量名。成员名</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name=%s, age = %d \\n\"</span><span class=\"token punctuation\">,</span> stu<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> stu<span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// 方式 2：(* 指针变量名). 成员名</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name=%s, age = %d \\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// 方式 3：指针变量名 -> 成员名</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name=%s, age = %d \\n\"</span><span class=\"token punctuation\">,</span> p<span class=\"token operator\">-></span>name<span class=\"token punctuation\">,</span> p<span class=\"token operator\">-></span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><div class=\"note info\"><p>(* 结构指针变量) 两侧的括号不可少，因为成员符 <code>.</code> 的优先级高于 <code>*</code> .<br>如去掉括号写作 <code>*pstu.num</code> 则等效于 <code>*(pstu.num)</code> , 这样，意义就完全不对了.</p></div><!-- rebuild by hrmmi -->",
            "tags": [
                "language",
                "c"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/16/language/c/sorting_algorithm/",
            "url": "https://kung-fu-master.github.io/2021/06/16/language/c/sorting_algorithm/",
            "title": "c sort",
            "date_published": "2021-06-16T12:57:21.816Z",
            "content_html": "<!-- build time:Wed Jun 16 2021 20:58:20 GMT+0800 (中国标准时间) --><h2 id=\"总览\"><a class=\"anchor\" href=\"#总览\">#</a> 总览</h2><p>插，冒，选，希，快，堆，并，基；</p><p>插冒 (稳定) 选希快堆 (不稳定) 并基 (稳定)</p><p><img data-src=\"01.png\" alt=\"\"></p><ol><li>稳定性</li></ol><ul><li><p>归并排序、冒泡排序、插入排序、基数排序是稳定的</p></li><li><p>选择排序、快速排序、希尔排序、堆排序是不稳定的</p></li></ul><ol start=\"2\"><li>时间复杂度</li></ol><p>最基础的四个算法：冒泡、选择、插入、快排中，快排的时间复杂度最小 O (n*log2n)，其他都是 O（n2）</p><table><thead><tr><th style=\"text-align:center\">排序方法</th><th style=\"text-align:left\">最好时间</th><th style=\"text-align:center\">平均时间</th><th style=\"text-align:center\">最坏时间</th><th style=\"text-align:center\">辅助存储</th><th style=\"text-align:center\">稳定性</th><th style=\"text-align:center\">备注</th></tr></thead><tbody><tr><td style=\"text-align:center\">插入排序</td><td style=\"text-align:left\">O(n)</td><td style=\"text-align:center\">O(n^2)</td><td style=\"text-align:center\">O(n^2)</td><td style=\"text-align:center\">O(1)</td><td style=\"text-align:center\">稳定</td><td style=\"text-align:center\">大部分已排序时较好</td></tr><tr><td style=\"text-align:center\">冒泡排序</td><td style=\"text-align:left\">O(n)</td><td style=\"text-align:center\">O(n^2)</td><td style=\"text-align:center\">O(n^2)</td><td style=\"text-align:center\">O(1)</td><td style=\"text-align:center\">稳定</td><td style=\"text-align:center\">n 小时较好</td></tr><tr><td style=\"text-align:center\">选择排序</td><td style=\"text-align:left\">O(n^2)</td><td style=\"text-align:center\">O(n^2)</td><td style=\"text-align:center\">O(n^2)</td><td style=\"text-align:center\">O(1)</td><td style=\"text-align:center\">不稳定</td><td style=\"text-align:center\">n 小时较好</td></tr><tr><td style=\"text-align:center\">希尔排序</td><td style=\"text-align:left\">O(n^1.3)</td><td style=\"text-align:center\">O(nlogn)</td><td style=\"text-align:center\">O(n^2)</td><td style=\"text-align:center\">O(1)</td><td style=\"text-align:center\">不稳定</td></tr><tr><td style=\"text-align:center\">快速排序</td><td style=\"text-align:left\">O(nlogn)</td><td style=\"text-align:center\">O(nlogn)</td><td style=\"text-align:center\">O(n^2)</td><td style=\"text-align:center\">O(logn)</td><td style=\"text-align:center\">不稳定</td><td style=\"text-align:center\">n 大时较好</td></tr><tr><td style=\"text-align:center\">堆排序</td><td style=\"text-align:left\">O(nlogn)</td><td style=\"text-align:center\">O(nlogn)</td><td style=\"text-align:center\">O(nlogn)</td><td style=\"text-align:center\">O(1)</td><td style=\"text-align:center\">不稳定</td><td style=\"text-align:center\">n 大时较好</td></tr><tr><td style=\"text-align:center\">归并排序</td><td style=\"text-align:left\">O(nlogn)</td><td style=\"text-align:center\">O(nlogn)</td><td style=\"text-align:center\">O(nlogn)</td><td style=\"text-align:center\">O(n)</td><td style=\"text-align:center\">稳定</td><td style=\"text-align:center\">n 大时较好</td></tr><tr><td style=\"text-align:center\">基数排序</td><td style=\"text-align:left\">O(kn)</td><td style=\"text-align:center\">O(kn)</td><td style=\"text-align:center\">O(kn)</td><td style=\"text-align:center\">O(n)</td><td style=\"text-align:center\">稳定</td></tr></tbody></table><h2 id=\"插入排序\"><a class=\"anchor\" href=\"#插入排序\">#</a> 插入排序</h2><p>插入排序（Insertion-Sort）的算法描述是一种简单直观的排序算法。它的工作原理是通过构建有序序列，对于未排序数据，在已排序序列中从后向前扫描，找到相应位置并插入.</p><p><img data-src=\"insert-sort.gif\" alt=\"\"></p><h3 id=\"排序思路\"><a class=\"anchor\" href=\"#排序思路\">#</a> 排序思路</h3><p>假设按照升序排序</p><ol><li>从索引为 1 的元素开始向前比较，一旦前面一个元素大于自己就与前面的元素交换位置</li><li>直到没有可比较元素或者前面的元素小于自己的时候，就已经将自己交换到了当前空出来的位置</li></ol><h3 id=\"代码实现\"><a class=\"anchor\" href=\"#代码实现\">#</a> 代码实现</h3><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">swapElement</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span> m<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">*</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">int</span> tmp <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>m<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token operator\">*</span>m <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token operator\">*</span>n <span class=\"token operator\">=</span> tmp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// 待排序数组</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">int</span> num<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">// 0. 计算待排序数组长度</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 1. 从第一个元素而不是第 0 个开始依次取出所有用于比较元素</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// 2. 遍历取出前面元素进行比较</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> i<span class=\"token punctuation\">;</span> j <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">--</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token comment\">// 3. 如果前面一个元素大于当前元素，就交换位置</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">[</span>j <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token function\">swapElement</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>num<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>num<span class=\"token punctuation\">[</span>j <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%i\\n\"</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"冒泡排序\"><a class=\"anchor\" href=\"#冒泡排序\">#</a> 冒泡排序</h2><p>冒泡排序 (Bubble Sort) 是一种简单的排序算法。它重复 地走访过要排序的数列，一次比较两个元素，如果他们的顺序错误就把他们交换过来。走访数列的工作是重复地进行直到没有再需要交换，也就是说该数列已经排序完成。这个算法的名字由来是因为越小的元素会经由交换慢慢 “浮” 到数列的顶端.</p><p><img data-src=\"002.gif\" alt=\"\"></p><h3 id=\"排序思路-2\"><a class=\"anchor\" href=\"#排序思路-2\">#</a> 排序思路:</h3><ul><li>假设按照升序排序</li><li>1. 从第 0 个元素开始，每次都用相邻两个元素进行比较</li><li>2. 一旦发现后面一个元素小于前面一个元素就交换位置</li><li>3. 经过一轮比较之后最后一个元素就是最大值</li><li>4. 排除最后一个元素，以此类推，每次比较完成之后最大值都会出现再被比较所有元素的最后</li><li>直到当前元素没有可比较的元素，排序完成</li></ul><h3 id=\"代码实现-2\"><a class=\"anchor\" href=\"#代码实现-2\">#</a> 代码实现</h3><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">swapElement</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span> m<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">*</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">int</span> tmp <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>m<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token operator\">*</span>m <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token operator\">*</span>n <span class=\"token operator\">=</span> tmp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// 待排序数组</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">int</span> num<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> len <span class=\"token operator\">-</span> i <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> num<span class=\"token punctuation\">[</span>j <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token function\">swapElement</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>num<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>num<span class=\"token punctuation\">[</span>j <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%i\\n\"</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"选择排序\"><a class=\"anchor\" href=\"#选择排序\">#</a> 选择排序</h2><p>选择排序 (Selection sort) 是一种简单直观的排序算法。它的工作原理如下。首先在未排序序列中找到最小元素，存放到排序序列的起始位置，然后，再从剩余未排序元素中继续寻找最小元素，然后放到排序序列末尾。以此类推，直到所有元素均排序完毕.</p><p><img data-src=\"001.gif\" alt=\"\"></p><h3 id=\"排序思路-3\"><a class=\"anchor\" href=\"#排序思路-3\">#</a> 排序思路</h3><ul><li>假设按照升序排序</li><li>1. 用第 0 个元素和后面所有元素依次比较</li><li>2. 判断第 0 个元素是否大于当前被比较元素，一旦小于就交换位置</li><li>3. 第 0 个元素和后续所有元素比较完成后，第 0 个元素就是最小值</li><li>4. 排除第 0 个元素，用第 1 个元素重复 1~3 操作，比较完成后第 1 个元素就是倒数第二小的值</li><li>以此类推，直到当前元素没有可比较的元素，排序完成</li></ul><h3 id=\"代码实现-3\"><a class=\"anchor\" href=\"#代码实现-3\">#</a> 代码实现</h3><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 指针 (地址) 传递</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">swapElement</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span> m<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">*</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">int</span> tmp <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>m<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token operator\">*</span>m <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token operator\">*</span>n <span class=\"token operator\">=</span> tmp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 待排序数组</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">int</span> num<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> num<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token function\">swapElement</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>num<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>num<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%i\\n\"</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"希尔排序\"><a class=\"anchor\" href=\"#希尔排序\">#</a> 希尔排序</h2><p>1959 年 Shell 发明，第一个突破 O (n2) 的排序算法，是简单插入排序的改进版。它与插入排序的不同之处在于，它会优先比较距离较远的元素。希尔排序又叫缩小增量排序.</p><p><img data-src=\"shell-sort.gif\" alt=\"\"></p><p><img data-src=\"shell-01.JPG\" alt=\"\"></p><p><img data-src=\"shell-02.JPG\" alt=\"\"></p><p><img data-src=\"shell-03.JPG\" alt=\"\"></p><h3 id=\"排序思路-4\"><a class=\"anchor\" href=\"#排序思路-4\">#</a> 排序思路</h3><ol><li>希尔排序可以理解为插入排序的升级版，先将待排序数组按照指定步长划分为几个小数组</li><li>利用插入排序对小数组进行排序，然后将几个排序的小数组重新合并为原始数组</li><li>重复上述操作，直到步长为 1 时，再利用插入排序排序即可</li></ol><h3 id=\"代码实现-4\"><a class=\"anchor\" href=\"#代码实现-4\">#</a> 代码实现</h3><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">swapElement</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span> m<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">*</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">int</span> tmp <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>m<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token operator\">*</span>m <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token operator\">*</span>n <span class=\"token operator\">=</span> tmp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// 待排序数组</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">int</span> num<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token number\">84</span><span class=\"token punctuation\">,</span> <span class=\"token number\">83</span><span class=\"token punctuation\">,</span> <span class=\"token number\">88</span><span class=\"token punctuation\">,</span> <span class=\"token number\">87</span><span class=\"token punctuation\">,</span> <span class=\"token number\">61</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">70</span><span class=\"token punctuation\">,</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">99</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">// 0. 计算待排序数组长度</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 1. 计算步长</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">int</span> gap <span class=\"token operator\">=</span> len <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">do</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">// 1. 从第一个 (而非第 0 个) 元素 (gap 处元素) 开始往后依次取出待排序数组的所有元素，与各自所在当前组前面的元素进行简单插入排序.</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// 从 gap 处按顺序取待排序数组元素排序，而不是排完一组元素后再排另外一组元素，跟上图演示有些不一样.</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> gap<span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">// 2. 遍历取出前面元素进行比较</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>j <span class=\"token operator\">-</span> gap<span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token comment\">// 3. 如果前面一个元素大于当前元素，就交换位置</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">[</span>j <span class=\"token operator\">-</span> gap<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                    <span class=\"token function\">swapElement</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>num<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>num<span class=\"token punctuation\">[</span>j <span class=\"token operator\">-</span> gap<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token comment\">// 4. 继续往当前组的前一元素移动</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                j<span class=\"token operator\">-=</span> gap<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span>            </pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">// 每个小数组排序完成，重新计算步长</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        gap <span class=\"token operator\">=</span> gap <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>gap <span class=\"token operator\">>=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%i\\n\"</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"计数排序counting-sort\"><a class=\"anchor\" href=\"#计数排序counting-sort\">#</a> 计数排序（Counting Sort）</h2><p>计数排序是一个非基于比较的排序算法，该算法于 1954 年由 Harold H. Seward 提出。它的优势在于在 <code>对一定范围内的整数排序</code> 时，快于任何比较排序算法</p><h3 id=\"排序思路-5\"><a class=\"anchor\" href=\"#排序思路-5\">#</a> 排序思路:</h3><ul><li>1. 找出待排序数组最大值</li><li>2. 定义一个索引最大值为待排序数组最大值的数组</li><li>3. 遍历待排序数组，将待排序数组遍历到的值作新数组索引</li><li>4. 在新数组对应索引存储值原有基础上 + 1</li></ul><p><img data-src=\"001.png\" alt=\"\"></p><h3 id=\"简单代码实现\"><a class=\"anchor\" href=\"#简单代码实现\">#</a> 简单代码实现</h3><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// 待排序数组</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">int</span> num<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 用于排序数组</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">int</span> newNums<span class=\"token punctuation\">[</span><span class=\"token number\">17</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 计算待排序数组长度</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// 编列待排序数组</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 去除待排序数组当前值</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">int</span> index <span class=\"token operator\">=</span> num<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 将待排序数组当前值作为排序数组索引</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// 将用于排序数组对应索引原有值 + 1</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        newNums<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> newNums<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">// 计算排序数组长度</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">int</span> len2 <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>newNums<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>newNums<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// 输出排序数组索引， 就是排序之后的结果</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len2<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// 只有所在索引值大于 0，说明此索引值是原待排序数组中的值，可以输出.</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> newNums<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%i\\n\"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><!-- rebuild by hrmmi -->",
            "tags": [
                "language",
                "c"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/11/language/c/two-dimensional-array/",
            "url": "https://kung-fu-master.github.io/2021/06/11/language/c/two-dimensional-array/",
            "title": "Two dimensional array of c language",
            "date_published": "2021-06-11T13:39:32.813Z",
            "content_html": "<!-- build time:Fri Jun 11 2021 21:45:53 GMT+0800 (中国标准时间) --><p>Reference Link: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDYxNzk2OC9hcnRpY2xlL2RldGFpbHMvMTE3NjU2ODEwP3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19mZWVkX3YyLm5vbmUtdGFzay1ibG9nLWhvdF9yYW5rX2JvdHRvbWluZy04LnBjX3BlcnNvbnJlY2RlcHRoXzEtdXRtX3NvdXJjZT1kaXN0cmlidXRlLnBjX2ZlZWRfdjIubm9uZS10YXNrLWJsb2ctaG90X3JhbmtfYm90dG9taW5nLTgucGNfcGVyc29ucmVj\">https://blog.csdn.net/weixin_44617968/article/details/117656810?utm_medium=distribute.pc_feed_v2.none-task-blog-hot_rank_bottoming-8.pc_personrecdepth_1-utm_source=distribute.pc_feed_v2.none-task-blog-hot_rank_bottoming-8.pc_personrec</span></p><h2 id=\"字符串的基本概念\"><a class=\"anchor\" href=\"#字符串的基本概念\">#</a> 字符串的基本概念</h2><p>字符串是位于双引号中的字符序列，在内存中以 <code>\\0</code> 结束，所占字节比实际多一个.<br><img data-src=\"001.png\" alt=\"\"><br>在 C 语言中没有专门的字符串变量，通常用一个字符数组来存放一个字符串.</p><ul><li>当把一个字符串存入一个数组时，会把结束符 <code>\\0</code> 存入数组，并以此作为该字符串是否结束的标志.</li><li>有了 <code>\\0</code> 标志后，就不必再用字符数组的长度来判断字符串的长度了.</li></ul><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// \"中间不能包含 \\0\", 因为 `\\0` 是字符串的结束标志</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// \\0 的作用：字符串结束的标志</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"c\\0ool\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name = %s\\n\"</span><span class=\"token punctuation\">,</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>输出结果<span class=\"token operator\">:</span> c</pre></td></tr></table></figure><h2 id=\"字符串输出\"><a class=\"anchor\" href=\"#字符串输出\">#</a> 字符串输出</h2><ul><li><code>%s</code> 的本质就是根据传入的 name 的地址逐个去取数组中的元素然后输出，直到遇到 <code>\\0</code> 位置</li></ul><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">char</span> chs<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"lnj\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> chs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"注意点\"><a class=\"anchor\" href=\"#注意点\">#</a> 注意点</h3><ol><li><code>\\0</code> 引发的脏读问题</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'c'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'o'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'o'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'l'</span> <span class=\"token punctuation\">,</span> <span class=\"token string\">'\\0'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">char</span> name2<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'l'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'n'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'j'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name2 = %s\\n\"</span><span class=\"token punctuation\">,</span> name2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 输出结果: lnjcool</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 实际开发中这样定义</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">char</span> name2<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'l'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'n'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'j'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'\\0'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ol start=\"2\"><li>初始化</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">char</span> ch<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">scanf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\"</span><span class=\"token punctuation\">,</span>ch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul><li>对一个字符串数组，如果不做初始化赋值，必须指定数组长度</li><li>ch 最多存放由 9 个字符构成的字符串，其中最后一个字符的位置要留给字符串的结尾标示‘\\0’</li><li>当用 scanf 函数输入字符串时，字符串中不能含有空格，否则将以空格作为串的结束符</li></ul><h2 id=\"二维数组的初始化\"><a class=\"anchor\" href=\"#二维数组的初始化\">#</a> 二维数组的初始化</h2><p>二维数的初始化可分为两种:</p><ul><li>定义的同时初始化</li><li>先定义后初始化</li></ul><h3 id=\"定义的同时初始化\"><a class=\"anchor\" href=\"#定义的同时初始化\">#</a> 定义的同时初始化</h3><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 按行分段赋值</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>￼<span class=\"token number\">0</span><span class=\"token operator\">--</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 按行连续赋值</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span><span class=\"token number\">80</span><span class=\"token punctuation\">,</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span><span class=\"token number\">92</span><span class=\"token punctuation\">,</span><span class=\"token number\">61</span><span class=\"token punctuation\">,</span><span class=\"token number\">65</span><span class=\"token punctuation\">,</span><span class=\"token number\">71</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 完全初始化，省略第一维的长度</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>￼<span class=\"token number\">1</span><span class=\"token operator\">--</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 部分初始化，可以省略第一维的长度</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>￼<span class=\"token number\">2</span><span class=\"token operator\">--</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// 指定元素的初始化</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><div class=\"note info\"><p>注意：有些人可能想不明白，为什么可以省略行数，但不可以省略列数。也有人可能会问，可不可以只指定行数，但是省略列数？其实这个问题很简单，如果我们这样写：<br>int a [2][] = {1, 2, 3, 4, 5, 6}; // 错误写法<br>大家都知道，二维数组会先存放第 1 行的元素，由于不确定列数，也就是不确定第 1 行要存放多少个元素，所以这里会产生很多种情况，可能 1、2 是属于第 1 行的，也可能 1、2、3、4 是第一行的，甚至 1、2、3、4、5、6 全部都是属于第 1 行的</p></div><h3 id=\"先定义后初始化\"><a class=\"anchor\" href=\"#先定义后初始化\">#</a> 先定义后初始化</h3><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">80</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">75</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">92</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>a<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">61</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>a<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">65</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">71</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"作为函数参数注意点\"><a class=\"anchor\" href=\"#作为函数参数注意点\">#</a> 作为函数参数注意点</h2><ul><li>形参写法</li></ul><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 错误写法</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"我被执行了\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 正确写法</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"我被执行了\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> cs<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 正确写法</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"我被执行了\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul><li>二维数组作为函数参数，在被调函数中不能获得其有多少行，需要通过参数传入</li></ul><figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> row <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>cs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 二维数组长度，输出 8, 一维数组 (字符串) 在内存中以 “\\0” 结束，所占字节比实际多一个</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"row = %zu\\n\"</span><span class=\"token punctuation\">,</span> row<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul><li>二维数组作为函数参数，在被调函数中可以计算出二维数组有多少列</li></ul><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">size_t</span> col <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>cs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 输出 3</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"col = %zd\\n\"</span><span class=\"token punctuation\">,</span> col<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"值传递\"><a class=\"anchor\" href=\"#值传递\">#</a> 值传递</h2><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 和一位数组一样，只看形参是基本类型还是数组类型</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 如果是基本类型在函数中修改形参不会影响实参</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">change</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> ch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    ch <span class=\"token operator\">=</span> <span class=\"token string\">'n'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">char</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'d'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'e'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'f'</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cs[0][0] = %c\\n\"</span><span class=\"token punctuation\">,</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// a</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">change</span><span class=\"token punctuation\">(</span>cs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cs[0][0] = %c\\n\"</span><span class=\"token punctuation\">,</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// a</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"地址传递\"><a class=\"anchor\" href=\"#地址传递\">#</a> 地址传递</h2><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 和一位数组一样，只看形参是基本类型还是数组类型</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 如果是数组类型在函数中修改形参会影响实参</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">change</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> ch<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    ch<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'n'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">char</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'d'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'e'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'f'</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cs[0][0] = %c\\n\"</span><span class=\"token punctuation\">,</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// a</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">change</span><span class=\"token punctuation\">(</span>cs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cs[0][0] = %c\\n\"</span><span class=\"token punctuation\">,</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// n</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 和一位数组一样，只看形参是基本类型还是数组类型</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 如果是数组类型在函数中修改形参会影响实参</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">change</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> ch<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    ch<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'n'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">char</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'d'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'e'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'f'</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cs[0][0] = %c\\n\"</span><span class=\"token punctuation\">,</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// a</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">change</span><span class=\"token punctuation\">(</span>cs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cs[0][0] = %c\\n\"</span><span class=\"token punctuation\">,</span> cs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// n</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><!-- rebuild by hrmmi -->",
            "tags": [
                "language",
                "c"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/11/language/c/pointer/",
            "url": "https://kung-fu-master.github.io/2021/06/11/language/c/pointer/",
            "title": "c pointer",
            "date_published": "2021-06-11T13:39:32.792Z",
            "content_html": "<!-- build time:Wed Jun 16 2021 20:58:20 GMT+0800 (中国标准时间) --><p>Reference Link: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDYxNzk2OC9hcnRpY2xlL2RldGFpbHMvMTE3NjU2ODEwP3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19mZWVkX3YyLm5vbmUtdGFzay1ibG9nLWhvdF9yYW5rX2JvdHRvbWluZy04LnBjX3BlcnNvbnJlY2RlcHRoXzEtdXRtX3NvdXJjZT1kaXN0cmlidXRlLnBjX2ZlZWRfdjIubm9uZS10YXNrLWJsb2ctaG90X3JhbmtfYm90dG9taW5nLTgucGNfcGVyc29ucmVj\">https://blog.csdn.net/weixin_44617968/article/details/117656810?utm_medium=distribute.pc_feed_v2.none-task-blog-hot_rank_bottoming-8.pc_personrecdepth_1-utm_source=distribute.pc_feed_v2.none-task-blog-hot_rank_bottoming-8.pc_personrec</span></p><h2 id=\"定义初始化\"><a class=\"anchor\" href=\"#定义初始化\">#</a> 定义初始化</h2><p>C 语言中提供了 * 来定义指针变量和访问指针变量指向的内存存储空间.</p><ul><li>在定义变量的时候 * 是一个类型说明符，说明定义的这个变量是一个指针变量</li><li>在不是定义变量的时候 * 是一个操作符，代表访问指针所指向存储空间<br>C 语言中提供了地址运算符 &amp; 来表示变量的地址。其一般形式为: &amp; 变量名.</li></ul><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>p<span class=\"token operator\">=</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 定义指针变量</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>p1 <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>a<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a = %d\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>p1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 访问指针变量</span></pre></td></tr></table></figure><h2 id=\"野指针\"><a class=\"anchor\" href=\"#野指针\">#</a> 野指针</h2><p>指针没有初始化里面是一个垃圾值，这时候的指针是一个野指针.</p><p><img data-src=\"001.png\" alt=\"\"></p><ul><li>野指针可能会导致程序崩溃</li><li>野指针访问你不该访问数据</li><li>所以指针必须初始化才可以访问其所指向存储区域</li></ul><h2 id=\"二级指针\"><a class=\"anchor\" href=\"#二级指针\">#</a> 二级指针</h2><p>如果一个指针变量存放的又是另一个指针变量的地址，则称这个指针变量为指向指针的指针变量。也称为 “二级指针”.</p><p><img data-src=\"Secondary-pointer.png\" alt=\"\"></p><h2 id=\"数组指针\"><a class=\"anchor\" href=\"#数组指针\">#</a> 数组指针</h2><p>只要一个指针变量保存了数组元素的地址，我们就称之为数组元素指针.<br><img data-src=\"array-pointer.png\" alt=\"\"></p><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span>“<span class=\"token operator\">%</span>p <span class=\"token operator\">%</span>p”<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 输出结果：0x1100, 0x1100</span></pre></td></tr></table></figure><div class=\"note info\"><p>注意：数组名 a 不代表整个数组，只代表数组首元素的地址。<br>“p=a;” 的作用是 “把 a 数组的首元素的地址赋给指针变量 p”, 而不是 “把数组 a 各元素的值赋给 p”</p></div><h3 id=\"访问数组元素\"><a class=\"anchor\" href=\"#访问数组元素\">#</a> 访问数组元素</h3><p>访问数组元素，可用下面两种方法:</p><ul><li>下标法，如 a [i] 形式</li><li>指针法，*(p+i) 形式</li></ul><h2 id=\"字符串指针\"><a class=\"anchor\" href=\"#字符串指针\">#</a> 字符串指针</h2><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 数组名保存的是数组第 0 个元素的地址，指针也可以保存第 0 个元素的地址</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>str <span class=\"token operator\">=</span> <span class=\"token string\">\"abc\"</span></pre></td></tr></table></figure><h3 id=\"注意事项\"><a class=\"anchor\" href=\"#注意事项\">#</a> 注意事项</h3><ol><li>可以查看字符串的每一个字符</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>har <span class=\"token operator\">*</span>str <span class=\"token operator\">=</span> <span class=\"token string\">\"lnj\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%c-\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>str<span class=\"token operator\">+</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 输出结果:l-n-j</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"2\"><li>不可以修改字符串内容</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//   + 使用字符数组来保存的字符串是保存栈里的，保存栈里面东西是可读可写，所有可以修改字符串中的的字符</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//   + 使用字符指针来保存字符串，它保存的是字符串常量地址，常量区是只读的，所以我们不可以修改字符串中的字符</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>str <span class=\"token operator\">=</span> <span class=\"token string\">\"lnj\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>str<span class=\"token operator\">+</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 错误</span></pre></td></tr></table></figure><ol start=\"3\"><li>不能够直接接收键盘输入</li></ol><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 错误的原因是:str 是一个野指针，他并没有指向某一块内存空间</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// 所以不允许这样写如果给 str 分配内存空间是可以这样用 的</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>str<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">scanf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\"</span><span class=\"token punctuation\">,</span> str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"函数指针\"><a class=\"anchor\" href=\"#函数指针\">#</a> 函数指针</h2><p>为什么指针可以指向一个函数？</p><ul><li>函数作为一段程序，在内存中也要占据部分存储空间，它也有一个起始地址</li><li>函数有自己的地址，那就好办了，我们的指针变量就是用来存储地址的。</li><li>因此可以利用一个指针指向一个函数。其中，函数名就代表着函数的地址。<br>指针函数的定义</li><li>格式: <code>返回值类型 (*指针变量名)(形参1, 形参2, ...);</code></li></ul><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>c</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span> b<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>p <span class=\"token operator\">=</span> sum<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"应用场景\"><a class=\"anchor\" href=\"#应用场景\">#</a> 应用场景</h3><ul><li>调用函数</li><li>将函数作为参数在函数间传递</li></ul><h3 id=\"注意点\"><a class=\"anchor\" href=\"#注意点\">#</a> 注意点</h3><ul><li>由于这类指针变量存储的是一个函数的入口地址，所以对它们作加减运算 (比如 p++) 是无意义的.</li><li>函数调用中 <code>(*指针变量名)</code> 的两边的括号不可少，其中的不应该理解为求值运算，在此处它只是一种表示符号.</li></ul><!-- rebuild by hrmmi -->",
            "tags": [
                "language",
                "c"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/10/linux/shrink_home_and_expand_root_space/",
            "url": "https://kung-fu-master.github.io/2021/06/10/linux/shrink_home_and_expand_root_space/",
            "title": "缩小home并扩充增大root和根目录空间",
            "date_published": "2021-06-10T12:12:50.709Z",
            "content_html": "<!-- build time:Fri Jun 11 2021 00:17:16 GMT+0800 (中国标准时间) --><p>Reference Link: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZXJ2ZXJmYXVsdC5jb20vcXVlc3Rpb25zLzc3MTkyMS9ob3ctdG8tc2hyaW5rLWhvbWUtYW5kLWFkZC1tb3JlLXNwYWNlLW9uLWNlbnRvczc=\">https://serverfault.com/questions/771921/how-to-shrink-home-and-add-more-space-on-centos7</span></p><h2 id=\"查看磁盘空间\"><a class=\"anchor\" href=\"#查看磁盘空间\">#</a> 查看磁盘空间</h2><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">df</span> -h</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  Filesystem               Size  Used Avail Use% Mounted on</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  devtmpfs                  16G  <span class=\"token number\">4</span>.0K   16G   <span class=\"token number\">1</span>% /dev</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  tmpfs                     16G  <span class=\"token number\">4</span>.0K   16G   <span class=\"token number\">1</span>% /dev/shm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  tmpfs                     16G  <span class=\"token number\">1</span>.6G   14G  <span class=\"token number\">11</span>% /run</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  tmpfs                     16G     <span class=\"token number\">0</span>   16G   <span class=\"token number\">0</span>% /sys/fs/cgroup</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  /dev/mapper/centos-root   50G   28G   23G  <span class=\"token number\">55</span>% /</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  /dev/nvme0n1p2          1014M  221M  794M  <span class=\"token number\">22</span>% /boot</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  /dev/nvme0n1p1           200M   12M  189M   <span class=\"token number\">6</span>% /boot/efi</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  /dev/mapper/centos-home  410G   13G  398G   <span class=\"token number\">4</span>% /home</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>$ lvs -v</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  LV   VG     <span class=\"token comment\">#Seg Attr       LSize   Maj Min KMaj KMin Pool Origin Data%  Meta%  Move Cpy%Sync Log Convert LV UUID                                LProfile</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  home centos    <span class=\"token number\">1</span> -wi-ao---- <span class=\"token number\">410</span>.05g  -1  -1  <span class=\"token number\">253</span>    <span class=\"token number\">2</span>                                                     8fo1p0-XK0U-N3zw-MjcU-ZBFI-JMrp-NhqJN9</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  root centos    <span class=\"token number\">1</span> -wi-ao----  <span class=\"token number\">50</span>.00g  -1  -1  <span class=\"token number\">253</span>    <span class=\"token number\">0</span>                                                     ZXqpMd-OaaD-c3U0-VWDx-2ysu-ptZk-sE02xr</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  swap centos    <span class=\"token number\">1</span> -wi-a----- <span class=\"token operator\">&lt;</span><span class=\"token number\">15</span>.69g  -1  -1  <span class=\"token number\">253</span>    <span class=\"token number\">1</span>                                                     7lNXQY-I3Wa-jfTX-20Ti-vbee-7RmK-v5zH14</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>$ vgs -v</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  VG     Attr   Ext   <span class=\"token comment\">#PV #LV #SN VSize   VFree VG UUID                                VProfile</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  centos wz--n- <span class=\"token number\">4</span>.00m   <span class=\"token number\">1</span>   <span class=\"token number\">3</span>   <span class=\"token number\">0</span> <span class=\"token number\">475</span>.74g <span class=\"token number\">4</span>.00m G4DGmH-S9n4-BDqF-fbsV-xWNC-2BiL-xYVvar</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>$ pvs -v</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  PV             VG     Fmt  Attr PSize   PFree DevSize PV UUID</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  /dev/nvme0n1p3 centos lvm2 a--  <span class=\"token number\">475</span>.74g <span class=\"token number\">4</span>.00m <span class=\"token number\">475</span>.74g ggeHwe-NAVG-wngq-gpry-cKgt-8HoM-0ZL2J0</pre></td></tr></table></figure><h2 id=\"创建备份磁盘目录\"><a class=\"anchor\" href=\"#创建备份磁盘目录\">#</a> 创建备份磁盘目录</h2><p>mount 一个磁盘足够容纳 /root 和 /home 目录空间大小，并 mount 到一个目录.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ lsblk</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  sda               <span class=\"token number\">8</span>:0    <span class=\"token number\">0</span>   <span class=\"token number\">3</span>.7T  <span class=\"token number\">0</span> disk</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  ├─sda1            <span class=\"token number\">8</span>:1    <span class=\"token number\">0</span>    10G  <span class=\"token number\">0</span> part</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  ├─sda2            <span class=\"token number\">8</span>:2    <span class=\"token number\">0</span>    10G  <span class=\"token number\">0</span> part /mnt/test</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  ├─sda3            <span class=\"token number\">8</span>:3    <span class=\"token number\">0</span>    30G  <span class=\"token number\">0</span> part</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  ├─sda4            <span class=\"token number\">8</span>:4    <span class=\"token number\">0</span>   200G  <span class=\"token number\">0</span> part</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  └─sda5            <span class=\"token number\">8</span>:5    <span class=\"token number\">0</span>   500G  <span class=\"token number\">0</span> part</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>$ mkfs.ext4 /dev/sda5</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>$ <span class=\"token function\">mount</span> /dev/sda5 /mnt/tmp/</pre></td></tr></table></figure><h2 id=\"压缩备份home\"><a class=\"anchor\" href=\"#压缩备份home\">#</a> 压缩备份 home</h2><p>Backup the contents of <code>/home</code> .</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token builtin class-name\">cd</span> /mnt/tmp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>// 将/home目录仅打包, 不压缩</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>$ <span class=\"token function\">tar</span> -cvf /mnt/tmp/home.tgz -C /home <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>//<span class=\"token punctuation\">(</span>推荐<span class=\"token punctuation\">)</span>将/home目录打包后, 以gzip压缩</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>$ <span class=\"token function\">tar</span> -czvf /mnt/tmp/home.tgz -C /home <span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p>Test the backup.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// 查看压缩文件内容</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>$ <span class=\"token function\">tar</span> -tvf home.tgz</pre></td></tr></table></figure><h2 id=\"umount-home\"><a class=\"anchor\" href=\"#umount-home\">#</a> umount home</h2><p>Unmount home</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">umount</span> /dev/mapper/centos-home</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  umount: /home: target is busy.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>          <span class=\"token punctuation\">(</span>In some cases useful info about processes that use</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>           the device is found by lsof<span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span> or fuser<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">))</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>// mount报磁盘busy, 可以用如下命令</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>$ <span class=\"token function\">umount</span> -l /dev/mapper/centos-home</pre></td></tr></table></figure><h2 id=\"remove-home-logical-volume\"><a class=\"anchor\" href=\"#remove-home-logical-volume\">#</a> remove home logical volume</h2><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// 移除home逻辑卷时候可能会报filesystem <span class=\"token keyword\">in</span> use信息.</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>$ lvremove /dev/mapper/centos-home</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  Logical volume centos/home contains a filesystem <span class=\"token keyword\">in</span> use.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>// 解决方法如下</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>$ <span class=\"token function\">fuser</span> -kuc /dev/mapper/centos-home</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>$ lvremove /dev/mapper/centos-home</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  Do you really want to remove active logical volume centos/home? <span class=\"token punctuation\">[</span>y/n<span class=\"token punctuation\">]</span>: y</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  Logical volume <span class=\"token string\">\"home\"</span> successfully removed</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>// 再次查看发现已经没有/home逻辑卷</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>$ lvs -v</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  LV   VG     <span class=\"token comment\">#Seg Attr       LSize   Maj Min KMaj KMin Pool Origin Data%  Meta%  Move Cpy%Sync Log Convert LV UUID                                LProfile</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  root centos    <span class=\"token number\">1</span> -wi-ao----  <span class=\"token number\">50</span>.00g  -1  -1  <span class=\"token number\">253</span>    <span class=\"token number\">0</span>                                                     ZXqpMd-OaaD-c3U0-VWDx-2ysu-ptZk-sE02xr       </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  swap centos    <span class=\"token number\">1</span> -wi-a----- <span class=\"token operator\">&lt;</span><span class=\"token number\">15</span>.69g  -1  -1  <span class=\"token number\">253</span>    <span class=\"token number\">1</span>                                                     7lNXQY-I3Wa-jfTX-20Ti-vbee-7RmK-v5zH14</pre></td></tr></table></figure><h2 id=\"recreate-a-logical-volume-for-home\"><a class=\"anchor\" href=\"#recreate-a-logical-volume-for-home\">#</a> Recreate a logical volume for home</h2><p>Recreate a new 300GB logical volume for /home, format and mount it.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ lvcreate -L 300GB -n home centos</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>$ lvs -v</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  LV   VG     <span class=\"token comment\">#Seg Attr       LSize   Maj Min KMaj KMin Pool Origin Data%  Meta%  Move Cpy%Sync Log Convert LV UUID                                LProfile</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  home centos    <span class=\"token number\">1</span> -wi-a----- <span class=\"token number\">300</span>.00g  -1  -1  <span class=\"token number\">253</span>    <span class=\"token number\">2</span>                                                     CbNJO2-DWMb-VvES-3gNv-YufK-VpvN-IQw2ch       </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  root centos    <span class=\"token number\">1</span> -wi-ao----  <span class=\"token number\">50</span>.00g  -1  -1  <span class=\"token number\">253</span>    <span class=\"token number\">0</span>                                                     ZXqpMd-OaaD-c3U0-VWDx-2ysu-ptZk-sE02xr       </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  swap centos    <span class=\"token number\">1</span> -wi-a----- <span class=\"token operator\">&lt;</span><span class=\"token number\">15</span>.69g  -1  -1  <span class=\"token number\">253</span>    <span class=\"token number\">1</span>                                                     7lNXQY-I3Wa-jfTX-20Ti-vbee-7RmK-v5zH14       </pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>$ mkfs.xfs /dev/centos/home</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>$ <span class=\"token function\">mount</span> /dev/mapper/centos-home</pre></td></tr></table></figure><h2 id=\"extend-root-space\"><a class=\"anchor\" href=\"#extend-root-space\">#</a> Extend root space</h2><p>Extend your /root volume with ALL of the remaining space and resize (-r) the file system while doing so.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ lvextend -r -l +100%FREE /dev/mapper/centos-root</pre></td></tr></table></figure><h2 id=\"restore-your-backup\"><a class=\"anchor\" href=\"#restore-your-backup\">#</a> Restore your backup</h2><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> -xzvf /mnt/tmp/home.tgz -C /home</pre></td></tr></table></figure><h2 id=\"update-etcfstab\"><a class=\"anchor\" href=\"#update-etcfstab\">#</a> Update /etc/fstab</h2><p>Check <code>/etc/fstab</code> for any mapping of <code>/home</code> volume. IF it is using UUID you should update the UUID portion. (Since we created a new volume, UUID has changed).</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">vim</span> /etc/fstab</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  /dev/mapper/centos-home /home                   xfs     defaults        <span class=\"token number\">0</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr></table></figure><h2 id=\"sync-the-changes\"><a class=\"anchor\" href=\"#sync-the-changes\">#</a> Sync the changes</h2><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ dracut --regenerate-all --force</pre></td></tr></table></figure><!-- rebuild by hrmmi -->",
            "tags": [
                "linux"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/09/linux/xargs/",
            "url": "https://kung-fu-master.github.io/2021/06/09/linux/xargs/",
            "title": "xargs",
            "date_published": "2021-06-09T12:02:25.271Z",
            "content_html": "<!-- build time:Wed Jun 09 2021 20:03:37 GMT+0800 (中国标准时间) --><h2 id=\"xargs介绍\"><a class=\"anchor\" href=\"#xargs介绍\">#</a> xargs 介绍</h2><p>xargs 用作替换工具，读取输入数据重新格式化后输出</p><h2 id=\"实例\"><a class=\"anchor\" href=\"#实例\">#</a> 实例</h2><h3 id=\"读文本数据\"><a class=\"anchor\" href=\"#读文本数据\">#</a> 读文本数据</h3><p>读多行文本数据并一行输出</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">cat</span> test.txt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a b c d e f g</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>h i j k l m n</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>o p q</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>r s t</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>u <span class=\"token function\">v</span> w x y z</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>$ <span class=\"token function\">cat</span> test.txt <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a b c d e f g h i j k l m n o p q r s t u <span class=\"token function\">v</span> w x y z</pre></td></tr></table></figure><h3 id=\"获取ping输出\"><a class=\"anchor\" href=\"#获取ping输出\">#</a> 获取 ping 输出</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ping</span> hci-node01 -c <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span></pre></td></tr></table></figure><!-- rebuild by hrmmi -->",
            "tags": [
                "linux"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/07/linux/environment_variable/",
            "url": "https://kung-fu-master.github.io/2021/06/07/linux/environment_variable/",
            "title": "环境变量加载顺序",
            "date_published": "2021-06-07T12:53:07.242Z",
            "content_html": "<!-- build time:Mon Jun 07 2021 20:55:25 GMT+0800 (中国标准时间) --><h2 id=\"环境变量分类\"><a class=\"anchor\" href=\"#环境变量分类\">#</a> 环境变量分类</h2><p>环境变量可以简单的分成 <code>用户自定义的环境变量</code> 以及 <code>系统级别的环境变量</code> .<br><strong><span class=\"red\">后加载的环境变量会替换先加载的同名的环境变量</span></strong></p><ul><li>用户级别环境变量定义文件： <code>~/.bashrc</code> 、 <code>~/.profile</code> （部分系统为： <code>~/.bash_profile</code> ）</li><li>系统级别环境变量定义文件： <code>/etc/bashrc</code> 、 <code>/etc/profile</code> (部分系统为： <code>/etc/bash_profile</code> ）、 <code>/etc/environment</code></li></ul><p>另外在用户环境变量中，系统会首先读取 <code>~/.bash_profile</code> （或者 <code>~/.profile</code> ）文件，如果没有该文件则读取 <code>~/.bash_login</code> ，根据这些文件中内容再去读取 <code>~/.bashrc</code> .</p><h2 id=\"加载顺序\"><a class=\"anchor\" href=\"#加载顺序\">#</a> 加载顺序</h2><p>在每个文件中的第一行都加上下面这句代码，并相应的把冒号后的内容修改为当前文件的绝对文件名。</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">UU_ORDER</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$UU_ORDER</span>:/Path/to/this/file\"</span></pre></td></tr></table></figure><p><strong><span class=\"red\">Linux 加载环境变量的顺序如下：</span></strong></p><p>系统环境变量 -&gt; 用户自定义环境变量<br><code>/etc/environment</code> -&gt; <code>/etc/profile</code> -&gt; <code>~/.profile</code></p><p><strong><span class=\"red\">Linux 加载环境变量的顺序如下：</span></strong></p><ol><li><code>/etc/environment</code></li><li><code>/etc/profile</code></li><li><code>/etc/bash.bashrc</code></li><li><code>/etc/profile.d/test.sh</code></li><li><code>~/.profile</code></li><li><code>~/.bashrc</code></li></ol><h2 id=\"自定义环境变量\"><a class=\"anchor\" href=\"#自定义环境变量\">#</a> 自定义环境变量</h2><p>比如在某个项目下定义 <code>uusama.profile</code> ，在这个文件中使用 <code>export</code> 定义一系列变量，然后在 <code>~/.profile</code> 文件后面加上： <code>sourc uusama.profile</code> ，这样你每次登陆都可以在 Shell 脚本中使用自己定义的一系列变量。</p><!-- rebuild by hrmmi -->",
            "tags": [
                "linux"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/07/technologies/docker/docker_copy_file/",
            "url": "https://kung-fu-master.github.io/2021/06/07/technologies/docker/docker_copy_file/",
            "title": "docker container/image 复制(copy)文件/文件夹",
            "date_published": "2021-06-07T12:52:51.407Z",
            "content_html": "<!-- build time:Mon Jun 07 2021 20:55:25 GMT+0800 (中国标准时间) --><h2 id=\"container-copy-files\"><a class=\"anchor\" href=\"#container-copy-files\">#</a> container copy files</h2><p>从容器中 copy 文件或文件夹到 host 机器.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker  <span class=\"token function\">cp</span>  <span class=\"token operator\">&lt;</span>ImageID<span class=\"token operator\">></span>:/Image/path/to/file  /Host/path/to/destination</pre></td></tr></table></figure><p>从 host 机器 copy 文件或文件夹到容器中.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker  <span class=\"token function\">cp</span>  /Host/path/to/destination  <span class=\"token operator\">&lt;</span>ImageID<span class=\"token operator\">></span>:/Image/path/to/file</pre></td></tr></table></figure><h2 id=\"image-copy-files\"><a class=\"anchor\" href=\"#image-copy-files\">#</a> image copy files</h2><p>从 image 中直接 copy 文件或文件夹到 host 机器.</p><div class=\"tab\" data-id=\"id10\" data-title=\"第一种 copy file\"><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run --rm --entrypoint <span class=\"token function\">cat</span> <span class=\"token operator\">&lt;</span>Image-Name<span class=\"token operator\">></span>:<span class=\"token operator\">&lt;</span>Tag<span class=\"token operator\">></span>  /Image/path/to/file <span class=\"token operator\">></span>  /Host/path/to/destination</pre></td></tr></table></figure></div><div class=\"tab\" data-id=\"id10\" data-title=\"第二种 copy file/folder\"><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ docker <span class=\"token function\">cp</span> <span class=\"token variable\"><span class=\"token variable\">$(</span>docker create --rm <span class=\"token operator\">&lt;</span>Image-Name<span class=\"token operator\">></span>:<span class=\"token operator\">&lt;</span>Tag<span class=\"token operator\">></span><span class=\"token variable\">)</span></span>:/Image/path/to/file  /Host/path/to/destination</pre></td></tr></table></figure></div><!-- rebuild by hrmmi -->",
            "tags": [
                "technologies",
                "docker",
                "docker"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/03/linux/mount_umount/",
            "url": "https://kung-fu-master.github.io/2021/06/03/linux/mount_umount/",
            "title": "mount/umount",
            "date_published": "2021-06-03T14:21:24.897Z",
            "content_html": "<!-- build time:Wed Jun 09 2021 20:03:37 GMT+0800 (中国标准时间) --><h2 id=\"mount\"><a class=\"anchor\" href=\"#mount\">#</a> mount</h2><p><strong>语法</strong></p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token punctuation\">[</span>-fnrsvw<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>-t vfstype<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>-o options<span class=\"token punctuation\">]</span> device <span class=\"token function\">dir</span></pre></td></tr></table></figure><p><strong>实例</strong></p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// 将 /dev/hda1 挂在 /mnt 之下。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mount</span> /dev/hda1 /mnt</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>// 将 /dev/hda1 用唯读模式挂在 /mnt 之下。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mount</span> -o ro /dev/hda1 /mnt</pre></td></tr></table></figure><h2 id=\"umount\"><a class=\"anchor\" href=\"#umount\">#</a> umount</h2><p><strong>语法</strong></p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">umount</span> <span class=\"token punctuation\">[</span>-ahnrvV<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>-t <span class=\"token operator\">&lt;</span>文件系统类型<span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>文件系统<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p><strong>参数：</strong></p><ul><li>-a 卸除 /etc/mtab 中记录的所有文件系统。</li><li>-h 显示帮助。</li><li>-n 卸除时不要将信息存入 /etc/mtab 文件中。</li><li>-r 若无法成功卸除，则尝试以只读的方式重新挂入文件系统。</li><li>-t &lt;文件系统类型&gt; 仅卸除选项中所指定的文件系统。</li><li>-v 执行时显示详细的信息。</li><li>-V 显示版本信息。<br>[文件系统] 除了直接指定文件系统外，也可以用设备名称或挂入点来表示文件系统。</li></ul><p><strong>实例</strong></p><p>下面两条命令分别通过设备名和挂载点卸载文件系统，同时输出详细信息：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># umount -v /dev/sda1          通过设备名卸载  </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/dev/sda1 umounted  </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># umount -v /mnt/mymount/      通过挂载点卸载  </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>/tmp/diskboot.img umounted</pre></td></tr></table></figure><p>如果设备正忙，卸载即告失败。卸载失败的常见原因是，某个打开的 shell 当前目录为挂载点里的某个目录：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># umount -v /mnt/mymount/  </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>umount: /mnt/mymount: device is busy  </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>umount: /mnt/mymount: device is busy</pre></td></tr></table></figure><h2 id=\"遇到的问题\"><a class=\"anchor\" href=\"#遇到的问题\">#</a> 遇到的问题</h2><h3 id=\"mount挂载磁盘\"><a class=\"anchor\" href=\"#mount挂载磁盘\">#</a> mount 挂载磁盘</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mount</span> /dev/sda8 /mnt/minio_data/</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  mount: /dev/sda8 is write-protected, mounting read-only</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  mount: unknown filesystem <span class=\"token builtin class-name\">type</span> <span class=\"token string\">'(null)'</span></pre></td></tr></table></figure><p>原因是磁盘分区之后直接挂载出现这样的错误， 解决方法</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mkfs.ext4  /dev/sda8</pre></td></tr></table></figure><p>不是刚分区的磁盘慎用，防止格式化.</p><h3 id=\"unmount出错\"><a class=\"anchor\" href=\"#unmount出错\">#</a> unmount 出错</h3><p>Linux 下挂载后的分区或者磁盘某些时候需要 umount 的时候出现类似 “umount: /mnt: target is busy.” 等字样，或者 “umount: /xxx: device is busy.”。</p><p>解决办法：</p><div class=\"tab\" data-id=\"id001\" data-title=\"使用fuser命令处理\"><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ yum <span class=\"token function\">install</span> psmisc </pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>// 查看挂载的磁盘目录使用进程</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>$ <span class=\"token function\">fuser</span> -mv /mnt/disk01</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                       <span class=\"token environment constant\">USER</span>        PID ACCESS COMMAND</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  /mnt:                root     kernel <span class=\"token function\">mount</span> /mnt/disk01</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                       root      <span class=\"token number\">13830</span> <span class=\"token punctuation\">..</span>c<span class=\"token punctuation\">..</span> <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>// 杀死占用的进程</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>$ <span class=\"token function\">kill</span> -9 <span class=\"token number\">13830</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>// 发现 <span class=\"token function\">bash</span> 退出了，新开shell并再次查看</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>$ <span class=\"token function\">fuser</span> -mv /mnt/</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                       <span class=\"token environment constant\">USER</span>        PID ACCESS COMMAND</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  /mnt:                root     kernel <span class=\"token function\">mount</span> /mnt/disk01</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>// 确认无进程连接后，使用卸载命令</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>$ <span class=\"token function\">umount</span> /mnt/disk01</pre></td></tr></table></figure></div><div class=\"tab\" data-id=\"id001\" data-title=\"通过lsof命令处理\"><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">lsof</span> /mnt/disk01</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  COMMAND   PID <span class=\"token environment constant\">USER</span>   FD   TYPE DEVICE SIZE/OFF NODE NAME</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token function\">bash</span>    <span class=\"token number\">16302</span> root  cwd    DIR   <span class=\"token number\">8,17</span>       <span class=\"token number\">50</span>   <span class=\"token number\">64</span> /mnt/disk01</pre></td></tr></table></figure><p>找到 PID 对应的进程或者服务，然后杀死或者停止相应服务即可.</p></div><div class=\"tab\" data-id=\"id001\" data-title=\"重启系统\"><p>重启后挂载自动解除.</p></div><!-- rebuild by hrmmi -->",
            "tags": [
                "linux"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/01/linux/shell/",
            "url": "https://kung-fu-master.github.io/2021/06/01/linux/shell/",
            "title": "shell",
            "date_published": "2021-06-01T13:12:28.905Z",
            "content_html": "<!-- build time:Tue Jun 01 2021 21:13:20 GMT+0800 (中国标准时间) --><h2 id=\"切换目录\"><a class=\"anchor\" href=\"#切换目录\">#</a> 切换目录</h2><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">touch</span> a.sh</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 用 vi 打开 a.sh 文件进行编写</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#!/bin/sh  </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /data/usr/data/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">pwd</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">ls</span> -l</pre></td></tr></table></figure><p>如果只执行 <code>./a.sh</code> , 可以看到 <code>/data/usr/data/</code> 下的内容。但 shell 退出后还是原来的工作目录。</p><p>如果执行 <code>source ./a.sh</code> , shell 程序运行完成后不仅能看到 <code>/data/usr/data/</code> 下的内容，而且工作目录变成了 <code>/data/usr/data/</code> .</p><!-- rebuild by hrmmi -->",
            "tags": [
                "linux"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/01/MLearning/matplotlib/01_%E5%AD%90%E5%9B%BE%E4%B8%8E%E6%A0%87%E6%B3%A8/",
            "url": "https://kung-fu-master.github.io/2021/06/01/MLearning/matplotlib/01_%E5%AD%90%E5%9B%BE%E4%B8%8E%E6%A0%87%E6%B3%A8/",
            "title": "01 子图与标注",
            "date_published": "2021-06-01T13:11:31.447Z",
            "content_html": "<!-- build time:Tue Jun 01 2021 21:13:20 GMT+0800 (中国标准时间) --><p>python 中有很多画图库，基本上都是用 matplotlib 进行封装</p><p><a id=\"more\"></a></p><h2 id=\"matplotlib\"><a class=\"anchor\" href=\"#matplotlib\">#</a> matplotlib</h2><pre><code>import numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\n\n// 查看matplotlib包所在位置\nprint(mpl.__file__)\n// 输出: /usr/local/lib64/python3.6/site-packages/matplotlib/__init__.py\n\nplt.plot([1, 2, 3, 4, 5], [1, 4, 9, 16, 25], &quot;-.&quot;, color=&quot;r&quot;)\n#plt.plot([1, 2, 3, 4, 5], [1, 4, 9, 16, 25], linestyle=&quot;-.&quot;, color=&quot;r&quot;)\n\nplt.xlabel(&quot;xlabel&quot;, fontsize=16)\nplt.ylabel(&quot;ylabel&quot;)\nplt.show()\n#plt.savefig(&quot;matplotlib/test01.png&quot;)\n\n</code></pre><h2 id=\"线条\"><a class=\"anchor\" href=\"#线条\">#</a> 线条</h2><h3 id=\"线条形状\"><a class=\"anchor\" href=\"#线条形状\">#</a> 线条形状</h3><p>更多线条参考 reference:<br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYXRwbG90bGliLm9yZy90dXRvcmlhbHMvaW5kZXguaHRtbA==\">https://matplotlib.org/tutorials/index.html</span><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYXRwbG90bGliLm9yZy90dXRvcmlhbHMvaW50cm9kdWN0b3J5L3NhbXBsZV9wbG90cy5odG1s\">https://matplotlib.org/tutorials/introductory/sample_plots.html</span><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYXRwbG90bGliLm9yZy90dXRvcmlhbHMvaW50cm9kdWN0b3J5L3B5cGxvdC5odG1s\">https://matplotlib.org/tutorials/introductory/pyplot.html</span><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9hcGkvX2FzX2dlbi9tYXRwbG90bGliLmxpbmVzLkxpbmUyRC5odG1sI21hdHBsb3RsaWIubGluZXMuTGluZTJELnNldF9saW5lc3R5bGU=\">https://matplotlib.org/api/_as_gen/matplotlib.lines.Line2D.html#matplotlib.lines.Line2D.set_linestyle</span><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9leGFtcGxlcy9weWxhYl9leGFtcGxlcy9tdWx0aWNvbG9yZWRfbGluZS5odG1s\">https://matplotlib.org/examples/pylab_examples/multicolored_line.html</span></p><table><thead><tr><th style=\"text-align:center\">字符</th><th style=\"text-align:center\">类型</th></tr></thead><tbody><tr><td style=\"text-align:center\">'-' or 'solid'</td><td style=\"text-align:center\">实线 solid hline</td></tr><tr><td style=\"text-align:center\">'_'</td><td style=\"text-align:center\">横线点</td></tr><tr><td style=\"text-align:center\">'</td><td style=\"text-align:center\">'</td><td>vline</td></tr><tr><td style=\"text-align:center\">'+'</td><td style=\"text-align:center\">plus</td></tr><tr><td style=\"text-align:center\">'--' or 'dashed'</td><td style=\"text-align:center\">虚线 dashed line</td></tr><tr><td style=\"text-align:center\">'-.' or 'dashdot'</td><td style=\"text-align:center\">虚点线 dash-dotted line</td></tr><tr><td style=\"text-align:center\">':' or 'dotted'</td><td style=\"text-align:center\">点线 dotted line</td></tr><tr><td style=\"text-align:center\">'None' or ' ' or ''</td><td style=\"text-align:center\">draw nothing</td></tr><tr><td style=\"text-align:center\">'.'</td><td style=\"text-align:center\">点</td></tr><tr><td style=\"text-align:center\">','</td><td style=\"text-align:center\">像素点</td></tr><tr><td style=\"text-align:center\">'o'</td><td style=\"text-align:center\">圆点</td></tr><tr><td style=\"text-align:center\">'s'</td><td style=\"text-align:center\">正方点</td></tr><tr><td style=\"text-align:center\">'p'</td><td style=\"text-align:center\">五角点</td></tr><tr><td style=\"text-align:center\">'*'</td><td style=\"text-align:center\">star</td></tr><tr><td style=\"text-align:center\">'h'</td><td style=\"text-align:center\">六边形点 1</td></tr><tr><td style=\"text-align:center\">'H'</td><td style=\"text-align:center\">六边形点 2</td></tr><tr><td style=\"text-align:center\">'D'</td><td style=\"text-align:center\">实心菱形点</td></tr><tr><td style=\"text-align:center\">'d'</td><td style=\"text-align:center\">瘦菱形点</td></tr><tr><td style=\"text-align:center\">'x'</td><td style=\"text-align:center\">filled</td></tr><tr><td style=\"text-align:center\">'v'</td><td style=\"text-align:center\">下三角点</td></tr><tr><td style=\"text-align:center\">'^'</td><td style=\"text-align:center\">上三角点</td></tr><tr><td style=\"text-align:center\">'&lt;'</td><td style=\"text-align:center\">左三角点</td></tr><tr><td style=\"text-align:center\">'&gt;'</td><td style=\"text-align:center\">右三角点</td></tr><tr><td style=\"text-align:center\">'1'</td><td style=\"text-align:center\">下三叉点</td></tr><tr><td style=\"text-align:center\">'2'</td><td style=\"text-align:center\">上三叉点</td></tr><tr><td style=\"text-align:center\">'3'</td><td style=\"text-align:center\">左三叉点</td></tr><tr><td style=\"text-align:center\">'4'</td><td style=\"text-align:center\">右三叉点</td></tr></tbody></table><figure class=\"highlight python\"><figcaption data-lang=\"python\"><span>n</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pylab <span class=\"token keyword\">as</span> plt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>markers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token string\">'.'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">','</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'o'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'v'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'^'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&lt;'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'>'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'4'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'s'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'p'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'P'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'h'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'H'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'x'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'X'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'D'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'d'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'|'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'_'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>descriptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token string\">'point'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pixel'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'circle'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'triangle_down'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'triangle_up'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token string\">'triangle_left'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'triangle_right'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'tri_down'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'tri_up'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'tri_left'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token string\">'tri_right'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'octagon'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'square'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pentagon'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'plus (filled)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'star'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token string\">'hexagon1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hexagon2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'plus'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'x'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'x (filled)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'diamond'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token string\">'thin_diamond'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vline'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hline'</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>x <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>y <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        x<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        y<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>plt<span class=\"token punctuation\">.</span>figure<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">,</span> m<span class=\"token punctuation\">,</span> l <span class=\"token keyword\">in</span> <span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> markers<span class=\"token punctuation\">,</span> descriptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    plt<span class=\"token punctuation\">.</span>scatter<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">,</span> marker<span class=\"token operator\">=</span>m<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    plt<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">(</span>i <span class=\"token operator\">-</span> <span class=\"token number\">0.15</span><span class=\"token punctuation\">,</span> j <span class=\"token operator\">+</span> <span class=\"token number\">0.15</span><span class=\"token punctuation\">,</span> s<span class=\"token operator\">=</span>m <span class=\"token operator\">+</span> <span class=\"token string\">' : '</span> <span class=\"token operator\">+</span> l<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>plt<span class=\"token punctuation\">.</span>axis<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4.8</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4.5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>plt<span class=\"token punctuation\">.</span>tight_layout<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>plt<span class=\"token punctuation\">.</span>axis<span class=\"token punctuation\">(</span><span class=\"token string\">'off'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"line_style.png\" alt=\"\"></p><h3 id=\"线条颜色\"><a class=\"anchor\" href=\"#线条颜色\">#</a> 线条颜色</h3><p>reference:<br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYXRwbG90bGliLm9yZy90dXRvcmlhbHMvaW5kZXguaHRtbCNjb2xvcnM=\">https://matplotlib.org/tutorials/index.html#colors</span></p><pre><code>// 线条与颜色分开写\nplt.plot([1, 2, 3, 4, 5], [1, 4, 9, 16, 25], &quot;-.&quot;, color=&quot;r&quot;)\n// 线条与颜色连在一块写\nplt.plot([1, 2, 3, 4, 5], [1, 4, 9, 16, 25], &quot;r-.&quot;)\n</code></pre><h2 id=\"绘制多条线\"><a class=\"anchor\" href=\"#绘制多条线\">#</a> 绘制多条线</h2><figure class=\"highlight python\"><figcaption data-lang=\"python\"><span>n</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>tang_numpy<span class=\"token punctuation\">,</span> tang_numpy<span class=\"token punctuation\">,</span> <span class=\"token string\">\"r--\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>tang_numpy<span class=\"token punctuation\">,</span> tang_numpy<span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bs\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">//</span> 上面两行等同于以下一行python代码</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>tang_numpy<span class=\"token punctuation\">,</span> tang_numpy<span class=\"token punctuation\">,</span> <span class=\"token string\">\"r--\"</span><span class=\"token punctuation\">,</span> tang_numpy<span class=\"token punctuation\">,</span> tang_numpy<span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bs\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>指定线条宽度，关键点标志</p><pre><code>x = np.linspace(-10, 10)\ny = np.sin(x)\n\nplt.plot(x,\n         y,\n         linestyle=&quot;:&quot;,\n         linewidth=3.0,\n         marker=&quot;o&quot;,\t\t\t# 指定x轴值所在位置标志图形\n         markerfacecolor=&quot;r&quot;,\t# 标志颜色\n         markersize=10,\t\t\t# 标志大小\n         alpha=0.5)\t\t\t\t# 透明程度\nplt.savefig(&quot;matplotlib/line01.png&quot;)\nplt.show()\n</code></pre><p>先画图，再设置参数</p><figure class=\"highlight python\"><figcaption data-lang=\"python\"><span>n</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>x <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>linspace<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>y <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sin<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>line <span class=\"token operator\">=</span> plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>plt<span class=\"token punctuation\">.</span>setp<span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         color<span class=\"token operator\">=</span><span class=\"token string\">\"r\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         linestyle<span class=\"token operator\">=</span><span class=\"token string\">\":\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         linewidth<span class=\"token operator\">=</span><span class=\"token number\">3.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         marker<span class=\"token operator\">=</span><span class=\"token string\">\"o\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         markerfacecolor<span class=\"token operator\">=</span><span class=\"token string\">\"r\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         markersize<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>         alpha<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>plt<span class=\"token punctuation\">.</span>savefig<span class=\"token punctuation\">(</span><span class=\"token string\">\"matplotlib/line01.png\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"line01.png\" alt=\"\"></p><h2 id=\"子图\"><a class=\"anchor\" href=\"#子图\">#</a> 子图</h2><p><img data-src=\"subpic01.png\" alt=\"\"></p><figure class=\"highlight python\"><figcaption data-lang=\"python\"><span>n</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> matplotlib <span class=\"token keyword\">as</span> mpl</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pylab <span class=\"token keyword\">as</span> plt</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>tang_numpy <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>arange<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>tang_numpy<span class=\"token punctuation\">,</span> tang_numpy<span class=\"token punctuation\">,</span> <span class=\"token string\">\"r--\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>tang_numpy<span class=\"token punctuation\">,</span> tang_numpy<span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bs\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 上面两行等价于下面一行</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#plt.plot(tang_numpy, tang_numpy, \"r--\", tang_numpy, tang_numpy**2, \"bs\")</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#====================================================================================</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>x <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>linspace<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>y <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sin<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>line <span class=\"token operator\">=</span> plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>plt<span class=\"token punctuation\">.</span>setp<span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>         color<span class=\"token operator\">=</span><span class=\"token string\">\"r\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>         linestyle<span class=\"token operator\">=</span><span class=\"token string\">\":\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         linewidth<span class=\"token operator\">=</span><span class=\"token number\">3.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         marker<span class=\"token operator\">=</span><span class=\"token string\">\"o\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         markerfacecolor<span class=\"token operator\">=</span><span class=\"token string\">\"r\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         markersize<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>         alpha<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>plt<span class=\"token punctuation\">.</span>savefig<span class=\"token punctuation\">(</span><span class=\"token string\">\"matplotlib/line01.png\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#====================================================================================</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>x <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>linspace<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>y <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sin<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># 211 表示一会要画的图是 3 行 2 列的，最后一个 1 表示子图当中第 1 个图</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>plt<span class=\"token punctuation\">.</span>subplot<span class=\"token punctuation\">(</span><span class=\"token number\">321</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>plt<span class=\"token punctuation\">.</span>xlabel<span class=\"token punctuation\">(</span><span class=\"token string\">\"01XXX\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>plt<span class=\"token punctuation\">.</span>ylabel<span class=\"token punctuation\">(</span><span class=\"token string\">\"01YYY\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>plt<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token string\">\"Test 01\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\"># 在图中坐标 (5, 0) 处添加信息</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>plt<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Info\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\"># 添加注释箭头</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>plt<span class=\"token punctuation\">.</span>annotate<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token string\">\"zhushi001\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    xy<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    xytext<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    arrowprops<span class=\"token operator\">=</span><span class=\"token builtin\">dict</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        facecolor<span class=\"token operator\">=</span><span class=\"token string\">\"black\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 箭头颜色</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        shrink<span class=\"token operator\">=</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 箭头大小</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        headlength<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 箭头长度</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        headwidth<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 箭头宽度</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token comment\"># 添加格子</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>plt<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>plt<span class=\"token punctuation\">.</span>subplot<span class=\"token punctuation\">(</span><span class=\"token number\">324</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> x<span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">\"b\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>plt<span class=\"token punctuation\">.</span>xlabel<span class=\"token punctuation\">(</span><span class=\"token string\">\"01XXX\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>plt<span class=\"token punctuation\">.</span>ylabel<span class=\"token punctuation\">(</span><span class=\"token string\">\"01YYY\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>plt<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token string\">\"Test 03\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>plt<span class=\"token punctuation\">.</span>savefig<span class=\"token punctuation\">(</span><span class=\"token string\">\"matplotlib\\matplotlib.png\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><!-- rebuild by hrmmi -->",
            "tags": [
                "MLearning",
                "matplotlib",
                "MLearning"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/01/MLearning/matplotlib/02_%E9%A3%8E%E6%A0%BC%E8%AE%BE%E7%BD%AE/",
            "url": "https://kung-fu-master.github.io/2021/06/01/MLearning/matplotlib/02_%E9%A3%8E%E6%A0%BC%E8%AE%BE%E7%BD%AE/",
            "title": "02 风格设置",
            "date_published": "2021-06-01T13:11:31.447Z",
            "content_html": "<!-- build time:Tue Jun 01 2021 21:13:20 GMT+0800 (中国标准时间) --><h2 id=\"查看多少风格\"><a class=\"anchor\" href=\"#查看多少风格\">#</a> 查看多少风格</h2><figure class=\"highlight py\"><figcaption data-lang=\"Python\"><span>y</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>plt<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>available<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"单个风格\"><a class=\"anchor\" href=\"#单个风格\">#</a> 单个风格</h2><figure class=\"highlight py\"><figcaption data-lang=\"Python\"><span>y</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>x <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>linspace<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>y <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sin<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>plt<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>use<span class=\"token punctuation\">(</span><span class=\"token string\">'ggplot'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 使用风格步骤一定要在画图前面，最好在一开始就设置好.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"01.png\" alt=\"\"></p><h2 id=\"混合风格\"><a class=\"anchor\" href=\"#混合风格\">#</a> 混合风格</h2><figure class=\"highlight py\"><figcaption data-lang=\"Python\"><span>y</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>x <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>linspace<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>y <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sin<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>plt<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>use<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ggplot'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'bmh'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 使用风格步骤一定要在画图前面，最好在一开始就设置好.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"02.png\" alt=\"\"></p><h2 id=\"歪歪扭扭风格\"><a class=\"anchor\" href=\"#歪歪扭扭风格\">#</a> 歪歪扭扭风格</h2><figure class=\"highlight py\"><figcaption data-lang=\"Python\"><span>y</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>x <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>linspace<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>y <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sin<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>plt<span class=\"token punctuation\">.</span>xkcd<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"03.png\" alt=\"\"></p><!-- rebuild by hrmmi -->",
            "tags": [
                "MLearning",
                "matplotlib",
                "MLearning"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/06/01/MLearning/matplotlib/03_%E6%9D%A1%E5%BD%A2%E5%9B%BE/",
            "url": "https://kung-fu-master.github.io/2021/06/01/MLearning/matplotlib/03_%E6%9D%A1%E5%BD%A2%E5%9B%BE/",
            "title": "03 条形图",
            "date_published": "2021-06-01T13:11:31.447Z",
            "content_html": "<!-- build time:Tue Jun 01 2021 21:13:20 GMT+0800 (中国标准时间) --><h2 id=\"竖着画图\"><a class=\"anchor\" href=\"#竖着画图\">#</a> 竖着画图</h2><figure class=\"highlight py\"><figcaption data-lang=\"Python\"><span>y</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>mean_values <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>variance <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>bar_label <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"bar1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bar2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bar3\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># range (3) 等价于 range (0, 3), 是 [0, 1, 2] 没有 3.</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>x_pos <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>bar_label<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># plt.bar: 表示竖着画图.</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># yerr: 梯形图上方的误差棒</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># alpha: 条形图透明程度</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># color: 条形图颜色</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>plt<span class=\"token punctuation\">.</span>bar<span class=\"token punctuation\">(</span>x_pos<span class=\"token punctuation\">,</span> mean_values<span class=\"token punctuation\">,</span> yerr<span class=\"token operator\">=</span>variance<span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">'g'</span><span class=\"token punctuation\">,</span> alpha<span class=\"token operator\">=</span><span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># zip (): 将对象中对应的元素打包成一个个元组，然后返回由这些元组组成的列表</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># list (zip (mean_values, variance)) 返回： [(1, 0.2), (2, 0.4), (3, 0.5)]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># max (zip (mean_values, variance)) 返回: (3, 0.5)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>max_y <span class=\"token operator\">=</span> <span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>mean_values<span class=\"token punctuation\">,</span> variance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>plt<span class=\"token punctuation\">.</span>ylim<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>max_y<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> max_y<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1.2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>plt<span class=\"token punctuation\">.</span>ylabel<span class=\"token punctuation\">(</span><span class=\"token string\">\"variable y\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>plt<span class=\"token punctuation\">.</span>xticks<span class=\"token punctuation\">(</span>x_pos<span class=\"token punctuation\">,</span> bar_label<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"01.png\" alt=\"\"></p><h2 id=\"横着画图\"><a class=\"anchor\" href=\"#横着画图\">#</a> 横着画图</h2><figure class=\"highlight py\"><figcaption data-lang=\"Python\"><span>y</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 生成 [1 2 3] 数组</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>x1 <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>x2 <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>bar_labels <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"bar1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bar2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bar3\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>fig <span class=\"token operator\">=</span> plt<span class=\"token punctuation\">.</span>figure<span class=\"token punctuation\">(</span>figsize<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 返回 [0 1 2] 数组</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>y_pos <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>arange<span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 返回 [0, 1, 2] 数组</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>y_pos <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>x <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> y_pos<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 横着画图</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>plt<span class=\"token punctuation\">.</span>barh<span class=\"token punctuation\">(</span>y_pos<span class=\"token punctuation\">,</span> x1<span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">'y'</span><span class=\"token punctuation\">,</span> alpha<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>plt<span class=\"token punctuation\">.</span>barh<span class=\"token punctuation\">(</span>y_pos<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>x2<span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> alpha<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>plt<span class=\"token punctuation\">.</span>ylim<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x1<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>plt<span class=\"token punctuation\">.</span>xlim<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span>x2<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span>x1<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"02.png\" alt=\"\"></p><!-- rebuild by hrmmi -->",
            "tags": [
                "MLearning",
                "matplotlib",
                "MLearning"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/05/31/technologies/docker/DCT/",
            "url": "https://kung-fu-master.github.io/2021/05/31/technologies/docker/DCT/",
            "title": "Docker Content Trust(DCT) and Notary",
            "date_published": "2021-05-31T03:28:46.161Z",
            "content_html": "<!-- build time:Mon May 31 2021 11:38:18 GMT+0800 (中国标准时间) --><p>reference: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3NlY3VyaXR5L3RydXN0Lw==\">https://docs.docker.com/engine/security/trust/</span></p><p><a id=\"more\"></a></p><p><strong><code>Note:</code> </strong>每次重新部署 DCT 和 Notary 时候要重启 shell 终端，因为设置了很多临时环境变量会导致重新部署 Notary 不成功！</p><pre><code>unset DOCKER_CONTENT_TRUST_SERVER\nunset DOCKER_CONTENT_TRUST\n</code></pre><h2 id=\"machine-configuration\"><a class=\"anchor\" href=\"#machine-configuration\">#</a> Machine configuration</h2><table><thead><tr><th style=\"text-align:left\">机器</th><th style=\"text-align:left\">IP</th><th style=\"text-align:center\">作用</th></tr></thead><tbody><tr><td style=\"text-align:left\">master</td><td style=\"text-align:left\">10.239.140.65</td><td style=\"text-align:center\">部署了 docker registry 仓库和 notary 服务器</td></tr><tr><td style=\"text-align:left\">laboratory</td><td style=\"text-align:left\">10.239.131.157</td><td style=\"text-align:center\">用来测试上传下载 master 上的 registry 中的 images</td></tr></tbody></table><ul><li>master 机器：</li></ul><pre><code>cat /etc/hosts\n......\n10.239.140.65 master\n10.239.131.157 laboratory\n127.0.0.1 notary-server\n</code></pre><ul><li>laboratory 机器:</li></ul><pre><code>10.239.140.65 master notaryserver\n10.239.131.157 laboratory\n</code></pre><h2 id=\"master机器\"><a class=\"anchor\" href=\"#master机器\">#</a> master 机器</h2><h3 id=\"部署registry本地仓库\"><a class=\"anchor\" href=\"#部署registry本地仓库\">#</a> 部署 registry 本地仓库</h3><pre><code>//改变容器运行时存储位置\n$ vim /etc/docker/daemon.json\n{\n&quot;insecure-registries&quot; :[&quot;10.239.140.65:5000&quot;, &quot;master:5000&quot;],\n&quot;registry-mirrors&quot;: [&quot;https://uxk0ognt.mirror.aliyuncs.com&quot;],\n&quot;live-restore&quot;: true,\n&quot;data-root&quot;: &quot;/home/&lt;user-name&gt;/data&quot;,\n}\n\n// 重新加载docker daemon, systemctl daemon-reload会重启doker运行时.\n$ systemctl reload docker\n\n// 部署私有仓库\n$ docker run -d -p 5000:5000 -v /home/&lt;user-name&gt;/data/registry:/var/lib/registry --restart=always --name registry registry:2\n</code></pre><h3 id=\"安装docker-compose\"><a class=\"anchor\" href=\"#安装docker-compose\">#</a> 安装 docker-compose</h3><pre><code>$ sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.28.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose\n\n// Apply executable permissions to the binary:\n$ sudo chmod +x /usr/local/bin/docker-compose\n</code></pre><h3 id=\"部署notary-server\"><a class=\"anchor\" href=\"#部署notary-server\">#</a> 部署 notary server</h3><p><strong><code>master机器上部署notary server, signer, mysql服务</code></strong></p><p>notary 只能在 master 机器上部署</p><pre><code>git clone https://github.com/theupdateframework/notary.git\ncd notary/fixtures/\n\nvim regenerateTestingCerts.sh\n# Centos添加openssl.cnf路径\n# 在&quot;notary-server.cnf&quot;部分的subjectAltName变量修改成如上, 加上master机器IP\n# subjectAltName = DNS:notary-server, DNS:notaryserver, DNS:localhost, IP:10.239.140.65, IP:127.0.0.1\n# 另外 notary-server.key, notary-signer.key, notary-escrow.key默认用已存在的key\n# 需要再在regenerateTestingCerts.sh脚本里添加重新生成这三者\n  ......\n  7 for path in /etc/pki/tls/openssl.cnf /etc/openssl/openssl.cnf /etc/ssl/openssl.cnf /usr/local/etc/openssl/openssl.cnf; do\n  ......\n  56 # Then generate notary-server\n  57 openssl genrsa -out &quot;notary-server.key&quot; 3072\n  58 # Use the existing notary-server key\n  ......\n  62 cat &gt; &quot;notary-server.cnf&quot; &lt;&lt;EOL\n  63 [notary_server]\n  64 authorityKeyIdentifier=keyid,issuer\n  65 basicConstraints = critical,CA:FALSE\n  66 extendedKeyUsage=serverAuth,clientAuth\n  67 keyUsage = critical, digitalSignature, keyEncipherment\n  68 subjectAltName = DNS:notary-server, DNS:notaryserver, DNS:localhost, IP:10.239.140.65, IP:127.0.0.1\n  69 subjectKeyIdentifier=hash\n  70 EOL\n  ......\n  80 # Then generate notary-signer\n  81 openssl genrsa -out &quot;notary-signer.key&quot; 3072\n  82 # Use the existing notary-signer key\n  ......\n  104 # Then generate notary-escrow\n  105 openssl genrsa -out &quot;notary-escrow.key&quot; 3072\n  106 # Use the existing notary-escrow key\n  ......\n\n# 执行脚本，最后出错的信息不用管他，用不着.\n./regenerateTestingCerts.sh\n\n\ncd ..    //回到notary根目录\nvim  -O server.Dockerfile signer.Dockerfile 添加如下两行配置proxy\n\tENV http_proxy=http://child-prc.intel.com:913\n\tENV https_proxy=http://child-prc.intel.com:913\ndocker-compose build  // 构建image, 但不会启动容器\ndocker-compose up -d  // 启动容器, -d:后台运行\nmkdir -p ~/.notary &amp;&amp; cp cmd/notary/config.json cmd/notary/root-ca.crt ~/.notary\n\n// 拷贝 notary-server.crt到docker可信赖目录\nmkdir -p ~/.docker/tls/127.0.0.1:4443\ncp fixtures/notary-server.crt ~/.docker/tls/127.0.0.1:4443/ca.crt\n</code></pre><p><strong><code>NOTE:</code> </strong>完整的 regenerateTestingCerts.sh 文件请参考<a href=\"../../../../../02/02/technologies/docker/regenerateTestingCerts/\"> regenerateTestingCerts.sh</a> 文档</p><p>修改 ** <code>~/.notary/config.json</code> ** 文件内容如下:</p><pre><code>{\n    &quot;trust_dir&quot; : &quot;~/.docker/trust&quot;,\n    &quot;remote_server&quot;: {\n        &quot;url&quot;: &quot;https://127.0.0.1:4443&quot;,\n        &quot;root_ca&quot;: &quot;root-ca.crt&quot;\n    }\n}\n</code></pre><p>所有 notary server 配置文件设置信息请参考如下连接:<br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vbm90YXJ5L3JlZmVyZW5jZS9zZXJ2ZXItY29uZmlnLw==\">https://docs.docker.com/notary/reference/server-config/</span></p><p>添加 ** <code>trust_dir</code> ** 后运行如下命令可以查看已存在的 key, 但是需要参考下面下载 notary client 才可执行</p><pre><code>$ notary key list\n</code></pre><p>Add <strong><code>127.0.0.1 notary-server</code> </strong>to your <strong><code>/etc/hosts</code> </strong>, or if using docker-machine, add $(docker-machine ip) notary-server).<br>You can run through the examples in the getting started docs and advanced usage docs, but without the** <code>-s</code> ** (server URL) argument to the <strong><code>notary</code> </strong>command since the server URL is specified already in the configuration, file you copied.</p><p>You can also leave off the <strong><code>-d ~/.docker/trust</code> </strong>argument if you do not care to use <strong><code>notary</code> </strong>with Docker images.</p><pre><code>docker ps | grep notary\n\tbcaa8af05a11        notary_server                    &quot;/usr/bin/env sh -c …&quot;   3 hours ago         Up 3 hours          0.0.0.0:4443-&gt;4443/tcp, 0.0.0.0:32769-&gt;8080/tcp   notary_server_1\n\t8a5f51586629        notary_signer                    &quot;/usr/bin/env sh -c …&quot;   3 hours ago         Up 3 hours                                                            notary_signer_1\n\t17920752ae65        mariadb:10.4                     &quot;docker-entrypoint.s…&quot;   3 hours ago         Up 3 hours          3306/tcp                                          notary_mysql_1\n</code></pre><p>验证证书:</p><pre><code>openssl verify -CAfile &lt;(cat fixtures/intermediate-ca.crt fixtures/root-ca.crt) fixtures/notary-server.crt\n</code></pre><p>(可选操作) 添加 notary 根证书到主机 ** <code>/etc/pki/ca-trust/source/anchors/</code> ** 目录，让主机信任证书，这里可以跳过不设置.</p><pre><code>sudo cp fixtures/root-ca.crt /etc/pki/ca-trust/source/anchors/\nsudo cp fixtures/intermediate-ca.crt /etc/pki/ca-trust/source/anchors/\nupdate-ca-trust\n</code></pre><p>测试 connect to notary server</p><pre><code>openssl s_client -connect 10.239.140.65:4443 -CAfile fixtures/root-ca.crt -no_ssl3 -no_ssl2\nopenssl s_client -connect 10.239.140.65:4443 -CAfile ~/.notary/root-ca.crt -no_ssl3 -no_ssl2\n</code></pre><h3 id=\"设置环境变量\"><a class=\"anchor\" href=\"#设置环境变量\">#</a> 设置环境变量</h3><p>配置 notary server 端证书到 docker 目录</p><pre><code>//export DOCKER_CONTENT_TRUST_SERVER=https://&lt;URL&gt;:&lt;PORT&gt;\nexport DOCKER_CONTENT_TRUST_SERVER=https://127.0.0.1:4443\nexport DOCKER_CONTENT_TRUST=1\n</code></pre><h3 id=\"生成key和证书\"><a class=\"anchor\" href=\"#生成key和证书\">#</a> 生成 key 和证书.</h3><p><strong>可以在 master 机器上生成 key 和证书可以用来</strong> <code>sign image</code> <strong>, 在 laboratory 机器上生成 key 和证书可以用来 sign image</strong>, <strong><code>此时master机器和laboraty机器作用一样</code></strong></p><p>A prerequisite for signing an image is a Docker Registry with a Notary server attached (Such as the Docker Hub ). Instructions for standing up a self-hosted environment can be found here <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3NlY3VyaXR5L3RydXN0L2RlcGxveWluZ19ub3Rhcnkv\">deploying_notary</span>.</p><p>To sign a Docker Image you will need a delegation key pair. These keys can be generated locally using <strong><code>$ docker trust key generate</code> </strong>or generated by a certificate authority.</p><p>在 master 机器和 laboratry 分别执行以下操作生成 key 和证书，名字可以一个叫 jeff, 另一个叫 tester01.</p><pre><code>openssl genrsa -out key.pem 3072\nopenssl req -new -sha512 -key key.pem -out key.csr\n\t填写信息直接回车, 到要填写CN处输入*然后回车\n\tCommon Name (eg, your name or your server's hostname) []:* or you-node-hostname 如 'master'\nopenssl x509 -req -sha512 -days 365 -in key.csr -signkey key.pem -out key.crt\nchmod 600 key.pem\nexport DOCKER_CONTENT_TRUST_REPOSITORY_PASSPHRASE=&quot;12345678&quot; //有这一步后下面的命令就不需要再输入密码\n\ndocker trust key load key.pem --name jeff\n\t输入passphrase: 12345678\n</code></pre><p>之后会在 <strong><code>~/.docker/trust/private/</code> </strong>生成相应的 key</p><p>Within the Docker CLI we can sign and push a container image with the <strong><code>$ docker trust</code> </strong>command syntax. This is built on top of the Notary feature set, more information on Notary can be found here <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vbm90YXJ5L2dldHRpbmdfc3RhcnRlZC8=\">notary-get-start</span>.</p><h3 id=\"签名仓库和镜像\"><a class=\"anchor\" href=\"#签名仓库和镜像\">#</a> 签名仓库和镜像</h3><p><strong>私有仓库 (如 10.239.140.65:5000/python) 先前已经存在，上传 <code>jeff</code> 的 <code>signer key</code> 到此私有仓库，于此同时初始化此私有仓库</strong></p><pre><code>docker trust signer add --key certs/key.crt jeff 10.239.140.65:5000/python\nnotary delegation list 10.239.140.65:5000/python\n</code></pre><p><strong><code>NOTE:</code> </strong>通过 registry:2 搭建的 private repository 里的 <strong><code>python目录</code> </strong>就相当于一个私有仓库，而其它目录如 <strong><code>dir02</code> </strong>就是另外的仓库.<br>如果用 <strong><code>trust signer</code> </strong>上传到 <strong><code>dir02</code> </strong>就会重新生成 singer key 到 ** <code>dir02</code> ** 仓库，此过程会需要你重新设置 <strong>dir02</strong> 仓库 singer key 的 PASSPHRASE<br>上面操作后应该是会在宿主机 <strong><code>ls ~/.docker/trust/private/</code> </strong>生成 signer key, 下次操作时候可以注意下.</p><p><strong>签名本地 image 并上传到 private repository</strong><br>use the delegation private key to sign a particular tag and push it up to the registry：<br>使用 <strong><code>jeff</code> </strong>的 ** <code>signer key</code> ** 签名 image 并上传到部署的 registry 私有仓库.</p><pre><code>\tdocker trust sign 10.239.140.65:5000/python:3.9.1-slim-security-01\n</code></pre><p>Remote trust data for a tag or a repository can be viewed by the $ docker trust inspect command:<br>如果 sign 过的 image 显示信息如下:</p><pre><code>\t$ docker trust inspect --pretty 10.239.140.65:5000/python:3.9.1-slim-security-01\n\tSignatures for 10.239.140.65:5000/python:3.9.1-slim-security-01\n\t\n\tSIGNED TAG               DIGEST                                                             SIGNERS\n\t3.9.1-slim-security-01   b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33   jeff\n\t\n\tList of signers and their keys for 10.239.140.65:5000/python:3.9.1-slim-security-01\n\t\n\tSIGNER              KEYS\n\tjeff                3e6bcd979c6c\n\t\n\tAdministrative keys for 10.239.140.65:5000/python:3.9.1-slim-security-01\n\t\n\t  Repository Key:       fd98d671f8da8902c3202891513c743408039cf747185ce74a3790142a0a2535\n\t  Root Key:     f6ee60c9640fb9ed3a3086c3d884a1fde655a31e5fd0eed70e07ba985c634f95\n</code></pre><p>没有 sign 过的 image 显示信息如下，缺少 SIGNED TAG 信息:</p><pre><code>\t$ docker trust inspect --pretty 10.239.140.65:5000/python:3.9.1-slim\n\tNo signatures for 10.239.140.65:5000/python:3.9.1-slim\n\t\n\tList of signers and their keys for 10.239.140.65:5000/python:3.9.1-slim\n\t\n\tSIGNER              KEYS\n\tjeff                3e6bcd979c6c\n\t\n\tAdministrative keys for 10.239.140.65:5000/python:3.9.1-slim\n\t\n\t  Repository Key:       fd98d671f8da8902c3202891513c743408039cf747185ce74a3790142a0a2535\n\t  Root Key:     f6ee60c9640fb9ed3a3086c3d884a1fde655a31e5fd0eed70e07ba985c634f95\n</code></pre><h3 id=\"去掉镜像签名\"><a class=\"anchor\" href=\"#去掉镜像签名\">#</a> 去掉镜像签名</h3><p>去除 Remote Trust data for a tag:</p><pre><code>\tdocker trust revoke 10.239.140.65:5000/python:3.9.1-slim-security-01\n</code></pre><p>使 docker 客户端强制实行 DCT<br>Content trust is disabled by default in the Docker Client. To enable it, set the DOCKER_CONTENT_TRUST environment variable to 1</p><pre><code>\texport DOCKER_CONTENT_TRUST=1\n</code></pre><p>When DCT is enabled in the Docker client, <strong><code>docker</code> </strong>CLI commands that operate on tagged images must either have content signatures or explicit content hashes. The commands that operate with DCT are:<br>• push<br>• build<br>• create<br>• pull<br>• run</p><p>For example, with DCT enabled a docker pull someimage:latest only succeeds if someimage:latest is signed. However, an operation with an explicit content hash always succeeds as long as the hash exists:</p><pre><code>\t$ docker pull 10.239.140.65:5000/python:3.9.1-slim\n\tNo valid trust data for 3.9.1-slim\n\t\n\t$ docker pull 10.239.140.65:5000/python:3.9.1-slim-security-01\n\tPull (1 of 1): 10.239.140.65:5000/python:3.9.1-slim-security-01@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33\n\tsha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33: Pulling from python\n\tDigest: sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33\n\tStatus: Image is up to date for 10.239.140.65:5000/python@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33\n\tTagging 10.239.140.65:5000/python@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33 as 10.239.140.65:5000/python:3.9.1-slim-security-01\n\t10.239.140.65:5000/python:3.9.1-slim-security-01\n\t\n\t$ docker pull 10.239.140.65:5000/python:3.9.1-slim@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33\n\tsha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33: Pulling from python\n\tDigest: sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33\n\tStatus: Image is up to date for 10.239.140.65:5000/python@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33\n\t10.239.140.65:5000/python:3.9.1-slim@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33\n\t\n\t$ docker images | grep python \n\t看不到上面的10.239.140.65:5000/python:3.9.1-slim@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33\n\t\n\t但是可以通过tag命令给此image再添加标签如:\n\t$ docker tag 10.239.140.65:5000/python:3.9.1-slim@sha256:b2013807b8af03d66f60a979f20d4e93e4e4a111df1287d9632c8cfd41ecfa33 10.239.140.65:5000/python:test\n\t$ docker images | grep python\n\t10.239.140.65:5000/python                               test                           edd87973afe0        2 weeks ago         114MB\n</code></pre><h2 id=\"laboratory机器\"><a class=\"anchor\" href=\"#laboratory机器\">#</a> laboratory 机器</h2><h3 id=\"配置环境变量\"><a class=\"anchor\" href=\"#配置环境变量\">#</a> 配置环境变量</h3><pre><code>cat /etc/hosts\n10.239.140.65 master notaryserver\n10.239.131.157 laboratory\n</code></pre><p>设置 DCT 可信任变量</p><pre><code>export DOCKER_CONTENT_TRUST_SERVER=https://10.239.140.65:4443\nexport DOCKER_CONTENT_TRUST=1\n</code></pre><h3 id=\"拷贝master-notary证书\"><a class=\"anchor\" href=\"#拷贝master-notary证书\">#</a> 拷贝 master notary 证书</h3><p>scp master 机器的 notary-server 证书和 root-ca 证书 到 laboratory 机器.</p><pre><code>mkdir -p ~/.docker/tls/10.239.140.65:4443/\nscp root@10.239.140.65:/root/.docker/tls/127.0.0.1:4443/ca.crt ~/.docker/tls/10.239.140.65:4443/ca.crt\nmkdir -p ~/.notary\nscp root@10.239.140.65:/root/.notary/root-ca.crt ~/.notary/root-ca.crt\n</code></pre><p>编写 notary config 文件</p><pre><code>cat ~/.notary/config.json\n{\n        &quot;trust_dir&quot; : &quot;~/.docker/trust&quot;,\n        &quot;remote_server&quot;: {\n                &quot;url&quot;: &quot;https://10.239.140.65:4443&quot;,\n                &quot;root_ca&quot;: &quot;root-ca.crt&quot;\n        }\n}\n</code></pre><h3 id=\"生成key和证书-2\"><a class=\"anchor\" href=\"#生成key和证书-2\">#</a> 生成 key 和证书</h3><p>在 laboratory 机器上生成 signer <strong><code>bob</code> </strong>的 key 和 证书，添加 signer <strong><code>bob</code> </strong>的 key 到指定 registry 仓库，之后 sign image</p><pre><code>mkdir certs\ncd certs\nopenssl genrsa -out key.pem 3072\nopenssl req -new -sha512 -key key.pem -out key.csr\n\t填写信息直接回车, 到要填写CN处输入*然后回车\n\tCommon Name (eg, your name or your server's hostname) []:* or you-node-hostname 如 'laboratory'\nopenssl x509 -req -sha512 -days 365 -in key.csr -signkey key.pem -out key.crt\nchmod 600 key.pem\nexport DOCKER_CONTENT_TRUST_REPOSITORY_PASSPHRASE=&quot;12345678&quot; //有这一步后下面的命令就不需要再输入密码\n\ndocker trust key load key.pem --name bob\n\t输入passphrase: 12345678\n之后会在 **`~/.docker/trust/private/`** 生成相应的key\n</code></pre><h3 id=\"拷贝master机器上的repository-key到本机器\"><a class=\"anchor\" href=\"#拷贝master机器上的repository-key到本机器\">#</a> 拷贝 master 机器上的 Repository Key 到本机器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 到 master 机器上查看 Repository Key</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker trust inspect --pretty <span class=\"token number\">10.239</span>.140.65:5000/python</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  Signatures <span class=\"token keyword\">for</span> inspire-dev-nodea:5000/test/hello-world</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  SIGNED TAG          DIGEST                                                             SIGNERS</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  trust-1             1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792   yazhan</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  List of signers and their keys <span class=\"token keyword\">for</span> inspire-dev-nodea:5000/test/hello-world</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  SIGNER              KEYS</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  bob                 e2023d903e94</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  yazhan              57e9a0ca4094</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  Administrative keys <span class=\"token keyword\">for</span> inspire-dev-nodea:5000/test/hello-world</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    Repository Key:       8200a5fab04b51f18dec2dc4fc7bd7860aae0d83f717b524aee76b30bc19c093</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    Root Key:     574e81ebb53ec457ffdfe34afd3013e7dcee00dc80fe7a7898853c7f337786a2</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># 从 master 机器上拷贝 Repository Key 到 laboratory 机器</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token function\">scp</span> -r ~/.docker/trust/private/8200a5fab04b51f18dec2dc4fc7bd7860aae0d83f717b524aee76b30bc19c093.key  root@10.239.140.157:~/.docker/trust/private/</pre></td></tr></table></figure><h3 id=\"签名仓库和镜像并上传\"><a class=\"anchor\" href=\"#签名仓库和镜像并上传\">#</a> 签名仓库和镜像并上传</h3><pre><code>// 添加signer key到10.239.140.65:5000/python-test10仓库\n$ docker trust signer add --key certs/key.crt bob 10.239.140.65:5000/python-test10\n\n// 查看delegation key\n$ notary delegation list 10.239.140.65:5000/python-test10\n  ROLE                PATHS             KEY IDS                                                             THRESHOLD\n  ----                -----             -------                                                             ---------\n  targets/releases    &quot;&quot; &lt;all paths&gt;    7e1f01ed1d6d0698d5cd5856ec9be27debed33645d2450f20495b70a8a5db83c    1\n  targets/bob         &quot;&quot; &lt;all paths&gt;    7e1f01ed1d6d0698d5cd5856ec9be27debed33645d2450f20495b70a8a5db83c    1\n\n// sign image并上传到10.239.140.65:5000/python-test10仓库\n$ docker trust sign 10.239.140.65:5000/python-test10:3.9.1-slim-security-01\n\n// 再次sign同一个image会提示image的sign已存在\n$ docker trust sign 10.239.140.65:5000/python-test10:3.9.1-slim-security-01\n  Signing and pushing trust metadata for 10.239.140.65:5000/python-test10:3.9.1-slim-security-01\n  Existing signatures for tag 3.9.1-slim-security-01 digest b9c45d9576c0e70dfe19ec5f481ec4b59daf970a5036463fcb523cf8ebf7fc5c from:\n  bob\n  Successfully signed 10.239.140.65:5000/python-test10:3.9.1-slim-security-01\n</code></pre><h3 id=\"查看registry私有仓库\"><a class=\"anchor\" href=\"#查看registry私有仓库\">#</a> 查看 registry 私有仓库</h3><pre><code>//查看所有仓库\n$ curl 10.239.140.65:5000/v2/_catalog\n\n//查看指定仓库所有tag\n$ curl 10.239.140.65:5000/v2/python-test10/tags/list\n{&quot;name&quot;:&quot;python-test10&quot;,&quot;tags&quot;:[&quot;3.9.1-slim-security-01&quot;, &quot;3.9.1-slim-security-02&quot;]}\n</code></pre><h2 id=\"notary-client\"><a class=\"anchor\" href=\"#notary-client\">#</a> notary client</h2><p><strong>master 和 laboratory 都需要下载 notary client, notary client 是一个二进制可执行文件.</strong></p><p>If you would like to use your own Notary server, it is important to use the same or a newer Notary version, as the client for feature compatibility (ex: client version 0.2, server/signer version &gt;= 0.2). (reference: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vbm90YXJ5L2dldHRpbmdfc3RhcnRlZC8jaW5zcGVjdC1hLWRvY2tlci1odWItcmVwb3NpdG9yeQ==\">https://docs.docker.com/notary/getting_started/#inspect-a-docker-hub-repository</span>)<br>查看 nodary server signer 版本</p><pre><code>docker images | grep notary\n\nwget https://github.com/theupdateframework/notary/releases/download/v0.6.1/notary-Linux-amd64\nchmod +x notary-Linux-amd64\ncp notary-Linux-amd64 /usr/local/bin/notary\n</code></pre><p>查看 notary client 版本</p><pre><code>$ notary version\nnotary\n Version:    0.6.1\n Git commit: d6e1431f\n</code></pre><p>The Notary client used in isolation does not know where the trust repositories are located. So, you must provide the <strong><code>-s</code> </strong>(or long form <strong><code>--server</code> </strong>) flag to tell the client which repository server it should communicate with.</p><p>Additionally, Notary stores your own signing keys, and a cache of previously downloaded trust metadata in a directory, provided with the <strong><code>-d</code> </strong>flag. When interacting with Docker Hub repositories, you must instruct the client to use the associated trust directory, which by default is found at <strong><code>.docker/trust</code> </strong>within the calling user’s home directory (failing to use this directory may result in errors when publishing updates to your trust data):</p><pre><code>$ notary -s https://notary.docker.io -d ~/.docker/trust list docker.io/library/alpine\n   NAME                                 DIGEST                                SIZE (BYTES)    ROLE\n------------------------------------------------------------------------------------------------------\n  2.6      e9cec9aec697d8b9d450edd32860ecd363f2f3174c8338beb5f809422d182c63   1374           targets\n  2.7      9f08005dff552038f0ad2f46b8e65ff3d25641747d3912e3ea8da6785046561a   1374           targets\n  3.1      e876b57b2444813cd474523b9c74aacacc238230b288a22bccece9caf2862197   1374           targets\n  3.2      4a8c62881c6237b4c1434125661cddf09434d37c6ef26bf26bfaef0b8c5e2f05   1374           targets\n  3.3      2d4f890b7eddb390285e3afea9be98a078c2acd2fb311da8c9048e3d1e4864d3   1374           targets\n  edge     878c1b1d668830f01c2b1622ebf1656e32ce830850775d26a387b2f11f541239   1374           targets\n  latest   24a36bbc059b1345b7e8be0df20f1b23caa3602e85d42fff7ecd9d0bd255de56   1377           targets\n</code></pre><h2 id=\"rotate-keys\"><a class=\"anchor\" href=\"#rotate-keys\">#</a> Rotate keys</h2><p>Reference: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZXVwZGF0ZWZyYW1ld29yay9ub3RhcnkvYmxvYi9tYXN0ZXIvZG9jcy9hZHZhbmNlZF91c2FnZS5tZCNtYW5hZ2Uta2V5cw==\">https://github.com/theupdateframework/notary/blob/master/docs/advanced_usage.md#manage-keys</span></p><h2 id=\"清理notary\"><a class=\"anchor\" href=\"#清理notary\">#</a> 清理 notary</h2><pre><code>cd notary\nrm -rf ~/.notary\nrm -rf ~/.docker\ndocker-compose down\ndocker rmi notary_server:latest\ndocker rmi notary_signer:latest\nunset DOCKER_CONTENT_TRUST_REPOSITORY_PASSPHRASE\nunset DOCKER_CONTENT_TRUST_SERVER\nunset DOCKER_CONTENT_TRUST\n</code></pre><h3 id=\"清理notary-key\"><a class=\"anchor\" href=\"#清理notary-key\">#</a> 清理 notary key</h3><p>Remove the key from the local Docker Trust store</p><pre><code>// 查看有哪些key\nnotary key list\n\n// 清理key\nnotary key remove 1091060d7bfd938dfa5be703fa057974f9322a4faef6f580334f3d6df44c02d1\n</code></pre><p>以下命令可以直接从本地删除 key, 因此避免误删最好备份.</p><pre><code>rm -rf ~/.notary/trust/private/&lt;key-number&gt;\n</code></pre><!-- rebuild by hrmmi -->",
            "tags": [
                "technologies",
                "docker",
                "docker"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/05/31/technologies/docker/docker_02_private_hub/",
            "url": "https://kung-fu-master.github.io/2021/05/31/technologies/docker/docker_02_private_hub/",
            "title": "docker 02 private hub & journal",
            "date_published": "2021-05-31T03:28:46.161Z",
            "content_html": "<!-- build time:Thu Jun 03 2021 22:22:32 GMT+0800 (中国标准时间) --><h2 id=\"docker-引擎\"><a class=\"anchor\" href=\"#docker-引擎\">#</a> Docker 引擎</h2><p>目前 Docker 支持 Docker 引 擎、 Docker Hub 、 Docker Cloud 等多种服务 。</p><ul><li>Docker 引擎：包括支持在桌面系统或云平台安装 Docker，以及为企业提供简单安全弹性的容器集群编排和管理；</li><li>DockerHub ：官方提供的云托管服务，可以提供公有或私有的镜像仓库；</li><li>DockerCloud ：官方提供的容器云服务，可以完成容器的部署与管理，可以完整地支持容器化项目，还有 CI 、 CD 功能<br>用户可以通过如下命令检查自己的内核版本详细信息 ：</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">uname</span> -a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">cat</span> /proc/version</pre></td></tr></table></figure><h2 id=\"查看日志\"><a class=\"anchor\" href=\"#查看日志\">#</a> 查看日志</h2><p>如果服务工作不正常，可以通过查看 Docker 服务的日志信息来确定问题，例如<br>在 RedHat 系统上的系统运行日志文件为</p><pre><code>/var/log/messages\n</code></pre><p>在 Ubuntu 或 CentOS 系统上可以执行命令</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>journalctl -u docker.service </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>journalctl -xe</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>journalctl -f -n <span class=\"token number\">10</span> -u docker.service //滚屏输出10条服务docker.service的log信息</pre></td></tr></table></figure><h2 id=\"访问docker-仓库-repository\"><a class=\"anchor\" href=\"#访问docker-仓库-repository\">#</a> 访问 Docker 仓库 Repository</h2><p>分公共仓库和私有仓库</p><h3 id=\"公共仓库\"><a class=\"anchor\" href=\"#公共仓库\">#</a> 公共仓库</h3><p>Docker Hub 是 Docker 官方提供的最大的公共镜像仓库，docker search 命令来查找官方仓库中的镜像</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker search centos</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker pull centos</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>docker images 命令来查看下载到本地的镜像</pre></td></tr></table></figure><p>国内不少云服务商都提供了 Docker 镜像市场包括腾讯云 、 网易云、阿里云等<br>下载第三方服务商如 腾讯云 提供的镜像格式为 <span class=\"exturl\" data-url=\"aHR0cDovL2luZGV4LnRlbnhjbG91ZC5jb20v\">index.tenxcloud.com/</span>&lt;namespace&gt;/&lt;repository&gt;:&lt;tag&gt;</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker pull index.tenxcloud.com/docker_library/node:latest</pre></td></tr></table></figure><p>下载后，可以更新镜像的标签，与官方标签保持一致，方便使用：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker tag index.tenxcloud.com/docker_library/node:latest node:latest</pre></td></tr></table></figure><h2 id=\"搭建本地私有仓库\"><a class=\"anchor\" href=\"#搭建本地私有仓库\">#</a> 搭建本地私有仓库</h2><h3 id=\"使用-registry-镜像创建私有仓库\"><a class=\"anchor\" href=\"#使用-registry-镜像创建私有仓库\">#</a> 使用 registry 镜像创建私有仓库</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker search registry --limit<span class=\"token operator\">=</span><span class=\"token number\">5</span>\t// Hub official website 查找registry镜像</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker run -d -p <span class=\"token number\">5000</span>:5000 registry:2</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  Unable to <span class=\"token function\">find</span> image <span class=\"token string\">'registry:2'</span> locally</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token number\">2</span>: Pulling from library/registry</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  486039affc0a: Downloading <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span>                                        <span class=\"token punctuation\">]</span>  <span class=\"token number\">475</span>.1kB/2.207MB</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  ba51a3b098e6: Download complete</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  8bb4c43d6c8e: Downloading <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">></span>                                                <span class=\"token punctuation\">]</span>  <span class=\"token number\">363</span>.8kB/6.824MB</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  6f5f453e5f2d: Download complete</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  42bc10b72f42: Download complete</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>docker run -d -p <span class=\"token number\">5000</span>:5000 registry:2</pre></td></tr></table></figure><p>默认情况下，仓库会被创建在容器的 /var/lib/registry 目录下，容器退出后，存储的数据也会丢失.<br>因此实际开发环境中私有仓库 registry 存储路径必须绑定到主机目录.<br>可以通过 －v 参数来将镜像文件存放在本地的指定路径 。 例如下面的例子将上传的镜像放到 /opt/data/registry 目录：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run -d -p <span class=\"token number\">5000</span>:5000 -v /opt/data/registry:/var/lib/registry --restart<span class=\"token operator\">=</span>always --name registry registry:2</pre></td></tr></table></figure><p>如果创建容器时没有添加自动重启参数 --restart=always ，导致的后果是：当 Docker 服务重启时，容器未能自动启动。<br>第一种添加修改该参数 (实测有效):</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker container update --restart<span class=\"token operator\">=</span>always 容器名字或容器ID</pre></td></tr></table></figure><p>第二种修改该参数；</p><pre><code>首先停止容器，不然无法修改配置文件(实测中不用停止容器也修改了, 但是docker服务重启后容器没有重启)\n配置文件路径为：/var/lib/docker/containers/容器ID(容器ID通过 $ docker ps | grep 容器Name 进行查看)\n在该目录下找到一个文件 hostconfig.json ，找到该文件中关键字 RestartPolicy\n修改前配置：&quot;RestartPolicy&quot;:{&quot;Name&quot;:&quot;no&quot;,&quot;MaximumRetryCount&quot;:0}\n修改后配置：&quot;RestartPolicy&quot;:{&quot;Name&quot;:&quot;always&quot;,&quot;MaximumRetryCount&quot;:0}\n最后启动容器。\n\n另外也可以查看容器绑定存储文件路径\n&quot;Binds&quot;:[&quot;/opt/data/registry1:/var/lib/registry&quot;]\n没有绑定到主机目录的容器此hostconfig.json文件内容为 &quot;Binds&quot;:null\n</code></pre><p>此时， 在本地将启动一个私有仓库服务，监听端口为 5000</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS              PORTS                    NAMES</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  e0bb400f0ba6        registry:2             <span class=\"token string\">\"/entrypoint.sh /etc…\"</span>   <span class=\"token number\">11</span> hours ago        Up <span class=\"token number\">11</span> hours         <span class=\"token number\">0.0</span>.0.0:5000-<span class=\"token operator\">></span><span class=\"token number\">5000</span>/tcp   registry</pre></td></tr></table></figure><h3 id=\"从私有仓库上传下载镜像-查看\"><a class=\"anchor\" href=\"#从私有仓库上传下载镜像-查看\">#</a> 从私有仓库上传下载镜像 &amp; 查看</h3><blockquote><p>应为 docker 客户端发送的是 https 请求，从私有仓库下载镜像时候需要用 http 请求协议，因此在其它机器上要上传或下载 10.239.140.186:5000 (me office) 机器上的 image 时候会出问题<br>需要在其它要下载 10.239.140.186 机器上 image 的机器比如 10.239.85.243 (solu02) 上添加并修改如下文件：<br>master 和 worker 节点都需要添加启动仓库 registry:2 所在的机器 IP 和开放的端口，内容和步骤如下:</p></blockquote><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /etc/docker/daemon.json\t// 没有的话需要新建这个json文件, 然后添加如下内容, 表示信任10.239.140.186机器5000端口提供的服务</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token string\">\"insecure-registries\"</span>:<span class=\"token punctuation\">[</span><span class=\"token string\">\"10.239.140.186:5000\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token string\">\"registry-mirrors\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://registry.docker-cn.com\"</span><span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token string\">\"live-restore\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>systemctl daemon-reload\t\t\t// 重新加载daemon</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>systemctl restart docker\t\t\t// 重启docker</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> docker.service\t// 开机默认启动</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># 如果是在运行 registry 容器的机器上重启 docker service 之后一定要查看 registry 容器是否重新启动.</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>docker run -d -p <span class=\"token number\">5000</span>:5000 registry:2</pre></td></tr></table></figure><blockquote><p>在 solu02 机器上从 hub 公共 image 库下载个 image 如 ubuntu:latest</p></blockquote><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dcoker pull ubuntu\t\t\t\t// 默认下载latest</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker images</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  ➜  ~ docker images</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  ubuntu              latest              1d622ef86b13        <span class=\"token number\">5</span> days ago          <span class=\"token number\">73</span>.9MB</pre></td></tr></table></figure><h3 id=\"上传image\"><a class=\"anchor\" href=\"#上传image\">#</a> 上传 image</h3><p>给要上传的 image 重新打个标签</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker tag ubuntu:latest <span class=\"token number\">10.239</span>.140.186:5000/solu02_utunbu:latest</pre></td></tr></table></figure><p>使用 docker push 上传标记的镜像：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker push <span class=\"token number\">10.239</span>.140.186:5000/solu02_utunbu:latest  // 要和 <span class=\"token string\">\"/etc/docker/daemon.json中配置的insecure-registries的值一致\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  或者 $ docker push master-node:5000/solu02_utunbu:latest</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  ➜  ~ docker push <span class=\"token number\">10.239</span>.140.186:5000/solu02_utunbu:latest</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  The push refers to repository <span class=\"token punctuation\">[</span><span class=\"token number\">10.239</span>.140.186:5000/solu02_utunbu<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  8891751e0a17: Pushed</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  2a19bd70fcd4: Pushed</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  9e53fd489559: Pushed</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  7789f1a3d4e9: Pushed</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  latest: digest: sha256:5747316366b8cc9e3021cd7286f42b2d6d81e3d743e2ab571f55bcd5df788cc8 size: <span class=\"token number\">1152</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  ➜  ~</pre></td></tr></table></figure><h3 id=\"查看image\"><a class=\"anchor\" href=\"#查看image\">#</a> 查看 image</h3><p>在仓库主机 10.239.140.186 机器上使用 curl 查看仓库 10.239.140.186:5000 (me office) 中的镜像：<br>是用 10.239.140.186 访问，还是用在 /etc/hosts 中将主机 IP:10.239.140.186 映射为 master-node 访问，<br>主要是跟 /etc/docker/daemon-reload 设置的 insecure-registries 值一致.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> http://10.239.140.186:5000/v2/_catalog</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  或 $ <span class=\"token function\">curl</span> http://master-node:5000/v2/_catalog</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"repositories\"</span>:<span class=\"token punctuation\">[</span><span class=\"token string\">\"solu02_utunbu\"</span>,<span class=\"token string\">\"test_ubuntu\"</span>,<span class=\"token string\">\"test_ubuntu1\"</span>,<span class=\"token string\">\"docker.io/nginx\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>查看镜像和相应 tag:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> -XGET http://master-node:5000/v2/<span class=\"token punctuation\">&#123;</span>image_name<span class=\"token punctuation\">&#125;</span>/tags/list</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token number\">10.239</span>.140.186:5000/v2/docker.io/nginx/tags/list</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"docker.io/nginx\"</span>,<span class=\"token string\">\"tags\"</span>:<span class=\"token punctuation\">[</span><span class=\"token string\">\"alpine\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>浏览器输入如下地址查看<br><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo1MDAwL3YyL19jYXRhbG9n\">http://localhost:5000/v2/_catalog</span> // 查看所有 images<br><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo1MDAwL3YyL2RvY2tlci5pby9uZ2lueC90YWdzL2xpc3Q=\">http://localhost:5000/v2/docker.io/nginx/tags/list</span>\t// 查看所有 images 的 tags</p><h3 id=\"下载image\"><a class=\"anchor\" href=\"#下载image\">#</a> 下载 image</h3><p>在 solu02 (10.239.85.243) 机器上下载 10.239.140.186 私有仓库里的 image:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker pull <span class=\"token number\">10.239</span>.140.186:5000/test_ubuntu</pre></td></tr></table></figure><p>拉去指定 tag 的 image</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker pull <span class=\"token number\">10.239</span>.140.186:5000/docker.io/nginx:alpine</pre></td></tr></table></figure><h3 id=\"dns-解析ip\"><a class=\"anchor\" href=\"#dns-解析ip\">#</a> DNS 解析 IP</h3><p>用 master-node 等代替 registry 运行所在的主机的 IP</p><figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>vim /etc/hosts</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  10.239.140.186 master-node</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  10.239.141.101 node-1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>vim /etc/docker/daemon.json</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  &#123;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  \"insecure-registries\": [\"master-node:5000\"]</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  \"registry-mirrors\": [\"https://registry.docker-cn.com\"],</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  \"live-restore\": true</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  &#125;</pre></td></tr></table></figure><h2 id=\"配置docker的http_proxy-https_proxy-no_proxy\"><a class=\"anchor\" href=\"#配置docker的http_proxy-https_proxy-no_proxy\">#</a> 配置 docker 的 HTTP_PROXY, HTTPS_PROXY, NO_PROXY</h2><p>第一种：放到一个文件里</p><figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>vim /etc/systemd/system/docker.service.d/http-proxy.conf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  [Service]</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  Environment=\"HTTP_PROXY=http://proxy:913\" \"NO_PROXY=localhost,127.0.0.1,master-node\"</pre></td></tr></table></figure><p>第二种：将 docker 的 HTTP_PROXY, HTTPS_PROXY, NO_PROXY 放到三个文件<br>新建三个文件，并添加类似的如下信息</p><figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>touch /etc/systemd/system/docker.service.d/no-proxy.conf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  [Service]</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  Environment=\"NO_PROXY=10.67.108.211,10.67.109.142,10.67.109.147,10.67.109.144,hci-node01,hci-node02,hci-node03,hci-node04\"</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>touch /etc/systemd/system/docker.service.d/http-proxy.conf</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  [Service]</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  Environment=\"HTTP_PROXY=http://proxy:913/\"</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>touch /etc/systemd/system/docker.service.d/https-proxy.conf</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  [Service]</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  Environment=\"HTTPS_PROXY=http://proxy:913/\"</pre></td></tr></table></figure><p>修改完上面信息之后重启 docker</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl daemon-reload</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl restart docker</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>docker tag docker.io/nginx:alpine master-node:5000/docker.io/nginx:alpine</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>docker push master-node:5000/docker.io/nginx:alpine</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token number\">10.239</span>.140.186:5000/v2/_catalog</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 或者</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">curl</span> master-node:5000/v2/_catalog</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 遇到访问不了如下面显示信息时候，原因是通过 curl 方式访问 master-node 主机时仍通过 linux 设置的公司的 proxy 访问</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">&lt;</span>HTML<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">&lt;</span>HEAD<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>TITLE<span class=\"token operator\">></span>Redirection<span class=\"token operator\">&lt;</span>/TITLE<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/HEAD<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token operator\">&lt;</span>BODY<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>H<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>Redirect<span class=\"token operator\">&lt;</span>/H<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span><span class=\"token operator\">&lt;</span>/BODY<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token operator\">&lt;</span>/HTML<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># 设置 linux 的 NO_PROXY 环境变量，使 curl 访问 master-node 时不通过公司的 proxy</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">NO_PROXY</span><span class=\"token operator\">=</span>master-node</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token function\">curl</span> master-node:5000/v2/_catalog</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"repositories\"</span>:<span class=\"token punctuation\">[</span><span class=\"token string\">\"docker.io/nginx\"</span>,<span class=\"token string\">\"hello-world\"</span>,<span class=\"token string\">\"hello-world1\"</span>,<span class=\"token string\">\"hello-world11\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"遇到的问题\"><a class=\"anchor\" href=\"#遇到的问题\">#</a> 遇到的问题</h2><h3 id=\"503错误\"><a class=\"anchor\" href=\"#503错误\">#</a> 503 错误</h3><pre><code>$ docker pull hci-node01:5000/greenplum-1.13.0/greenplum-operator:v1.13.0\n  Error response from daemon: received unexpected HTTP status: 503 Service Unavailable\n\n$ docker pull 10.67.108.211:5000/storage/kes:0.1\n  Error response from daemon: Get https://10.67.108.211:5000/v2/: net/http: TLS handshake timeout\n</code></pre><p>解决方法，在 docker 的配置文件中加上 NO_PROXY (确保添加的 NO_PROXY 中的机器域名正确，否则也会导致上面问题), 如下：</p><pre><code>vim /etc/systemd/system/docker.service.d/proxy.conf\n[Service]\nEnvironment=&quot;HTTP_PROXY=http://child-prc.intel.com:913&quot;\nEnvironment=&quot;HTTPS_PROXY=http://child-prc.intel.com:913&quot;\nEnvironment=&quot;NO_PROXY=127.0.0.1,k8s-vip,hci-node01,hci-node02,hci-node03,hci-node04&quot;\n</code></pre><!-- rebuild by hrmmi -->",
            "tags": [
                "technologies",
                "docker",
                "docker"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/05/31/technologies/docker/docker_01_installation/",
            "url": "https://kung-fu-master.github.io/2021/05/31/technologies/docker/docker_01_installation/",
            "title": "docker 01 installation and control commands",
            "date_published": "2021-05-31T03:28:46.161Z",
            "content_html": "<!-- build time:Mon May 31 2021 11:38:18 GMT+0800 (中国标准时间) --><h2 id=\"docker-引擎\"><a class=\"anchor\" href=\"#docker-引擎\">#</a> Docker 引擎</h2><p>目前 Docker 支持 Docker 引 擎、 Docker Hub 、 Docker Cloud 等多种服务 。</p><ul><li>Docker 引擎：包括支持在桌面系统或云平台安装 Docker，以及为企业提供简单安全弹性的容器集群编排和管理；</li><li>DockerHub ：官方提供的云托管服务，可以提供公有或私有的镜像仓库；</li><li>DockerCloud ：官方提供的容器云服务，可以完成容器的部署与管理，可以完整地支持容器化项目，还有 CI 、 CD 功能</li></ul><p><a id=\"more\"></a><br>用户可以通过如下命令检查自己的内核版本详细信息 ：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">uname</span> -a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> $ <span class=\"token function\">cat</span> /proc/version</pre></td></tr></table></figure><h2 id=\"ubuntu1804-docker环境安装\"><a class=\"anchor\" href=\"#ubuntu1804-docker环境安装\">#</a> Ubuntu18.04 docker 环境安装：</h2><p>官网: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS9nZXQtc3RhcnRlZA==\">https://www.docker.com/get-started</span><br>查找 image: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9zZWFyY2g/dHlwZT1pbWFnZQ==\">https://hub.docker.com/search?type=image</span></p><h2 id=\"简介\"><a class=\"anchor\" href=\"#简介\">#</a> 简介</h2><blockquote><p>Docker 是基于 Go 语言实现的开源容器项目 。 它诞生于 2013 年年初，最初发起者是 dotCloud 公司，dotCloud 公司也随之快速发展壮大，在 2013 年年底直接改名为 Docker Inc ，并专注于 Docker 相关技术和产品的开发，目前已经成为全球最大的 Docker 容器服务提供商 。 官方网站为 <span class=\"exturl\" data-url=\"aHR0cDovL2RvY2tlci5jb20=\">docker.com</span><br>在 Linux 基金会最近一次关于 “最受欢 迎的 云 计算开源项目” 的调查中， Docker 仅次于 2010 年发起的 OpenStack 项目，并仍处于上升趋势 。2014 年， Docker 镜像下载数达到了一百万次， 2015 年直接突破十亿次， 2017 年更是突破了惊人的百亿次<br>Docker 的构想是要实现 “Build , Ship and Run Any App, Anywhere”，即通过对应用的封装（ Packaging）、分发（ Distribution ）、部署（ Deployment）、运行（ Runtime ）生命周期进行管理，达到应用组件级别的 “一次封装 ，到处运行”<br>与大部分新兴技术的诞生一样， Docker 也并非 “从石头缝里蹦出来的”，而是站在前人的肩膀上。 其中最重要的就是 Linux 容器（ Linux Containers, LXC ）技术.<br>每个容器内运行着一个应用，不同的容器相互隔离，容器之间也可以通过网络互相通信 。 容器的创建和停止十分快速，几乎跟创建和终止原生应用－致.<br>容器自身对系统资源的额外需求也十分有限，远远低于传统虚拟机。 很多时候，甚至直接把容器当作应用本身也没有任何问题.</p></blockquote><h2 id=\"为什么用docker\"><a class=\"anchor\" href=\"#为什么用docker\">#</a> 为什么用 Docker</h2><blockquote><p>在云时代，开发者创建的应用必须要能很方便地在网络上传播，也就是说应用必须脱离底层物理硬件的限制；同时必须是 “任何时间任何地点” 可获取的 。 因此，开发者们需要一种新型的创建分布式应用程序的方式，快速分发和部署，而这正是 Docker 所能够提供的最大优势<br>Docker 提供了一种更为聪明的方式，通过容器来打包应用、解藕应用和运行平台。这意味着迁移的时候，只需要在新的服务器上启动需要的容器就可以了，无论新旧服务器是否是同一类型的平台 。 这无疑将帮助我们节约大量的宝贵时间，并降低部署过程出现问题的风险<br>传统虚拟机方式运行 N 个不同的应用就要启用 N 个虚拟机（每个虚拟机需要单独分配独占的内存、磁盘等资源），而 Docker 只需要启动 N 个隔离得 “很薄的” 容器，并将应用放进容器内即可 。 应用获得的是接近原生的运行性能<br>传统方式是在硬件层面实现虚拟化，需要有额外的虚拟机管理应用和虚拟机操作系统层。 Docker 容器是在操作系统层面上实现虚拟化，直接复用本地主机的操作系统，因此更加轻量级</p></blockquote><h2 id=\"docker-ce与-docker-ee区别\"><a class=\"anchor\" href=\"#docker-ce与-docker-ee区别\">#</a> docker ce 与 docker ee 区别</h2><ul><li><p>Docker Engine 改为 Docker CE (社区版), 它包含了 CLI 客户端、后台进程 / 服务以及 API。用户像以前以同样的方式获取。<br>docker-ce 是 docker 公司维护的开源项目，是一个基于 moby 项目的免费的容器产品；</p></li><li><p>Docker Data Center 改为 Docker EE（企业版）<br>docker-ee 是 docker 公司维护的闭源产品，是 docker 公司的商业产品；<br>这些 ce 和 ee 版并不影响 Docker Compose 以及 Docker Machine<br>docker-ce project 是 docker 公司维护，docker-ee 是闭源的；</p></li></ul><p>要使用免费的 docker，从网页 docker-ce 上获取；</p><p>要使用收费的 docker，从网页 docker-ee 上获取</p><h2 id=\"docker-ucp-介绍\"><a class=\"anchor\" href=\"#docker-ucp-介绍\">#</a> docker UCP 介绍</h2><p>：：： info<br>Docker Universal Control Plane（UCP）是 Docker 公司在 2015 年底巴塞罗那的开发者大会上发布的，这是一个跟单信用证，是一个新的 Docker 支付服务的组合的一部分，旨在帮助运维团队轻松地设置一个集群，使开发人员可以快速部署 Dockerized 应用。他们构建 Docker DataCenter 的其中重要的组成部分。<br>UCP 集群包含两种节点：<br>Controller: 管理集群，并持久化集群配置<br>Node：运行容器<br>：：：</p><h2 id=\"安装curl\"><a class=\"anchor\" href=\"#安装curl\">#</a> 安装 curl:</h2><div class=\"tab\" data-id=\"id0\" data-title=\"第一种方法:\"><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>https://curl.haxx.se/download.html</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>curl-7.69.1.tar.gz</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>./configure --prefix<span class=\"token operator\">=</span>/usr/local/curl</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">make</span> -j12</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">make</span> <span class=\"token function\">install</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">ln</span> -s /usr/local/curl/bin/curl /usr/bin</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">vim</span> ~/.bashrc 添加 <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">LD_LIBRARY_PATH</span><span class=\"token operator\">=</span><span class=\"token variable\">$LD_LIBRARY_PATH</span>:/usr/local/curl/lib</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">source</span> ~/.bashrc</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">curl</span> --version \t\t// 查看curl版本和支持的协议如http, https</pre></td></tr></table></figure></div><div class=\"tab\" data-id=\"id0\" data-title=\"第二种方法(推荐，方便快捷):\"><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt-get</span> update</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">apt-get</span> upgrade</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token function\">curl</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">curl</span> --version</pre></td></tr></table></figure></div><p>提前设置好系统的 proxy 如:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">http_proxy</span><span class=\"token operator\">=</span>child-prc.intel.com:913</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">https_proxy</span><span class=\"token operator\">=</span>child-prc.intel.com:913 // https的proxy与上面的http的要一样</pre></td></tr></table></figure><h2 id=\"安装docker\"><a class=\"anchor\" href=\"#安装docker\">#</a> 安装 docker</h2><div class=\"tab\" data-id=\"id1\" data-title=\"Ubuntu安装docker\"><h3 id=\"卸载旧版本\"><a class=\"anchor\" href=\"#卸载旧版本\">#</a> 卸载旧版本</h3><p>Docker 的旧版本被称为 docker，<span class=\"exturl\" data-url=\"aHR0cDovL2RvY2tlci5pbw==\">docker.io</span> 或 docker-engine 。如果已安装，请卸载它们：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> remove docker docker-engine docker.io containerd runc</pre></td></tr></table></figure><p>当前称为 Docker Engine-Community 软件包 docker-ce.</p><h3 id=\"设置仓库\"><a class=\"anchor\" href=\"#设置仓库\">#</a> 设置仓库</h3><p>在新主机上首次安装 Docker Engine-Community 之前，需要设置 Docker 仓库。之后，您可以从仓库安装和更新 Docker.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    apt-transport-https <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    ca-certificates <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token function\">curl</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    gnupg-agent <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    software-properties-common</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 添加 Docker 的官方 GPG 密钥：</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">curl</span> -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> apt-key <span class=\"token function\">add</span> -</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88 通过搜索指纹的后 8 个字符，验证您现在是否拥有带有指纹的密钥。</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">sudo</span> apt-key fingerprint 0EBFCD88</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  pub   rsa4096 <span class=\"token number\">2017</span>-02-22 <span class=\"token punctuation\">[</span>SCEA<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        9DC8 <span class=\"token number\">5822</span> 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  uid           <span class=\"token punctuation\">[</span> unknown<span class=\"token punctuation\">]</span> Docker Release <span class=\"token punctuation\">(</span>CE deb<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span>docker@docker.com<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  sub   rsa4096 <span class=\"token number\">2017</span>-02-22 <span class=\"token punctuation\">[</span>S<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># 使用以下指令设置稳定版仓库</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token function\">sudo</span> add-apt-repository <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token string\">\"deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/ \\</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token variable\"><span class=\"token variable\">$(</span>lsb_release -cs<span class=\"token variable\">)</span></span> \\</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  stable\"</pre></td></tr></table></figure><h3 id=\"安装指定版本docker\"><a class=\"anchor\" href=\"#安装指定版本docker\">#</a> 安装指定版本 docker</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 在仓库中列出可用版本</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">apt-cache</span> madison docker-ce</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">apt-cache</span> madison docker-ce-cli</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">apt-cache</span> madison containerd.io</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 安装特定版本</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> docker-ce<span class=\"token operator\">=</span><span class=\"token number\">5</span>:19.03.8~3-0~ubuntu-bionic docker-ce-cli<span class=\"token operator\">=</span><span class=\"token number\">5</span>:19.03.8~3-0~ubuntu-bionic containerd.io</pre></td></tr></table></figure><h3 id=\"配置docker-daemon\"><a class=\"anchor\" href=\"#配置docker-daemon\">#</a> 配置 docker daemon</h3><p>配置 docker daemon, 没有就新建.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 配置 docker daemon</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">vim</span>  /etc/docker/daemon.json</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"insecure-registries\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;your-private-repository-node-IP>:5000\"</span><span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token string\">\"registry-mirrors\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://uxk0ognt.mirror.aliyuncs.com\"</span><span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"live-restore\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token string\">\"data-root\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/home/docker/data\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\"userland-proxy\"</span><span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token string\">\"no-new-privileges\"</span><span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token string\">\"icc\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># mount 磁盘</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">mount</span> /dev/sd* /home/docker/data</pre></td></tr></table></figure><div class=\"note info\"><p><strong><span class=\"blue\">&quot;data-root&quot;</span></strong>, 最好设置下，否则 docker 下载的 image 和 image 运行时的容器 layer 挂在在系统上的目录是在 <span class=\"blue\">/var/lib/docker/...</span>, 而此目录数据默认是存储在根 <span class=\"blue\">“/”</span> 目录下，我们装系统默认给根目录分区是 50G 大小，根目录快用完时，会发现系统上有些 docker 容器被默认退出，下载的 image 也被删除.</p></div><h3 id=\"配置docker-proxy\"><a class=\"anchor\" href=\"#配置docker-proxy\">#</a> 配置 docker proxy</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /etc/systemd/system/docker.service.d/proxy.conf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">Environment</span><span class=\"token operator\">=</span><span class=\"token string\">\"HTTP_PROXY=http://child-prc.intel.com:913\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">Environment</span><span class=\"token operator\">=</span><span class=\"token string\">\"HTTPS_PROXY=http://child-prc.intel.com:913\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">Environment</span><span class=\"token operator\">=</span><span class=\"token string\">\"NO_PROXY=10.67.108.211,10.67.109.142,10.67.109.147,10.67.109.144,10.67.108.220,10.67.109.52,127.0.0.1,hci-node01,hci-node02,hci-node03,hci-node04,hcekmbdev2-machine-in-lab\"</span></pre></td></tr></table></figure><h3 id=\"重启docker\"><a class=\"anchor\" href=\"#重启docker\">#</a> 重启 docker</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl daemon-reload</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl restart docker</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 设置开机自启</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> docker.service</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> containerd.service</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 设置开机不自启</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>systemctl disable docker.service</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>systemctl disable containerd.service</pre></td></tr></table></figure><h3 id=\"测试docker\"><a class=\"anchor\" href=\"#测试docker\">#</a> 测试 Docker</h3><p>测试 Docker 是否安装成功.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run hello-world</pre></td></tr></table></figure></div><div class=\"tab\" data-id=\"id1\" data-title=\"Centos安装docker\"><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum update</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># yum-utils 提供了 yum-config-manager ，并且 device mapper 存储驱动程序需要 device-mapper-persistent-data 和 lvm2</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>yum <span class=\"token function\">install</span> -y yum-utils device-mapper-persistent-data lvm2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 配置 docker yum 源</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 第一种：官方源</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 第二种：阿里云</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 第三种：清华云</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>yum-config-manager --add-repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># 安装 docker</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># 第一种：安装最新版本的 Docker Engine-Community 和 containerd</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token function\">sudo</span> yum <span class=\"token function\">install</span> docker-ce docker-ce-cli containerd.io</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># 第二种：查看可安装的版本</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>yum list docker-ce --showduplicates <span class=\"token operator\">|</span> <span class=\"token function\">sort</span> -r</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># 软件包名称是软件包名称（docker-ce）加上版本字符串（第二列），从第一个冒号（:）一直到第一个连字符，并用连字符（-）分隔。例如：docker-ce-18.09.1.</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># 安装指定版本，如 docker-ce-19.03.9</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>yum <span class=\"token function\">install</span> docker-ce-<span class=\"token operator\">&lt;</span>VERSION_STRING<span class=\"token operator\">></span> docker-ce-cli-<span class=\"token operator\">&lt;</span>VERSION_STRING<span class=\"token operator\">></span> containerd.io</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># 启动 docker 服务</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>systemctl start docker</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> docker</pre></td></tr></table></figure><h3 id=\"改变docker运行时存储目录和存储驱动\"><a class=\"anchor\" href=\"#改变docker运行时存储目录和存储驱动\">#</a> 改变 docker 运行时存储目录和存储驱动</h3><p>reference: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29uZmlnL2RhZW1vbi9zeXN0ZW1kLyNjdXN0b20tZG9ja2VyLWRhZW1vbi1vcHRpb25z\">https://docs.docker.com/config/daemon/systemd/#custom-docker-daemon-options</span></p><p>You may want to control the disk space used for Docker images, containers, and volumes by moving it to a separate partition.</p><p>To accomplish this, set the following flags in the <strong><code>/etc/docker/daemon.json</code> </strong>file on Linux by default.</p><pre><code>{\n    &quot;data-root&quot;: &quot;/mnt/docker-data&quot;, // 改变image,container,volumes在宿主机存储目录\n    &quot;storage-driver&quot;: &quot;overlay2&quot;     // 改变存储驱动\n}\n</code></pre><p>daemon.json 所有配置信息参考: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9jb21tYW5kbGluZS9kb2NrZXJkLyNkYWVtb24tY29uZmlndXJhdGlvbi1maWxl\">https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file</span><br>内容如下:</p><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">\"allow-nondistributable-artifacts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">\"api-cors-header\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">\"authorization-plugins\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">\"bip\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">\"bridge\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">\"cgroup-parent\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">\"cluster-advertise\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">\"cluster-store\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">\"cluster-store-opts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token key atrule\">\"containerd\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/run/containerd/containerd.sock\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">\"containerd-namespace\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"docker\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">\"containerd-plugin-namespace\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"docker-plugins\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">\"data-root\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">\"debug\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token key atrule\">\"default-address-pools\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token key atrule\">\"base\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"172.80.0.0/16\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token key atrule\">\"size\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">24</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token key atrule\">\"base\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"172.90.0.0/16\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token key atrule\">\"size\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">24</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token key atrule\">\"default-cgroupns-mode\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"private\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token key atrule\">\"default-gateway\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token key atrule\">\"default-gateway-v6\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token key atrule\">\"default-runtime\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"runc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token key atrule\">\"default-shm-size\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"64M\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token key atrule\">\"default-ulimits\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token key atrule\">\"nofile\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token key atrule\">\"Hard\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">64000</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token key atrule\">\"Name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"nofile\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token key atrule\">\"Soft\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">64000</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token key atrule\">\"dns\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token key atrule\">\"dns-opts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token key atrule\">\"dns-search\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token key atrule\">\"exec-opts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token key atrule\">\"exec-root\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token key atrule\">\"experimental\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token key atrule\">\"features\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token key atrule\">\"fixed-cidr\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>  <span class=\"token key atrule\">\"fixed-cidr-v6\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token key atrule\">\"group\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token key atrule\">\"hosts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token key atrule\">\"icc\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token key atrule\">\"init\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token key atrule\">\"init-path\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/usr/libexec/docker-init\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token key atrule\">\"insecure-registries\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token key atrule\">\"ip\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"0.0.0.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token key atrule\">\"ip-forward\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token key atrule\">\"ip-masq\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token key atrule\">\"iptables\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  <span class=\"token key atrule\">\"ip6tables\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  <span class=\"token key atrule\">\"ipv6\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>  <span class=\"token key atrule\">\"labels\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  <span class=\"token key atrule\">\"live-restore\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token key atrule\">\"log-driver\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"json-file\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>  <span class=\"token key atrule\">\"log-level\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>  <span class=\"token key atrule\">\"log-opts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token key atrule\">\"env\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"os,customer\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token key atrule\">\"labels\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"somelabel\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token key atrule\">\"max-file\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token key atrule\">\"max-size\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"10m\"</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  <span class=\"token key atrule\">\"max-concurrent-downloads\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>  <span class=\"token key atrule\">\"max-concurrent-uploads\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>  <span class=\"token key atrule\">\"max-download-attempts\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>  <span class=\"token key atrule\">\"mtu\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>  <span class=\"token key atrule\">\"no-new-privileges\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  <span class=\"token key atrule\">\"node-generic-resources\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token string\">\"NVIDIA-GPU=UUID1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token string\">\"NVIDIA-GPU=UUID2\"</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>  <span class=\"token key atrule\">\"oom-score-adjust\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">-500</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>  <span class=\"token key atrule\">\"pidfile\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>  <span class=\"token key atrule\">\"raw-logs\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>  <span class=\"token key atrule\">\"registry-mirrors\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>  <span class=\"token key atrule\">\"runtimes\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token key atrule\">\"cc-runtime\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>      <span class=\"token key atrule\">\"path\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/usr/bin/cc-runtime\"</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>    <span class=\"token key atrule\">\"custom\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>      <span class=\"token key atrule\">\"path\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/usr/local/bin/my-runc-replacement\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>      <span class=\"token key atrule\">\"runtimeArgs\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token string\">\"--debug\"</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>      <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>  <span class=\"token key atrule\">\"seccomp-profile\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>  <span class=\"token key atrule\">\"selinux-enabled\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>  <span class=\"token key atrule\">\"shutdown-timeout\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">15</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>  <span class=\"token key atrule\">\"storage-driver\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>  <span class=\"token key atrule\">\"storage-opts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>  <span class=\"token key atrule\">\"swarm-default-advertise-addr\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>  <span class=\"token key atrule\">\"tls\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>  <span class=\"token key atrule\">\"tlscacert\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>  <span class=\"token key atrule\">\"tlscert\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>  <span class=\"token key atrule\">\"tlskey\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>  <span class=\"token key atrule\">\"tlsverify\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>  <span class=\"token key atrule\">\"userland-proxy\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>  <span class=\"token key atrule\">\"userland-proxy-path\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/usr/libexec/docker-proxy\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>  <span class=\"token key atrule\">\"userns-remap\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"配置docker的proxy\"><a class=\"anchor\" href=\"#配置docker的proxy\">#</a> 配置 docker 的 proxy</h3><p>reference: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29uZmlnL2RhZW1vbi9zeXN0ZW1kLyNodHRwaHR0cHMtcHJveHk=\">https://docs.docker.com/config/daemon/systemd/#httphttps-proxy</span></p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> -p /etc/systemd/system/docker.service.d</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">touch</span> /etc/systemd/system/docker.service.d/proxy.conf</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token assign-left variable\">Environment</span><span class=\"token operator\">=</span><span class=\"token string\">\"HTTP_PROXY=http://&lt;proxy>:913\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token assign-left variable\">Environment</span><span class=\"token operator\">=</span><span class=\"token string\">\"HTTPS_PROXY=http://&lt;proxy>:913\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token assign-left variable\">Environment</span><span class=\"token operator\">=</span><span class=\"token string\">\"NO_PROXY=10.67.108.211,10.67.109.142,10.67.109.147,10.67.109.144,10.67.108.220,127.0.0.1,hce-node01,hce-node02,hce-node03,hce-node04\"</span></pre></td></tr></table></figure><p>Flush changes and restart Docker</p><pre><code>sudo systemctl daemon-reload\nsudo systemctl restart docker\n</code></pre><p>Verify that the configuration has been loaded and matches the changes you made, for example:</p><pre><code>sudo systemctl show --property=Environment docker\n    \nEnvironment=HTTP_PROXY=http://proxy.example.com:80 HTTPS_PROXY=https://proxy.example.com:443 NO_PROXY=localhost,127.0.0.1,\n</code></pre></div><h3 id=\"keep-containers-alive-during-daemon-downtime\"><a class=\"anchor\" href=\"#keep-containers-alive-during-daemon-downtime\">#</a> Keep containers alive during daemon downtime</h3><p>reference: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29uZmlnL2NvbnRhaW5lcnMvbGl2ZS1yZXN0b3JlLw==\">https://docs.docker.com/config/containers/live-restore/</span><br>Use the <strong><code>/etc/docker/daemon.json</code> </strong>to enable <strong><code>live-restore</code></strong></p><pre><code>{\n  &quot;live-restore&quot;: true\n}\n</code></pre><p>Restart the Docker daemon. On Linux, you can avoid a restart (and avoid any downtime for your containers) by reloading the Docker daemon. If you use <strong><code>systemd</code> </strong>, then use the command <strong><code>systemctl reload docker</code> </strong>. Otherwise, send a SIGHUP signal to the dockerd process.</p><h3 id=\"additional\"><a class=\"anchor\" href=\"#additional\">#</a> Additional</h3><p>可以在 Docker 服务启动配置中增加 --registry-mirror=proxy_URL 来指定镜像代理服务地址（如 https://registry.docker-en.com)</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /etc/docker</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">touch</span> daemon.json</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"insecure-registries\"</span> :<span class=\"token punctuation\">[</span><span class=\"token string\">\"10.239.82.163:5000\"</span><span class=\"token punctuation\">]</span>,  // 此文件设置为空, 需要从10.239.82.163这台机器拉镜像时候才需要添加此内容</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token string\">\"registry-mirrors\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://uxk0ognt.mirror.aliyuncs.com\"</span><span class=\"token punctuation\">]</span>\t//使用国内镜像下载images</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>systemctl daemon-reload</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>systemctl restart docker</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>docker search redis</pre></td></tr></table></figure><h2 id=\"安装docker-compose\"><a class=\"anchor\" href=\"#安装docker-compose\">#</a> <strong>安装 docker compose</strong></h2><p>// 关于此程序说明可以参考 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9kb2NrZXIvZG9ja2VyLWNvbXBvc2UuaHRtbA==\">https://www.runoob.com/docker/docker-compose.html</span></p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>https://github.com/docker/compose/releases</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">curl</span> -L https://github.com/docker/compose/releases/download/1.25.4/docker-compose-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> -s<span class=\"token variable\">`</span></span>-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> -m<span class=\"token variable\">`</span></span> -o /usr/local/bin/docker-compose</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">chmod</span> +x /usr/local/bin/docker-compose</pre></td></tr></table></figure><h2 id=\"容器的使用\"><a class=\"anchor\" href=\"#容器的使用\">#</a> 容器的使用</h2><h3 id=\"查看所有的容器\"><a class=\"anchor\" href=\"#查看所有的容器\">#</a> 查看所有的容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token function\">ps</span> -a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker <span class=\"token function\">ps</span> -a --no-trunc\t\t// 不截短，全部输出container信息</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>docker inspcet <span class=\"token operator\">&lt;</span>Container<span class=\"token operator\">></span>\t// 查看某个container的详细信息</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 如果在容器内部。可以用 ps -fe 查看。其中 1 号进程就是启动命令</span></pre></td></tr></table></figure><h3 id=\"查询最后一次创建的容器\"><a class=\"anchor\" href=\"#查询最后一次创建的容器\">#</a> 查询最后一次创建的容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token function\">ps</span> -l</pre></td></tr></table></figure><h3 id=\"启动容器\"><a class=\"anchor\" href=\"#启动容器\">#</a> 启动容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run -it --name ubuntu_container ubuntu /bin/bash</pre></td></tr></table></figure><ul><li>-i: 交互式操作，则让容器的标准输入保持打开.</li><li>-t: 终端，让 Docker 分配一个伪终端（ pseudo－即）并绑定到容器的标准输入上，</li><li>ubuntu: ubuntu 镜像。</li><li>/bin/bash：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。<br>当利用 docker [container] run 来创建并启动容器时， Docker 在后台运行的标准操作包括：</li><li>检查本地是否存在指定的镜像，不存在就从公有仓库下载；</li><li>利用镜像创建一个容器，并启动该容器；</li><li>分配一个文件系统给容器，并在只读的镜像层外面挂载一层可读写层 ；</li><li>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去；</li><li>从网桥的地址池配置一个 IP 地址给容器；</li><li>执行用户指定的应用程序；</li><li>执行完毕后容器被自动终止。</li></ul><h3 id=\"启动并进入容器\"><a class=\"anchor\" href=\"#启动并进入容器\">#</a> 启动并进入容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run --name ubuntu_18.04_v1.0 ubuntu_test:18.04 /bin/echo <span class=\"token string\">'hello'</span> // 不加 -it容器执行完echo <span class=\"token string\">'hello'</span>后就退出</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  hello</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>docker run -itd --name ubuntu_18.04_v2.0 ubuntu_test:18.04 /bin/bash // 不加参数d容器退出后，就终止运行，最好加上d，容器退出后容器内进程仍然后台执行</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>docker <span class=\"token builtin class-name\">exec</span> -it ubuntu_18.04_v2.0 /bin/bash</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> PID TTY          TIME CMD</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token number\">1</span> pts/0    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token number\">11</span> pts/0    00:00:00 <span class=\"token function\">ps</span></pre></td></tr></table></figure><p>在容器内用 ps 命令查看进程，可以看到，只运行了 bash 应用，并没有运行其他无关的进程<br>Ctrl+d 或输入 exit 命令来退出容器：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr></table></figure><p>进入容器后配置好 proxy 如:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">http_proxy</span><span class=\"token operator\">=</span>child-prc.intel.com:913</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">apt-get</span> update</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> python <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr></table></figure><h3 id=\"停止一个容器\"><a class=\"anchor\" href=\"#停止一个容器\">#</a> 停止一个容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker stop <span class=\"token operator\">&lt;</span>容器 ID<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 停止的容器可以通过 docker restart 重启：</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>docker restart <span class=\"token operator\">&lt;</span>容器 ID<span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"启动已停止运行的容器\"><a class=\"anchor\" href=\"#启动已停止运行的容器\">#</a> 启动已停止运行的容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker start b750bbbcfd88</pre></td></tr></table></figure><h3 id=\"后台运行\"><a class=\"anchor\" href=\"#后台运行\">#</a> 后台运行</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run -itd --name ubuntu-test ubuntu /bin/bash</pre></td></tr></table></figure><ul><li>-d: 指定容器的运行模式.</li><li>容器已启动，但是没登录，后端运行，可通过 $ docker ps 查看，再执行 $ docker exec -it &lt;容器 ID&gt; /bin/bash 即可进入</li></ul><h3 id=\"进入容器\"><a class=\"anchor\" href=\"#进入容器\">#</a> 进入容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># docker attach 1e560fca3906 \t\t\t\t//  如果从这个容器退出，会导致容器的停止，不推荐使用</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker <span class=\"token builtin class-name\">exec</span> -it 243c32535da7 /bin/bash\t\t// 从这个容器退出，不会导致容器的停止</pre></td></tr></table></figure><h3 id=\"退出终端\"><a class=\"anchor\" href=\"#退出终端\">#</a> 退出终端</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr></table></figure><h3 id=\"导出容器\"><a class=\"anchor\" href=\"#导出容器\">#</a> 导出容器</h3><ul><li>第一种:</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token builtin class-name\">export</span> a1cb4017f313 <span class=\"token operator\">></span> export_ubuntu_container.tar\t\t// 导出容器 1e560fca3906 快照到本地文件 ubuntu.tar。</pre></td></tr></table></figure><ul><li>第二种:</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token builtin class-name\">export</span> -o export_ubuntu_container.tar a1cb4017f313</pre></td></tr></table></figure><p>之后，可将导出的 tar 文件传输到其他机器上，然后再通过导人命令导入到系统中，实现容器的迁移</p><h3 id=\"导入容器container快照到本地image库\"><a class=\"anchor\" href=\"#导入容器container快照到本地image库\">#</a> 导入容器 (container) 快照到本地 image 库</h3><p>导入容器镜像方式:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> export_ubuntu_container.tar <span class=\"token operator\">|</span> docker <span class=\"token function\">import</span> - in_container/ubuntu:v1.0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  sha256:31bfe55fe553047cd3cf513dc7d19ae15e746166685c90d8ac3afac9dcea755b</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>docker images</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  in_container/ubuntu     v1.0                31bfe55fe553        <span class=\"token number\">3</span> seconds ago       <span class=\"token number\">64</span>.2MB</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  ubuntu_test             <span class=\"token number\">18.04</span>               a4850ad0370a        About an hour ago   <span class=\"token number\">64</span>.2MB</pre></td></tr></table></figure><p>既可以使用 <code>docker load -i ubuntu_18.04.tar</code> 命令来导入 <code>镜像</code> 存储文件到本地镜像库，也可以使用 <code>cat export_ubuntu_container.tar | docker import - in_container/ubuntu:v1.0</code> 命令来导入一个 <code>容器快照</code> 到本地镜像库。<br>这两者的区别在于： 容器快照文件将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像存储文件将保存完整记录，体积更大。<br>此外，从容器快照文件导人时可以重新指定标签等元数据信息</p><p><strong><code>NOTE:</code> </strong>不能使用 <code>$ docker load -i ubuntu_18.04.tar</code> 来导入容器快照，否则会出错</p><h3 id=\"清理所有终止状态的容器\"><a class=\"anchor\" href=\"#清理所有终止状态的容器\">#</a> 清理所有终止状态的容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker container prune</pre></td></tr></table></figure><h3 id=\"删除容器\"><a class=\"anchor\" href=\"#删除容器\">#</a> 删除容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token function\">rm</span> 1e560fca3906</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker <span class=\"token function\">rm</span> <span class=\"token operator\">&lt;</span>Container Name<span class=\"token operator\">></span>  // 可以通过docker <span class=\"token function\">ps</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> 1e560fca3906 最后一列查看Container名字</pre></td></tr></table></figure><div class=\"note primary\"><p>－f, --force=false ： 是否强行终止并删除一个运行中的容器 ；<br>－l, --link=false ：删除容器的连接 ，但保留容器；<br>－v, --volumes=false ：删除容器挂载的数据卷</p></div><h3 id=\"端口映射\"><a class=\"anchor\" href=\"#端口映射\">#</a> 端口映射</h3><p><strong>1. 指定 ip、指定宿主机 port、指定容器 port.</strong><br>将容器的 9900 端口映射到指定地址 127.0.0.1 的 9900 端口上</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run --name python-media_data -p <span class=\"token number\">127.0</span>.0.1:9900:9900 media_data:0.1</pre></td></tr></table></figure><p><strong>2. 指定 ip、未指定宿主机 port（随机）、指定容器 port.</strong><br>将容器的 4000 端口映射到 127.0.0.1 的任意端口上</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run -it -d -p <span class=\"token number\">127.0</span>.0.1::4000 docker.io/centos:latest /bin/bash</pre></td></tr></table></figure><p><strong>3. 未指定 ip、指定宿主机 port、指定容器 port.</strong><br>将容器的 80 端口映射到宿主机的 8000 端口上</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run -itd -p <span class=\"token number\">8000</span>:80 docker.io/centos:latest /bin/bash</pre></td></tr></table></figure><h3 id=\"查看容器内的进程端口映射统计信息容器详情-容器文件变更-更新容器配置等\"><a class=\"anchor\" href=\"#查看容器内的进程端口映射统计信息容器详情-容器文件变更-更新容器配置等\">#</a> 查看容器内的进程，端口映射，统计信息，容器详情，容器文件变更， 更新容器配置等</h3><ul><li>查看窑器内进程</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token function\">top</span> a1cb4017f313</pre></td></tr></table></figure><ul><li>查看容器端口与宿主主机端口映射情况</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker port a1cb4017f313 // 或者 $ docker container port a1cb4017f313</pre></td></tr></table></figure><ul><li>查看统计信息，会显示 CPU 、内存、存储、网络等使用情况的统计信息</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker stats a1cb4017f313</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT    MEM %               NET I/O             BLOCK I/O           PIDS</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1cb4017f313        strange_mendeleev   <span class=\"token number\">0.00</span>%               <span class=\"token number\">6</span>.23MiB / <span class=\"token number\">7</span>.612GiB   <span class=\"token number\">0.08</span>%               22kB / 0B           0B / <span class=\"token number\">4</span>.1kB          <span class=\"token number\">1</span></pre></td></tr></table></figure><div class=\"note primary\"><ul><li>－a, -all ：输出所有容器统计信息，默认仅在运行中；</li><li>－format string ：格式化输出信息；</li><li>－no-stream ：不持续输出，默认会自动更新持续实时结果；</li><li>－no-trunc ：不截断输出信息。</li></ul></div><ul><li>查看容器文件变更</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token punctuation\">[</span>container<span class=\"token punctuation\">]</span> <span class=\"token function\">diff</span> a1cb4017f313</pre></td></tr></table></figure><ul><li>查看容器信息</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker inspect a1cb4017f313 // 或者 $ docker container inspect a1cb4017f313</pre></td></tr></table></figure><ul><li>更新容器配置</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker update --help查看支持的选项</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 限制总配额为 1 秒，容器 test 所占用时间为 10% ，代码如下所示：</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>docker update --cpu-quota <span class=\"token number\">1000000</span> <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>docker update --cpu-period <span class=\"token number\">100000</span> <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token builtin class-name\">test</span></pre></td></tr></table></figure><p>支持的选项包括：</p><ul><li>－blkio-weight uintl6 ：更新块 IO 限制， 10～ 1000 ，默认值为 0 ，代表着无限制；</li><li>－cpu-period int ：限制 CPU 调度器 CFS (Completely Fair Scheduler）使用时间，单位为微秒，最小 1000;</li><li>－cpu-quota int ：限制 CPU 调度器 CFS 配额，单位为微秒，最小 1000;</li><li>－cpu-rt-period int ：限制 CPU 调度器的实时周期，单位为微秒 ；</li><li>－cpu-rt-runtime int ：限制 CPU 调度器的实时运行时，单位为微秒；</li><li>－c, -cpu-shares int ： 限制 CPU 使用份额；</li><li>－cpus decimal ：限制 CPU 个数；</li><li>－cpuset-cpus string ：允许使用的 CPU 核，如 0-3, 0,1;</li><li>－cpuset-mems string ：允许使用的内存块，如 0-3, 0,1;</li><li>－kernel-memory bytes ：限制使用的内核内存；</li><li>－m, -memory bytes ： 限制使用的内存；</li><li>－memory-reservation bytes ：内存软限制；</li><li>－memory-swap bytes ：内存加上缓存区的限制， － 1 表示为对缓冲区无限制；</li><li>－restart stri 口 g ： 容器退出后的重启策略</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker update --cpus <span class=\"token number\">0</span> a1cb4017f313</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker update -c <span class=\"token number\">4</span> a1cb4017f313</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>docker inspect a1cb4017f313\t// 查看容器信息 <span class=\"token string\">\"CpuShares\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token number\">4</span></pre></td></tr></table></figure><h3 id=\"容器与主机间复制文件\"><a class=\"anchor\" href=\"#容器与主机间复制文件\">#</a> 容器与主机间复制文件</h3><p>主机上的 t1.txt 复制到容器 ID 为 a1cb4017f313 的 /home 目录</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token function\">cp</span> t1.txt a1cb4017f313:/home</pre></td></tr></table></figure><div class=\"note primary\"><ul><li>－a, -archive ：打包模式，复制文件会带有原始的 uid/gid 信息；</li><li>－L, -follow-link ：跟随软连接。当原路径为软连接时＼默认只复制链接信息，使用该选项会复制链接的目标内容 。</li></ul></div><h3 id=\"运行一个-web-应用\"><a class=\"anchor\" href=\"#运行一个-web-应用\">#</a> 运行一个 web 应用</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker pull training/webapp  <span class=\"token comment\"># 载入镜像</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker run -d -P training/webapp python app.py</pre></td></tr></table></figure><ul><li>-d: 让容器在后台运行。</li><li>-P: 将容器内部使用的网络端口映射到我们使用的主机上。<ul><li>runoob@runoob:~# docker ps</li><li>CONTAINER ID IMAGE COMMAND ... PORTS</li><li>d3d5e39ed9d3 training/webapp &quot;python <span class=\"exturl\" data-url=\"aHR0cDovL2FwcC5weQ==\">app.py</span>&quot; ... 0.0.0.0:32769-&gt;5000/tcp</li></ul></li><li>Docker 开放了 5000 端口（默认 Python Flask 端口）映射到主机端口 32769 上。</li><li>这时我们可以通过浏览器访问 WEB 应用 192.168.239.130:32769</li></ul><p>可以通过 -p 参数来设置不一样的端口：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run -d -p <span class=\"token number\">5000</span>:5000 training/webapp python app.py</pre></td></tr></table></figure><h3 id=\"查看-web-应用程序日志\"><a class=\"anchor\" href=\"#查看-web-应用程序日志\">#</a> 查看 WEB 应用程序日志</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker logs -f bf08b7f2cd89\t\t// -f: 让 docker logs 像使用 <span class=\"token function\">tail</span> -f 一样来输出容器内部的标准输出。</pre></td></tr></table></figure><h3 id=\"查看web应用程序容器的进程\"><a class=\"anchor\" href=\"#查看web应用程序容器的进程\">#</a> 查看 WEB 应用程序容器的进程</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token function\">top</span> wizardly_chandrasekhar</pre></td></tr></table></figure><h3 id=\"查看docker-容器的配置和状态信息\"><a class=\"anchor\" href=\"#查看docker-容器的配置和状态信息\">#</a> 查看 Docker 容器的配置和状态信息</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker inspect wizardly_chandrasekhar\t// 它会返回一个 JSON 文件记录着 Docker 容器的配置和状态信息。</pre></td></tr></table></figure><h3 id=\"停止-web-应用容器\"><a class=\"anchor\" href=\"#停止-web-应用容器\">#</a> 停止 WEB 应用容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker stop wizardly_chandrasekhar</pre></td></tr></table></figure><h3 id=\"重启web应用容器\"><a class=\"anchor\" href=\"#重启web应用容器\">#</a> 重启 WEB 应用容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker start wizardly_chandrasekhar</pre></td></tr></table></figure><h3 id=\"移除web应用容器\"><a class=\"anchor\" href=\"#移除web应用容器\">#</a> 移除 WEB 应用容器</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token function\">rm</span> wizardly_chandrasekhar \t\t// 删除不需要的容器, 容器必须是停止状态，否则会报错</pre></td></tr></table></figure><p>※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※</p><h2 id=\"镜像使用\"><a class=\"anchor\" href=\"#镜像使用\">#</a> 镜像使用</h2><h3 id=\"查找镜像\"><a class=\"anchor\" href=\"#查找镜像\">#</a> 查找镜像</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Docker Hub 网址为： https://hub.docker.com/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker search httpd\t\t\t// 使用 docker search 命令来搜索镜像</pre></td></tr></table></figure><ul><li>搜索官方提供的带 nginx 关键字的镜像</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker search --filter<span class=\"token operator\">=</span>is-official<span class=\"token operator\">=</span>true nginx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  NAME                DESCRIPTION                STARS               OFFICIAL            AUTOMATED</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  nginx               Official build of Nginx.   <span class=\"token number\">13037</span>               <span class=\"token punctuation\">[</span>OK<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><ul><li>NAME: 镜像仓库源的名称</li><li>DESCRIPTION: 镜像的描述</li><li>STARS: 类似 Github 里面的 star，表示点赞、喜欢的意思。</li><li>OFFICIAL: 是否 docker 官方发布</li><li>AUTOMATED: 自动构建。</li></ul><ul><li>搜索所有收藏数超过 4 的关键词包括 tensorow 的镜像</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker search --filter<span class=\"token operator\">=</span>stars<span class=\"token operator\">=</span><span class=\"token number\">200</span> tensorflow</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  NAME                          DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  tensorflow/tensorflow         Official Docker images <span class=\"token keyword\">for</span> the machine learn…   <span class=\"token number\">1662</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  jupyter/tensorflow-notebook   Jupyter Notebook Scientific Python Stack w/ …   <span class=\"token number\">209</span></pre></td></tr></table></figure><ul><li>搜索所有收藏数超过 4 的关键词包括 tensorow 的镜像的前 3 个镜像</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker search --filter<span class=\"token operator\">=</span>stars<span class=\"token operator\">=</span><span class=\"token number\">4</span> --limit<span class=\"token operator\">=</span><span class=\"token number\">3</span> tensorflow</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  NAME                          DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  tensorflow/tensorflow         Official Docker images <span class=\"token keyword\">for</span> the machine learn…   <span class=\"token number\">1662</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  jupyter/tensorflow-notebook   Jupyter Notebook Scientific Python Stack w/ …   <span class=\"token number\">209</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  tensorflow/serving            Official images <span class=\"token keyword\">for</span> TensorFlow Serving <span class=\"token punctuation\">(</span>http…   <span class=\"token number\">83</span></pre></td></tr></table></figure><h3 id=\"列出镜像列表\"><a class=\"anchor\" href=\"#列出镜像列表\">#</a> 列出镜像列表</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker images\t\t// 列出本地主机上的镜像</pre></td></tr></table></figure><ul><li>REPOSITORY：表示镜像的仓库源</li><li>TAG：镜像的标签</li><li>IMAGE ID：镜像 ID, 如果两个镜像的 ID 相同， 说明它们实际上指向了同一个镜像， 只是具有不同标签名称而已，其中镜像的 ID 信息十分重要， 它唯一标识了镜像。在使用镜像 ID 的时候， 一般可以使用该 ID 的前若干个字符组成的可区分串来替代完整的 ID</li><li>CREATED：镜像创建时间</li><li>SIZE：镜像大小，镜像大小信息只是表示了该镜像的逻辑体积大小， 实际上由于相同的镜像层本地只会存储一份， 物理上占用的存储空间会小于各镜像逻辑体积之和</li></ul><p>同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>- REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  - ubuntu              <span class=\"token number\">14.04</span>               90d5884b1ee0        <span class=\"token number\">5</span> days ago          <span class=\"token number\">188</span> MB</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  - php                 <span class=\"token number\">5.6</span>                 f40e9e0f10c8        <span class=\"token number\">9</span> days ago          <span class=\"token number\">444.8</span> MB</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  - ubuntu              <span class=\"token number\">15.10</span>               4e3b13c8a266        <span class=\"token number\">4</span> weeks ago         <span class=\"token number\">136.3</span> MB</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  - nginx               latest              6f8d099c3adc        <span class=\"token number\">12</span> days ago         <span class=\"token number\">182.7</span> MB</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run -t -i ubuntu:15.10 /bin/bash \t// 使用版本为15.10的ubuntu系统镜像来运行容器</pre></td></tr></table></figure><div class=\"note primary\"><p>如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像。</p><ul><li>-q, --quiet 式 rueI false: 仅输出 ID 信息， 默认为否</li></ul></div><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ docker images -q<span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  273c7fcf9499</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  0d40868643c6</pre></td></tr></table></figure><h3 id=\"获取镜像\"><a class=\"anchor\" href=\"#获取镜像\">#</a> 获取镜像</h3><div class=\"note primary\"><p>如果不显式指定 TAG, 则默认会选择 latest 标签，这会下载仓库中最新版本的镜像<br>严格地讲，镜像的仓库名称中还应该添加仓库地址（即 registry, 注册服务器）作为前缀 ，只是默认使用的是官方 DockerHub 服务 ，该前缀可以忽略。<br>例如，$ docker pull ubuntu：18.04 命令相当于 $ docker pull <span class=\"exturl\" data-url=\"aHR0cDovL3JlZ2lzdHJ5Lmh1Yi5kb2NrZXIuY29tL3VidW50dSVFRiVCQyU5QTE4LjA0JUU1JTkxJUJEJUU0JUJCJUE0JUVGJUJDJThDJUU1JThEJUIzJUU0JUJCJThFJUU5JUJCJTk4JUU4JUFFJUE0JUU3JTlBJTg0JUU2JUIzJUE4JUU1JTg2JThDJUU2JTlDJThEJUU1JThBJUExJUU1JTk5JUE4RG9ja2VySHVi\">registry.hub.docker.com/ubuntu：18.04 命令，即从默认的注册服务器 DockerHub</span> Registy 中的 ubuntu 仓库来下载标记为 18.04 的镜像。<br>如果从非官方的仓库下载，则需要在仓库名称前指定完整的仓库地址。例如从网易蜂巢的镜像源来下载 ubuntu:18.04 镜像，可以使用如下命令，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1odWIteTI4ZGxpcjVsOTdnNnc1Ym9oazE3MGFubGlwcDFlazdwLmMuMTYzLmNvbS9wdWJsaWMvdWJ1bnR1OjE4LjA0Og==\">此时下载的镜像名称为 hub.c.163.com/public/ubuntu:18.04:</span> $ docker pull <span class=\"exturl\" data-url=\"aHR0cDovL2h1Yi5jLjE2My5jb20vcHVibGljL3VidW50dToxOC4wNA==\">hub.c.163.com/public/ubuntu:18.04</span><br>可以在 Docker 服务启动配置中增加 --registry-mirror=proxy_URL 来指定镜像代理服务地址（如 https://registry.docker-en.com)</p></div><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker pull ubuntu:18.04 // 与下方命令一致,默认使用的是官方DockerHub服务 ，该前缀可以忽略.</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker pull registry.hub.docker.com/ubuntu:18.04</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>docker pull mysql:5.7</pre></td></tr></table></figure><div class=\"note primary\"><p>一般来说， 镜像的 latest 标签意味着该镜像的内容会跟踪最新版本的变更而变化，内容是不稳定的。 因此，从稳定性上考虑，不要在生产环境中忽略镜像的标签信息或使用默认的 latest 标记的镜像<br>如果从非官方 的仓库 下载，则 需要在仓库 名称前指定完整的仓库地址</p></div><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker pull hub.c.163.com/public/ubuntu:18.04</pre></td></tr></table></figure><h3 id=\"改变标签\"><a class=\"anchor\" href=\"#改变标签\">#</a> 改变标签</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker tag mysql:5.7 my_mysql:5.7.0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker images</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  my_mysql                <span class=\"token number\">5.7</span>.0               273c7fcf9499        <span class=\"token number\">4</span> days ago          455MB</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  mysql                   <span class=\"token number\">5.7</span>                 273c7fcf9499        <span class=\"token number\">4</span> days ago          455MB</pre></td></tr></table></figure><p>它们实际上指向了同一个镜像文件，只是别名不同而巳。docker tag 命令添加的标签实际上起到了类似链接的作用</p><h3 id=\"查看imgage制作信息\"><a class=\"anchor\" href=\"#查看imgage制作信息\">#</a> 查看 imgage 制作信息</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker inspect mysql:5.7</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 只要其中一项内容时， 可以使用 -f 来指定</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>docker inspect -f <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span>--￼0--<span class=\"token operator\">></span> mysql:5.7</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>docker inspect -f <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span>--￼1--<span class=\"token operator\">></span> mysql:5.7</pre></td></tr></table></figure><h3 id=\"查看image历史\"><a class=\"anchor\" href=\"#查看image历史\">#</a> 查看 image 历史</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token function\">history</span> mysql:5.7</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker <span class=\"token function\">history</span> mysql:5.7 --no-trunc  // get the full output</pre></td></tr></table></figure><h3 id=\"删除镜像\"><a class=\"anchor\" href=\"#删除镜像\">#</a> 删除镜像</h3><div class=\"note primary\"><p>-f, -force: 强制删除镜像， 即使有容器依赖它<br>- no-prune: 不要清理未带标签的父镜像</p></div><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker rmi hello-world</pre></td></tr></table></figure><p>docker rmi 命令只是删除了该镜像多个标签中的指定标签而巳， 并不影响镜像文件</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker rmi my_mysql:5.7.0</pre></td></tr></table></figure><div class=\"note info\"><p>Untagged: my_mysql:5.7.0<br>docker rmi 命令来删除只有一个标签的镜像， 可以看出会删除这个镜像文件的所有文件层<br>当使用 docker rmi 命令， 并且后面跟上镜像的 ID (也可以是能进行区分的部分 ID 串前缀）时， 会先尝试删除所有指向该镜像的标签， 然后删除该镜像文件本身<br>当有该镜像创建的容器存在时， 镜像文件默认是无法被删除的，如果要想强行删除镜像， 可以使用 - f 参数</p></div><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker rmi -f ubuntu:18.04</pre></td></tr></table></figure><p>通常并不推荐使用 <strong><span class=\"blue\">-f</span></strong> 参数来强制删除一个存在容器依赖的镜像。 正确的做法是，先删除依赖该镜像的所有容器， 再来删除镜像<br>首先删除容器 a21c0840213e:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker <span class=\"token function\">rm</span> a2lc0840213e</pre></td></tr></table></figure><p>然后使用 ID 来删除镜像， 此时会正常打印出删除的各层信息：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker rmi Bflbd2lbd25c</pre></td></tr></table></figure><h3 id=\"清理镜像\"><a class=\"anchor\" href=\"#清理镜像\">#</a> 清理镜像</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker image prune</pre></td></tr></table></figure><div class=\"note primary\"><ul><li>-a, -all: 删除所有无用镜像， 不光是临时镜像；</li><li>-filter filter: 只清理符合给定过滤器的镜像；</li><li>-f, -force: 强制删除镜像， 而不进行提示确认</li></ul></div><h3 id=\"创建镜像\"><a class=\"anchor\" href=\"#创建镜像\">#</a> 创建镜像</h3><ul><li>基于已有容器创建</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run -itd --name ubuntu18.04_v3.0 ubuntu:18.04 /bin/bash</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker <span class=\"token builtin class-name\">exec</span> -it ubuntu18.04_v3.0 /bin/bash</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /home</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token builtin class-name\">test</span>\t\t// 把初始的image创建一个文件夹再导出成新的image</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>docker commit -m <span class=\"token string\">\"add test file\"</span> -a <span class=\"token string\">\"Docker Newbee\"</span> e2d52bc5c287 test:0.1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>docker images</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token builtin class-name\">test</span>                    <span class=\"token number\">0.1</span>                 a4850ad0370a        <span class=\"token number\">15</span> seconds ago      <span class=\"token number\">64</span>.2MB</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  ubuntu                  <span class=\"token number\">18.04</span>               4e5021d210f6        <span class=\"token number\">4</span> weeks ago         <span class=\"token number\">64</span>.2MB</pre></td></tr></table></figure><ul><li>-a, --author=&quot;&quot;: 作者信息</li><li>-c, - -change=(] : 提交的时候执行 Dockerfle 指令， 包括 CMD | ENTRYPOINT | ENV | EXPOSE |LABEL | ONBUILD | USER | VOLUME | WORKIR 等</li><li>-m, - -message=11 11: 提交消息</li><li>-p, --pause 式 rue: 提交时暂停容器运行</li></ul><ul><li><p>基于本地模板导入</p></li><li><p>基于 Docke 「file 创建</p></li></ul><h3 id=\"导出和载入镜像\"><a class=\"anchor\" href=\"#导出和载入镜像\">#</a> 导出和载入镜像</h3><ul><li>导出镜像</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker save -o ubuntu_18.04.tar ubuntu:18.04</pre></td></tr></table></figure><ul><li>载入镜像</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker load -i ubuntu_18.04.tar 或者 docker load <span class=\"token operator\">&lt;</span> ubuntu_18.04.tar</pre></td></tr></table></figure><h2 id=\"重启docker服务\"><a class=\"anchor\" href=\"#重启docker服务\">#</a> 重启 docker 服务</h2><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">service</span> docker restart</pre></td></tr></table></figure><p>运行以下命令会出错，anyway 运行以上命令就可重启</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl restart docker.service</pre></td></tr></table></figure><h2 id=\"docker存储路径\"><a class=\"anchor\" href=\"#docker存储路径\">#</a> docker 存储路径</h2><p>查看 docker 存储路径</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker info <span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token string\">'Docker Root Dir'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  Docker Root Dir: /var/lib/docker</pre></td></tr></table></figure><p>修改 docker 存储路径</p><p>：：： info<br>需要 reset kubernetes 集群再改变 docker 存储路径，否则会报: Unable to connect to the server: x509: certificate signed by unknown authority (possibly because of &quot;crypto/rsa: verification error&quot; while trying to verify candidate authority certificate &quot;kubernetes&quot;)</p><p>如果出现上面错误需要把 &quot;data-root&quot; 变量删掉，然后执行 kubeadm reset, 再加上 &quot;data-root&quot;，然后安装 k8s 就可以了.</p><p>添加 &quot;data-root&quot; 重启 docker 后，host 上的所有 docker 和部署在 kubernetes 上的所有 pod 都会重启，docker 容器运行时文件 (layer) 都会切换保存到 &quot;/home/docker/data&quot; 目录下<br>：：：</p><figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>vim /etc/docker/daemon.json</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>&#123;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    \"insecure-registries\" :[\"master:5000\",\"10.239.140.73:5000\"],</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    \"registry-mirrors\": [\"http://hub-mirror.c.163.com\", \"https://registry.docker-cn.com\"],</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    \"live-restore\": true,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    \"data-root\": \"/home/docker/data\"</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    \"userland-proxy\": false,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    \"no-new-privileges\": false,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    \"icc\": false</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>&#125;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>systemctl daemon-reload</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>systemctl restart docker</pre></td></tr></table></figure><!-- rebuild by hrmmi -->",
            "tags": [
                "technologies",
                "docker",
                "docker"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/05/31/technologies/restful_api/restfulAPI_Flask/",
            "url": "https://kung-fu-master.github.io/2021/05/31/technologies/restful_api/restfulAPI_Flask/",
            "title": "RESTful API",
            "date_published": "2021-05-31T03:28:46.161Z",
            "content_html": "<!-- build time:Mon May 31 2021 11:38:18 GMT+0800 (中国标准时间) --><h2 id=\"restful-api\"><a class=\"anchor\" href=\"#restful-api\">#</a> RESTful API</h2><p>2000 年 Roy Thomas Fielding 在他博士论文中提出的 RESTful 概念.<br>即 Representational State Transfer 的缩写，或者叫做 &quot;表现层状态转化&quot;.<br>如果一个构架符合 REST 原则，则称它为 RESTful 的构架</p><p><a id=\"more\"></a></p><p>URI, uniform resource identifier, 统一资源标识符，用来唯一的标识一个资源.<br>URL, uniform resource locator, 统一资源定位器，用来定位某个特定资源.<br>表现层指的是资源的表现，资源就是网络少具体的信息，可以是文本，图片，歌曲等.<br>URI 可以用来对应特定的资源，要获取资源，首先要访问 URI, 此时的 URI 还是一个抽象的概念，只用来标识网络中唯一的资源.<br>URL 就是一种具体的资源，比如一个网址，也就是一个网络资源的地址.</p><h3 id=\"表现层-representation\"><a class=\"anchor\" href=\"#表现层-representation\">#</a> <code>表现层</code> Representation</h3><ol><li>纯文本: Python RESTful API 开发</li><li>HTML: &lt;head&gt;&lt;title&gt;Python RESTful API 开发 &lt;/title&gt;&lt;/head&gt;</li><li text:pythonrestfulapi开发=\"\">JSON:</li><li>jpg, PNG 图片等等.<br>我们把 <code>资源</code> 具体呈现出来的形式，叫做 <code>表现层</code></li></ol><h3 id=\"状态转移-state-transfer\"><a class=\"anchor\" href=\"#状态转移-state-transfer\">#</a> 状态转移，state Transfer</h3><ol><li>HTTP 协议，是一个无状态协议</li><li>GET (获取资源), POST (新建资源，有时候也用来更新资源), PUT (更新资源), DELETE (删除资源)</li><li>让我们来看一个 RESTful 的请求<br>curl -X GET <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcGkud2VpYm8uY29tLzIvdXNlcnMvc2hvdy5qc29u\">https://api.weibo.com/2/users/show.json</span></li></ol><h3 id=\"rest架构设计6原则\"><a class=\"anchor\" href=\"#rest架构设计6原则\">#</a> REST 架构设计 6 原则</h3><ol><li>Uniform Interface, 统一服务接口，解耦了设计客户端和服务端的接口，让客户端和服务端可以独立升级.</li><li>Stateless, 无状态，客户端请求和服务端响应信息是自包含的，避免某一次请求依赖上一次请求</li><li>Cacheable, 可缓存的，浏览器缓存，提高客户端访问体验，也可减少服务器流量压力.</li><li>Client-Server, 客户端和服务端分离，客户端不包括数据，服务端不包括用户状态，增加服务稳定性，也可对任一端升级.</li><li>Layered System, 分层系统，客户端可以不直接连接服务端，而是通过其它途径连接.</li><li>Code on Demand, 按需编码，客户端和服务端使用统一的接口进行通信，两端都可以用各自的编程语言进行编码，也可以对数据进行再加工，也就可以分工.</li></ol><h2 id=\"微博restful介绍-现在打开api测试工具不太管用了\"><a class=\"anchor\" href=\"#微博restful介绍-现在打开api测试工具不太管用了\">#</a> 微博 Restful 介绍，现在打开 API 测试工具不太管用了</h2><p>国内微博率先使用 RESTful 构架，并且还公开了开放平台。微博开放平台一些操作.<br>微博开放平台: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcGVuLndlaWJvLmNvbS8=\">https://open.weibo.com/</span></p><ol><li>选择 chrome 浏览器进入之后可选择上面的 <code>文档</code> ，然后选择左边的 <code>微博API</code> 查看相应接口</li><li>随便选择一个接口点击进入，点击 <code>API测试工具</code> 没反应，可以鼠标右击 <code>API测试工具</code> 选择 <code>检查N</code> , 点开 &lt;p&gt;&lt;/p &gt; 标签，然后点击里面的链接地址，可以打开 API 测试工具.<br><img data-src=\"1.PNG\" alt=\"\"></li></ol><h2 id=\"flask\"><a class=\"anchor\" href=\"#flask\">#</a> <strong>Flask</strong></h2><p>Flask 官网: <span class=\"exturl\" data-url=\"aHR0cDovL2ZsYXNrLnBvY29vLm9yZy8=\">http://flask.pocoo.org/</span><br>Flask 中文版: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3Jtb3VzZWhvbGUucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0Lw==\">https://dormousehole.readthedocs.io/en/latest/</span><br>Flask 支持的扩展插件: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9mbGFzay5wYWxsZXRzcHJvamVjdHMuY29tL2VuLzEuMS54L2V4dGVuc2lvbnMv\">https://flask.palletsprojects.com/en/1.1.x/extensions/</span></p><h2 id=\"工具介绍\"><a class=\"anchor\" href=\"#工具介绍\">#</a> 工具介绍</h2><p>将一串 json 转换为有缩进的格式<br><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYm9vdGNkbi5jbi9qc29ubGludC8=\">https://www.bootcdn.cn/jsonlint/</span></p><h2 id=\"github-api-schema\"><a class=\"anchor\" href=\"#github-api-schema\">#</a> github API schema</h2><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My8jc2NoZW1h\">https://developer.github.com/v3/#schema</span><br>Schema<br>All API access is over HTTPS, and accessed from <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcGkuZ2l0aHViLmNvbQ==\">https://api.github.com</span>. All data is sent and received as JSON.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> -i https://api.github.com/users/octocat/orgs</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  HTTP/1.1 <span class=\"token number\">200</span> OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  Server: nginx</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  Date: Fri, <span class=\"token number\">12</span> Oct <span class=\"token number\">2012</span> <span class=\"token number\">23</span>:33:14 GMT</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  Content-Type: application/json<span class=\"token punctuation\">;</span> <span class=\"token assign-left variable\">charset</span><span class=\"token operator\">=</span>utf-8</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  Connection: keep-alive</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  Status: <span class=\"token number\">200</span> OK</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  ETag: <span class=\"token string\">\"a00049ba79152d03380c34652f2cb612\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  X-GitHub-Media-Type: github.v3</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  X-RateLimit-Limit: <span class=\"token number\">5000</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  X-RateLimit-Remaining: <span class=\"token number\">4987</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  X-RateLimit-Reset: <span class=\"token number\">1350085394</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  Content-Length: <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  Cache-Control: max-age<span class=\"token operator\">=</span><span class=\"token number\">0</span>, private, must-revalidate</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  X-Content-Type-Options: nosniff</pre></td></tr></table></figure><h2 id=\"simple-samples\"><a class=\"anchor\" href=\"#simple-samples\">#</a> Simple Samples</h2><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"><span>s</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> Flask</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>app <span class=\"token operator\">=</span> <span class=\"token function\">Flask</span><span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>@app<span class=\"token punctuation\">.</span><span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>def <span class=\"token function\">hello_world</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"Hello World!!!\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>@app<span class=\"token punctuation\">.</span><span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/index/&lt;user>'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>def <span class=\"token function\">hello_user</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"Hello %s\"</span> <span class=\"token operator\">%</span> user</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>@app<span class=\"token punctuation\">.</span><span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/productpage'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>def <span class=\"token function\">hello_productpage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"Hello productpage!!!\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre># <span class=\"token constant\">POST</span>方法浏览器输入出错可以通过命令行方式访问<span class=\"token punctuation\">,</span> 如下指定<span class=\"token constant\">POST</span>方式访问</pre></td></tr><tr><td data-num=\"18\"></td><td><pre># pipenv shell</pre></td></tr><tr><td data-num=\"19\"></td><td><pre># python app<span class=\"token punctuation\">.</span>py</pre></td></tr><tr><td data-num=\"20\"></td><td><pre># curl <span class=\"token operator\">-</span><span class=\"token constant\">X</span> <span class=\"token constant\">POST</span> <span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token operator\">:</span><span class=\"token number\">9900</span><span class=\"token operator\">/</span>index <span class=\"token operator\">--</span>noproxy <span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>@app<span class=\"token punctuation\">.</span><span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/index'</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>def <span class=\"token function\">hello_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"Hello POST Methods!!!\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    app<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>host<span class=\"token operator\">=</span><span class=\"token string\">'127.0.0.1'</span><span class=\"token punctuation\">,</span> port<span class=\"token operator\">=</span><span class=\"token number\">9900</span><span class=\"token punctuation\">,</span> debug<span class=\"token operator\">=</span>True<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"教程视频\"><a class=\"anchor\" href=\"#教程视频\">#</a> 教程视频</h2><p>Restful API</p><p>NodeJS: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMUtFNDExajdXWD9wPTQ=\">https://www.bilibili.com/video/BV1KE411j7WX?p=4</span><br>NodeJS: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMUhoNDExWjdSYT9mcm9tPXNlYXJjaCZhbXA7c2VpZD0xODA0MDkzNzYyMzgwOTI0MzYzNg==\">https://www.bilibili.com/video/BV1Hh411Z7Ra?from=search&amp;seid=18040937623809243636</span><br>python Flask:\t<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMVJmNHkxMjdDeT9wPTY=\">https://www.bilibili.com/video/BV1Rf4y127Cy?p=6</span><br>java: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMWV0NDExVDdTUz9wPTg=\">https://www.bilibili.com/video/BV1et411T7SS?p=8</span><br>java Spring boot: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdHVkeS4xNjMuY29tL2NvdXJzZS9pbnRyb2R1Y3Rpb24uaHRtP2NvdXJzZUlkPTEwMDUyMTMwMzQjL2NvdXJzZURldGFpbD90YWI9MQ==\">https://study.163.com/course/introduction.htm?courseId=1005213034#/courseDetail?tab=1</span></p><!-- rebuild by hrmmi -->",
            "tags": [
                "technologies",
                "restful"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/05/31/technologies/git/git_commands/",
            "url": "https://kung-fu-master.github.io/2021/05/31/technologies/git/git_commands/",
            "title": "git commands",
            "date_published": "2021-05-31T03:28:46.161Z",
            "content_html": "<!-- build time:Mon May 31 2021 11:38:18 GMT+0800 (中国标准时间) --><h2 id=\"git-放弃本地修改\"><a class=\"anchor\" href=\"#git-放弃本地修改\">#</a> <strong>git 放弃本地修改</strong></h2><p><strong>1. 未使用 git add 缓存代码时</strong></p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> pull</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> checkout -- <span class=\"token operator\">&lt;</span>filePathName<span class=\"token operator\">></span> // <span class=\"token function\">git</span> checkout -- README.md</pre></td></tr></table></figure><p>但是此命令不会删除掉刚新建的文件。因为刚新建的文件还没已有加入到 git 的管理系统中。所以对于 git 是未知的。自己手动删除就好了.<br><strong>2. 已经使用了 git add 缓存了代码</strong></p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> pull</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> reset HEAD <span class=\"token operator\">&lt;</span>filePathName<span class=\"token operator\">></span> // <span class=\"token function\">git</span> reset HEAD readme.md</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 放弃所以的缓存可以使用如下命令:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">git</span> reset HEAD <span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p>此命令用来清除 git 对于文件修改的缓存。相当于撤销 git add 命令所在的工作。在使用本命令后，本地的修改并不会消失，而是回到了如（1）所示的状态。继续用（1）中的操作，就可以放弃本地的修改.<br><strong>3. 已经用 git commit 提交了代码</strong></p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> pull</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> reset --hard HEAD^\t// 回退到上一次commit的状态</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 回退到任意版本</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">git</span> log\t\t\t// 查看git的提交历史</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">git</span> reset --hard <span class=\"token operator\">&lt;</span>commitid<span class=\"token operator\">></span>\t//</pre></td></tr></table></figure><h2 id=\"git-创建新的分支\"><a class=\"anchor\" href=\"#git-创建新的分支\">#</a> <strong>git 创建新的分支</strong></h2><p>1. 使用 git bash 进入到已有项目根目录下，执行如下命令创建分支</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> checkout -b dev-01\t// 此命令相当于<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">git</span> branch dev-01<span class=\"token punctuation\">;</span> <span class=\"token function\">git</span> checkout dev-01<span class=\"token punctuation\">;</span><span class=\"token variable\">`</span></span></pre></td></tr></table></figure><p>2. 查看当前分支</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> branch</pre></td></tr></table></figure><p>它就会有如下显示：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>* dev-01</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  master</pre></td></tr></table></figure><p>3. 将新建分支提交到远程仓库，远程会自动生成同名新分支</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> push origin dev-01</pre></td></tr></table></figure><p>4. 拉取远程分支，但会发现提示没有指定要与哪个分支合并，无法与远程仓库进行关联，所以需要先关联，后拉取</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> branch --set-upstream-to<span class=\"token operator\">=</span>origin/dev-01</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> pull</pre></td></tr></table></figure><p>查看关联情况</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> branch -vv</pre></td></tr></table></figure><ol start=\"5\"><li>最后把本地代码推上去</li></ol><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> <span class=\"token function\">add</span> *</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> commit -m <span class=\"token string\">'your commit info'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">git</span> push origin dev-01</pre></td></tr></table></figure><ol start=\"6\"><li>切换分支执行上面命令后，查看远端 github 仓库新分支仍然有源分支文件，可以:</li></ol><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> <span class=\"token function\">rm</span> <span class=\"token operator\">&lt;</span>源文件<span class=\"token punctuation\">(</span>夹<span class=\"token punctuation\">)</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> commit -m <span class=\"token string\">\"*\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">git</span> push origin dev-01</pre></td></tr></table></figure><h2 id=\"git-切换分支\"><a class=\"anchor\" href=\"#git-切换分支\">#</a> <strong>git 切换分支</strong></h2><ol><li>查看远程分支</li></ol><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> branch -a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  * master</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  remotes/origin/HEAD -<span class=\"token operator\">></span> origin/master</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  remotes/origin/v0.9rc1</pre></td></tr></table></figure><ol start=\"2\"><li>查看本地分支</li></ol><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> branch</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  * master</pre></td></tr></table></figure><ol start=\"3\"><li>切换分支</li></ol><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> pull\t//拉去远程分支最新的文件, 之后再此分支基础上创建新的分支</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> checkout -b v0.9rc1 origin/v0.9rc1\t//如果本地已经有v0.9rc1分支了就可以直接<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">git</span> checkout v0.9rc1<span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  Branch v0.9rc1 <span class=\"token builtin class-name\">set</span> up to track remote branch v0.9rc1 from origin.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  Switched to a new branch <span class=\"token string\">'v0.9rc1'</span></pre></td></tr></table></figure><p>已经切换到 v0.9rc1 分支了</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> branch</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  master</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  * v0.9rc1</pre></td></tr></table></figure><p>切换回 master 分支</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> checkout master</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  Switched to branch <span class=\"token string\">'master'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  Your branch is up-to-date with <span class=\"token string\">'origin/master'</span><span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><h2 id=\"分支的新建与合并\"><a class=\"anchor\" href=\"#分支的新建与合并\">#</a> <strong>分支的新建与合并</strong></h2><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXQtc2NtLmNvbS9ib29rL3poL3YyL0dpdC0lRTUlODglODYlRTYlOTQlQUYtJUU1JTg4JTg2JUU2JTk0JUFGJUU3JTlBJTg0JUU2JTk2JUIwJUU1JUJCJUJBJUU0JUI4JThFJUU1JTkwJTg4JUU1JUI5JUI2\">https://git-scm.com/book/zh/v2/Git - 分支 - 分支的新建与合并</span></p><h2 id=\"git-diff-加上颜色\"><a class=\"anchor\" href=\"#git-diff-加上颜色\">#</a> <strong>git diff 加上颜色</strong></h2><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> config --global color.diff auto</pre></td></tr></table></figure><p>其它方式:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> config color.ui <span class=\"token boolean\">true</span></pre></td></tr></table></figure><h3 id=\"git-diff-显示完整信息\"><a class=\"anchor\" href=\"#git-diff-显示完整信息\">#</a> <strong>git diff 显示完整信息</strong></h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> config --global core.pager <span class=\"token string\">\"less -r\"</span></pre></td></tr></table></figure><h3 id=\"git-status-加上颜色\"><a class=\"anchor\" href=\"#git-status-加上颜色\">#</a> <strong>git status 加上颜色</strong></h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> config --global color.status auto</pre></td></tr></table></figure><h3 id=\"git-branch-加上颜色\"><a class=\"anchor\" href=\"#git-branch-加上颜色\">#</a> <strong>git branch 加上颜色</strong></h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> config --global color.branch auto</pre></td></tr></table></figure><h3 id=\"interactive-加上颜色\"><a class=\"anchor\" href=\"#interactive-加上颜色\">#</a> <strong>interactive 加上颜色</strong></h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> config --global color.interactive auto</pre></td></tr></table></figure><h2 id=\"git-reset到指定commit-log\"><a class=\"anchor\" href=\"#git-reset到指定commit-log\">#</a> <strong>git reset 到指定 commit log</strong></h2><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> log</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> reset --hard <span class=\"token operator\">&lt;</span>Commit-ID<span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"git-创建-merge-request\"><a class=\"anchor\" href=\"#git-创建-merge-request\">#</a> <strong>git 创建 merge request</strong></h2><ol><li>切换到要修改的分支</li></ol><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> checkout -b <span class=\"token operator\">&lt;</span>BRANCH<span class=\"token operator\">></span> origin/<span class=\"token operator\">&lt;</span>BRANCH<span class=\"token operator\">></span></pre></td></tr></table></figure><ol start=\"2\"><li>再要修改的分支基础上，创建新的分支，此时不要修改原要修改分支的文件</li></ol><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> checkout -b <span class=\"token operator\">&lt;</span>NEW-BRANCH-NAME<span class=\"token operator\">></span></pre></td></tr></table></figure><ol start=\"3\"><li>修改文件然后把新建的分支 <code>push</code> 到远程仓库</li></ol><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token operator\">&lt;</span>FILE<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> commit -m <span class=\"token string\">\"&lt;COMMENTS>\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">git</span> push origin <span class=\"token operator\">&lt;</span>NEW-BRANCH-NAME<span class=\"token operator\">></span></pre></td></tr></table></figure><ol start=\"4\"><li>登陆 gitlab, 选择左边的 Merge Requests<br><img data-src=\"merge_request_01.JPG\" alt=\"\"><br><img data-src=\"merge_request_02.JPG\" alt=\"\"><br><img data-src=\"merge_request_03.JPG\" alt=\"\"><br>之后填写 <code>Title</code> , <code>Description</code> , <code>Assignee</code> (选择自己).<br><code>Approval rules</code> 是要几个人 review 并 approve 之后才能 merge 成功，默认是 2 个人，可以改为 1 个人或更多.<br><img data-src=\"merge_request_04.JPG\" alt=\"\"><br>如果没有 <code>approval rule</code> 可以新建.<br><img data-src=\"merge_request_05.JPG\" alt=\"\"><br><img data-src=\"merge_request_06.JPG\" alt=\"\"><br><img data-src=\"merge_request_07.JPG\" alt=\"\"></li></ol><p>之后勾选 merge 成功后删除新建的分支.</p><p>reviewer 可以查看 commits 或 Changes, 如果有疑问可以提交 commits 通知提交 merge request 的自己修改.</p><ol start=\"5\"><li>可以 reviewer 或自己点击 merge 按钮进行 merge 并删除新建的分支<br><img data-src=\"merge_request_08.JPG\" alt=\"\"></li></ol><h2 id=\"git-删除-untracked-files\"><a class=\"anchor\" href=\"#git-删除-untracked-files\">#</a> **git 删除 untracked files **</h2><p>删除 untracked files</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> clean -f</pre></td></tr></table></figure><p>连 untracked 的目录也一起删掉</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> clean -fd</pre></td></tr></table></figure><h2 id=\"git-clone-到指定本地目录\"><a class=\"anchor\" href=\"#git-clone-到指定本地目录\">#</a> <strong>git clone 到指定本地目录</strong></h2><p>clone 项目到本地的 <code>themes/stun</code> 目录</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> clone https://github.com/liuyib/hexo-theme-stun.git themes/stun</pre></td></tr></table></figure><h2 id=\"删除新建的分支\"><a class=\"anchor\" href=\"#删除新建的分支\">#</a> 删除新建的分支</h2><p>git 删除本地分支</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> branch -D br</pre></td></tr></table></figure><p>git 删除远程分支</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> push origin :br  <span class=\"token punctuation\">(</span>origin 后面有空格<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><!-- rebuild by hrmmi -->",
            "tags": [
                "technologies",
                "git",
                "git"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/05/31/technologies/security/openssl_certificates/",
            "url": "https://kung-fu-master.github.io/2021/05/31/technologies/security/openssl_certificates/",
            "title": "openssl certificates",
            "date_published": "2021-05-31T03:28:46.161Z",
            "content_html": "<!-- build time:Mon May 31 2021 11:38:18 GMT+0800 (中国标准时间) --><h2 id=\"x509证书标准定义的两种编码格式pem和der\"><a class=\"anchor\" href=\"#x509证书标准定义的两种编码格式pem和der\">#</a> X.509 证书标准定义的两种编码格式 PEM 和 DER</h2><h2 id=\"pem编码privacy-enhanced-mail\"><a class=\"anchor\" href=\"#pem编码privacy-enhanced-mail\">#</a> PEM 编码 (Privacy Enhanced Mail)</h2><p>特点：纯文本文件，以 -----BEGIN CERTIFICATE----- 开头，以 -----END CERTIFICATE----- 结尾，<br>内容是 base64 编码。但使用文本编辑器只能查看表面的结构，需要输入命令例如</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 -in 某个PEM格式数字证书.pem -text -noout</pre></td></tr></table></figure><p>才能看到原始的数字证书信息.</p><pre><code>-----BEGIN CERTIFICATE-----\nMIID7TCCAtWgAwIBAgIJAOIRDhOcxsx6MA0GCSqGSIb3DQEBCwUAMIGLMQswCQYD\n……\nxAJz+w8tjrDWcf826VN14IL+/Cmqlg/rIfB5CHdwVIfWwpuGB66q/UiPegZMNs8a\n3g==\n-----END CERTIFICATE-----\n</code></pre><h2 id=\"der编码distinguished-encoding-rules\"><a class=\"anchor\" href=\"#der编码distinguished-encoding-rules\">#</a> DER 编码 (Distinguished Encoding Rules)</h2><p>特点：二进制文件格式，一般应使用 Windows/Java 开发工具打开，也可以使用 openssl 命令行工具提取其中信息或进行编码转换.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 -in 某个DER格式的数字证书.der -inform der -text -noout</pre></td></tr></table></figure><p>上面这个命令查看二进制文件中的证书信息.</p><h2 id=\"文件扩展名\"><a class=\"anchor\" href=\"#文件扩展名\">#</a> 文件扩展名</h2><p>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;&lt;font face=&quot;fantasy&quot; size=4 &gt; 我们身边有很多常见的数字证书文件，他们的扩展名通常既不叫 &quot;.pem&quot; 也不叫 &quot;.der&quot;, 但无论扩展名是什么，其内部编码格式只能从 PEM 和 DER 这两种编码格式中选择一种.&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;<br>不同平台所偏好的编码格式不同，不同类型的数字证书文件中存储的内容也略有差别，不过对于大部分证书文件，我们都可以借助命令行工具随时将其转换成另一种编码格式.</p><ul><li><strong>CRT</strong> - CRT 应该是 certificate 的三个字母，其实还是证书的意思，常见于 NIX 系统，有可能是 PEM 编码，也有可能是 DER 编码，大多数应该是 PEM 编码，相信你已经知道怎么辨别. <strong>证书内容包含: signer (如 CA:kubernetes), 个人信息，过期时间，公钥 public key, 加密算法 (非对称加密算法 RSA2048, 对称机密算法 AES256 等), 签名算法 (sign algorithm) 等信息.</strong></li><li><strong>KEY</strong> - 通常用来存放一个公钥或者私钥，并非 X.509 证书，编码同样的，可能是 PEM, 也可能是 DER.<br>查看 KEY 的办法:</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl rsa -in mykey.key -text -noout</pre></td></tr></table></figure><p>如果是 DER 格式的话，同理应该这样了:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl rsa -in mykey.key -text -noout -inform der</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /home/zhan/istio-1.6.0/samples/certs/</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>openssl x509 -in root-cert.pem -text -noout</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  Signature Algorithm: sha256WithRSAEncryption</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>$ openssl x509 -in root-cert.pem -text -noout <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> Validity -A <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  Validity</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>          Not Before: Jan <span class=\"token number\">24</span> <span class=\"token number\">19</span>:15:51 <span class=\"token number\">2018</span> GMT</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>          Not After <span class=\"token builtin class-name\">:</span> Dec <span class=\"token number\">31</span> <span class=\"token number\">19</span>:15:51 <span class=\"token number\">2117</span> GMT</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>-A n这样的shell写法，输出当前行之后的n行内容</pre></td></tr></table></figure><ul><li><strong>CSR - Certificate Signing Request</strong>, 即证书签名请求，这个并不是证书，而是向权威证书颁发机构获得签名证书的申请，其核心内容是一个<strong>公钥和个人信息</strong>，在生成这个申请的时候，要对应生成的有一个私钥，私钥要自己保管好，client 端把包含 public key 的 csr 文件发给 CA, 用 CA 的 private key 给 csr 文件做签名 (sign) 生成 client 端证书. <strong>CSR 文件</strong>内容一般包含: <strong>个人信息，公钥 public key, 加密算法 (非对称加密算法 RSA2048, 对称机密算法 AES256 等), 签名算法 (sign algorithm) 等信息.</strong><br>查看的办法:</li></ul><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl req -noout -text -in my.csr</pre></td></tr></table></figure><p>(如果是 DER 格式的话照旧命令行加上 - inform der, 这里不写了)</p><h2 id=\"证书编码的转换\"><a class=\"anchor\" href=\"#证书编码的转换\">#</a> <strong>证书编码的转换</strong></h2><p>・PEM 转为 DER：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 -in cert.crt -outform der -out cert.der</pre></td></tr></table></figure><p>・DER 转为 PEM：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 -in cert.crt -inform der -outform pem -out cert.pem</pre></td></tr></table></figure><h2 id=\"获得证书的步骤\"><a class=\"anchor\" href=\"#获得证书的步骤\">#</a> <strong>获得证书的步骤</strong></h2><p>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;・向权威证书颁发机构申请证书 &lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;<br>用以下命令生成一个 csr:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl req -newkey rsa:2048 -new -nodes -keyout my.key -out my.csr</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  my.csr  my.key</pre></td></tr></table></figure><p>把<strong> csr</strong> 交给权威证书颁发机构，权威证书颁发机构对此进行签名，完成。保留好 csr,<strong> 当权威证书颁发机构颁发的证书过期的时候，你还可以用同样的 csr 来申请新的证书，key 保持不变.</strong></p><p>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;・或者生成自签名的证书 &lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl req -newkey rsa:2048 -new -nodes -x509 -days <span class=\"token number\">3650</span> -keyout key.pem -out cert.pem</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  cert.pem  key.pem</pre></td></tr></table></figure><p>在生成证书的过程中会要你填一堆的东西，其实真正要填的只有 Common Name, 通常填写你服务器的域名，如 &quot;<span class=\"exturl\" data-url=\"aHR0cDovL3lvdXJjb21wYW55LmNvbQ==\">yourcompany.com</span>&quot;, 或者你服务器的 IP 地址，其它都可以留空的.<br>生产环境中还是不要使用自签的证书，否则浏览器会不认，或者如果你是企业应用的话能够强制让用户的浏览器接受你的自签证书也行。向权威机构要证书通常是要钱的，但现在也有免费的，仅仅需要一个简单的域名验证即可。有兴趣的话查查 &quot;沃通数字证书&quot;.</p><h2 id=\"生成证书\"><a class=\"anchor\" href=\"#生成证书\">#</a> <strong>生成证书</strong></h2><h3 id=\"一生成ca证书\"><a class=\"anchor\" href=\"#一生成ca证书\">#</a> <strong>一：生成 CA 证书</strong></h3><p>目前不使用第三方权威机构的 CA 来认证，自己充当 CA 的角色。<br>网上下载一个 openssl 软件<br>1. 创建私钥：<br>通常是 rsa 算法<br>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;<strong>ca-key.pem</strong>&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl genrsa -out ca/ca-key.pem <span class=\"token number\">2048</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 查看 key</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>openssl rsa -in ca/ca-key.pem -text -noout</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 如果是 DER 格式的话，同理应该这样</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>openssl rsa -in ca/ca-key.pem -text -noout -inform der</pre></td></tr></table></figure><p>2. 创建证书请求：</p><blockquote><p>因此在用户向 CA 申请数字证书时，用户首先需要在自己的电脑中先产生一个公私钥对。用户需要保管好自己的私钥，然后再把公钥和你的个人信息发送给 CA 机构，CA 机构通过你的公钥和个人信息最终签发出数字证书。<br>而 CSR 文件，其实就是包含了用户公钥和个人信息的一个数据文件。用户产生出这个 CSR 文件，再把这个 CSR 文件发送给 CA，CA 就会根据 CSR 中的内容来签发出数字证书。</p></blockquote><p>在制作 csr 文件的时，必须使用自己的私钥来签署申，还可以设定一个密钥.<br>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;<strong>ca-req.csr</strong>&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl req -new -out ca/ca-req.csr -key ca/ca-key.pem</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  Country Name <span class=\"token punctuation\">(</span><span class=\"token number\">2</span> letter code<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>AU<span class=\"token punctuation\">]</span>:cn</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  State or Province Name <span class=\"token punctuation\">(</span>full name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Some-State<span class=\"token punctuation\">]</span>:zhejiang</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  Locality Name <span class=\"token punctuation\">(</span>eg, city<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>:hangzhou</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  Organization Name <span class=\"token punctuation\">(</span>eg, company<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Internet Widgits Pty Ltd<span class=\"token punctuation\">]</span>:skyvision</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  Organizational Unit Name <span class=\"token punctuation\">(</span>eg, section<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>:test</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  Common Name <span class=\"token punctuation\">(</span>eg, YOUR name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>:root</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  Email Address <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>:sky</pre></td></tr></table></figure><p>3. 自签署证书 ：<br>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;<strong>ca/ca-cert.pem</strong>&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 -req -in ca/ca-req.csr -out ca/ca-cert.pem -signkey ca/ca-key.pem -days <span class=\"token number\">3650</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 查看证书格式:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>openssl x509 -in ca/ca-cert.pem -text -noout</pre></td></tr></table></figure><p>4. 将证书导出成浏览器支持的.p12 格式 ：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl pkcs12 -export -clcerts -in ca/ca-cert.pem -inkey ca/ca-key.pem -out ca/ca.p12</pre></td></tr></table></figure><p>密码：changeit</p><h3 id=\"二生成server证书\"><a class=\"anchor\" href=\"#二生成server证书\">#</a> <strong>二。生成 server 证书。</strong></h3><p>1. 创建私钥 ：<br>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;<strong>server/server-key.pem</strong>&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl genrsa -out server/server-key.pem <span class=\"token number\">2048</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 查看 key</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>openssl rsa -in server/server-key.pem -text -noout</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 如果是 DER 格式的话，同理应该这样</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>openssl rsa -in server/server-key.pem -text -noout -inform der</pre></td></tr></table></figure><p>2. 创建证书请求 ：<br>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;<strong>server/server-req.csr</strong>&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl req -new -out server/server-req.csr -key server/server-key.pem</pre></td></tr></table></figure><pre><code class=\"language-text\">Country Name (2 letter code) [AU]:cn\nState or Province Name (full name) [Some-State]:zhejiang\nLocality Name (eg, city) []:hangzhou\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:skyvision\nOrganizational Unit Name (eg, section) []:test\nCommon Name (eg, YOUR name) []:192.168.1.246 注释：一定要写服务器所在的ip地址\nEmail Address []:sky\n</code></pre><p>查看 csr 文件内容:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl req -in server-req.csr -text -noout // -noout 不用输出csr文件原始内容</pre></td></tr></table></figure><pre><code class=\"language-text\">Certificate Request:\n    Data:\n        Version: 0 (0x0)\n        Subject: C=XX, L=Default City, O=Default Company Ltd, CN=10.239.140.186\n        Subject Public Key Info:\n            Public Key Algorithm: rsaEncryption\n                Public-Key: (2048 bit)\n                Modulus:\n                    00:e2:0c:a7:33:33:d9:9b:90:1b:29:30:3c:81:31:\n                    09:97:0a:a9:76:d5:54:be:63:17:21:0c:b9:3a:f0:\n                    a6:02:37:1a:d4:1e:53:4e:e0:c8:d9:5f:27:57:7f:\n                    f3:eb:7f:9d:ad:79:d6:e7:40:64:c8:bc:3d:f3:b4:\n                    16:d6:30:e9:16:04:b6:a0:0e:8f:75:e4:4b:d6:8e:\n                    0a:8e:75:d8:41:89:09:90:96:b0:8d:32:5f:b5:96:\n                    1d:65:d6:a6:b4:c7:eb:3d:3b:f9:62:36:69:7d:07:\n                    6d:05:89:ce:a6:a5:98:a0:b2:5f:ab:bc:25:ba:08:\n                    d8:86:0a:b9:c0:91:ca:f8:d3:bb:36:14:21:f9:c2:\n                    b5:53:43:a9:2c:03:39:9b:93:ef:1d:d9:20:ef:dd:\n                    ff:57:c6:b5:47:e8:bb:46:32:e3:1d:3b:2e:5b:15:\n                    11:80:72:f6:2e:f5:b2:cc:02:7f:b1:d6:e9:3d:8e:\n                    0e:66:f6:6d:45:0e:2f:8c:d5:c3:92:dc:a1:9a:d9:\n                    b0:33:82:30:69:0a:05:ee:08:1b:a6:81:f4:bb:31:\n                    0d:fa:26:37:eb:4f:c8:58:df:e5:be:cc:ac:9a:62:\n                    42:f1:af:8c:35:88:e4:f3:b4:76:8f:6c:13:1f:9a:\n                    61:e0:08:0f:f2:b1:d6:f3:61:b4:0a:5d:9a:61:5f:\n                    e1:0b\n                Exponent: 65537 (0x10001)\n        Attributes:\n            a0:00\n    Signature Algorithm: sha256WithRSAEncryption\n         5b:62:35:07:43:99:dc:af:7c:61:1e:76:4e:f8:ef:59:b2:27:\n         60:71:30:15:5d:f3:0b:b1:b4:53:29:ec:d1:7c:18:48:0a:b3:\n         fe:b7:6d:80:ef:dc:c6:24:04:3d:bd:c1:b8:61:49:f3:1e:fb:\n         22:0f:fb:06:99:ec:db:18:ac:34:ff:4b:15:f8:84:06:01:4d:\n         68:4f:0c:a2:a5:34:dc:1b:61:44:c7:ff:ef:5d:92:a1:09:3f:\n         11:27:1c:a7:30:8e:97:6a:08:03:99:e6:6a:8f:1d:d6:ea:e7:\n         cd:18:a7:eb:36:3d:e7:6b:5e:ef:72:85:ca:eb:89:97:02:cf:\n         fc:38:31:58:e1:66:85:d1:e7:49:e2:72:ef:b1:60:36:55:d7:\n         90:bd:8d:0e:d8:c6:8f:d2:bf:bf:43:85:36:04:2e:f1:ec:5f:\n         d8:1b:17:22:a4:6a:de:a7:b2:2b:00:30:27:e6:4b:32:4d:55:\n         70:b0:61:3d:3f:f2:9d:e7:24:f6:4c:1f:bf:63:6a:d9:16:ef:\n         cb:91:a3:a4:43:b5:1f:11:85:ad:0e:b1:57:39:f2:0a:56:ec:\n         52:90:b0:11:96:c6:28:e0:de:0c:eb:f2:b1:66:ce:04:48:7f:\n         11:90:09:1d:fd:ca:a7:25:66:32:a2:64:33:1a:5e:a9:85:50:\n         8a:2d:90:a5\n</code></pre><p>3. 自签署证书 ：<br>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;<strong>server/server-cert.pem</strong>&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 -req -in server/server-req.csr -out server/server-cert.pem -signkey server/server-key.pem -CA ca/ca-cert.pem -CAkey ca/ca-key.pem -CAcreateserial -days <span class=\"token number\">3650</span></pre></td></tr></table></figure><ul><li>-CA 选项指明用于被签名的 csr 证书</li><li>-CAkey 选项指明用于签名的密钥</li><li>-CAcreateserial 指明文件不存在时自动生成</li></ul><p>查看证书格式:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 -in server/server-cert.pem -text -noout</pre></td></tr></table></figure><p>可以查看到证书里所包含的 public key 等相关信息:</p><pre><code>Certificate:\nData:\n    Version: 1 (0x0)\n    Serial Number:\n        cc:db:c0:f2:12:e8:09:27\nSignature Algorithm: sha256WithRSAEncryption\n    Issuer: C=XX, L=Default City, O=Default Company Ltd, CN=AI\t// 签发者(CA机构)\n    Validity\n        Not Before: Jul 16 07:01:18 2020 GMT\n        Not After : Jul 14 07:01:18 2030 GMT\n    Subject: C=XX, L=Default City, O=Default Company Ltd, CN=sky\n    Subject Public Key Info:\n        Public Key Algorithm: rsaEncryption\n            Public-Key: (2048 bit)\t\t\t// public key, 因此本地可以不需要再存储保留public key, 证书里已包含.\n            Modulus:\n                00:cd:d7:ed:e9:c6:5e:fa:bc:ef:1e:4e:92:52:99:\n                f0:34:96:67:7b:32:1b:f6:53:df:ca:7b:e5:72:6a:\n                29:e5:85:27:eb:71:00:c6:90:ac:c1:64:62:0d:2b:\n                b1:bc:b8:ee:e1:d4:54:b7:95:21:1e:de:56:c7:25:\n                4c:d4:2d:29:5f:48:19:8a:05:c4:33:d3:06:16:ec:\n                68:e2:81:07:cf:f9:d1:15:b2:68:3d:da:44:c3:d5:\n                ba:a3:0f:9e:34:34:71:53:4f:02:4b:eb:f8:de:fd:\n                94:3f:f4:ee:12:48:ea:b1:60:62:be:58:47:78:29:\n                59:5b:ae:57:53:23:31:aa:78:cc:6c:f0:f7:e9:76:\n                4a:b9:25:79:3f:9c:05:4e:f0:8e:87:32:df:87:72:\n                67:64:2e:9f:85:15:64:bf:ca:ce:33:71:ee:bb:1a:\n                d3:26:09:34:9b:65:b9:15:71:28:14:37:48:79:1b:\n                b1:99:a4:8c:cc:27:a1:a4:c4:28:8e:01:e5:08:db:\n                e6:45:6e:3d:d9:03:a9:cb:17:25:b7:c9:c9:4b:fb:\n                e5:93:d1:de:31:fe:a9:34:29:c3:29:a4:27:c2:eb:\n                66:99:c6:db:ba:52:07:30:97:d4:0a:1e:1b:5d:72:\n                f6:ff:19:92:22:c0:44:76:74:f7:a7:0d:c5:77:c8:\n                1c:55\n            Exponent: 65537 (0x10001)\nSignature Algorithm: sha256WithRSAEncryption\n     28:d1:d9:29:a5:40:f3:d3:d6:95:87:fd:2c:70:dc:0f:1c:86:\n     08:35:d0:a8:8e:d0:5d:78:28:ae:88:33:61:db:cd:b6:80:1c:\n     88:62:b8:ce:cf:87:14:15:bd:27:9a:3e:77:cb:a1:e0:11:0d:\n     89:ef:f2:e8:b2:2c:cf:96:26:bd:06:3a:7b:8f:4b:fa:b2:c3:\n     f9:14:3e:18:ef:57:b5:37:95:01:a0:0f:bf:6e:5c:c9:47:7b:\n     1a:ed:ca:7a:31:a1:89:e8:0d:4d:95:d2:61:e3:b8:48:e5:86:\n     19:91:3e:00:86:07:50:df:e2:57:29:69:61:c4:cc:55:8f:60:\n     de:20:c1:0d:7d:c7:98:52:f4:34:08:90:c5:90:34:ec:86:0f:\n     ad:9b:e7:1a:d4:7b:d9:dd:59:82:de:54:d3:87:8e:e7:82:ae:\n     22:70:cf:e7:d7:8c:f1:55:57:6d:41:e6:44:3c:83:b7:73:7e:\n     9a:d5:1d:af:72:e9:4e:88:d4:4f:9f:33:2f:dc:1b:50:10:8b:\n     db:cd:e4:0e:e6:96:cd:c6:27:c7:4b:c7:9f:05:74:32:35:7e:\n     99:78:36:30:ae:78:4b:c3:1a:6b:b8:db:62:23:b8:ab:22:11:\n     11:81:95:5d:46:f0:45:15:77:1f:6b:c0:bf:9d:a2:d2:b4:62:\n     c9:b5:2b:dd\n</code></pre><p>4. 将证书导出成浏览器支持的.p12 格式 ：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl pkcs12 -export -clcerts -in server/server-cert.pem -inkey server/server-key.pem -out server/server.p12</pre></td></tr></table></figure><p>密码：changeit</p><p>Additional：<br>因为 server 端的证书是由 CA 的 private key 签名 (sign) server 端的 public key 及其持有者的真实身份得到的，因此 server 端证书里就包含 server 的 public key.<br>就不需要用 Openssl 生成 server 端的 public key. 用 server 端的 **csr（certificate signing requests）** 生成 server 证书即可. client 端也一样.<br>client 端只需要用 CA 的 public key (CA 的 public key 所有人都能获取) 解密 server 端存放在 CA 的证书文件就可以得到 Server 端的 public key.<br>然后 client 端就可以用解密得到的 server 端的 public key 对 server 端用自身 private key 加密的信息附带的摘要 A (digest) 进行解密.<br>client 端将 server 端发过来的信息用 Hash 得到摘要 B (digest) 与解密得到的摘要 A (digest) 对比，如果一直则说明信息没有被黑客篡改.<br>如果中间黑客把 server 端加密的摘要 A (digest) 修改了，则 client 用从 CA 的 public key 解密得到的 server 端的 public key 是解不开摘要 A (digest) 的，说明摘要信息被黑客篡改，内容不可靠.</p><p>如果要生成 RSA 公钥，command 如下:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl rsa -in server/server-key.pem -pubout -out server/server-public-key.pem</pre></td></tr></table></figure><h3 id=\"三生成client证书\"><a class=\"anchor\" href=\"#三生成client证书\">#</a> <strong>三。生成 client 证书。</strong></h3><p>1. 创建私钥 ：<br>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;<strong>client/client-key.pem</strong>&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl genrsa -out client/client-key.pem <span class=\"token number\">2048</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 查看 key</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>openssl rsa -in client/client-key.pem -text -noout</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 如果是 DER 格式的话，同理应该这样</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>openssl rsa -in client/client-key.pem -text -noout -inform der</pre></td></tr></table></figure><p>2. 创建证书请求 ：<br>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;<strong>client/client-req.csr</strong>&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl req -new -out client/client-req.csr -key client/client-key.pem</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  Country Name <span class=\"token punctuation\">(</span><span class=\"token number\">2</span> letter code<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>AU<span class=\"token punctuation\">]</span>:cn</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  State or Province Name <span class=\"token punctuation\">(</span>full name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Some-State<span class=\"token punctuation\">]</span>:zhejiang</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  Locality Name <span class=\"token punctuation\">(</span>eg, city<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>:hangzhou</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  Organization Name <span class=\"token punctuation\">(</span>eg, company<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Internet Widgits Pty Ltd<span class=\"token punctuation\">]</span>:skyvision</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  Organizational Unit Name <span class=\"token punctuation\">(</span>eg, section<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>:test</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  Common Name <span class=\"token punctuation\">(</span>eg, YOUR name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>:sky</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  Email Address <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>:sky 注释：就是登入中心的用户（本来用户名应该是Common Name，但是中山公安的不知道为什么使用的Email Address，其他版本没有测试）</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  Please enter the following ‘extra’ attributes</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  to be sent with your certificate request</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  A challenge password <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>:123456</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  An optional company name <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>:tsing</pre></td></tr></table></figure><p>3. 自签署证书 ：<br>&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#54FF9F&gt;<strong>client/client-cert.pem</strong>&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 -req -in client/client-req.csr -out client/client-cert.pem -signkey client/client-key.pem -CA ca/ca-cert.pem -CAkey ca/ca-key.pem -CAcreateserial -days <span class=\"token number\">3650</span></pre></td></tr></table></figure><ul><li>-CA 选项指明用于被签名的 csr 证书</li><li>-CAkey 选项指明用于签名的密钥</li><li>-CAcreateserial 指明文件不存在时自动生成</li></ul><p>查看证书格式:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 -in client/client-cert.pem -text -noout</pre></td></tr></table></figure><p>4. 将证书导出成浏览器支持的.p12 格式 ：</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl pkcs12 -export -clcerts -in client/client-cert.pem -inkey client/client-key.pem -out client/client.p12</pre></td></tr></table></figure><p>密码：changeit</p><p>Additional. 生成 RSA 公钥:</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl rsa -in client/client-key.pem -pubout -out client/client-public-key.pem</pre></td></tr></table></figure><p>请一定严格根据里面的步骤来，待实验成功后，修改你自己想要修改的内容。我就是一开始没有安装该填写的来，结果生成的证书就无法配对成功。</p><h2 id=\"linux信任证书\"><a class=\"anchor\" href=\"#linux信任证书\">#</a> linux 信任证书</h2><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cp</span> *.pem /etc/pki/ca-trust/source/anchors/</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>update-ca-trust</pre></td></tr></table></figure><!-- rebuild by hrmmi -->",
            "tags": [
                "technologies",
                "security",
                "security"
            ]
        },
        {
            "id": "https://kung-fu-master.github.io/2021/05/31/storage/minio/minIO_06_KMS_k8s/",
            "url": "https://kung-fu-master.github.io/2021/05/31/storage/minio/minIO_06_KMS_k8s/",
            "title": "06 Deploy Vault, Consul, KES, MinIO on kubernetes",
            "date_published": "2021-05-31T03:28:46.161Z",
            "content_html": "<!-- build time:Mon May 31 2021 11:38:18 GMT+0800 (中国标准时间) --><h2 id=\"总览\"><a class=\"anchor\" href=\"#总览\">#</a> 总览</h2><p>Vault, Consul, KES, MinIO 都部署在 K8s.</p><h2 id=\"referenc-link\"><a class=\"anchor\" href=\"#referenc-link\">#</a> referenc link</h2><p>vault:<br><span class=\"exturl\" data-url=\"aHR0cDovL2RvY3MubWluaW8ub3JnLmNuL2RvY3MvbWFzdGVyL21pbmlvLWttcy1xdWlja3N0YXJ0LWd1aWRl\">http://docs.minio.org.cn/docs/master/minio-kms-quickstart-guide</span><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hhc2hpY29ycC92YXVsdC1oZWxtL2Jsb2IvbWFzdGVyL3ZhbHVlcy55YW1s\">https://github.com/hashicorp/vault-helm/blob/master/values.yaml</span><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5oYXNoaWNvcnAuY29tL3R1dG9yaWFscy92YXVsdC9rdWJlcm5ldGVzLXJhZnQtZGVwbG95bWVudC1ndWlkZT9pbj12YXVsdC9rdWJlcm5ldGVz\">https://learn.hashicorp.com/tutorials/vault/kubernetes-raft-deployment-guide?in=vault/kubernetes</span><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5oYXNoaWNvcnAuY29tL3R1dG9yaWFscy92YXVsdC90cm91Ymxlc2hvb3RpbmctdmF1bHQ/aW49dmF1bHQvb3BlcmF0aW9ucyNzZXJ2ZXItZ2F2ZS1odHRwLXJlc3BvbnNlLXRvLWh0dHBzLWNsaWVudA==\">https://learn.hashicorp.com/tutorials/vault/troubleshooting-vault?in=vault/operations#server-gave-http-response-to-https-client</span></p><p>KES:<br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pbmlvL2tlcw==\">https://github.com/minio/kes</span><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pbmlvL2tlcy9ibG9iL21hc3Rlci9Eb2NrZXJmaWxlLnJlbGVhc2U=\">https://github.com/minio/kes/blob/master/Dockerfile.release</span></p><h2 id=\"概念\"><a class=\"anchor\" href=\"#概念\">#</a> 概念</h2><p>MinIO 使用密钥管理系统（KMS）支持 SSE-S3。如果客户端请求 SSE-S3，或 启用了自动加密，则 MinIO 服务器会使用唯一的对象密钥对每个对象进行加密，该对象密钥受 KMS 管理的主密钥保护。</p><p>KMS 将 MinIO 作为面向应用程序的存储系统与安全密钥存储区分开，并且 可以由专门的安全团队进行管理。MinIO 通过我们的 KES project 支持常用的 KMS 实现，例如 Hashicorp Vault。 通过 KES，可以利用存储基础架构（MinIO 群集）水平扩展 KMS。 通常，MinIO-KMS 基础结构如下所示：</p><pre><code>     ┌─────────┐         ┌────────────┐         ┌─────────┐  \n     │  MinIO  ├─────────┤ KES Server ├─────────┤   KMS   │ \n     └─────────┘         └────────────┘         └─────────┘  \n</code></pre><p>当您将存储基础架构扩展到多个 MinIO 群集时，您的架构应如下所示：</p><pre><code>    ┌────────────┐\n    │ ┌──────────┴─┬─────╮          ┌────────────┐\n    └─┤ ┌──────────┴─┬───┴──────────┤ ┌──────────┴─┬─────────────────╮\n      └─┤ ┌──────────┴─┬─────┬──────┴─┤ KES Server ├─────────────────┤\n        └─┤   MinIO    ├─────╯        └────────────┘            ┌────┴────┐\n          └────────────┘                                        │   KMS   │\n                                                                └─────────┘\n</code></pre><p><strong><code>请注意</code> </strong>，所有 MinIO 群集均仅具有 <strong><code>其自己的</code> </strong>KES 实例的连接，而不能直接访问 Vault（作为一种可能的 KMS 实现）。 每个 KES 实例将处理 “其” MinIO 群集发出的所有加密 / 解密请求，从而使中央 KMS 实现不必处理 大量流量。相反，每个 KES 实例都将使用中央 KMS 实现作为安全密钥存储，并从中获取所需的主密钥。</p><p>该指南显示了如何使用 Hashicorp Vault 作为 KMS 实施来设置 MinIO-KMS 部署。 因此，它显示了如何设置和配置：</p><ul><li>Vault 服务器作为中央密钥库。</li><li>一个 KES 服务器实例，作为 MinIO 和保险柜之间的中间件。</li><li>MinIO 实例本身。</li></ul><div class=\"note info\"><p><strong><code>请注意,</code> </strong>为简便起见，本指南使用自签名证书。在生产部署中，应使用 由<span class=\"blue\"> “公共”</span>（例如，让我们加密）或组织内部的 CA 颁发的 X.509 证书。</p></div><p>本指南说明如何在同一台计算机上设置三台不同的服务器：</p><ul><li>Vault 服务器在 K8S 集群中为 <span class=\"exturl\" data-url=\"aHR0cHM6Ly92YXVsdC5kZXYuc3ZjLmNsdXN0ZXIubG9jYWw6ODIwMA==\">https://vault.dev.svc.cluster.local:8200</span></li><li>KES 服务器在 K8S 集群中为 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9rZXMtc3ZjLm1pbmlvLnN2Yy5jbHVzdGVyLmxvY2FsOjczNzM=\">https://kes-svc.minio.svc.cluster.local:7373</span></li><li>MinIO 在 K8s 上部署后 9000 映射到主机端口位 30007, K8S 集群中服务地址:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9taW5pby1obC1zdmMubWluaW8uc3ZjLmNsdXN0ZXIubG9jYWw=\">https://minio-hl-svc.minio.svc.cluster.local</span>; 映射到本地 30007 端口，所以本地 minio 服务地址为:<span class=\"exturl\" data-url=\"aHR0cHM6Ly8xMC4yMzkuMTQwLjczOjMwMDA3\">https://10.239.140.73:30007</span> or <span class=\"exturl\" data-url=\"aHR0cHM6Ly8xMjcuMC4wLjE6MzAwMDc=\">https://127.0.0.1:30007</span></li></ul><h2 id=\"download\"><a class=\"anchor\" href=\"#download\">#</a> Download</h2><p>安装 MinIO，KES 和 Vault。对于 MinIO，请参阅 MinIO 快速入门指南。然后安装 KES 并下载 适用于您的操作系统和平台的最新 Vault 二进制文件.</p><h3 id=\"vault\"><a class=\"anchor\" href=\"#vault\">#</a> Vault:</h3><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h 命令行提示符</span></figcaption><table><tr class=\"marked\"><td data-num=\"1\"></td><td data-command=\"$\"></td><td><pre><span class=\"token function\">wget</span> https://releases.hashicorp.com/vault/1.7.0-rc1/vault_1.7.0-rc1_linux_amd64.zip</pre></td></tr><tr class=\"marked\"><td data-num=\"2\"></td><td data-command=\"$\"></td><td><pre><span class=\"token function\">unzip</span> vault_1.7.0-rc1_linux_amd64.zip</pre></td></tr><tr class=\"marked\"><td data-num=\"3\"></td><td data-command=\"$\"></td><td><pre><span class=\"token function\">mv</span> vault /usr/local/bin/ <span class=\"token comment\"># 如果 cp 过去的话，下面启动 vault server 时候自动创建的 vault 文件夹会与此已存在的 vault 二进制文件冲突，因此直接 move 过去.</span></pre></td></tr><tr><td data-num=\"4\"></td><td data-command=\"\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td data-command=\"#\"></td><td><pre><span class=\"token comment\"># vault 可以在 Linux 系统上使用 mlock syscall 来防止 OS 将内存中的数据写入磁盘（交换）</span></pre></td></tr><tr><td data-num=\"6\"></td><td data-command=\"$\"></td><td><pre><span class=\"token function\">sudo</span> setcap <span class=\"token assign-left variable\">cap_ipc_lock</span><span class=\"token operator\">=</span>+ep <span class=\"token variable\"><span class=\"token variable\">$(</span>readlink -f <span class=\"token punctuation\">$(</span>which vault<span class=\"token punctuation\">)</span><span class=\"token variable\">)</span></span></pre></td></tr></table></figure><h3 id=\"kes\"><a class=\"anchor\" href=\"#kes\">#</a> KES:</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pbmlvL2tlcyNiaW5hcnktcmVsZWFzZXM=\">https://github.com/minio/kes#binary-releases</span></p><pre><code>wget https://github.com/minio/kes/releases/latest/download/kes-linux-amd64\nmv kes-linux-amd64 kes\nchmod +x kes\ncp kes /usr/local/bin/\nkes -h\n\n# KES 可以在Linux系统上使用 mlock syscall 来防止 OS 将内存中的数据写入磁盘（交换）\nsudo setcap cap_ipc_lock=+ep $(readlink -f $(which kes))\n</code></pre><h3 id=\"minio\"><a class=\"anchor\" href=\"#minio\">#</a> MinIO：</h3><pre><code>wget https://dl.min.io/server/minio/release/linux-amd64/minio\nchmod +x minio\ncp minio /usr/local/bin/\n</code></pre><h3 id=\"mc\"><a class=\"anchor\" href=\"#mc\">#</a> mc:</h3><pre><code>wget https://dl.min.io/client/mc/release/linux-amd64/mc\nchmod +x mc\n./mc --help\n</code></pre><h2 id=\"机器配置\"><a class=\"anchor\" href=\"#机器配置\">#</a> 机器配置</h2><table><thead><tr><th style=\"text-align:left\">IP</th><th style=\"text-align:left\">机器名</th><th style=\"text-align:left\">用途</th></tr></thead><tbody><tr><td style=\"text-align:left\">10.239.140.73</td><td style=\"text-align:left\">master</td><td style=\"text-align:left\">K8S 集群节点，master (去除污点), 部署 KMS, KES, MinIO 到 K8S 集群</td></tr><tr><td style=\"text-align:left\">10.239.131.157</td><td style=\"text-align:left\">laboratory</td><td style=\"text-align:left\">K8S 集群节点，master (去除污点)</td></tr></tbody></table><p>openssl 版本：</p><pre><code>$ openssl version -a\nOpenSSL 1.1.1j  16 Feb 2021\nbuilt on: Tue Mar 16 02:55:39 2021 UTC\nplatform: linux-x86_64\noptions:  bn(64,64) rc4(16x,int) des(int) idea(int) blowfish(ptr)\ncompiler: gcc -fPIC -pthread -m64 -Wa,--noexecstack -Wall -O3 -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_CPUID_OBJ -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DKECCAK1600_ASM -DRC4_ASM -DMD5_ASM -DAESNI_ASM -DVPAES_ASM -DGHASH_ASM -DECP_NISTZ256_ASM -DX25519_ASM -DPOLY1305_ASM -DZLIB -DNDEBUG\nOPENSSLDIR: &quot;/usr/local/openssl/ssl&quot;\nENGINESDIR: &quot;/usr/local/openssl/lib/engines-1.1&quot;\nSeeding source: os-specific\n</code></pre><h2 id=\"生成证书\"><a class=\"anchor\" href=\"#生成证书\">#</a> 生成证书</h2><h3 id=\"根证书\"><a class=\"anchor\" href=\"#根证书\">#</a> 根证书</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> pki</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">cd</span> pki</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>openssl genrsa -out <span class=\"token string\">\"root-ca.key\"</span> <span class=\"token number\">4096</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 注意，csr 里 subj 的 CN 会覆盖下面生成证书配置文件的 CN.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>openssl req -new -key <span class=\"token string\">\"root-ca.key\"</span> -out <span class=\"token string\">\"root-ca.csr\"</span> -sha512 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        -subj <span class=\"token string\">'/C=US/ST=CA/L=China/O=Hce/CN=Vault CA'</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">></span> <span class=\"token string\">\"root-ca.conf\"</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>[root_ca]</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>basicConstraints = critical,CA:TRUE,pathlen:1</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>keyUsage = critical, nonRepudiation, cRLSign, keyCertSign</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>subjectKeyIdentifier=hash</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>EOF</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>openssl x509 -req -days <span class=\"token number\">3650</span> -in <span class=\"token string\">\"root-ca.csr\"</span> -signkey <span class=\"token string\">\"root-ca.key\"</span> -sha512 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        -out <span class=\"token string\">\"root-ca.crt\"</span> -extfile <span class=\"token string\">\"root-ca.conf\"</span> -extensions root_ca</pre></td></tr></table></figure><p><strong><span class=\"blue\">&quot;-extensions root_ca&quot;</span></strong> 指向 minio-crt.conf 配置文件中的 <strong><span class=\"blue\">[root_ca]</span></strong>.</p><ul><li><p>CA 证书必须包含 **<span class=\"blue\">basicConstraints</span>** 值，且 CA 参数需为 TRUE。终端用户证书必须将 CA 参数设置为 FALSE，或者不包含 basicConstraints 值。</p></li><li><p><strong><span class=\"blue\">pathlen</span></strong> 参数指明了在证书链的当前证书之下允许存在的最大 CA 数量。当 CA 的 pathlen 值为 0 时，该 CA 仅能对终端用户证书进行签名，不能再对 CA 进行签名。</p></li></ul><h3 id=\"vault证书\"><a class=\"anchor\" href=\"#vault证书\">#</a> vault 证书</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 生成 vault 证书</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>openssl ecparam -genkey -name prime256v1 <span class=\"token operator\">|</span> openssl ec -out vault-server.key</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>openssl req -new  -key <span class=\"token string\">\"vault-server.key\"</span> -out <span class=\"token string\">\"vault-server.csr\"</span> -sha384 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        -subj <span class=\"token string\">'/C=US/ST=CA/L=China/O=Hce/CN=vault.dev.svc.cluster.local'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>openssl x509 -req -days <span class=\"token number\">30</span>  -in <span class=\"token string\">\"vault-server.csr\"</span> -CA <span class=\"token string\">\"root-ca.crt\"</span> -CAkey <span class=\"token string\">\"root-ca.key\"</span>  -CAcreateserial -out <span class=\"token string\">\"vault-server.crt\"</span> -extfile <span class=\"token string\">\"vault-crt.conf\"</span> -extensions vault_server</pre></td></tr></table></figure><p>vault-crt.conf 文件内容</p><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>vault_server<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>authorityKeyIdentifier=keyid<span class=\"token punctuation\">,</span>issuer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>basicConstraints = critical<span class=\"token punctuation\">,</span>CA<span class=\"token punctuation\">:</span><span class=\"token boolean important\">FALSE</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>extendedKeyUsage=serverAuth<span class=\"token punctuation\">,</span>clientAuth</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>keyUsage = critical<span class=\"token punctuation\">,</span> digitalSignature<span class=\"token punctuation\">,</span> keyEncipherment</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>subjectAltName = DNS<span class=\"token punctuation\">:</span>localhost<span class=\"token punctuation\">,</span> DNS<span class=\"token punctuation\">:</span>vault.dev.svc.cluster.local DNS<span class=\"token punctuation\">:</span>master<span class=\"token punctuation\">,</span> IP<span class=\"token punctuation\">:</span>127.0.0.1<span class=\"token punctuation\">,</span> IP<span class=\"token punctuation\">:</span>10.239.140.73</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>subjectKeyIdentifier=hash</pre></td></tr></table></figure><ul><li><strong><span class=\"blue\">subjectAltName</span></strong> 至少需要包含 <span class=\"blue\">DNS:vault.dev.svc.cluster.local</span> 和 IP:<span class=\"blue\">127.0.0.1</span>, 前者是用于集群间通信认证，后者是用于容器里带的 <span class=\"blude\">valut</span> 客户端初始化等操作时候的认证.</li></ul><h3 id=\"kesminio证书\"><a class=\"anchor\" href=\"#kesminio证书\">#</a> KES/minio 证书</h3><p>KES 和 minio 共用一样的密钥和证书，原因是目前没办法把 KES 证书挂载到 minio 容器，就先这样，后续会更新.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl ecparam -genkey -name prime256v1 <span class=\"token operator\">|</span> openssl ec -out private.key</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#生成 csr, 此处 CN 可以随便指定</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>openssl req -new  -key <span class=\"token string\">\"private.key\"</span> -out <span class=\"token string\">\"public.csr\"</span> -sha384 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        -subj <span class=\"token string\">'/C=US/ST=CA/L=China/O=Hce/CN=service'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>openssl x509 -req -days <span class=\"token number\">30</span>  -in <span class=\"token string\">\"public.csr\"</span> -CA <span class=\"token string\">\"root-ca.crt\"</span> -CAkey <span class=\"token string\">\"root-ca.key\"</span>  -CAcreateserial -out <span class=\"token string\">\"public.crt\"</span> -extfile <span class=\"token string\">\"minio-crt.conf\"</span> -extensions minio_server</pre></td></tr></table></figure><p><strong><span class=\"blue\">&quot;-extensions minio_server&quot;</span></strong> 指向 minio-crt.conf 配置文件中的 <strong><span class=\"blue\">[minio_server]</span></strong>.</p><p>minio-crt.conf 文件内容</p><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>minio_server<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>authorityKeyIdentifier=keyid<span class=\"token punctuation\">,</span>issuer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>basicConstraints = critical<span class=\"token punctuation\">,</span>CA<span class=\"token punctuation\">:</span><span class=\"token boolean important\">FALSE</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>extendedKeyUsage=serverAuth<span class=\"token punctuation\">,</span>clientAuth</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>keyUsage = critical<span class=\"token punctuation\">,</span> digitalSignature<span class=\"token punctuation\">,</span> keyEncipherment</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>subjectAltName = DNS<span class=\"token punctuation\">:</span>localhost<span class=\"token punctuation\">,</span> DNS<span class=\"token punctuation\">:</span><span class=\"token important\">*.minio-hl-svc.minio.svc.cluster.local</span><span class=\"token punctuation\">,</span> DNS<span class=\"token punctuation\">:</span>kes<span class=\"token punctuation\">-</span>svc.minio.svc.cluster.local<span class=\"token punctuation\">,</span> DNS<span class=\"token punctuation\">:</span>master<span class=\"token punctuation\">,</span> DNS<span class=\"token punctuation\">:</span>laboratory<span class=\"token punctuation\">,</span>IP<span class=\"token punctuation\">:</span>127.0.0.1<span class=\"token punctuation\">,</span> IP<span class=\"token punctuation\">:</span>10.239.140.73<span class=\"token punctuation\">,</span>IP<span class=\"token punctuation\">:</span>10.239.131.157</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>subjectKeyIdentifier=hash</pre></td></tr></table></figure><ul><li><strong><span class=\"blue\">subjectAltName</span></strong> 至少需要包含 <span class=\"blue\">DNS:*.minio-hl-svc.minio.svc.cluster.local</span>, <span class=\"blue\">DNS:kes-svc.minio.svc.cluster.local</span>, <span class=\"blue\">IP:127.0.0.1</span></li></ul><div class=\"note info\"><p><strong><span class=\"blue\">&quot;subjectAltName&quot;</span></strong> 表明此证书属于列出的服务 A 所属的域名和 IP, 服务 B 访问此服务 A 时，会将服务 A 的所属的域名和 IP 与服务 A 的有效证书中包含的域名和 IP 比较，一致或包含则验证通过.</p></div><p>拷贝一份密钥和证书给 KES 用.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cp</span> public.crt kes-server.crt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">cp</span> private.key kes-server.key</pre></td></tr></table></figure><h2 id=\"kmsvault\"><a class=\"anchor\" href=\"#kmsvault\">#</a> KMS(Vault)</h2><h3 id=\"部署consul\"><a class=\"anchor\" href=\"#部署consul\">#</a> 部署 consul</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># helm 添加 repo</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>helm del consul -n dev</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 查看所有 Vault 版本:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>helm search repo hashicorp/vault --versions</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 安装指定版本:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">(</span>reference<span class=\"token punctuation\">)</span>helm <span class=\"token function\">install</span> vault hashicorp/vault --namespace vault --version <span class=\"token number\">0.5</span>.0</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 安装默认最新版本</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>helm repo <span class=\"token function\">add</span> hashicorp https://helm.releases.hashicorp.com</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>helm repo update</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># 安装 local-storage-class</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">></span> <span class=\"token string\">\"local-storage.yaml\"</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre># Only create this for K8s 1.9+</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>apiVersion: storage.k8s.io/v1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>kind: StorageClass</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>metadata:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  name: local-storage</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>provisioner: kubernetes.io/no-provisioner</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>volumeBindingMode: WaitForFirstConsumer</pre></td></tr><tr><td data-num=\"21\"></td><td><pre># Supported policies: Delete, Retain</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>reclaimPolicy: Delete</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>EOF</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>kubectl apply -f local-storage.yaml</pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\"># 安装 consul</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>kubectl create namespace dev</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>kubectl apply -f pv-consul.yaml</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>helm <span class=\"token function\">install</span> consul hashicorp/consul -f consul-values.yaml --namespace dev</pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\"># Verify the Consul cluster</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>kubectl get po -n dev</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> -it consul-server-0 -n dev -- consul members</pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\"># 清理:</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>helm del consul -n dev</pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\"># 清理 pvc</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>kubectl delete pvc -l <span class=\"token assign-left variable\">app</span><span class=\"token operator\">=</span>consul -n dev</pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\"># 清理 pv</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>kubectl delete <span class=\"token function\">pv</span> -l <span class=\"token assign-left variable\">app</span><span class=\"token operator\">=</span>consul</pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\"># 清理 consul 在主机存储的文件</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\"># 登陆 master 机器</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token function\">rm</span> -rf /home/zhan/storage/minio/disks/local-pv-master-01/*</pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token function\">rm</span> -rf /home/zhan/storage/minio/disks/local-pv-master-01/*</pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\"># 登陆 laboratory 机器</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token function\">rm</span> -rf /home/zhan/storage/minio/disks/local-pv-laboratory-01/*</pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token function\">rm</span> -rf /home/zhan/storage/minio/disks/local-pv-laboratory-01/*</pre></td></tr></table></figure><h3 id=\"部署vault\"><a class=\"anchor\" href=\"#部署vault\">#</a> 部署 vault</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 创建 secret 资源</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl --namespace<span class=\"token operator\">=</span><span class=\"token string\">'dev'</span> create secret tls tls-ca --cert ./pki/root-ca.crt --key ./pki/root-ca.key</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>kubectl --namespace<span class=\"token operator\">=</span><span class=\"token string\">'dev'</span> create secret tls tls-server --cert ./pki/vault-server.crt --key ./pki/vault-server.key</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 安装</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>helm <span class=\"token function\">install</span> vault hashicorp/vault --namespace dev -f values.yaml</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>kubectl get pods --selector<span class=\"token operator\">=</span><span class=\"token string\">'app.kubernetes.io/name=vault'</span> --namespace<span class=\"token operator\">=</span><span class=\"token string\">'dev'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 初始化</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> -it vault-0 -n dev -- vault operator init</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  Unseal Key <span class=\"token number\">1</span>: +1/bK0rrP5ntXjvKXX2tsmsvb4HvKahE8jX+ht5IQiO4</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  Unseal Key <span class=\"token number\">2</span>: glBmkDM950AO0rl89ckI9M+HEE2zAnT8PVKOv7yxW55Z</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  Unseal Key <span class=\"token number\">3</span>: mJO6ULlGwaV+mxAyDC+mj+ggp0MFle0qhOdMiw8GSWMT</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  Unseal Key <span class=\"token number\">4</span>: 1pq9vUpAnRwMVufuCG1D6lxLKiseTZsgN+P2J0/qFfAl</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  Unseal Key <span class=\"token number\">5</span>: n/XARk8In6cxOtzjtO27h5AYL/JqPnst/a5oe6X/Zwty</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  Initial Root Token: s.vmMwIUVY8fMIIdXUB35uZvGD</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># 解封:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> -it vault-0 -n dev -- vault operator unseal +1/bK0rrP5ntXjvKXX2tsmsvb4HvKahE8jX+ht5IQiO4</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> -it vault-0 -n dev -- vault operator unseal glBmkDM950AO0rl89ckI9M+HEE2zAnT8PVKOv7yxW55Z</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> -it vault-0 -n dev -- vault operator unseal mJO6ULlGwaV+mxAyDC+mj+ggp0MFle0qhOdMiw8GSWMT</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># 查看解封状态</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> -it vault-0 -n dev -- vault status</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  Key             Value</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  ---             -----</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  Seal Type       shamir</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  Initialized     <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  Sealed          <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  Total Shares    <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  Threshold       <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  Version         <span class=\"token number\">1.6</span>.2</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  Storage Type    consul</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  Cluster Name    vault-cluster-a10c41b0</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  Cluster ID      3e10ba0e-0f81-6c2d-3ef6-3565713cdc62</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  HA Enabled      <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  HA Cluster      https://vault-0.vault-internal:8201</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  HA Mode         active</pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">(</span>optional<span class=\"token punctuation\">)</span><span class=\"token comment\"># 本地映射端口，如果需要在本地 vaule 客户端操作 k8s 集群中搭建的 vault 服务，需要再生成的 vault 证书里 [subjectAltName]&#123;.blue&#125; 字段加上 [本地主机域名]&#123;.blue&#125; 或 [本地主机 IP]&#123;.blue&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">(</span>optional<span class=\"token punctuation\">)</span>kubectl apply -f  nodePort-vault.yaml</pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\"># 使用:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> -it vault-0 -n dev -- /bin/sh -c <span class=\"token string\">\"export VAULT_TOKEN=s.vmMwIUVY8fMIIdXUB35uZvGD;vault secrets enable kv\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> -it vault-0 -n dev -- /bin/sh -c <span class=\"token string\">\"export VAULT_TOKEN=s.vmMwIUVY8fMIIdXUB35uZvGD;vault auth enable approle\"</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\"># 登陆 pod 容器</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> -it vault-0 -n dev -- /bin/sh</pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">></span> /tmp/minio-kes-policy.hcl <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>path \"kv/minio/*\" &#123;</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  capabilities = [ \"create\", \"read\", \"delete\" ]</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>&#125;</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>EOF</pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">VAULT_TOKEN</span><span class=\"token operator\">=</span>s.vmMwIUVY8fMIIdXUB35uZvGD</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>vault policy <span class=\"token function\">write</span> minio-key-policy /tmp/minio-kes-policy.hcl</pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>vault <span class=\"token function\">write</span> auth/approle/role/kes-role <span class=\"token assign-left variable\">token_num_uses</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>  <span class=\"token assign-left variable\">secret_id_num_uses</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>  <span class=\"token assign-left variable\">period</span><span class=\"token operator\">=</span>5m</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>vault <span class=\"token function\">write</span> auth/approle/role/kes-role <span class=\"token assign-left variable\">policies</span><span class=\"token operator\">=</span>minio-key-policy</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>vault <span class=\"token builtin class-name\">read</span> auth/approle/role/kes-role/role-id </pre></td></tr><tr><td data-num=\"63\"></td><td><pre>  Key        Value</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>  ---        -----</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  role_id    1e82b3a5-d935-dd04-a5cd-480ec74791d2</pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token comment\"># 如果下面启动 KES 服务出现 \"* Vault is sealed\" 错误， 需要重新获取 secret-id，并填写进 KES 配置文件</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>vault <span class=\"token function\">write</span> -f auth/approle/role/kes-role/secret-id    </pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  Key                   Value</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>  ---                   -----</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>  secret_id             c1625424-d82d-17cc-ac6d-84844306574c</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>  secret_id_accessor    cd6f5c1e-63f2-9b81-2637-56cb40a6c52b</pre></td></tr><tr><td data-num=\"73\"></td><td><pre></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token comment\"># Use the Vault CLI to inspect the K/V backend</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token comment\"># 在下面部署 KES 生成新的 key 后才能运行下面命令看到</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>vault kv list kv/</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>  Keys</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>  ----</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>  minio/</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>vault kv list kv/minio</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>  Keys</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>  ----</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>  minio-key-1</pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token comment\"># 退出 pod 容器</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token comment\"># 清理:</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>helm del vault -n dev</pre></td></tr><tr><td data-num=\"91\"></td><td><pre></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token comment\"># 清理 secret</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>kubectl delete secret tls-ca -n dev</pre></td></tr><tr><td data-num=\"94\"></td><td><pre>kubectl delete secret tls-server -n dev</pre></td></tr></table></figure><h3 id=\"pv-consulyaml\"><a class=\"anchor\" href=\"#pv-consulyaml\">#</a> pv-consul.yaml</h3><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolume</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> consul<span class=\"token punctuation\">-</span>local<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>master<span class=\"token punctuation\">-</span><span class=\"token number\">01</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> consul</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">capacity</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 10Gi</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">-</span> ReadWriteOnce</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">persistentVolumeReclaimPolicy</span><span class=\"token punctuation\">:</span> Delete</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> local<span class=\"token punctuation\">-</span>storage</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /home/zhan/storage/minio/disks/local<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>master<span class=\"token punctuation\">-</span><span class=\"token number\">01</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token key atrule\">nodeAffinity</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token key atrule\">nodeSelectorTerms</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matchExpressions</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> kubernetes.io/hostname</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>          <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> In</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>          <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          <span class=\"token punctuation\">-</span> master</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolume</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> consul<span class=\"token punctuation\">-</span>local<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>master<span class=\"token punctuation\">-</span><span class=\"token number\">02</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> consul</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token key atrule\">capacity</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 10Gi</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token punctuation\">-</span> ReadWriteOnce</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token key atrule\">persistentVolumeReclaimPolicy</span><span class=\"token punctuation\">:</span> Delete</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> local<span class=\"token punctuation\">-</span>storage</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /home/zhan/storage/minio/disks/local<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>master<span class=\"token punctuation\">-</span><span class=\"token number\">02</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token key atrule\">nodeAffinity</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token key atrule\">nodeSelectorTerms</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matchExpressions</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> kubernetes.io/hostname</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>          <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> In</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>          <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>          <span class=\"token punctuation\">-</span> master</pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolume</pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> consul<span class=\"token punctuation\">-</span>local<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>laboratory<span class=\"token punctuation\">-</span><span class=\"token number\">01</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> consul</pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token key atrule\">capacity</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 10Gi</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>  <span class=\"token punctuation\">-</span> ReadWriteOnce</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  <span class=\"token key atrule\">persistentVolumeReclaimPolicy</span><span class=\"token punctuation\">:</span> Delete</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> local<span class=\"token punctuation\">-</span>storage</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>  <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /home/zhan/storage/minio/disks/local<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>laboratory<span class=\"token punctuation\">-</span><span class=\"token number\">01</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>  <span class=\"token key atrule\">nodeAffinity</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>      <span class=\"token key atrule\">nodeSelectorTerms</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matchExpressions</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> kubernetes.io/hostname</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>          <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> In</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>          <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>          <span class=\"token punctuation\">-</span> laboratory</pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolume</pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> consul<span class=\"token punctuation\">-</span>local<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>laboratory<span class=\"token punctuation\">-</span><span class=\"token number\">02</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> consul</pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>  <span class=\"token key atrule\">capacity</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 10Gi</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>  <span class=\"token punctuation\">-</span> ReadWriteOnce</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>  <span class=\"token key atrule\">persistentVolumeReclaimPolicy</span><span class=\"token punctuation\">:</span> Delete</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> local<span class=\"token punctuation\">-</span>storage</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>  <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /home/zhan/storage/minio/disks/local<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>laboratory<span class=\"token punctuation\">-</span><span class=\"token number\">02</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>  <span class=\"token key atrule\">nodeAffinity</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>      <span class=\"token key atrule\">nodeSelectorTerms</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matchExpressions</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> kubernetes.io/hostname</pre></td></tr><tr><td data-num=\"93\"></td><td><pre>          <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> In</pre></td></tr><tr><td data-num=\"94\"></td><td><pre>          <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>          <span class=\"token punctuation\">-</span> laboratory</pre></td></tr></table></figure><h3 id=\"vault-nodeportyaml\"><a class=\"anchor\" href=\"#vault-nodeportyaml\">#</a> vault-nodeport.yaml</h3><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> vault<span class=\"token punctuation\">-</span>nodeport</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">app.kubernetes.io/instance</span><span class=\"token punctuation\">:</span> vault</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">app.kubernetes.io/name</span><span class=\"token punctuation\">:</span> vault</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">component</span><span class=\"token punctuation\">:</span> server</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\"># By default and for convenience, the `targetPort` is set to the same value as the `port` field.</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8200</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8200</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token comment\"># Optional field</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token comment\"># By default and for convenience, the Kubernetes control plane will allocate a port from a range (default: 30000-32767)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token key atrule\">nodePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30820</span></pre></td></tr></table></figure><h3 id=\"valuesyaml\"><a class=\"anchor\" href=\"#valuesyaml\">#</a> values.yaml</h3><p>Referencd Link: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hhc2hpY29ycC92YXVsdC1oZWxtL2Jsb2IvbWFzdGVyL3ZhbHVlcy55YW1s\">https://github.com/hashicorp/vault-helm/blob/master/values.yaml</span></p><figure class=\"highlight raw\"><figcaption data-lang=\"\"><span>w</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>global:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  enabled: true</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  imagePullSecrets: []</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  tlsDisable: false</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  openshift: false</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  psp:</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    enable: false</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    annotations: |</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      seccomp.security.alpha.kubernetes.io&#x2F;allowedProfileNames: docker&#x2F;default,runtime&#x2F;default</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      apparmor.security.beta.kubernetes.io&#x2F;allowedProfileNames: runtime&#x2F;default</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      seccomp.security.alpha.kubernetes.io&#x2F;defaultProfileName:  runtime&#x2F;default</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      apparmor.security.beta.kubernetes.io&#x2F;defaultProfileName:  runtime&#x2F;default</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>injector:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  enabled: true</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  replicas: 1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  leaderElector:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    enabled: true</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    image:</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      repository: &quot;gcr.io&#x2F;google_containers&#x2F;leader-elector&quot;</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      tag: &quot;0.4&quot;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    ttl: 60s</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  metrics:</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    enabled: false</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  externalVaultAddr: &quot;&quot;</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  image:</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    repository: &quot;hashicorp&#x2F;vault-k8s&quot;</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    tag: &quot;0.8.0&quot;</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    pullPolicy: IfNotPresent</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  agentImage:</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    repository: &quot;vault&quot;</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    tag: &quot;1.6.2&quot;</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  authPath: &quot;auth&#x2F;kubernetes&quot;</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  logLevel: &quot;info&quot;</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  logFormat: &quot;standard&quot;</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  revokeOnShutdown: false</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  namespaceSelector: &#123;&#125;</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  failurePolicy: Ignore</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  certs:</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    secretName: null</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    caBundle: &quot;&quot;</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    certName: tls.crt</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    keyName: tls.key</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  resources: &#123;&#125;</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  extraEnvironmentVars: &#123;&#125;</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  affinity: |</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    podAntiAffinity:</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      requiredDuringSchedulingIgnoredDuringExecution:</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        - labelSelector:</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            matchLabels:</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\n              app.kubernetes.io/name: {{ template \"vault.name\" . }}-agent-injector\n              app.kubernetes.io/instance: \"{{ .Release.Name }}\"\n</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>              component: webhook</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>          topologyKey: kubernetes.io&#x2F;hostname</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  tolerations: null</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  nodeSelector: null</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  priorityClassName: &quot;&quot;</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  annotations: &#123;&#125;</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  extraLabels: &#123;&#125;</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  service:</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    annotations: &#123;&#125;</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>server:</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  image:</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    repository: &quot;vault&quot;</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    tag: &quot;1.6.2&quot;</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    pullPolicy: IfNotPresent</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  updateStrategyType: &quot;OnDelete&quot;</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  resources: &#123;&#125;</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  ingress:</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    enabled: false</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    labels: &#123;&#125;</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    annotations: &#123;&#125;</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    hosts:</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>      - host: chart-example.local</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        paths: []</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    tls: []</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  route:</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    enabled: false</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    labels: &#123;&#125;</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    annotations: &#123;&#125;</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    host: chart-example.local</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>  authDelegator:</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    enabled: true</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>  extraInitContainers: null</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>  extraContainers: null</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>  shareProcessNamespace: false</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>  extraArgs: &quot;&quot;</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>  readinessProbe:</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    enabled: true</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    failureThreshold: 2</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    initialDelaySeconds: 5</pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    periodSeconds: 5</pre></td></tr><tr><td data-num=\"91\"></td><td><pre>    successThreshold: 1</pre></td></tr><tr><td data-num=\"92\"></td><td><pre>    timeoutSeconds: 3</pre></td></tr><tr><td data-num=\"93\"></td><td><pre>  livenessProbe:</pre></td></tr><tr><td data-num=\"94\"></td><td><pre>    enabled: false</pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    path: &quot;&#x2F;v1&#x2F;sys&#x2F;health?standbyok&#x3D;true&quot;</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>    failureThreshold: 2</pre></td></tr><tr><td data-num=\"97\"></td><td><pre>    initialDelaySeconds: 60</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>    periodSeconds: 5</pre></td></tr><tr><td data-num=\"99\"></td><td><pre>    successThreshold: 1</pre></td></tr><tr><td data-num=\"100\"></td><td><pre>    timeoutSeconds: 3</pre></td></tr><tr><td data-num=\"101\"></td><td><pre>  preStopSleepSeconds: 5</pre></td></tr><tr><td data-num=\"102\"></td><td><pre>  postStart: []</pre></td></tr><tr><td data-num=\"103\"></td><td><pre>  extraEnvironmentVars:</pre></td></tr><tr><td data-num=\"104\"></td><td><pre>    VAULT_CACERT: &#x2F;vault&#x2F;userconfig&#x2F;tls-ca&#x2F;tls.crt</pre></td></tr><tr><td data-num=\"105\"></td><td><pre>  extraSecretEnvironmentVars: [].</pre></td></tr><tr><td data-num=\"106\"></td><td><pre>  extraVolumes:</pre></td></tr><tr><td data-num=\"107\"></td><td><pre>    - type: secret</pre></td></tr><tr><td data-num=\"108\"></td><td><pre>      name: tls-server</pre></td></tr><tr><td data-num=\"109\"></td><td><pre>    - type: secret</pre></td></tr><tr><td data-num=\"110\"></td><td><pre>      name: tls-ca</pre></td></tr><tr><td data-num=\"111\"></td><td><pre>  volumes: null</pre></td></tr><tr><td data-num=\"112\"></td><td><pre>  volumeMounts: null</pre></td></tr><tr><td data-num=\"113\"></td><td><pre>  affinity: |</pre></td></tr><tr><td data-num=\"114\"></td><td><pre>    podAntiAffinity:</pre></td></tr><tr><td data-num=\"115\"></td><td><pre>      requiredDuringSchedulingIgnoredDuringExecution:</pre></td></tr><tr><td data-num=\"116\"></td><td><pre>        - labelSelector:</pre></td></tr><tr><td data-num=\"117\"></td><td><pre>            matchLabels:</pre></td></tr><tr><td data-num=\"118\"></td><td><pre>\n              app.kubernetes.io/name: {{ template \"vault.name\" . }}\n              app.kubernetes.io/instance: \"{{ .Release.Name }}\"\n</pre></td></tr><tr><td data-num=\"119\"></td><td><pre>              component: server</pre></td></tr><tr><td data-num=\"120\"></td><td><pre>          topologyKey: kubernetes.io&#x2F;hostname</pre></td></tr><tr><td data-num=\"121\"></td><td><pre>  tolerations: null</pre></td></tr><tr><td data-num=\"122\"></td><td><pre>  nodeSelector: null</pre></td></tr><tr><td data-num=\"123\"></td><td><pre>  networkPolicy:</pre></td></tr><tr><td data-num=\"124\"></td><td><pre>    enabled: false</pre></td></tr><tr><td data-num=\"125\"></td><td><pre>    egress: []</pre></td></tr><tr><td data-num=\"126\"></td><td><pre>  priorityClassName: &quot;&quot;</pre></td></tr><tr><td data-num=\"127\"></td><td><pre>  extraLabels: &#123;&#125;</pre></td></tr><tr><td data-num=\"128\"></td><td><pre>  annotations: &#123;&#125;</pre></td></tr><tr><td data-num=\"129\"></td><td><pre>  service:</pre></td></tr><tr><td data-num=\"130\"></td><td><pre>    enabled: true</pre></td></tr><tr><td data-num=\"131\"></td><td><pre>    port: 8200</pre></td></tr><tr><td data-num=\"132\"></td><td><pre>    targetPort: 8200</pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    annotations: &#123;&#125;</pre></td></tr><tr><td data-num=\"134\"></td><td><pre>  dataStorage:</pre></td></tr><tr><td data-num=\"135\"></td><td><pre>    enabled: true</pre></td></tr><tr><td data-num=\"136\"></td><td><pre>    size: 10Gi</pre></td></tr><tr><td data-num=\"137\"></td><td><pre>    mountPath: &quot;&#x2F;vault&#x2F;data&quot;</pre></td></tr><tr><td data-num=\"138\"></td><td><pre>    storageClass: local-storage</pre></td></tr><tr><td data-num=\"139\"></td><td><pre>    accessMode: ReadWriteOnce</pre></td></tr><tr><td data-num=\"140\"></td><td><pre>    annotations: &#123;&#125;</pre></td></tr><tr><td data-num=\"141\"></td><td><pre>  auditStorage:</pre></td></tr><tr><td data-num=\"142\"></td><td><pre>    enabled: false</pre></td></tr><tr><td data-num=\"143\"></td><td><pre>    size: 10Gi</pre></td></tr><tr><td data-num=\"144\"></td><td><pre>    mountPath: &quot;&#x2F;vault&#x2F;audit&quot;</pre></td></tr><tr><td data-num=\"145\"></td><td><pre>    storageClass: local-storage</pre></td></tr><tr><td data-num=\"146\"></td><td><pre>    accessMode: ReadWriteOnce</pre></td></tr><tr><td data-num=\"147\"></td><td><pre>    annotations: &#123;&#125;</pre></td></tr><tr><td data-num=\"148\"></td><td><pre>  dev:</pre></td></tr><tr><td data-num=\"149\"></td><td><pre>    enabled: false</pre></td></tr><tr><td data-num=\"150\"></td><td><pre>    devRootToken: &quot;root&quot;</pre></td></tr><tr><td data-num=\"151\"></td><td><pre>  standalone:</pre></td></tr><tr><td data-num=\"152\"></td><td><pre>    enabled: false</pre></td></tr><tr><td data-num=\"153\"></td><td><pre>    config: |</pre></td></tr><tr><td data-num=\"154\"></td><td><pre>      ui &#x3D; true</pre></td></tr><tr><td data-num=\"155\"></td><td><pre>      listener &quot;tcp&quot; &#123;</pre></td></tr><tr><td data-num=\"156\"></td><td><pre>        tls_disable &#x3D; 1</pre></td></tr><tr><td data-num=\"157\"></td><td><pre>        address &#x3D; &quot;[::]:8200&quot;</pre></td></tr><tr><td data-num=\"158\"></td><td><pre>        cluster_address &#x3D; &quot;[::]:8201&quot;</pre></td></tr><tr><td data-num=\"159\"></td><td><pre>      &#125;</pre></td></tr><tr><td data-num=\"160\"></td><td><pre>      storage &quot;file&quot; &#123;</pre></td></tr><tr><td data-num=\"161\"></td><td><pre>        path &#x3D; &quot;&#x2F;vault&#x2F;data&quot;</pre></td></tr><tr><td data-num=\"162\"></td><td><pre>      &#125;</pre></td></tr><tr><td data-num=\"163\"></td><td><pre>  ha:</pre></td></tr><tr><td data-num=\"164\"></td><td><pre>    enabled: true</pre></td></tr><tr><td data-num=\"165\"></td><td><pre>    replicas: 2</pre></td></tr><tr><td data-num=\"166\"></td><td><pre>    apiAddr: null</pre></td></tr><tr><td data-num=\"167\"></td><td><pre>    raft:</pre></td></tr><tr><td data-num=\"168\"></td><td><pre>      enabled: false</pre></td></tr><tr><td data-num=\"169\"></td><td><pre>      setNodeId: false</pre></td></tr><tr><td data-num=\"170\"></td><td><pre>      config: |</pre></td></tr><tr><td data-num=\"171\"></td><td><pre>        ui &#x3D; true</pre></td></tr><tr><td data-num=\"172\"></td><td><pre>        listener &quot;tcp&quot; &#123;</pre></td></tr><tr><td data-num=\"173\"></td><td><pre>          tls_disable &#x3D; 1</pre></td></tr><tr><td data-num=\"174\"></td><td><pre>          address &#x3D; &quot;[::]:8200&quot;</pre></td></tr><tr><td data-num=\"175\"></td><td><pre>          cluster_address &#x3D; &quot;[::]:8201&quot;</pre></td></tr><tr><td data-num=\"176\"></td><td><pre>        &#125;</pre></td></tr><tr><td data-num=\"177\"></td><td><pre>        storage &quot;raft&quot; &#123;</pre></td></tr><tr><td data-num=\"178\"></td><td><pre>          path &#x3D; &quot;&#x2F;vault&#x2F;data&quot;</pre></td></tr><tr><td data-num=\"179\"></td><td><pre>        &#125;</pre></td></tr><tr><td data-num=\"180\"></td><td><pre>        service_registration &quot;kubernetes&quot; &#123;&#125;</pre></td></tr><tr><td data-num=\"181\"></td><td><pre>    config: |</pre></td></tr><tr><td data-num=\"182\"></td><td><pre>      ui &#x3D; true</pre></td></tr><tr><td data-num=\"183\"></td><td><pre>      listener &quot;tcp&quot; &#123;</pre></td></tr><tr><td data-num=\"184\"></td><td><pre>        tls_disable &#x3D; 0</pre></td></tr><tr><td data-num=\"185\"></td><td><pre>        address &#x3D; &quot;[::]:8200&quot;</pre></td></tr><tr><td data-num=\"186\"></td><td><pre>        cluster_address &#x3D; &quot;[::]:8201&quot;</pre></td></tr><tr><td data-num=\"187\"></td><td><pre>        tls_cert_file &#x3D; &quot;&#x2F;vault&#x2F;userconfig&#x2F;tls-server&#x2F;tls.crt&quot;</pre></td></tr><tr><td data-num=\"188\"></td><td><pre>        tls_key_file &#x3D; &quot;&#x2F;vault&#x2F;userconfig&#x2F;tls-server&#x2F;tls.key&quot;</pre></td></tr><tr><td data-num=\"189\"></td><td><pre>        tls_ca_cert_file &#x3D; &quot;&#x2F;vault&#x2F;userconfig&#x2F;tls-ca&#x2F;tls.crt&quot;</pre></td></tr><tr><td data-num=\"190\"></td><td><pre>      &#125;</pre></td></tr><tr><td data-num=\"191\"></td><td><pre>      storage &quot;consul&quot; &#123;</pre></td></tr><tr><td data-num=\"192\"></td><td><pre>        path &#x3D; &quot;vault&quot;</pre></td></tr><tr><td data-num=\"193\"></td><td><pre>        address &#x3D; &quot;consul-server.dev:8500&quot;</pre></td></tr><tr><td data-num=\"194\"></td><td><pre>      &#125;</pre></td></tr><tr><td data-num=\"195\"></td><td><pre>      service_registration &quot;kubernetes&quot; &#123;&#125;</pre></td></tr><tr><td data-num=\"196\"></td><td><pre>    disruptionBudget:</pre></td></tr><tr><td data-num=\"197\"></td><td><pre>      enabled: true</pre></td></tr><tr><td data-num=\"198\"></td><td><pre>      maxUnavailable: null</pre></td></tr><tr><td data-num=\"199\"></td><td><pre>  serviceAccount:</pre></td></tr><tr><td data-num=\"200\"></td><td><pre>    create: true</pre></td></tr><tr><td data-num=\"201\"></td><td><pre>    name: &quot;&quot;</pre></td></tr><tr><td data-num=\"202\"></td><td><pre>    annotations: &#123;&#125;</pre></td></tr><tr><td data-num=\"203\"></td><td><pre>  statefulSet:</pre></td></tr><tr><td data-num=\"204\"></td><td><pre>    annotations: &#123;&#125;</pre></td></tr><tr><td data-num=\"205\"></td><td><pre>ui:</pre></td></tr><tr><td data-num=\"206\"></td><td><pre>  enabled: false</pre></td></tr><tr><td data-num=\"207\"></td><td><pre>  publishNotReadyAddresses: true</pre></td></tr><tr><td data-num=\"208\"></td><td><pre>  activeVaultPodOnly: false</pre></td></tr><tr><td data-num=\"209\"></td><td><pre>  serviceType: &quot;ClusterIP&quot;</pre></td></tr><tr><td data-num=\"210\"></td><td><pre>  serviceNodePort: null</pre></td></tr><tr><td data-num=\"211\"></td><td><pre>  externalPort: 8200</pre></td></tr><tr><td data-num=\"212\"></td><td><pre>  annotations: &#123;&#125;</pre></td></tr></table></figure><h3 id=\"consul-valuesyaml\"><a class=\"anchor\" href=\"#consul-valuesyaml\">#</a> consul-values.yaml</h3><figure class=\"highlight raw\"><figcaption data-lang=\"\"><span>w</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>global:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  enabled: true</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  name: consul</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  domain: consul</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  image: &quot;hashicorp&#x2F;consul:1.9.2&quot;</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  imagePullSecrets: []</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  imageK8S: &quot;hashicorp&#x2F;consul-k8s:0.23.0&quot;</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  datacenter: dc1</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  enablePodSecurityPolicies: false</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  gossipEncryption:</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    secretName: &quot;&quot;</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    secretKey: &quot;&quot;</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  tls:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    enabled: false</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    enableAutoEncrypt: false</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    serverAdditionalDNSSANs: []</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    serverAdditionalIPSANs: []</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    verify: true</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    httpsOnly: true</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    caCert:</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      secretName: null</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      secretKey: null</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    caKey:</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      secretName: null</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      secretKey: null</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  enableConsulNamespaces: false</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  acls:</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    manageSystemACLs: false</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    bootstrapToken:</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      secretName: null</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      secretKey: null</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    createReplicationToken: false</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    replicationToken:</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      # The name of the Kubernetes secret.</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      secretName: null</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      # The key of the Kubernetes secret.</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      secretKey: null</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  federation:</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    enabled: false</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    createFederationSecret: false</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  lifecycleSidecarContainer:</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    resources:</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      requests:</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        memory: &quot;25Mi&quot;</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        cpu: &quot;20m&quot;</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      limits:</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        memory: &quot;50Mi&quot;</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        cpu: &quot;20m&quot;</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  imageEnvoy: &quot;envoyproxy&#x2F;envoy-alpine:v1.16.0&quot;</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  openshift:</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    enabled: false</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>server:</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  enabled: &quot;-&quot;</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  image: null</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  replicas: 2</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  bootstrapExpect: null</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  enterpriseLicense:</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    secretName: null</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    secretKey: null</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  exposeGossipAndRPCPorts: false</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  ports:</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    serflan:</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      port: 8301</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>  storage: 4.9Gi</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  storageClass: local-storage</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  connect: true</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  resources:</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    requests:</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>      memory: &quot;100Mi&quot;</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>      cpu: &quot;100m&quot;</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    limits:</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>      memory: &quot;100Mi&quot;</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>      cpu: &quot;100m&quot;</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  securityContext:</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    runAsNonRoot: true</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    runAsGroup: 1000</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    runAsUser: 100</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    fsGroup: 1000</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>  updatePartition: 0</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>  disruptionBudget:</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    enabled: true</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>    maxUnavailable: null</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>  extraConfig: |</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>    &#123;&#125;</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>  extraVolumes: []</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>  affinity: |</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    podAntiAffinity:</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>      requiredDuringSchedulingIgnoredDuringExecution:</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        - labelSelector:</pre></td></tr><tr><td data-num=\"90\"></td><td><pre>            matchLabels:</pre></td></tr><tr><td data-num=\"91\"></td><td><pre>\n              app: {{ template \"consul.name\" . }}\n              release: \"{{ .Release.Name }}\"\n</pre></td></tr><tr><td data-num=\"92\"></td><td><pre>              component: server</pre></td></tr><tr><td data-num=\"93\"></td><td><pre>          topologyKey: kubernetes.io&#x2F;hostname</pre></td></tr><tr><td data-num=\"94\"></td><td><pre>  tolerations: &quot;&quot;</pre></td></tr><tr><td data-num=\"95\"></td><td><pre>  nodeSelector: null</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>  priorityClassName: &quot;&quot;</pre></td></tr><tr><td data-num=\"97\"></td><td><pre>  extraLabels: null</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>  annotations: null</pre></td></tr><tr><td data-num=\"99\"></td><td><pre>  service:</pre></td></tr><tr><td data-num=\"100\"></td><td><pre>    annotations: null</pre></td></tr><tr><td data-num=\"101\"></td><td><pre>  extraEnvironmentVars: &#123;&#125;</pre></td></tr><tr><td data-num=\"102\"></td><td><pre>externalServers:</pre></td></tr><tr><td data-num=\"103\"></td><td><pre>  enabled: false</pre></td></tr><tr><td data-num=\"104\"></td><td><pre>  hosts: []</pre></td></tr><tr><td data-num=\"105\"></td><td><pre>  httpsPort: 8501</pre></td></tr><tr><td data-num=\"106\"></td><td><pre>  tlsServerName: null</pre></td></tr></table></figure><h2 id=\"kes-2\"><a class=\"anchor\" href=\"#kes-2\">#</a> KES</h2><h3 id=\"配置\"><a class=\"anchor\" href=\"#配置\">#</a> 配置</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 获取 minio 证书 id</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kes tool identity of pki/public.crt</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> Identity:  03ebeb2c14c4584b7ba3b487ad2cef8a57b4a8e40fb5d1ffd163b887082058b9</pre></td></tr></table></figure><h3 id=\"kes-configyaml\"><a class=\"anchor\" href=\"#kes-configyaml\">#</a> kes-config.yaml</h3><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">address</span><span class=\"token punctuation\">:</span> 0.0.0.0<span class=\"token punctuation\">:</span><span class=\"token number\">7373</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">root</span><span class=\"token punctuation\">:</span>    disabled  <span class=\"token comment\"># We disable the root identity since we don't need it in this guide</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">tls</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span>  /pki/kes<span class=\"token punctuation\">-</span>server.key</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">cert</span><span class=\"token punctuation\">:</span> /pki/kes<span class=\"token punctuation\">-</span>server.crt</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">policy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">minio</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">-</span> /v1/key/create/minio<span class=\"token punctuation\">-</span>*</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">-</span> /v1/key/generate/minio<span class=\"token punctuation\">-</span>*</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">-</span> /v1/key/decrypt/minio<span class=\"token punctuation\">-</span>*</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">identities</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">&#123;</span>APP_IDENTITY<span class=\"token punctuation\">&#125;</span> <span class=\"token comment\"># $ 最好不要写成 03ebeb2c14c4584b7ba3b487ad2cef8a57b4a8e40fb5d1ffd163b887082058b9, 否则证书变了就必须重新 build image</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token key atrule\">expiry</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">any</span><span class=\"token punctuation\">:</span>    5m0s</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">unused</span><span class=\"token punctuation\">:</span> 20s</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token key atrule\">keys</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">vault</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">endpoint</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//vault.dev.svc.cluster.local<span class=\"token punctuation\">:</span><span class=\"token number\">8200</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">prefix</span><span class=\"token punctuation\">:</span> minio</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">approle</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>APP_ROLE_ID<span class=\"token punctuation\">&#125;</span> <span class=\"token comment\"># Your AppRole ID</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token key atrule\">secret</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>APP_SECRET_ID<span class=\"token punctuation\">&#125;</span> <span class=\"token comment\"># Your AppRole Secret ID</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token key atrule\">retry</span><span class=\"token punctuation\">:</span>  15s</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token key atrule\">status</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token key atrule\">ping</span><span class=\"token punctuation\">:</span> 10s</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token key atrule\">tls</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token key atrule\">ca</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/pki/vault-server.crt\"</span> <span class=\"token comment\"># Since we use self-signed certificates</span></pre></td></tr></table></figure><h3 id=\"构建kes-image\"><a class=\"anchor\" href=\"#构建kes-image\">#</a> 构建 KES image</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 构建 image</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docker build -t kes:0.1 --build-arg <span class=\"token assign-left variable\">HTTP_PROXY</span><span class=\"token operator\">=</span>http://child-prc.intel.com:913 --build-arg <span class=\"token assign-left variable\">HTTPS_PROXY</span><span class=\"token operator\">=</span>http://child-prc.intel.com:913 <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># image 拷贝到 laboratory 机器</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>docker save -o kes-0.1.tar kes:0.1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">scp</span> kes-0.1.tar root@10.239.131.157:/home/zhan/docker-images/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">ssh</span> root@10.239.131.157</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>docker load -i kes-0.1.tar</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr></table></figure><h3 id=\"部署kes\"><a class=\"anchor\" href=\"#部署kes\">#</a> 部署 KES</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 创建 namespace</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl create ns minio</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 创建 secret</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Reference:</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>https://github.com/minio/operator/blob/master/docs/tls.md  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>https://kubernetes.io/docs/concepts/configuration/secret/<span class=\"token comment\">#using-secrets  </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>kubectl create secret generic kes-crts --from-file<span class=\"token operator\">=</span>pki/private.key --from-file<span class=\"token operator\">=</span>pki/public.crt --from-file<span class=\"token operator\">=</span>pki/kes-server.crt --from-file<span class=\"token operator\">=</span>pki/kes-server.key --from-file<span class=\"token operator\">=</span>pki/vault-server.crt -n minio</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 部署 kes</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>kubectl apply -f kes-k8s.yaml</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 查看 log</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>kubectl logs -l <span class=\"token assign-left variable\">app</span><span class=\"token operator\">=</span>kes -n minio --tail<span class=\"token operator\">=</span>-1</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  Authenticating to Hashicorp Vault <span class=\"token string\">'https://vault.dev.svc.cluster.local:8200'</span> <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  Endpoint: https://127.0.0.1:7373        https://10.32.0.11:7373</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  Root:     _     <span class=\"token punctuation\">[</span> disabled <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  Auth:     off   <span class=\"token punctuation\">[</span> any client can connect but policies still apply <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  Keys:     Hashicorp Vault: https://vault.dev.svc.cluster.local:8200</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  CLI:      <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">KES_SERVER</span><span class=\"token operator\">=</span>https://127.0.0.1:7373</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">KES_CLIENT_KEY</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>client-private-key<span class=\"token operator\">></span>   // e.g. <span class=\"token environment constant\">$HOME</span>/root.key</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">KES_CLIENT_CERT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>client-certificate<span class=\"token operator\">></span>  // e.g. <span class=\"token environment constant\">$HOME</span>/root.cert</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            kes --help</pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\"># 创建主密钥</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span>kubectl get pod -l <span class=\"token assign-left variable\">app</span><span class=\"token operator\">=</span>kes -n minio -o <span class=\"token assign-left variable\">jsonpath</span><span class=\"token operator\">=</span><span class=\"token string\">'&#123;.items[0].metadata.name&#125;'</span><span class=\"token variable\">)</span></span>\"</span> -n minio -it -- /bin/bash</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">VAULT_SKIP_VERIFY</span><span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>./kes key create -k minio-key-1</pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#  Derive data keys from the previously created minio-key-1</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>./kes key derive -k minio-key-1</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    plaintext <span class=\"token builtin class-name\">:</span> <span class=\"token assign-left variable\">TPq3GqKMYx8Y1TrzhI8kyKMlKnqLZjcpw3HQ2MU1YIg</span><span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    ciphertext: <span class=\"token assign-left variable\">eyJhZWFkIjoiQUVTLTI1Ni1HQ00tSE1BQy1TSEEtMjU2IiwiaXYiOiJoOGRRbk9tSmdzRS9tQ0pDU21LdkV3PT0iLCJub25jZSI6Im0rNzdyTjBJMFRPT0Njd2YiLCJieXRlcyI6Imh5aDM5SVBXMEt3VGYxeEt6QWdSdTQ0QTlmSC9jQXR6ckNkWGk5TXo3My9EdkRxMXczTUZYaFlwVWNBVzVlbUYifQ</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\"># Decrypt data keys from the previously created minio-key-1</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\"># ./kes key decrypt -k my-app-key &lt;base64-ciphertext></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>./kes key decrypt -k minio-key-1 <span class=\"token assign-left variable\">eyJhZWFkIjoiQUVTLTI1Ni1HQ00tSE1BQy1TSEEtMjU2IiwiaXYiOiJoOGRRbk9tSmdzRS9tQ0pDU21LdkV3PT0iLCJub25jZSI6Im0rNzdyTjBJMFRPT0Njd2YiLCJieXRlcyI6Imh5aDM5SVBXMEt3VGYxeEt6QWdSdTQ0QTlmSC9jQXR6ckNkWGk5TXo3My9EdkRxMXczTUZYaFlwVWNBVzVlbUYifQ</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  plaintext: <span class=\"token assign-left variable\">TPq3GqKMYx8Y1TrzhI8kyKMlKnqLZjcpw3HQ2MU1YIg</span><span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\"># 退出 pod</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr></table></figure><div class=\"note primary\"><p><strong><span class=\"blue\">KES derive</span></strong> 命令的用法参考 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hhcnNoYXZhcmRoYW5hL2tlcyMzLWdlbmVyYXRlLWEtbmV3LWRhdGEtZW5jcnlwdGlvbi1rZXktZGVr\">KES Github</span><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pbmlvL2tlcy93aWtpL0dldHRpbmctU3RhcnRlZCMzMy1kZXJpdmUtYS1uZXctZGF0YS1rZXktcGxhaW50ZXh0Y2lwaGVydGV4dC1wYWly\">KES Github wiki</span></p></div><div class=\"note primary\"><p>Now, you can use that master key to derive a new data encryption key.<br>You will get a plaintext and a ciphertext data key. The ciphertext data key is the encrypted version of the plaintext key. Your application would use the plaintext key to e.g. encrypt some application data but only remember the ciphertext key version.</p></div><p>上面 KES derive 内容再结合 <strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pbi5pby9kb2NzL21pbmlvLXNlY3VyaXR5LW92ZXJ2aWV3Lmh0bWw=\">MinIO 官网</span></strong> 的 <strong><span class=\"blue\">Key rotation - Basic Operation</span></strong> 部分看.</p><h3 id=\"dockerfile\"><a class=\"anchor\" href=\"#dockerfile\">#</a> Dockerfile</h3><figure class=\"highlight docker\"><figcaption data-lang=\"docker\"><span>r</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">FROM</span> registry.access.redhat.com/ubi8/ubi<span class=\"token punctuation\">-</span>minimal<span class=\"token punctuation\">:</span>8.3</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">LABEL</span> name=<span class=\"token string\">\"MinIO\"</span> \\</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      vendor=<span class=\"token string\">\"MinIO Inc &lt;dev@min.io>\"</span> \\</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      maintainer=<span class=\"token string\">\"MinIO Inc &lt;dev@min.io>\"</span> \\</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      version=<span class=\"token string\">\"v0.13.4\"</span> \\</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      release=<span class=\"token string\">\"v0.13.4\"</span> \\</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      summary=<span class=\"token string\">\"KES is a stateless and distributed key-management system for high-performance applications.\"</span> \\</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      description=<span class=\"token string\">\"KES as the bridge between modern applications - running as containers on Kubernetes - and centralized KMS solutions. Therefore, KES has been designed to be simple, scalable and secure by default. It has just a few knobs to tweak instead of a complex configuration and does not require a deep understanding of secure key-management or cryptography.\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">ARG</span> HTTP_PROXY</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">ARG</span> HTTPS_PROXY</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">RUN</span> \\</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    microdnf update <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>nodocs &amp;&amp; \\</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    microdnf install ca<span class=\"token punctuation\">-</span>certificates <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>nodocs &amp;&amp; \\</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    microdnf clean all &amp;&amp; \\</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    mkdir /licenses &amp;&amp; \\</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    curl <span class=\"token punctuation\">-</span>s <span class=\"token punctuation\">-</span>q https<span class=\"token punctuation\">:</span>//raw.githubusercontent.com/minio/kes/master/CREDITS <span class=\"token punctuation\">-</span>o /licenses/CREDITS &amp;&amp; \\</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    curl <span class=\"token punctuation\">-</span>s <span class=\"token punctuation\">-</span>q https<span class=\"token punctuation\">:</span>//raw.githubusercontent.com/minio/kes/master/LICENSE <span class=\"token punctuation\">-</span>o /licenses/LICENSE</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">COPY</span> kes /kes</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">COPY</span> ./kes<span class=\"token punctuation\">-</span>config.yaml /kes<span class=\"token punctuation\">-</span>config.yaml</pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">ENV</span> VAULT_SKIP_VERIFY true</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">ENV</span> KES_CLIENT_CERT /pki/public.crt</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">ENV</span> KES_CLIENT_KEY /pki/private.key</pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">EXPOSE</span> 7373</pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">WORKDIR</span> /</pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">ENTRYPOINT</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/kes\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"server\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--config=kes-config.yaml\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--root=disabled\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--auth=off\"</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><h3 id=\"kes-k8syaml\"><a class=\"anchor\" href=\"#kes-k8syaml\">#</a> kes-k8s.yaml</h3><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> minio</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kes<span class=\"token punctuation\">-</span>svc</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kes</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7373</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7373</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> minio</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kes<span class=\"token punctuation\">-</span>svc<span class=\"token punctuation\">-</span>node</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kes</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7373</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7373</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token key atrule\">nodePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30737</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> minio</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kes</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kes</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kes</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kes</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kes</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> kes<span class=\"token punctuation\">:</span><span class=\"token number\">0.1</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> APP_IDENTITY</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> 03ebeb2c14c4584b7ba3b487ad2cef8a57b4a8e40fb5d1ffd163b887082058b9</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> APP_ROLE_ID</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> 1e82b3a5<span class=\"token punctuation\">-</span>d935<span class=\"token punctuation\">-</span>dd04<span class=\"token punctuation\">-</span>a5cd<span class=\"token punctuation\">-</span>480ec74791d2</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> APP_SECRET_ID</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> c1625424<span class=\"token punctuation\">-</span>d82d<span class=\"token punctuation\">-</span>17cc<span class=\"token punctuation\">-</span>ac6d<span class=\"token punctuation\">-</span>84844306574c</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7373</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kes<span class=\"token punctuation\">-</span>crts</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/pki\"</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kes<span class=\"token punctuation\">-</span>crts</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token key atrule\">secret</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>          <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> kes<span class=\"token punctuation\">-</span>crts</pre></td></tr></table></figure><h2 id=\"minio-2\"><a class=\"anchor\" href=\"#minio-2\">#</a> MinIO</h2><h3 id=\"磁盘分区\"><a class=\"anchor\" href=\"#磁盘分区\">#</a> 磁盘分区</h3><p>参考 linux parted 命令，如下将 /dev/sdb 磁盘分出 7 个 50GB 大小的磁盘分区.<br>如果系统上没有 <code>parted</code> 工具需要用 yum 或 apt-get 下载.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">parted</span> --script /dev/sdb <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    mklabel gpt <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    mkpart primary 4096s 51200MiB <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    mkpart primary 51200MiB 102400MiB  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    mkpart primary 102400MiB 153600MiB <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    mkpart primary 153600MiB 204800MiB <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    mkpart primary 204800MiB 256000MiB <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    mkpart primary 256000MiB 307200MiB <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    mkpart primary 307200MiB 358400MiB</pre></td></tr></table></figure><h3 id=\"mount磁盘\"><a class=\"anchor\" href=\"#mount磁盘\">#</a> mount 磁盘</h3><p>登陆到每台机器操作</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> -p /mnt/minio</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mount</span> /dev/sd* /mnt/minio</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> -p /mnt/minio/data</pre></td></tr></table></figure><div class=\"note info\"><p>mount 磁盘一定要在最初做，否则后边在部署 direct-csi 后再 mount 磁盘的话会导致 minio 数据存放不到 mount 到的磁盘.</p></div><h3 id=\"mkdir_minio_nodesh\"><a class=\"anchor\" href=\"#mkdir_minio_nodesh\">#</a> mkdir_minio_node.sh</h3><p>用来自动登陆 master 和 laboratory 机器创建文件夹.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#usecase: ./bash_shell_commands.sh -u &lt;username> -p &lt;pwd>  --node01 &lt;node01-ip> --node02 &lt;node02-ip> --node03 &lt;node03-ip> --node04=&lt;node04-ip></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#./mkdir_minio_node.sh -u root -p 123456 --node01 10.239.140.73 --node02 10.239.131.157</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">ARGS</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span>getopt -o u:p: --long username:,password:,node01_ip:,node02_ip:,node03_ip:,node04_ip:: -n <span class=\"token string\">'mkdir_node_minio.sh'</span> -- <span class=\"token string\">\"<span class=\"token variable\">$@</span>\"</span><span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$?</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Terminating...\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">eval</span> <span class=\"token builtin class-name\">set</span> -- <span class=\"token string\">\"<span class=\"token variable\">$&#123;ARGS&#125;</span>\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$&#123;ARGS&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">case</span> <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token keyword\">in</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                -u<span class=\"token operator\">|</span>--username<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                        <span class=\"token assign-left variable\">username</span><span class=\"token operator\">=</span><span class=\"token variable\">$2</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                        <span class=\"token builtin class-name\">shift</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                -p<span class=\"token operator\">|</span>--password<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        <span class=\"token assign-left variable\">password</span><span class=\"token operator\">=</span><span class=\"token variable\">$2</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                        <span class=\"token builtin class-name\">shift</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                --node01_ip<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                        <span class=\"token assign-left variable\">node01_ip</span><span class=\"token operator\">=</span><span class=\"token variable\">$2</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        <span class=\"token assign-left variable\">nodes</span><span class=\"token operator\">+=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$&#123;node01_ip&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        <span class=\"token builtin class-name\">shift</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                --node02_ip<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                        <span class=\"token assign-left variable\">node02_ip</span><span class=\"token operator\">=</span><span class=\"token variable\">$2</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                        <span class=\"token assign-left variable\">nodes</span><span class=\"token operator\">+=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$&#123;node02_ip&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                        <span class=\"token builtin class-name\">shift</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                --node03_ip<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                        <span class=\"token assign-left variable\">node03_ip</span><span class=\"token operator\">=</span><span class=\"token variable\">$2</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                        <span class=\"token assign-left variable\">nodes</span><span class=\"token operator\">+=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$&#123;node03_ip&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                        <span class=\"token builtin class-name\">shift</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                --node04_ip<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                        <span class=\"token keyword\">case</span> <span class=\"token string\">\"<span class=\"token variable\">$2</span>\"</span> <span class=\"token keyword\">in</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                                <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                                        <span class=\"token builtin class-name\">shift</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                                *<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                                        <span class=\"token assign-left variable\">node04_ip</span><span class=\"token operator\">=</span><span class=\"token variable\">$2</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                                        <span class=\"token assign-left variable\">nodes</span><span class=\"token operator\">+=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$&#123;node04_ip&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                                        <span class=\"token builtin class-name\">shift</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                        <span class=\"token keyword\">esac</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                        <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                --<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                        <span class=\"token builtin class-name\">shift</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                        <span class=\"token builtin class-name\">break</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                *<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Error!\"</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                        <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">esac</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">node</span> <span class=\"token keyword\">in</span> <span class=\"token variable\">$&#123;nodes<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span>&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token function\">expect</span> <span class=\"token operator\">&lt;&lt;-</span><span class=\"token string\">EOF</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>spawn ssh <span class=\"token variable\">$username</span>@<span class=\"token variable\">$&#123;node&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>expect &#123;</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        \"yes/no\" &#123; send \"yes<span class=\"token entity\" title=\"\\r\">\\r</span>\"; exp_continue &#125;</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        \"password\" &#123; send \"<span class=\"token variable\">$&#123;password&#125;</span><span class=\"token entity\" title=\"\\r\">\\r</span>\"; exp_continue &#125;</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        \"Last login\" &#123; send \"<span class=\"token entity\" title=\"\\r\">\\r</span>\" &#125;</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>&#125;</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>expect \"*#\"</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>send \"rm -rf /mnt/minio/data <span class=\"token entity\" title=\"\\r\">\\r</span>\"</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>send \"mkdir -p /mnt/minio/data <span class=\"token entity\" title=\"\\r\">\\r</span>\"</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>expect \"*#\"</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>send \"exit<span class=\"token entity\" title=\"\\r\">\\r</span>\"</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>expect \"eof\"</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>EOF</pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><h3 id=\"minioinstanceyaml\"><a class=\"anchor\" href=\"#minioinstanceyaml\">#</a> minioinstance.yaml</h3><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Secret</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>creds<span class=\"token punctuation\">-</span>secret</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Opaque</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">accesskey</span><span class=\"token punctuation\">:</span> aGNlbWluaW8= <span class=\"token comment\"># base 64 encoded \"hceminio\" (echo -n 'hceminio' | base64)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">secretkey</span><span class=\"token punctuation\">:</span> aGNlbWluaW8xMjM= <span class=\"token comment\"># based 64 encoded \"hceminio123\" (echo -n 'hceminio123' | base64)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>service</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9000</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9000</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> minio</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> operator.min.io/v1</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> MinIOInstance</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> minio</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token key atrule\">prometheus.io/path</span><span class=\"token punctuation\">:</span> /minio/prometheus/metrics</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token key atrule\">prometheus.io/port</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"9000\"</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token key atrule\">prometheus.io/scrape</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> minio/minio<span class=\"token punctuation\">:</span>RELEASE.2020<span class=\"token punctuation\">-</span>06<span class=\"token punctuation\">-</span>18T02<span class=\"token punctuation\">-</span>23<span class=\"token punctuation\">-</span>35Z</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>internal<span class=\"token punctuation\">-</span>service</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token key atrule\">zones</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"zone-0\"</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token key atrule\">servers</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token key atrule\">volumesPerServer</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /export</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token key atrule\">volumeClaimTemplate</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> data</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token punctuation\">-</span> ReadWriteOnce</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>          <span class=\"token comment\">#storage: 1Ti</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>          <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 1Gi</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> direct.csi.min.io</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token key atrule\">credsSecret</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>creds<span class=\"token punctuation\">-</span>secret</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token key atrule\">podManagementPolicy</span><span class=\"token punctuation\">:</span> Parallel</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  <span class=\"token key atrule\">externalCertSecret</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> tls<span class=\"token punctuation\">-</span>ssl<span class=\"token punctuation\">-</span>minio</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>  <span class=\"token key atrule\">requestAutoCert</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  <span class=\"token key atrule\">certConfig</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token key atrule\">commonName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token key atrule\">organizationName</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token key atrule\">dnsNames</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>  <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MINIO_KMS_KES_ENDPOINT</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>      <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//kes<span class=\"token punctuation\">-</span>svc.minio.svc.cluster.local<span class=\"token punctuation\">:</span><span class=\"token number\">7373</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MINIO_KMS_KES_KEY_FILE</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>      <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> /tmp/certs/private.key</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MINIO_KMS_KES_CERT_FILE</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>      <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> /tmp/certs/public.crt</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MINIO_KMS_KES_KEY_NAME    <span class=\"token comment\"># 要根 KES 创建的 master key 一致</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>      <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>key<span class=\"token punctuation\">-</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MINIO_KMS_KES_CA_PATH</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>      <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> /tmp/certs/public.crt</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  <span class=\"token key atrule\">liveness</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr></table></figure><h3 id=\"minio-operatoryaml\"><a class=\"anchor\" href=\"#minio-operatoryaml\">#</a> minio-operator.yaml</h3><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apiextensions.k8s.io/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> CustomResourceDefinition</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minioinstances.operator.min.io</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> operator.min.io</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">scope</span><span class=\"token punctuation\">:</span> Namespaced</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">names</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> MinIOInstance</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">singular</span><span class=\"token punctuation\">:</span> minioinstance</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">plural</span><span class=\"token punctuation\">:</span> minioinstances</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">versions</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">served</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">schema</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token comment\"># openAPIV3Schema is the schema for validating custom objects.</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token comment\"># Refer https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/#specifying-a-structural-schema</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token comment\"># for more details</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token key atrule\">openAPIV3Schema</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> object</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>          <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>              <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> object</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>              <span class=\"token key atrule\">x-kubernetes-preserve-unknown-fields</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>              <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> integer</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                  <span class=\"token key atrule\">minimum</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                  <span class=\"token key atrule\">maximum</span><span class=\"token punctuation\">:</span> <span class=\"token number\">32</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token key atrule\">volumesPerServer</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> integer</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token key atrule\">podManagementPolicy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                  <span class=\"token key atrule\">enum</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>Parallel<span class=\"token punctuation\">,</span>OrderedReady<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                  <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> Parallel</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token key atrule\">requestAutoCert</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> boolean</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                  <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token key atrule\">mountpath</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token key atrule\">subpath</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token key atrule\">mcs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> object</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                  <span class=\"token key atrule\">x-kubernetes-preserve-unknown-fields</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                  <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                    <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> integer</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                      <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                    <span class=\"token key atrule\">mcsSecret</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> object</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                      <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token key atrule\">kes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> object</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                  <span class=\"token key atrule\">x-kubernetes-preserve-unknown-fields</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                  <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                    <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> integer</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                      <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                    <span class=\"token key atrule\">kesSecret</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> object</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                      <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>            <span class=\"token key atrule\">status</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>              <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> object</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>              <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                <span class=\"token key atrule\">currentState</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>      <span class=\"token key atrule\">subresources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>        <span class=\"token comment\"># status enables the status subresource.</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        <span class=\"token key atrule\">status</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>      <span class=\"token key atrule\">additionalPrinterColumns</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Current State</pre></td></tr><tr><td data-num=\"90\"></td><td><pre>          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string</pre></td></tr><tr><td data-num=\"91\"></td><td><pre>          <span class=\"token key atrule\">jsonPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\".status.currentState\"</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1beta1</pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole</pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>operator<span class=\"token punctuation\">-</span>role</pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>  <span class=\"token punctuation\">-</span> namespaces</pre></td></tr><tr><td data-num=\"102\"></td><td><pre>  <span class=\"token punctuation\">-</span> secrets</pre></td></tr><tr><td data-num=\"103\"></td><td><pre>  <span class=\"token punctuation\">-</span> pods</pre></td></tr><tr><td data-num=\"104\"></td><td><pre>  <span class=\"token punctuation\">-</span> services</pre></td></tr><tr><td data-num=\"105\"></td><td><pre>  <span class=\"token punctuation\">-</span> events</pre></td></tr><tr><td data-num=\"106\"></td><td><pre>  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>  <span class=\"token punctuation\">-</span> get</pre></td></tr><tr><td data-num=\"108\"></td><td><pre>  <span class=\"token punctuation\">-</span> watch</pre></td></tr><tr><td data-num=\"109\"></td><td><pre>  <span class=\"token punctuation\">-</span> create</pre></td></tr><tr><td data-num=\"110\"></td><td><pre>  <span class=\"token punctuation\">-</span> list</pre></td></tr><tr><td data-num=\"111\"></td><td><pre>  <span class=\"token punctuation\">-</span> delete</pre></td></tr><tr><td data-num=\"112\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>  <span class=\"token punctuation\">-</span> apps</pre></td></tr><tr><td data-num=\"114\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>  <span class=\"token punctuation\">-</span> statefulsets</pre></td></tr><tr><td data-num=\"116\"></td><td><pre>  <span class=\"token punctuation\">-</span> deployments</pre></td></tr><tr><td data-num=\"117\"></td><td><pre>  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>  <span class=\"token punctuation\">-</span> get</pre></td></tr><tr><td data-num=\"119\"></td><td><pre>  <span class=\"token punctuation\">-</span> create</pre></td></tr><tr><td data-num=\"120\"></td><td><pre>  <span class=\"token punctuation\">-</span> list</pre></td></tr><tr><td data-num=\"121\"></td><td><pre>  <span class=\"token punctuation\">-</span> patch</pre></td></tr><tr><td data-num=\"122\"></td><td><pre>  <span class=\"token punctuation\">-</span> watch</pre></td></tr><tr><td data-num=\"123\"></td><td><pre>  <span class=\"token punctuation\">-</span> update</pre></td></tr><tr><td data-num=\"124\"></td><td><pre>  <span class=\"token punctuation\">-</span> delete</pre></td></tr><tr><td data-num=\"125\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>  <span class=\"token punctuation\">-</span> batch</pre></td></tr><tr><td data-num=\"127\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>  <span class=\"token punctuation\">-</span> jobs</pre></td></tr><tr><td data-num=\"129\"></td><td><pre>  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>  <span class=\"token punctuation\">-</span> get</pre></td></tr><tr><td data-num=\"131\"></td><td><pre>  <span class=\"token punctuation\">-</span> create</pre></td></tr><tr><td data-num=\"132\"></td><td><pre>  <span class=\"token punctuation\">-</span> list</pre></td></tr><tr><td data-num=\"133\"></td><td><pre>  <span class=\"token punctuation\">-</span> patch</pre></td></tr><tr><td data-num=\"134\"></td><td><pre>  <span class=\"token punctuation\">-</span> watch</pre></td></tr><tr><td data-num=\"135\"></td><td><pre>  <span class=\"token punctuation\">-</span> update</pre></td></tr><tr><td data-num=\"136\"></td><td><pre>  <span class=\"token punctuation\">-</span> delete</pre></td></tr><tr><td data-num=\"137\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"certificates.k8s.io\"</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"certificatesigningrequests\"</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"certificatesigningrequests/approval\"</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"certificatesigningrequests/status\"</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>  <span class=\"token punctuation\">-</span> update</pre></td></tr><tr><td data-num=\"145\"></td><td><pre>  <span class=\"token punctuation\">-</span> create</pre></td></tr><tr><td data-num=\"146\"></td><td><pre>  <span class=\"token punctuation\">-</span> get</pre></td></tr><tr><td data-num=\"147\"></td><td><pre>  <span class=\"token punctuation\">-</span> delete</pre></td></tr><tr><td data-num=\"148\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>  <span class=\"token punctuation\">-</span> operator.min.io</pre></td></tr><tr><td data-num=\"150\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"*\"</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"*\"</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>  <span class=\"token punctuation\">-</span> min.io</pre></td></tr><tr><td data-num=\"156\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"*\"</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"*\"</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"162\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"163\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>operator</pre></td></tr><tr><td data-num=\"165\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> minio</pre></td></tr><tr><td data-num=\"166\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRoleBinding</pre></td></tr><tr><td data-num=\"168\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1beta1</pre></td></tr><tr><td data-num=\"169\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>operator<span class=\"token punctuation\">-</span>binding</pre></td></tr><tr><td data-num=\"171\"></td><td><pre><span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre>  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io</pre></td></tr><tr><td data-num=\"173\"></td><td><pre>  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole</pre></td></tr><tr><td data-num=\"174\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>operator<span class=\"token punctuation\">-</span>role</pre></td></tr><tr><td data-num=\"175\"></td><td><pre><span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"177\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>operator</pre></td></tr><tr><td data-num=\"178\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> minio</pre></td></tr><tr><td data-num=\"179\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"181\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"182\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>operator</pre></td></tr><tr><td data-num=\"184\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> minio</pre></td></tr><tr><td data-num=\"185\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>operator</pre></td></tr><tr><td data-num=\"190\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>operator</pre></td></tr><tr><td data-num=\"194\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>      <span class=\"token key atrule\">serviceAccountName</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>operator</pre></td></tr><tr><td data-num=\"196\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>operator</pre></td></tr><tr><td data-num=\"198\"></td><td><pre>          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> minio/k8s<span class=\"token punctuation\">-</span>operator<span class=\"token punctuation\">:</span>2.0.6</pre></td></tr><tr><td data-num=\"199\"></td><td><pre>          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent</pre></td></tr><tr><td data-num=\"200\"></td><td><pre>          <span class=\"token comment\"># To specify cluster domain, un comment the following:</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre>          <span class=\"token comment\"># env:</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre>          <span class=\"token comment\">#   - name: CLUSTER_DOMAIN</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre>          <span class=\"token comment\">#     value: mycluster.mydomain</span></pre></td></tr></table></figure><h3 id=\"direct-csi\"><a class=\"anchor\" href=\"#direct-csi\">#</a> direct-csi</h3><p>用来自动生成 pv</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> default.env</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token assign-left variable\">DIRECT_CSI_DRIVES</span><span class=\"token operator\">=</span>data  <span class=\"token comment\"># minio 数据存放位置</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token assign-left variable\">DIRECT_CSI_DRIVES_DIR</span><span class=\"token operator\">=</span>/mnt/minio  <span class=\"token comment\"># direct-csi 的一些控制组件存放路径</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token assign-left variable\">KUBELET_DIR_PATH</span><span class=\"token operator\">=</span>/var/lib/kubelet</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">git</span> clone https://github.com/minio/direct-csi.git</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token builtin class-name\">cd</span> direct-csi/</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">git</span> checkout v0.2.1</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token builtin class-name\">cd</span> <span class=\"token punctuation\">..</span>/</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">cat</span> default.env<span class=\"token variable\">)</span></span></pre></td></tr></table></figure><h3 id=\"搭建minio\"><a class=\"anchor\" href=\"#搭建minio\">#</a> 搭建 minio</h3><p>vim build_minio.sh</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>kubectl create ns minio</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>kubectl create secret generic tls-ssl-minio --from-file<span class=\"token operator\">=</span>pki/private.key --from-file<span class=\"token operator\">=</span>pki/public.crt -n minio</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># Create key and crt</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>:<span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">block</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>rm -rf pki</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>mkdir pki -p</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>openssl genrsa -out pki/private.key 2048</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>sleep 1</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>openssl req -new -x509 -days 3650 -key pki/private.key -out pki/public.crt -subj \"/C=US/ST=state/L=location/O=organization/CN=*.minio-hl-svc.minio.svc.cluster.local\"</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>sleep 1</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>block</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># Using Direct CSI Driver</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#cat &lt;&lt; EOF > default.env</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">## 这种写法表示一个 minio server 挂载 4 个 volume, 如果想挂载一个 volume 就不要写成这样，直接写成下面的 `data`</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#DIRECT_CSI_DRIVES=data&#123;1...4&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#DIRECT_CSI_DRIVES_DIR=/mnt/minio</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#EOF</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">EOF<span class=\"token bash punctuation\"> <span class=\"token operator\">></span> default.env</span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>DIRECT_CSI_DRIVES=data</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>DIRECT_CSI_DRIVES_DIR=/mnt/minio</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>EOF</pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">cat</span> default.env<span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>kubectl apply -k direct-csi</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token function\">sleep</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># Create Operator Deployment</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>kubectl apply -f minio-operator.yaml -n minio</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>kubectl apply -f minioinstance.yaml -n minio</pre></td></tr></table></figure><h3 id=\"nodeport-minioyaml\"><a class=\"anchor\" href=\"#nodeport-minioyaml\">#</a> nodePort-minio.yaml</h3><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> minio<span class=\"token punctuation\">-</span>service<span class=\"token punctuation\">-</span>nodeport</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> minio</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9000</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9000</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">nodePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30007</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> minio</pre></td></tr></table></figure><h3 id=\"clean\"><a class=\"anchor\" href=\"#clean\">#</a> clean</h3><p>vim <span class=\"exturl\" data-url=\"aHR0cDovL2NsZWFuLnNo\">clean.sh</span></p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># delete minio pod</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>kubectl delete -f minioinstance.yaml -n minio</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># delete pvc</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">pvc_results</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>kubectl get pvc -n minio <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> minio <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'&#123;print <span class=\"token variable\">$1</span>&#125;'</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">pvc_arr</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$&#123;pvc_results&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token variable\"><span class=\"token punctuation\">((</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>$&#123;#pvc_arr[<span class=\"token operator\">*</span>]&#125;<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span> <span class=\"token punctuation\">))</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>kubectl delete pvc <span class=\"token variable\">$&#123;pvc_arr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>&#125;</span> -n minio</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># delete pv</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token assign-left variable\">pv_results</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>kubectl get <span class=\"token function\">pv</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> minio <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'&#123;print <span class=\"token variable\">$1</span>&#125;'</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token assign-left variable\">pv_arr</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$&#123;pv_results&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token variable\"><span class=\"token punctuation\">((</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>$&#123;#pv_arr[<span class=\"token operator\">*</span>]&#125;<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span> <span class=\"token punctuation\">))</span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>kubectl delete <span class=\"token function\">pv</span> <span class=\"token variable\">$&#123;pv_arr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\"># delete minio operator</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>kubectl delete -f minio-operator.yaml -n minio</pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\"># delete minio sc</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>kubectl delete -k direct-csi</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># 登陆到每台机器删除 direct-csi 插件</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token function\">rm</span> -rf /var/lib/kubelet/plugins/direct-*</pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token function\">rm</span> -rf /var/lib/kubelet/plugins_registry/direct.csi.min.io-reg.sock</pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># delete secret</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>kubectl delete secret tls-ssl-minio -n minio</pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\"># delete ns</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>kubectl delete ns minio</pre></td></tr></table></figure><h3 id=\"清理direct-csi-host上文件\"><a class=\"anchor\" href=\"#清理direct-csi-host上文件\">#</a> 清理 direct-csi Host 上文件</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">rm</span> -rf /var/lib/kubelet/plugins/direct-csi-*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">rm</span> -rf /var/lib/kubelet/plugins_registry/direct.csi.min.io-reg.sock</pre></td></tr></table></figure><h2 id=\"mc实例\"><a class=\"anchor\" href=\"#mc实例\">#</a> mc 实例</h2><h3 id=\"加密minio数据\"><a class=\"anchor\" href=\"#加密minio数据\">#</a> 加密 minio 数据</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 查看 minio host 列表</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>./mc config <span class=\"token function\">host</span> list</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 本地创建 minio 服务地址</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>./mc <span class=\"token builtin class-name\">alias</span> <span class=\"token builtin class-name\">set</span> hceminio https://10.239.140.73:30007 hceminio hceminio123 --insecure</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 上传数据加密</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>./mc mb hceminio/test01 --insecure</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>./mc encrypt <span class=\"token builtin class-name\">set</span> sse-s3 hceminio/test01 --insecure</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>./mc encrypt info hceminio/test01 --insecure</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>./mc <span class=\"token function\">cp</span> k8s.jpg hceminio/test01 --insecure</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>./mc <span class=\"token function\">stat</span> hceminio/test01/k8s.jpg --insecure</pre></td></tr></table></figure><h3 id=\"查看key\"><a class=\"anchor\" href=\"#查看key\">#</a> 查看 key</h3><p>Reference Link: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pbmlvL21jL2Jsb2IvbWFzdGVyL2RvY3MvbWluaW8tYWRtaW4tY29tcGxldGUtZ3VpZGUubWQ=\">https://github.com/minio/mc/blob/master/docs/minio-admin-complete-guide.md</span><br>Display status information for the default master key.</p><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./mc admin kms key status hceminio --insecure</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  Key: minio-key-1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     - Encryption ✔</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     - Decryption ✔</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>./mc admin kms key status hceminio minio-key-1 --insecure</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  Key: minio-key-1</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>           • Encryption ✔</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>           • Decryption ✔</pre></td></tr></table></figure><h3 id=\"查看minio日志\"><a class=\"anchor\" href=\"#查看minio日志\">#</a> 查看 minio 日志</h3><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./mc admin console hceminio --insecure</pre></td></tr></table></figure><!-- rebuild by hrmmi -->",
            "tags": [
                "storage",
                "minio",
                "storage"
            ]
        }
    ]
}